(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.Libp2PWebrtc = factory()}(typeof self !== 'undefined' ? self : this, function () {
"use strict";var Libp2PWebrtc=(()=>{var Y_=Object.create;var Ku=Object.defineProperty;var J_=Object.getOwnPropertyDescriptor;var Q_=Object.getOwnPropertyNames;var eS=Object.getPrototypeOf,tS=Object.prototype.hasOwnProperty;var zp=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),St=(r,e)=>{for(var t in e)Ku(r,t,{get:e[t],enumerable:!0})},Sg=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Q_(e))!tS.call(r,o)&&o!==t&&Ku(r,o,{get:()=>e[o],enumerable:!(n=J_(e,o))||n.enumerable});return r};var $r=(r,e,t)=>(t=r!=null?Y_(eS(r)):{},Sg(e||!r||!r.__esModule?Ku(t,"default",{value:r,enumerable:!0}):t,r)),rS=r=>Sg(Ku({},"__esModule",{value:!0}),r);var Lb=zp(()=>{var Rb;(function(r){(function(e){var t=typeof globalThis=="object"||typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof this=="object"?this:a(),n=o(r);typeof t.Reflect<"u"&&(n=o(t.Reflect,n)),e(n,t),typeof t.Reflect>"u"&&(t.Reflect=r);function o(c,l){return function(f,p){Object.defineProperty(c,f,{configurable:!0,writable:!0,value:p}),l&&l(f,p)}}function i(){try{return Function("return this;")()}catch{}}function s(){try{return(0,eval)("(function() { return this; })()")}catch{}}function a(){return i()||s()}})(function(e,t){var n=Object.prototype.hasOwnProperty,o=typeof Symbol=="function",i=o&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",s=o&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",a=typeof Object.create=="function",c={__proto__:[]}instanceof Array,l=!a&&!c,f={create:a?function(){return qp(Object.create(null))}:c?function(){return qp({__proto__:null})}:function(){return qp({})},has:l?function(b,S){return n.call(b,S)}:function(b,S){return S in b},get:l?function(b,S){return n.call(b,S)?b[S]:void 0}:function(b,S){return b[S]}},p=Object.getPrototypeOf(Function),y=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:G_(),m=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:q_(),x=typeof WeakMap=="function"?WeakMap:z_(),v=o?Symbol.for("@reflect-metadata:registry"):void 0,d=$_(),I=F_(d);function D(b,S,k,F){if(U(k)){if(!ir(b))throw new TypeError;if(!mg(S))throw new TypeError;return O(b,S)}else{if(!ir(b))throw new TypeError;if(!se(S))throw new TypeError;if(!se(F)&&!U(F)&&!de(F))throw new TypeError;return de(F)&&(F=void 0),k=lt(k),B(b,S,k,F)}}e("decorate",D);function j(b,S){function k(F,ce){if(!se(F))throw new TypeError;if(!U(ce)&&!H_(ce))throw new TypeError;X(b,S,F,ce)}return k}e("metadata",j);function Z(b,S,k,F){if(!se(k))throw new TypeError;return U(F)||(F=lt(F)),X(b,S,k,F)}e("defineMetadata",Z);function P(b,S,k){if(!se(S))throw new TypeError;return U(k)||(k=lt(k)),R(b,S,k)}e("hasMetadata",P);function M(b,S,k){if(!se(S))throw new TypeError;return U(k)||(k=lt(k)),N(b,S,k)}e("hasOwnMetadata",M);function V(b,S,k){if(!se(S))throw new TypeError;return U(k)||(k=lt(k)),L(b,S,k)}e("getMetadata",V);function K(b,S,k){if(!se(S))throw new TypeError;return U(k)||(k=lt(k)),W(b,S,k)}e("getOwnMetadata",K);function g(b,S){if(!se(b))throw new TypeError;return U(S)||(S=lt(S)),G(b,S)}e("getMetadataKeys",g);function T(b,S){if(!se(b))throw new TypeError;return U(S)||(S=lt(S)),ie(b,S)}e("getOwnMetadataKeys",T);function E(b,S,k){if(!se(S))throw new TypeError;if(U(k)||(k=lt(k)),!se(S))throw new TypeError;U(k)||(k=lt(k));var F=va(S,k,!1);return U(F)?!1:F.OrdinaryDeleteMetadata(b,S,k)}e("deleteMetadata",E);function O(b,S){for(var k=b.length-1;k>=0;--k){var F=b[k],ce=F(S);if(!U(ce)&&!de(ce)){if(!mg(ce))throw new TypeError;S=ce}}return S}function B(b,S,k,F){for(var ce=b.length-1;ce>=0;--ce){var ze=b[ce],nt=ze(S,k,F);if(!U(nt)&&!de(nt)){if(!se(nt))throw new TypeError;F=nt}}return F}function R(b,S,k){var F=N(b,S,k);if(F)return!0;var ce=Gp(S);return de(ce)?!1:R(b,ce,k)}function N(b,S,k){var F=va(S,k,!1);return U(F)?!1:tt(F.OrdinaryHasOwnMetadata(b,S,k))}function L(b,S,k){var F=N(b,S,k);if(F)return W(b,S,k);var ce=Gp(S);if(!de(ce))return L(b,ce,k)}function W(b,S,k){var F=va(S,k,!1);if(!U(F))return F.OrdinaryGetOwnMetadata(b,S,k)}function X(b,S,k,F){var ce=va(k,F,!0);ce.OrdinaryDefineOwnMetadata(b,S,k,F)}function G(b,S){var k=ie(b,S),F=Gp(b);if(F===null)return k;var ce=G(F,S);if(ce.length<=0)return k;if(k.length<=0)return ce;for(var ze=new m,nt=[],ge=0,J=k;ge<J.length;ge++){var ee=J[ge],re=ze.has(ee);re||(ze.add(ee),nt.push(ee))}for(var ne=0,we=ce;ne<we.length;ne++){var ee=we[ne],re=ze.has(ee);re||(ze.add(ee),nt.push(ee))}return nt}function ie(b,S){var k=va(b,S,!1);return k?k.OrdinaryOwnMetadataKeys(b,S):[]}function Y(b){if(b===null)return 1;switch(typeof b){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return b===null?1:6;default:return 6}}function U(b){return b===void 0}function de(b){return b===null}function Oe(b){return typeof b=="symbol"}function se(b){return typeof b=="object"?b!==null:typeof b=="function"}function De(b,S){switch(Y(b)){case 0:return b;case 1:return b;case 2:return b;case 3:return b;case 4:return b;case 5:return b}var k=S===3?"string":S===5?"number":"default",F=gg(b,i);if(F!==void 0){var ce=F.call(b,k);if(se(ce))throw new TypeError;return ce}return _t(b,k==="default"?"number":k)}function _t(b,S){if(S==="string"){var k=b.toString;if(Ji(k)){var F=k.call(b);if(!se(F))return F}var ce=b.valueOf;if(Ji(ce)){var F=ce.call(b);if(!se(F))return F}}else{var ce=b.valueOf;if(Ji(ce)){var F=ce.call(b);if(!se(F))return F}var ze=b.toString;if(Ji(ze)){var F=ze.call(b);if(!se(F))return F}}throw new TypeError}function tt(b){return!!b}function rt(b){return""+b}function lt(b){var S=De(b,3);return Oe(S)?S:rt(S)}function ir(b){return Array.isArray?Array.isArray(b):b instanceof Object?b instanceof Array:Object.prototype.toString.call(b)==="[object Array]"}function Ji(b){return typeof b=="function"}function mg(b){return typeof b=="function"}function H_(b){switch(Y(b)){case 3:return!0;case 4:return!0;default:return!1}}function Wp(b,S){return b===S||b!==b&&S!==S}function gg(b,S){var k=b[S];if(k!=null){if(!Ji(k))throw new TypeError;return k}}function wg(b){var S=gg(b,s);if(!Ji(S))throw new TypeError;var k=S.call(b);if(!se(k))throw new TypeError;return k}function bg(b){return b.value}function xg(b){var S=b.next();return S.done?!1:S}function vg(b){var S=b.return;S&&S.call(b)}function Gp(b){var S=Object.getPrototypeOf(b);if(typeof b!="function"||b===p||S!==p)return S;var k=b.prototype,F=k&&Object.getPrototypeOf(k);if(F==null||F===Object.prototype)return S;var ce=F.constructor;return typeof ce!="function"||ce===b?S:ce}function V_(){var b;!U(v)&&typeof t.Reflect<"u"&&!(v in t.Reflect)&&typeof t.Reflect.defineMetadata=="function"&&(b=W_(t.Reflect));var S,k,F,ce=new x,ze={registerProvider:nt,getProvider:J,setProvider:re};return ze;function nt(ne){if(!Object.isExtensible(ze))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case b===ne:break;case U(S):S=ne;break;case S===ne:break;case U(k):k=ne;break;case k===ne:break;default:F===void 0&&(F=new m),F.add(ne);break}}function ge(ne,we){if(!U(S)){if(S.isProviderFor(ne,we))return S;if(!U(k)){if(k.isProviderFor(ne,we))return S;if(!U(F))for(var Ue=wg(F);;){var Xe=xg(Ue);if(!Xe)return;var xr=bg(Xe);if(xr.isProviderFor(ne,we))return vg(Ue),xr}}}if(!U(b)&&b.isProviderFor(ne,we))return b}function J(ne,we){var Ue=ce.get(ne),Xe;return U(Ue)||(Xe=Ue.get(we)),U(Xe)&&(Xe=ge(ne,we),U(Xe)||(U(Ue)&&(Ue=new y,ce.set(ne,Ue)),Ue.set(we,Xe))),Xe}function ee(ne){if(U(ne))throw new TypeError;return S===ne||k===ne||!U(F)&&F.has(ne)}function re(ne,we,Ue){if(!ee(Ue))throw new Error("Metadata provider not registered.");var Xe=J(ne,we);if(Xe!==Ue){if(!U(Xe))return!1;var xr=ce.get(ne);U(xr)&&(xr=new y,ce.set(ne,xr)),xr.set(we,Ue)}return!0}}function $_(){var b;return!U(v)&&se(t.Reflect)&&Object.isExtensible(t.Reflect)&&(b=t.Reflect[v]),U(b)&&(b=V_()),!U(v)&&se(t.Reflect)&&Object.isExtensible(t.Reflect)&&Object.defineProperty(t.Reflect,v,{enumerable:!1,configurable:!1,writable:!1,value:b}),b}function F_(b){var S=new x,k={isProviderFor:function(ee,re){var ne=S.get(ee);return U(ne)?!1:ne.has(re)},OrdinaryDefineOwnMetadata:nt,OrdinaryHasOwnMetadata:ce,OrdinaryGetOwnMetadata:ze,OrdinaryOwnMetadataKeys:ge,OrdinaryDeleteMetadata:J};return d.registerProvider(k),k;function F(ee,re,ne){var we=S.get(ee),Ue=!1;if(U(we)){if(!ne)return;we=new y,S.set(ee,we),Ue=!0}var Xe=we.get(re);if(U(Xe)){if(!ne)return;if(Xe=new y,we.set(re,Xe),!b.setProvider(ee,re,k))throw we.delete(re),Ue&&S.delete(ee),new Error("Wrong provider for target.")}return Xe}function ce(ee,re,ne){var we=F(re,ne,!1);return U(we)?!1:tt(we.has(ee))}function ze(ee,re,ne){var we=F(re,ne,!1);if(!U(we))return we.get(ee)}function nt(ee,re,ne,we){var Ue=F(ne,we,!0);Ue.set(ee,re)}function ge(ee,re){var ne=[],we=F(ee,re,!1);if(U(we))return ne;for(var Ue=we.keys(),Xe=wg(Ue),xr=0;;){var _g=xg(Xe);if(!_g)return ne.length=xr,ne;var X_=bg(_g);try{ne[xr]=X_}catch(Z_){try{vg(Xe)}finally{throw Z_}}xr++}}function J(ee,re,ne){var we=F(re,ne,!1);if(U(we)||!we.delete(ee))return!1;if(we.size===0){var Ue=S.get(re);U(Ue)||(Ue.delete(ne),Ue.size===0&&S.delete(Ue))}return!0}}function W_(b){var S=b.defineMetadata,k=b.hasOwnMetadata,F=b.getOwnMetadata,ce=b.getOwnMetadataKeys,ze=b.deleteMetadata,nt=new x,ge={isProviderFor:function(J,ee){var re=nt.get(J);return!U(re)&&re.has(ee)?!0:ce(J,ee).length?(U(re)&&(re=new m,nt.set(J,re)),re.add(ee),!0):!1},OrdinaryDefineOwnMetadata:S,OrdinaryHasOwnMetadata:k,OrdinaryGetOwnMetadata:F,OrdinaryOwnMetadataKeys:ce,OrdinaryDeleteMetadata:ze};return ge}function va(b,S,k){var F=d.getProvider(b,S);if(!U(F))return F;if(k){if(d.setProvider(b,S,I))return I;throw new Error("Illegal state.")}}function G_(){var b={},S=[],k=function(){function ge(J,ee,re){this._index=0,this._keys=J,this._values=ee,this._selector=re}return ge.prototype["@@iterator"]=function(){return this},ge.prototype[s]=function(){return this},ge.prototype.next=function(){var J=this._index;if(J>=0&&J<this._keys.length){var ee=this._selector(this._keys[J],this._values[J]);return J+1>=this._keys.length?(this._index=-1,this._keys=S,this._values=S):this._index++,{value:ee,done:!1}}return{value:void 0,done:!0}},ge.prototype.throw=function(J){throw this._index>=0&&(this._index=-1,this._keys=S,this._values=S),J},ge.prototype.return=function(J){return this._index>=0&&(this._index=-1,this._keys=S,this._values=S),{value:J,done:!0}},ge}(),F=function(){function ge(){this._keys=[],this._values=[],this._cacheKey=b,this._cacheIndex=-2}return Object.defineProperty(ge.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),ge.prototype.has=function(J){return this._find(J,!1)>=0},ge.prototype.get=function(J){var ee=this._find(J,!1);return ee>=0?this._values[ee]:void 0},ge.prototype.set=function(J,ee){var re=this._find(J,!0);return this._values[re]=ee,this},ge.prototype.delete=function(J){var ee=this._find(J,!1);if(ee>=0){for(var re=this._keys.length,ne=ee+1;ne<re;ne++)this._keys[ne-1]=this._keys[ne],this._values[ne-1]=this._values[ne];return this._keys.length--,this._values.length--,Wp(J,this._cacheKey)&&(this._cacheKey=b,this._cacheIndex=-2),!0}return!1},ge.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=b,this._cacheIndex=-2},ge.prototype.keys=function(){return new k(this._keys,this._values,ce)},ge.prototype.values=function(){return new k(this._keys,this._values,ze)},ge.prototype.entries=function(){return new k(this._keys,this._values,nt)},ge.prototype["@@iterator"]=function(){return this.entries()},ge.prototype[s]=function(){return this.entries()},ge.prototype._find=function(J,ee){if(!Wp(this._cacheKey,J)){this._cacheIndex=-1;for(var re=0;re<this._keys.length;re++)if(Wp(this._keys[re],J)){this._cacheIndex=re;break}}return this._cacheIndex<0&&ee&&(this._cacheIndex=this._keys.length,this._keys.push(J),this._values.push(void 0)),this._cacheIndex},ge}();return F;function ce(ge,J){return ge}function ze(ge,J){return J}function nt(ge,J){return[ge,J]}}function q_(){var b=function(){function S(){this._map=new y}return Object.defineProperty(S.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),S.prototype.has=function(k){return this._map.has(k)},S.prototype.add=function(k){return this._map.set(k,k),this},S.prototype.delete=function(k){return this._map.delete(k)},S.prototype.clear=function(){this._map.clear()},S.prototype.keys=function(){return this._map.keys()},S.prototype.values=function(){return this._map.keys()},S.prototype.entries=function(){return this._map.entries()},S.prototype["@@iterator"]=function(){return this.keys()},S.prototype[s]=function(){return this.keys()},S}();return b}function z_(){var b=16,S=f.create(),k=F();return function(){function J(){this._key=F()}return J.prototype.has=function(ee){var re=ce(ee,!1);return re!==void 0?f.has(re,this._key):!1},J.prototype.get=function(ee){var re=ce(ee,!1);return re!==void 0?f.get(re,this._key):void 0},J.prototype.set=function(ee,re){var ne=ce(ee,!0);return ne[this._key]=re,this},J.prototype.delete=function(ee){var re=ce(ee,!1);return re!==void 0?delete re[this._key]:!1},J.prototype.clear=function(){this._key=F()},J}();function F(){var J;do J="@@WeakMap@@"+ge();while(f.has(S,J));return S[J]=!0,J}function ce(J,ee){if(!n.call(J,k)){if(!ee)return;Object.defineProperty(J,k,{value:f.create()})}return J[k]}function ze(J,ee){for(var re=0;re<ee;++re)J[re]=Math.random()*255|0;return J}function nt(J){if(typeof Uint8Array=="function"){var ee=new Uint8Array(J);return typeof crypto<"u"?crypto.getRandomValues(ee):typeof msCrypto<"u"?msCrypto.getRandomValues(ee):ze(ee,J),ee}return ze(new Array(J),J)}function ge(){var J=nt(b);J[6]=J[6]&79|64,J[8]=J[8]&191|128;for(var ee="",re=0;re<b;++re){var ne=J[re];(re===4||re===6||re===8)&&(ee+="-"),ne<16&&(ee+="0"),ee+=ne.toString(16).toLowerCase()}return ee}}function qp(b){return b.__=void 0,delete b.__,b}})})(Rb||(Rb={}))});var _n=zp(Bs=>{"use strict";var G2="[object ArrayBuffer]",vn=class r{static isArrayBuffer(e){return Object.prototype.toString.call(e)===G2}static toArrayBuffer(e){return this.isArrayBuffer(e)?e:e.byteLength===e.buffer.byteLength||e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:this.toUint8Array(e.buffer).slice(e.byteOffset,e.byteOffset+e.byteLength).buffer}static toUint8Array(e){return this.toView(e,Uint8Array)}static toView(e,t){if(e.constructor===t)return e;if(this.isArrayBuffer(e))return new t(e);if(this.isArrayBufferView(e))return new t(e.buffer,e.byteOffset,e.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}static isBufferSource(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}static isArrayBufferView(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}static isEqual(e,t){let n=r.toUint8Array(e),o=r.toUint8Array(t);if(n.length!==o.byteLength)return!1;for(let i=0;i<n.length;i++)if(n[i]!==o[i])return!1;return!0}static concat(...e){let t;Array.isArray(e[0])&&!(e[1]instanceof Function)||Array.isArray(e[0])&&e[1]instanceof Function?t=e[0]:e[e.length-1]instanceof Function?t=e.slice(0,e.length-1):t=e;let n=0;for(let s of t)n+=s.byteLength;let o=new Uint8Array(n),i=0;for(let s of t){let a=this.toUint8Array(s);o.set(a,i),i+=a.length}return e[e.length-1]instanceof Function?this.toView(o,e[e.length-1]):o.buffer}},ey="string",q2=/^[0-9a-f\s]+$/i,z2=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/,X2=/^[a-zA-Z0-9-_]+$/,pf=class{static fromString(e){let t=unescape(encodeURIComponent(e)),n=new Uint8Array(t.length);for(let o=0;o<t.length;o++)n[o]=t.charCodeAt(o);return n.buffer}static toString(e){let t=vn.toUint8Array(e),n="";for(let i=0;i<t.length;i++)n+=String.fromCharCode(t[i]);return decodeURIComponent(escape(n))}},ur=class{static toString(e,t=!1){let n=vn.toArrayBuffer(e),o=new DataView(n),i="";for(let s=0;s<n.byteLength;s+=2){let a=o.getUint16(s,t);i+=String.fromCharCode(a)}return i}static fromString(e,t=!1){let n=new ArrayBuffer(e.length*2),o=new DataView(n);for(let i=0;i<e.length;i++)o.setUint16(i*2,e.charCodeAt(i),t);return n}},hf=class r{static isHex(e){return typeof e===ey&&q2.test(e)}static isBase64(e){return typeof e===ey&&z2.test(e)}static isBase64Url(e){return typeof e===ey&&X2.test(e)}static ToString(e,t="utf8"){let n=vn.toUint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(n);case"binary":return this.ToBinary(n);case"hex":return this.ToHex(n);case"base64":return this.ToBase64(n);case"base64url":return this.ToBase64Url(n);case"utf16le":return ur.toString(n,!0);case"utf16":case"utf16be":return ur.toString(n);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromString(e,t="utf8"){if(!e)return new ArrayBuffer(0);switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);case"utf16le":return ur.fromString(e,!0);case"utf16":case"utf16be":return ur.fromString(e);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToBase64(e){let t=vn.toUint8Array(e);if(typeof btoa<"u"){let n=this.ToString(t,"binary");return btoa(n)}else return Buffer.from(t).toString("base64")}static FromBase64(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!r.isBase64(t))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return typeof atob<"u"?this.FromBinary(atob(t)):new Uint8Array(Buffer.from(t,"base64")).buffer}static FromBase64Url(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!r.isBase64Url(t))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(t.replace(/\-/g,"+").replace(/\_/g,"/")))}static ToBase64Url(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}static FromUtf8String(e,t=r.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.FromBinary(e);case"utf8":return pf.fromString(e);case"utf16":case"utf16be":return ur.fromString(e);case"utf16le":case"usc2":return ur.fromString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToUtf8String(e,t=r.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.ToBinary(e);case"utf8":return pf.toString(e);case"utf16":case"utf16be":return ur.toString(e);case"utf16le":case"usc2":return ur.toString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromBinary(e){let t=e.length,n=new Uint8Array(t);for(let o=0;o<t;o++)n[o]=e.charCodeAt(o);return n.buffer}static ToBinary(e){let t=vn.toUint8Array(e),n="";for(let o=0;o<t.length;o++)n+=String.fromCharCode(t[o]);return n}static ToHex(e){let t=vn.toUint8Array(e),n="",o=t.length;for(let i=0;i<o;i++){let s=t[i];s<16&&(n+="0"),n+=s.toString(16)}return n}static FromHex(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!r.isHex(t))throw new TypeError("Argument 'hexString' is not HEX encoded");t.length%2&&(t=`0${t}`);let n=new Uint8Array(t.length/2);for(let o=0;o<t.length;o=o+2){let i=t.slice(o,o+2);n[o/2]=parseInt(i,16)}return n.buffer}static ToUtf16String(e,t=!1){return ur.toString(e,t)}static FromUtf16String(e,t=!1){return ur.fromString(e,t)}static Base64Padding(e){let t=4-e.length%4;if(t<4)for(let n=0;n<t;n++)e+="=";return e}static formatString(e){return e?.replace(/[\n\r\t ]/g,"")||""}};hf.DEFAULT_UTF8_ENCODING="utf8";function Z2(r,...e){let t=arguments[0];for(let n=1;n<arguments.length;n++){let o=arguments[n];for(let i in o)t[i]=o[i]}return t}function Y2(...r){let e=r.map(o=>o.byteLength).reduce((o,i)=>o+i),t=new Uint8Array(e),n=0;return r.map(o=>new Uint8Array(o)).forEach(o=>{for(let i of o)t[n++]=i}),t.buffer}function J2(r,e){if(!(r&&e)||r.byteLength!==e.byteLength)return!1;let t=new Uint8Array(r),n=new Uint8Array(e);for(let o=0;o<r.byteLength;o++)if(t[o]!==n[o])return!1;return!0}Bs.BufferSourceConverter=vn;Bs.Convert=hf;Bs.assign=Z2;Bs.combine=Y2;Bs.isEqual=J2});var Bv=zp((a$,ap)=>{var fv,pv,hv,dv,yv,mv,gv,wv,bv,sp,am,xv,vv,aa,_v,Sv,Av,Ev,Cv,Tv,Iv,Ov,Pv;(function(r){var e=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof this=="object"?this:{};typeof define=="function"&&define.amd?define("tslib",["exports"],function(n){r(t(e,t(n)))}):typeof ap=="object"&&typeof ap.exports=="object"?r(t(e,t(ap.exports))):r(t(e));function t(n,o){return n!==e&&(typeof Object.create=="function"?Object.defineProperty(n,"__esModule",{value:!0}):n.__esModule=!0),function(i,s){return n[i]=o?o(i,s):s}}})(function(r){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var o in n)n.hasOwnProperty(o)&&(t[o]=n[o])};fv=function(t,n){e(t,n);function o(){this.constructor=t}t.prototype=n===null?Object.create(n):(o.prototype=n.prototype,new o)},pv=Object.assign||function(t){for(var n,o=1,i=arguments.length;o<i;o++){n=arguments[o];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},hv=function(t,n){var o={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&n.indexOf(i)<0&&(o[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)n.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(o[i[s]]=t[i[s]]);return o},dv=function(t,n,o,i){var s=arguments.length,a=s<3?n:i===null?i=Object.getOwnPropertyDescriptor(n,o):i,c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(t,n,o,i);else for(var l=t.length-1;l>=0;l--)(c=t[l])&&(a=(s<3?c(a):s>3?c(n,o,a):c(n,o))||a);return s>3&&a&&Object.defineProperty(n,o,a),a},yv=function(t,n){return function(o,i){n(o,i,t)}},mv=function(t,n){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,n)},gv=function(t,n,o,i){function s(a){return a instanceof o?a:new o(function(c){c(a)})}return new(o||(o=Promise))(function(a,c){function l(y){try{p(i.next(y))}catch(m){c(m)}}function f(y){try{p(i.throw(y))}catch(m){c(m)}}function p(y){y.done?a(y.value):s(y.value).then(l,f)}p((i=i.apply(t,n||[])).next())})},wv=function(t,n){var o={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},i,s,a,c;return c={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function l(p){return function(y){return f([p,y])}}function f(p){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,s&&(a=p[0]&2?s.return:p[0]?s.throw||((a=s.return)&&a.call(s),0):s.next)&&!(a=a.call(s,p[1])).done)return a;switch(s=0,a&&(p=[p[0]&2,a.value]),p[0]){case 0:case 1:a=p;break;case 4:return o.label++,{value:p[1],done:!1};case 5:o.label++,s=p[1],p=[0];continue;case 7:p=o.ops.pop(),o.trys.pop();continue;default:if(a=o.trys,!(a=a.length>0&&a[a.length-1])&&(p[0]===6||p[0]===2)){o=0;continue}if(p[0]===3&&(!a||p[1]>a[0]&&p[1]<a[3])){o.label=p[1];break}if(p[0]===6&&o.label<a[1]){o.label=a[1],a=p;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(p);break}a[2]&&o.ops.pop(),o.trys.pop();continue}p=n.call(t,o)}catch(y){p=[6,y],s=0}finally{i=a=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}},Pv=function(t,n,o,i){i===void 0&&(i=o),t[i]=n[o]},bv=function(t,n){for(var o in t)o!=="default"&&!n.hasOwnProperty(o)&&(n[o]=t[o])},sp=function(t){var n=typeof Symbol=="function"&&Symbol.iterator,o=n&&t[n],i=0;if(o)return o.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")},am=function(t,n){var o=typeof Symbol=="function"&&t[Symbol.iterator];if(!o)return t;var i=o.call(t),s,a=[],c;try{for(;(n===void 0||n-- >0)&&!(s=i.next()).done;)a.push(s.value)}catch(l){c={error:l}}finally{try{s&&!s.done&&(o=i.return)&&o.call(i)}finally{if(c)throw c.error}}return a},xv=function(){for(var t=[],n=0;n<arguments.length;n++)t=t.concat(am(arguments[n]));return t},vv=function(){for(var t=0,n=0,o=arguments.length;n<o;n++)t+=arguments[n].length;for(var i=Array(t),s=0,n=0;n<o;n++)for(var a=arguments[n],c=0,l=a.length;c<l;c++,s++)i[s]=a[c];return i},aa=function(t){return this instanceof aa?(this.v=t,this):new aa(t)},_v=function(t,n,o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=o.apply(t,n||[]),s,a=[];return s={},c("next"),c("throw"),c("return"),s[Symbol.asyncIterator]=function(){return this},s;function c(x){i[x]&&(s[x]=function(v){return new Promise(function(d,I){a.push([x,v,d,I])>1||l(x,v)})})}function l(x,v){try{f(i[x](v))}catch(d){m(a[0][3],d)}}function f(x){x.value instanceof aa?Promise.resolve(x.value.v).then(p,y):m(a[0][2],x)}function p(x){l("next",x)}function y(x){l("throw",x)}function m(x,v){x(v),a.shift(),a.length&&l(a[0][0],a[0][1])}},Sv=function(t){var n,o;return n={},i("next"),i("throw",function(s){throw s}),i("return"),n[Symbol.iterator]=function(){return this},n;function i(s,a){n[s]=t[s]?function(c){return(o=!o)?{value:aa(t[s](c)),done:s==="return"}:a?a(c):c}:a}},Av=function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t[Symbol.asyncIterator],o;return n?n.call(t):(t=typeof sp=="function"?sp(t):t[Symbol.iterator](),o={},i("next"),i("throw"),i("return"),o[Symbol.asyncIterator]=function(){return this},o);function i(a){o[a]=t[a]&&function(c){return new Promise(function(l,f){c=t[a](c),s(l,f,c.done,c.value)})}}function s(a,c,l,f){Promise.resolve(f).then(function(p){a({value:p,done:l})},c)}},Ev=function(t,n){return Object.defineProperty?Object.defineProperty(t,"raw",{value:n}):t.raw=n,t},Cv=function(t){if(t&&t.__esModule)return t;var n={};if(t!=null)for(var o in t)Object.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return n.default=t,n},Tv=function(t){return t&&t.__esModule?t:{default:t}},Iv=function(t,n){if(!n.has(t))throw new TypeError("attempted to get private field on non-instance");return n.get(t)},Ov=function(t,n,o){if(!n.has(t))throw new TypeError("attempted to set private field on non-instance");return n.set(t,o),o},r("__extends",fv),r("__assign",pv),r("__rest",hv),r("__decorate",dv),r("__param",yv),r("__metadata",mv),r("__awaiter",gv),r("__generator",wv),r("__exportStar",bv),r("__createBinding",Pv),r("__values",sp),r("__read",am),r("__spread",xv),r("__spreadArrays",vv),r("__await",aa),r("__asyncGenerator",_v),r("__asyncDelegator",Sv),r("__asyncValues",Av),r("__makeTemplateObject",Ev),r("__importStar",Cv),r("__importDefault",Tv),r("__classPrivateFieldGet",Iv),r("__classPrivateFieldSet",Ov)})});var tI={};St(tI,{webRTC:()=>eI,webRTCDirect:()=>QT});var Xp=Symbol.for("@libp2p/peer-id");var Hu=Symbol.for("@libp2p/transport");var Ag;(function(r){r[r.FATAL_ALL=0]="FATAL_ALL",r[r.NO_FATAL=1]="NO_FATAL"})(Ag||(Ag={}));var Vu=class extends Error{static name="UnexpectedPeerError";constructor(e="Unexpected Peer"){super(e),this.name="UnexpectedPeerError"}},$u=class extends Error{static name="InvalidCryptoExchangeError";constructor(e="Invalid crypto exchange"){super(e),this.name="InvalidCryptoExchangeError"}},Ie=class extends Error{static name="InvalidParametersError";constructor(e="Invalid parameters"){super(e),this.name="InvalidParametersError"}},Qi=class extends Error{static name="InvalidPublicKeyError";constructor(e="Invalid public key"){super(e),this.name="InvalidPublicKeyError"}},_a=class extends Error{static name="InvalidPrivateKeyError";constructor(e="Invalid private key"){super(e),this.name="InvalidPrivateKeyError"}};var Fu=class extends Error{static name="ConnectionFailedError";constructor(e="Connection failed"){super(e),this.name="ConnectionFailedError"}};var Wu=class extends Error{static name="StreamResetError";constructor(e="The stream has been reset"){super(e),this.name="StreamResetError"}},Po=class extends Error{static name="StreamStateError";constructor(e="The stream is in an invalid state"){super(e),this.name="StreamStateError"}},Bo=class extends Error{static name="NotFoundError";constructor(e="Not found"){super(e),this.name="NotFoundError"}};var Gu=class extends Error{static name="InvalidCIDError";constructor(e="Invalid CID"){super(e),this.name="InvalidCIDError"}},qu=class extends Error{static name="InvalidMultihashError";constructor(e="Invalid Multihash"){super(e),this.name="InvalidMultihashError"}};var zu=class extends Error{static name="InvalidMessageError";constructor(e="Invalid message"){super(e),this.name="InvalidMessageError"}};var Xu=class extends Error{static name="TimeoutError";constructor(e="Timed out"){super(e),this.name="TimeoutError"}},Zu=class extends Error{static name="NotStartedError";constructor(e="Not started"){super(e),this.name="NotStartedError"}};var $n=class extends Error{static name="UnsupportedKeyTypeError";constructor(e="Unsupported key type"){super(e),this.name="UnsupportedKeyTypeError"}};var Fn=class extends EventTarget{#e=new Map;constructor(){super()}listenerCount(e){let t=this.#e.get(e);return t==null?0:t.length}addEventListener(e,t,n){super.addEventListener(e,t,n);let o=this.#e.get(e);o==null&&(o=[],this.#e.set(e,o)),o.push({callback:t,once:(n!==!0&&n!==!1&&n?.once)??!1})}removeEventListener(e,t,n){super.removeEventListener(e.toString(),t??null,n);let o=this.#e.get(e);o!=null&&(o=o.filter(({callback:i})=>i!==t),this.#e.set(e,o))}dispatchEvent(e){let t=super.dispatchEvent(e),n=this.#e.get(e.type);return n==null||(n=n.filter(({once:o})=>!o),this.#e.set(e.type,n)),t}safeDispatchEvent(e,t={}){return this.dispatchEvent(new CustomEvent(e,t))}};var es=Symbol.for("@libp2p/service-capabilities"),Eg=Symbol.for("@libp2p/service-dependencies");var eh={};St(eh,{base58btc:()=>Ke,base58flickr:()=>uS});var II=new Uint8Array(0);function Cg(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function hn(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function Tg(r){return new TextEncoder().encode(r)}function Ig(r){return new TextDecoder().decode(r)}function nS(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var o=0;o<r.length;o++){var i=r.charAt(o),s=i.charCodeAt(0);if(t[s]!==255)throw new TypeError(i+" is ambiguous");t[s]=o}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),f=Math.log(256)/Math.log(a);function p(x){if(x instanceof Uint8Array||(ArrayBuffer.isView(x)?x=new Uint8Array(x.buffer,x.byteOffset,x.byteLength):Array.isArray(x)&&(x=Uint8Array.from(x))),!(x instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(x.length===0)return"";for(var v=0,d=0,I=0,D=x.length;I!==D&&x[I]===0;)I++,v++;for(var j=(D-I)*f+1>>>0,Z=new Uint8Array(j);I!==D;){for(var P=x[I],M=0,V=j-1;(P!==0||M<d)&&V!==-1;V--,M++)P+=256*Z[V]>>>0,Z[V]=P%a>>>0,P=P/a>>>0;if(P!==0)throw new Error("Non-zero carry");d=M,I++}for(var K=j-d;K!==j&&Z[K]===0;)K++;for(var g=c.repeat(v);K<j;++K)g+=r.charAt(Z[K]);return g}function y(x){if(typeof x!="string")throw new TypeError("Expected String");if(x.length===0)return new Uint8Array;var v=0;if(x[v]!==" "){for(var d=0,I=0;x[v]===c;)d++,v++;for(var D=(x.length-v)*l+1>>>0,j=new Uint8Array(D);x[v];){var Z=t[x.charCodeAt(v)];if(Z===255)return;for(var P=0,M=D-1;(Z!==0||P<I)&&M!==-1;M--,P++)Z+=a*j[M]>>>0,j[M]=Z%256>>>0,Z=Z/256>>>0;if(Z!==0)throw new Error("Non-zero carry");I=P,v++}if(x[v]!==" "){for(var V=D-I;V!==D&&j[V]===0;)V++;for(var K=new Uint8Array(d+(D-V)),g=d;V!==D;)K[g++]=j[V++];return K}}}function m(x){var v=y(x);if(v)return v;throw new Error(`Non-${e} character`)}return{encode:p,decodeUnsafe:y,decode:m}}var oS=nS,iS=oS,Pg=iS;var Zp=class{name;prefix;baseEncode;constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Yp=class{name;prefix;baseDecode;prefixCodePoint;constructor(e,t,n){this.name=e,this.prefix=t;let o=t.codePointAt(0);if(o===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=o,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Bg(this,e)}},Jp=class{decoders;constructor(e){this.decoders=e}or(e){return Bg(this,e)}decode(e){let t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function Bg(r,e){return new Jp({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}var Qp=class{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(e,t,n,o){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=o,this.encoder=new Zp(e,t,n),this.decoder=new Yp(e,t,o)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function ts({name:r,prefix:e,encode:t,decode:n}){return new Qp(r,e,t,n)}function Wn({name:r,prefix:e,alphabet:t}){let{encode:n,decode:o}=Pg(t,r);return ts({prefix:e,name:r,encode:n,decode:i=>hn(o(i))})}function sS(r,e,t,n){let o=r.length;for(;r[o-1]==="=";)--o;let i=new Uint8Array(o*t/8|0),s=0,a=0,c=0;for(let l=0;l<o;++l){let f=e[r[l]];if(f===void 0)throw new SyntaxError(`Non-${n} character`);a=a<<t|f,s+=t,s>=8&&(s-=8,i[c++]=255&a>>s)}if(s>=t||(255&a<<8-s)!==0)throw new SyntaxError("Unexpected end of data");return i}function aS(r,e,t){let n=e[e.length-1]==="=",o=(1<<t)-1,i="",s=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],s+=8;s>t;)s-=t,i+=e[o&a>>s];if(s!==0&&(i+=e[o&a<<t-s]),n)for(;(i.length*t&7)!==0;)i+="=";return i}function cS(r){let e={};for(let t=0;t<r.length;++t)e[r[t]]=t;return e}function Fe({name:r,prefix:e,bitsPerChar:t,alphabet:n}){let o=cS(n);return ts({prefix:e,name:r,encode(i){return aS(i,n,t)},decode(i){return sS(i,o,t,r)}})}var Ke=Wn({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),uS=Wn({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var th={};St(th,{base32:()=>Gn,base32hex:()=>hS,base32hexpad:()=>yS,base32hexpadupper:()=>mS,base32hexupper:()=>dS,base32pad:()=>fS,base32padupper:()=>pS,base32upper:()=>lS,base32z:()=>gS});var Gn=Fe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),lS=Fe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),fS=Fe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),pS=Fe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),hS=Fe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),dS=Fe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),yS=Fe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),mS=Fe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),gS=Fe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var rh={};St(rh,{base36:()=>Sa,base36upper:()=>wS});var Sa=Wn({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),wS=Wn({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var vr={};St(vr,{Digest:()=>ko,create:()=>At,decode:()=>os,equals:()=>oh,hasCode:()=>LS});var bS=Dg,kg=128,xS=127,vS=~xS,_S=Math.pow(2,31);function Dg(r,e,t){e=e||[],t=t||0;for(var n=t;r>=_S;)e[t++]=r&255|kg,r/=128;for(;r&vS;)e[t++]=r&255|kg,r>>>=7;return e[t]=r|0,Dg.bytes=t-n+1,e}var SS=nh,AS=128,Ng=127;function nh(r,n){var t=0,n=n||0,o=0,i=n,s,a=r.length;do{if(i>=a)throw nh.bytes=0,new RangeError("Could not decode varint");s=r[i++],t+=o<28?(s&Ng)<<o:(s&Ng)*Math.pow(2,o),o+=7}while(s>=AS);return nh.bytes=i-n,t}var ES=Math.pow(2,7),CS=Math.pow(2,14),TS=Math.pow(2,21),IS=Math.pow(2,28),OS=Math.pow(2,35),PS=Math.pow(2,42),BS=Math.pow(2,49),kS=Math.pow(2,56),NS=Math.pow(2,63),DS=function(r){return r<ES?1:r<CS?2:r<TS?3:r<IS?4:r<OS?5:r<PS?6:r<BS?7:r<kS?8:r<NS?9:10},jS={encode:bS,decode:SS,encodingLength:DS},RS=jS,Aa=RS;function Ea(r,e=0){return[Aa.decode(r,e),Aa.decode.bytes]}function rs(r,e,t=0){return Aa.encode(r,e,t),e}function ns(r){return Aa.encodingLength(r)}function At(r,e){let t=e.byteLength,n=ns(r),o=n+ns(t),i=new Uint8Array(o+t);return rs(r,i,0),rs(t,i,n),i.set(e,o),new ko(r,t,e,i)}function os(r){let e=hn(r),[t,n]=Ea(e),[o,i]=Ea(e.subarray(n)),s=e.subarray(n+i);if(s.byteLength!==o)throw new Error("Incorrect length");return new ko(t,o,s,e)}function oh(r,e){if(r===e)return!0;{let t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&Cg(r.bytes,t.bytes)}}var ko=class{code;size;digest;bytes;constructor(e,t,n,o){this.code=e,this.size=t,this.digest=n,this.bytes=o}};function LS(r,e){return r.code===e}function jg(r,e){let{bytes:t,version:n}=r;switch(n){case 0:return MS(t,ih(r),e??Ke.encoder);default:return KS(t,ih(r),e??Gn.encoder)}}var Rg=new WeakMap;function ih(r){let e=Rg.get(r);if(e==null){let t=new Map;return Rg.set(r,t),t}return e}var Ze=class r{code;version;multihash;bytes;"/";constructor(e,t,n,o){this.code=t,this.version=e,this.multihash=n,this.bytes=o,this["/"]=o}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:e,multihash:t}=this;if(e!==Ca)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==HS)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return r.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:e,digest:t}=this.multihash,n=At(e,t);return r.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return r.equals(this,e)}static equals(e,t){let n=t;return n!=null&&e.code===n.code&&e.version===n.version&&oh(e.multihash,n.multihash)}toString(e){return jg(this,e)}toJSON(){return{"/":jg(this)}}link(){return this}[Symbol.toStringTag]="CID";[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;let t=e;if(t instanceof r)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){let{version:n,code:o,multihash:i,bytes:s}=t;return new r(n,o,i,s??Lg(n,o,i.bytes))}else if(t[VS]===!0){let{version:n,multihash:o,code:i}=t,s=os(o);return r.create(n,i,s)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Ca)throw new Error(`Version 0 CID must use dag-pb (code: ${Ca}) block encoding`);return new r(e,t,n,n.bytes)}case 1:{let o=Lg(e,t,n.bytes);return new r(e,t,n,o)}default:throw new Error("Invalid version")}}static createV0(e){return r.create(0,Ca,e)}static createV1(e,t){return r.create(1,e,t)}static decode(e){let[t,n]=r.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){let t=r.inspectBytes(e),n=t.size-t.multihashSize,o=hn(e.subarray(n,n+t.multihashSize));if(o.byteLength!==t.multihashSize)throw new Error("Incorrect length");let i=o.subarray(t.multihashSize-t.digestSize),s=new ko(t.multihashCode,t.digestSize,i,o);return[t.version===0?r.createV0(s):r.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0,n=()=>{let[p,y]=Ea(e.subarray(t));return t+=y,p},o=n(),i=Ca;if(o===18?(o=0,t=0):i=n(),o!==0&&o!==1)throw new RangeError(`Invalid CID version ${o}`);let s=t,a=n(),c=n(),l=t+c,f=l-s;return{version:o,codec:i,multihashCode:a,digestSize:c,multihashSize:f,size:l}}static parse(e,t){let[n,o]=US(e,t),i=r.decode(o);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return ih(i).set(n,e),i}};function US(r,e){switch(r[0]){case"Q":{let t=e??Ke;return[Ke.prefix,t.decode(`${Ke.prefix}${r}`)]}case Ke.prefix:{let t=e??Ke;return[Ke.prefix,t.decode(r)]}case Gn.prefix:{let t=e??Gn;return[Gn.prefix,t.decode(r)]}case Sa.prefix:{let t=e??Sa;return[Sa.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function MS(r,e,t){let{prefix:n}=t;if(n!==Ke.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);let o=e.get(n);if(o==null){let i=t.encode(r).slice(1);return e.set(n,i),i}else return o}function KS(r,e,t){let{prefix:n}=t,o=e.get(n);if(o==null){let i=t.encode(r);return e.set(n,i),i}else return o}var Ca=112,HS=18;function Lg(r,e,t){let n=ns(r),o=n+ns(e),i=new Uint8Array(o+t.byteLength);return rs(r,i,0),rs(e,i,n),i.set(t,o),i}var VS=Symbol.for("@ipld/js-cid/CID");var sh={};St(sh,{identity:()=>_r});var Ug=0,$S="identity",Mg=hn;function FS(r){return At(Ug,Mg(r))}var _r={code:Ug,name:$S,encode:Mg,digest:FS};function We(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function ot(r=0){return new Uint8Array(r)}function it(r=0){return new Uint8Array(r)}function Bt(r,e){e==null&&(e=r.reduce((o,i)=>o+i.length,0));let t=it(e),n=0;for(let o of r)t.set(o,n),n+=o.length;return t}var Hg=Symbol.for("@achingbrain/uint8arraylist");function Kg(r,e){if(e==null||e<0)throw new RangeError("index is out of bounds");let t=0;for(let n of r){let o=t+n.byteLength;if(e<o)return{buf:n,index:e-t};t=o}throw new RangeError("index is out of bounds")}function Ju(r){return!!r?.[Hg]}var be=class r{bufs;length;[Hg]=!0;constructor(...e){this.bufs=[],this.length=0,e.length>0&&this.appendAll(e)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...e){this.appendAll(e)}appendAll(e){let t=0;for(let n of e)if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.push(n);else if(Ju(n))t+=n.byteLength,this.bufs.push(...n.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}prepend(...e){this.prependAll(e)}prependAll(e){let t=0;for(let n of e.reverse())if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.unshift(n);else if(Ju(n))t+=n.byteLength,this.bufs.unshift(...n.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}get(e){let t=Kg(this.bufs,e);return t.buf[t.index]}set(e,t){let n=Kg(this.bufs,e);n.buf[n.index]=t}write(e,t=0){if(e instanceof Uint8Array)for(let n=0;n<e.length;n++)this.set(t+n,e[n]);else if(Ju(e))for(let n=0;n<e.length;n++)this.set(t+n,e.get(n));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(e){if(e=Math.trunc(e),!(Number.isNaN(e)||e<=0)){if(e===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(e>=this.bufs[0].byteLength)e-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(e),this.length-=e;break}}}slice(e,t){let{bufs:n,length:o}=this._subList(e,t);return Bt(n,o)}subarray(e,t){let{bufs:n,length:o}=this._subList(e,t);return n.length===1?n[0]:Bt(n,o)}sublist(e,t){let{bufs:n,length:o}=this._subList(e,t),i=new r;return i.length=o,i.bufs=[...n],i}_subList(e,t){if(e=e??0,t=t??this.length,e<0&&(e=this.length+e),t<0&&(t=this.length+t),e<0||t>this.length)throw new RangeError("index is out of bounds");if(e===t)return{bufs:[],length:0};if(e===0&&t===this.length)return{bufs:this.bufs,length:this.length};let n=[],o=0;for(let i=0;i<this.bufs.length;i++){let s=this.bufs[i],a=o,c=a+s.byteLength;if(o=c,e>=c)continue;let l=e>=a&&e<c,f=t>a&&t<=c;if(l&&f){if(e===a&&t===c){n.push(s);break}let p=e-a;n.push(s.subarray(p,p+(t-e)));break}if(l){if(e===0){n.push(s);continue}n.push(s.subarray(e-a));continue}if(f){if(t===c){n.push(s);break}n.push(s.subarray(0,t-a));break}n.push(s)}return{bufs:n,length:t-e}}indexOf(e,t=0){if(!Ju(e)&&!(e instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');let n=e instanceof Uint8Array?e:e.subarray();if(t=Number(t??0),isNaN(t)&&(t=0),t<0&&(t=this.length+t),t<0&&(t=0),e.length===0)return t>this.length?this.length:t;let o=n.byteLength;if(o===0)throw new TypeError("search must be at least 1 byte long");let i=256,s=new Int32Array(i);for(let p=0;p<i;p++)s[p]=-1;for(let p=0;p<o;p++)s[n[p]]=p;let a=s,c=this.byteLength-n.byteLength,l=n.byteLength-1,f;for(let p=t;p<=c;p+=f){f=0;for(let y=l;y>=0;y--){let m=this.get(p+y);if(n[y]!==m){f=Math.max(1,y-a[m]);break}}if(f===0)return p}return-1}getInt8(e){let t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getInt8(0)}setInt8(e,t){let n=it(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,t),this.write(n,e)}getInt16(e,t){let n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,t)}setInt16(e,t,n){let o=ot(2);new DataView(o.buffer,o.byteOffset,o.byteLength).setInt16(0,t,n),this.write(o,e)}getInt32(e,t){let n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,t)}setInt32(e,t,n){let o=ot(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setInt32(0,t,n),this.write(o,e)}getBigInt64(e,t){let n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,t)}setBigInt64(e,t,n){let o=ot(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setBigInt64(0,t,n),this.write(o,e)}getUint8(e){let t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getUint8(0)}setUint8(e,t){let n=it(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,t),this.write(n,e)}getUint16(e,t){let n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,t)}setUint16(e,t,n){let o=ot(2);new DataView(o.buffer,o.byteOffset,o.byteLength).setUint16(0,t,n),this.write(o,e)}getUint32(e,t){let n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,t)}setUint32(e,t,n){let o=ot(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setUint32(0,t,n),this.write(o,e)}getBigUint64(e,t){let n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,t)}setBigUint64(e,t,n){let o=ot(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setBigUint64(0,t,n),this.write(o,e)}getFloat32(e,t){let n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,t)}setFloat32(e,t,n){let o=ot(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setFloat32(0,t,n),this.write(o,e)}getFloat64(e,t){let n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,t)}setFloat64(e,t,n){let o=ot(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setFloat64(0,t,n),this.write(o,e)}equals(e){if(e==null||!(e instanceof r)||e.bufs.length!==this.bufs.length)return!1;for(let t=0;t<this.bufs.length;t++)if(!We(this.bufs[t],e.bufs[t]))return!1;return!0}static fromUint8Arrays(e,t){let n=new r;return n.bufs=e,t==null&&(t=e.reduce((o,i)=>o+i.byteLength,0)),n.length=t,n}};var ah={};St(ah,{base10:()=>GS});var GS=Wn({prefix:"9",name:"base10",alphabet:"0123456789"});var ch={};St(ch,{base16:()=>qS,base16upper:()=>zS});var qS=Fe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),zS=Fe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var uh={};St(uh,{base2:()=>XS});var XS=Fe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var lh={};St(lh,{base256emoji:()=>eA});var Vg=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),ZS=Vg.reduce((r,e,t)=>(r[t]=e,r),[]),YS=Vg.reduce((r,e,t)=>{let n=e.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${e}`);return r[n]=t,r},[]);function JS(r){return r.reduce((e,t)=>(e+=ZS[t],e),"")}function QS(r){let e=[];for(let t of r){let n=t.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${t}`);let o=YS[n];if(o==null)throw new Error(`Non-base256emoji character: ${t}`);e.push(o)}return new Uint8Array(e)}var eA=ts({prefix:"\u{1F680}",name:"base256emoji",encode:JS,decode:QS});var fh={};St(fh,{base64:()=>tA,base64pad:()=>rA,base64url:()=>No,base64urlpad:()=>nA});var tA=Fe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),rA=Fe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),No=Fe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),nA=Fe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var ph={};St(ph,{base8:()=>oA});var oA=Fe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var hh={};St(hh,{identity:()=>iA});var iA=ts({prefix:"\0",name:"identity",encode:r=>Ig(r),decode:r=>Tg(r)});var lO=new TextEncoder,fO=new TextDecoder;var mh={};St(mh,{sha256:()=>sr,sha512:()=>cA});function yh({name:r,code:e,encode:t}){return new dh(r,e,t)}var dh=class{name;code;encode;constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?At(this.code,t):t.then(n=>At(this.code,n))}else throw Error("Unknown type, must be binary type")}};function Fg(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}var sr=yh({name:"sha2-256",code:18,encode:Fg("SHA-256")}),cA=yh({name:"sha2-512",code:19,encode:Fg("SHA-512")});var Do={...hh,...uh,...ph,...ah,...ch,...th,...rh,...eh,...fh,...lh},SO={...mh,...sh};function Gg(r,e,t,n){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:n}}}var Wg=Gg("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),gh=Gg("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);let e=it(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),uA={utf8:Wg,"utf-8":Wg,hex:Do.base16,latin1:gh,ascii:gh,binary:gh,...Do},Qu=uA;function he(r,e="utf8"){let t=Qu[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return t.decoder.decode(`${t.prefix}${r}`)}function le(r,e="utf8"){let t=Qu[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return t.encoder.encode(r).substring(1)}var lA=parseInt("11111",2),wh=parseInt("10000000",2),fA=parseInt("01111111",2),qg={0:Ta,1:Ta,2:pA,3:yA,4:mA,5:dA,6:hA,16:Ta,22:Ta,48:Ta};function dn(r,e={offset:0}){let t=r[e.offset]&lA;if(e.offset++,qg[t]!=null)return qg[t](r,e);throw new Error("No decoder for tag "+t)}function Ia(r,e){let t=0;if((r[e.offset]&wh)===wh){let n=r[e.offset]&fA,o="0x";e.offset++;for(let i=0;i<n;i++,e.offset++)o+=r[e.offset].toString(16).padStart(2,"0");t=parseInt(o,16)}else t=r[e.offset],e.offset++;return t}function Ta(r,e){Ia(r,e);let t=[];for(;!(e.offset>=r.byteLength);){let n=dn(r,e);if(n===null)break;t.push(n)}return t}function pA(r,e){let t=Ia(r,e),n=e.offset,o=e.offset+t,i=[];for(let s=n;s<o;s++)s===n&&r[s]===0||i.push(r[s]);return e.offset+=t,Uint8Array.from(i)}function hA(r,e){let t=Ia(r,e),n=e.offset+t,o=r[e.offset];e.offset++;let i=0,s=0;o<40?(i=0,s=o):o<80?(i=1,s=o-40):(i=2,s=o-80);let a=`${i}.${s}`,c=[];for(;e.offset<n;){let l=r[e.offset];if(e.offset++,c.push(l&127),l<128){c.reverse();let f=0;for(let p=0;p<c.length;p++)f+=c[p]<<p*7;a+=`.${f}`,c=[]}}return a}function dA(r,e){return e.offset++,null}function yA(r,e){let t=Ia(r,e),n=r[e.offset];e.offset++;let o=r.subarray(e.offset,e.offset+t-1);if(e.offset+=t,n!==0)throw new Error("Unused bits in bit string is unimplemented");return o}function mA(r,e){let t=Ia(r,e),n=r.subarray(e.offset,e.offset+t);return e.offset+=t,n}function gA(r){let e=r.toString(16);e.length%2===1&&(e="0"+e);let t=new be;for(let n=0;n<e.length;n+=2)t.append(Uint8Array.from([parseInt(`${e[n]}${e[n+1]}`,16)]));return t}function el(r){if(r.byteLength<128)return Uint8Array.from([r.byteLength]);let e=gA(r.byteLength);return new be(Uint8Array.from([e.byteLength|wh]),e)}function kt(r){let e=new be,t=128;return(r.subarray()[0]&t)===t&&e.append(Uint8Array.from([0])),e.append(r),new be(Uint8Array.from([2]),el(e),e)}function Oa(r){let e=Uint8Array.from([0]),t=new be(e,r);return new be(Uint8Array.from([3]),el(t),t)}function zg(r){return new be(Uint8Array.from([4]),el(r),r)}function Sr(r,e=48){let t=new be;for(let n of r)t.append(n);return new be(Uint8Array.from([e]),el(t),t)}async function Xg(r="P-256"){let e=await crypto.subtle.generateKey({name:"ECDSA",namedCurve:r},!0,["sign","verify"]);return{publicKey:await crypto.subtle.exportKey("jwk",e.publicKey),privateKey:await crypto.subtle.exportKey("jwk",e.privateKey)}}async function Zg(r,e,t){let n=await crypto.subtle.importKey("jwk",r,{name:"ECDSA",namedCurve:r.crv??"P-256"},!1,["sign"]);t?.signal?.throwIfAborted();let o=await crypto.subtle.sign({name:"ECDSA",hash:{name:"SHA-256"}},n,e.subarray());return t?.signal?.throwIfAborted(),new Uint8Array(o,0,o.byteLength)}async function Yg(r,e,t,n){let o=await crypto.subtle.importKey("jwk",r,{name:"ECDSA",namedCurve:r.crv??"P-256"},!1,["verify"]);n?.signal?.throwIfAborted();let i=await crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},o,e,t.subarray());return n?.signal?.throwIfAborted(),i}var wA=Uint8Array.from([6,8,42,134,72,206,61,3,1,7]),bA=Uint8Array.from([6,5,43,129,4,0,34]),xA=Uint8Array.from([6,5,43,129,4,0,35]),vA={ext:!0,kty:"EC",crv:"P-256"},_A={ext:!0,kty:"EC",crv:"P-384"},SA={ext:!0,kty:"EC",crv:"P-521"},bh=32,xh=48,vh=66;function _h(r){let e=dn(r);return Jg(e)}function Jg(r){let e=r[1][1][0],t=1,n,o;if(e.byteLength===bh*2+1)return n=le(e.subarray(t,t+bh),"base64url"),o=le(e.subarray(t+bh),"base64url"),new jo({...vA,key_ops:["verify"],x:n,y:o});if(e.byteLength===xh*2+1)return n=le(e.subarray(t,t+xh),"base64url"),o=le(e.subarray(t+xh),"base64url"),new jo({..._A,key_ops:["verify"],x:n,y:o});if(e.byteLength===vh*2+1)return n=le(e.subarray(t,t+vh),"base64url"),o=le(e.subarray(t+vh),"base64url"),new jo({...SA,key_ops:["verify"],x:n,y:o});throw new Ie(`coordinates were wrong length, got ${e.byteLength}, expected 65, 97 or 133`)}function Qg(r){return Sr([kt(Uint8Array.from([1])),zg(he(r.d??"","base64url")),Sr([t0(r.crv)],160),Sr([Oa(new be(Uint8Array.from([4]),he(r.x??"","base64url"),he(r.y??"","base64url")))],161)]).subarray()}function e0(r){return Sr([kt(Uint8Array.from([1])),Sr([t0(r.crv)],160),Sr([Oa(new be(Uint8Array.from([4]),he(r.x??"","base64url"),he(r.y??"","base64url")))],161)]).subarray()}function t0(r){if(r==="P-256")return wA;if(r==="P-384")return bA;if(r==="P-521")return xA;throw new Ie(`Invalid curve ${r}`)}async function r0(r="P-256"){let e=await Xg(r);return new tl(e.privateKey)}var jo=class{type="ECDSA";jwk;_raw;constructor(e){this.jwk=e}get raw(){return this._raw==null&&(this._raw=e0(this.jwk)),this._raw}toMultihash(){return _r.digest(qn(this))}toCID(){return Ze.createV1(114,this.toMultihash())}toString(){return Ke.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:We(this.raw,e.raw)}async verify(e,t,n){return Yg(this.jwk,t,e,n)}},tl=class{type="ECDSA";jwk;publicKey;_raw;constructor(e){this.jwk=e,this.publicKey=new jo({crv:e.crv,ext:e.ext,key_ops:["verify"],kty:"EC",x:e.x,y:e.y})}get raw(){return this._raw==null&&(this._raw=Qg(this.jwk)),this._raw}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:We(this.raw,e.raw)}async sign(e,t){return Zg(this.jwk,e,t)}};var Ro=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function ss(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Lo(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function Et(r,...e){if(!ss(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function Pa(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");Lo(r.outputLen),Lo(r.blockLen)}function as(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function o0(r,e){Et(r);let t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function Ar(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}function rl(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function Er(r,e){return r<<32-e|r>>>e}var i0=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",AA=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function Fr(r){if(Et(r),i0)return r.toHex();let e="";for(let t=0;t<r.length;t++)e+=AA[r[t]];return e}var yn={_0:48,_9:57,A:65,F:70,a:97,f:102};function n0(r){if(r>=yn._0&&r<=yn._9)return r-yn._0;if(r>=yn.A&&r<=yn.F)return r-(yn.A-10);if(r>=yn.a&&r<=yn.f)return r-(yn.a-10)}function cs(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);if(i0)return Uint8Array.fromHex(r);let e=r.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);let n=new Uint8Array(t);for(let o=0,i=0;o<t;o++,i+=2){let s=n0(r.charCodeAt(i)),a=n0(r.charCodeAt(i+1));if(s===void 0||a===void 0){let c=r[i]+r[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}n[o]=s*16+a}return n}function s0(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function zn(r){return typeof r=="string"&&(r=s0(r)),Et(r),r}function Jt(...r){let e=0;for(let n=0;n<r.length;n++){let o=r[n];Et(o),e+=o.length}let t=new Uint8Array(e);for(let n=0,o=0;n<r.length;n++){let i=r[n];t.set(i,o),o+=i.length}return t}var is=class{};function Sh(r){let e=n=>r().update(zn(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function Uo(r=32){if(Ro&&typeof Ro.getRandomValues=="function")return Ro.getRandomValues(new Uint8Array(r));if(Ro&&typeof Ro.randomBytes=="function")return Uint8Array.from(Ro.randomBytes(r));throw new Error("crypto.getRandomValues must be defined")}function EA(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);let o=BigInt(32),i=BigInt(4294967295),s=Number(t>>o&i),a=Number(t&i),c=n?4:0,l=n?0:4;r.setUint32(e+c,s,n),r.setUint32(e+l,a,n)}function a0(r,e,t){return r&e^~r&t}function c0(r,e,t){return r&e^r&t^e&t}var Ba=class extends is{constructor(e,t,n,o){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=o,this.buffer=new Uint8Array(e),this.view=rl(this.buffer)}update(e){as(this),e=zn(e),Et(e);let{view:t,buffer:n,blockLen:o}=this,i=e.length;for(let s=0;s<i;){let a=Math.min(o-this.pos,i-s);if(a===o){let c=rl(e);for(;o<=i-s;s+=o)this.process(c,s);continue}n.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===o&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){as(this),o0(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:o,isLE:i}=this,{pos:s}=this;t[s++]=128,Ar(this.buffer.subarray(s)),this.padOffset>o-s&&(this.process(n,0),s=0);for(let p=s;p<o;p++)t[p]=0;EA(n,o-8,BigInt(this.length*8),i),this.process(n,0);let a=rl(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let l=c/4,f=this.get();if(l>f.length)throw new Error("_sha2: outputLen bigger than state");for(let p=0;p<l;p++)a.setUint32(4*p,f[p],i)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:n,length:o,finished:i,destroyed:s,pos:a}=this;return e.destroyed=s,e.finished=i,e.length=o,e.pos=a,o%t&&e.buffer.set(n),e}clone(){return this._cloneInto()}},mn=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]);var ft=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]);var nl=BigInt(4294967295),u0=BigInt(32);function CA(r,e=!1){return e?{h:Number(r&nl),l:Number(r>>u0&nl)}:{h:Number(r>>u0&nl)|0,l:Number(r&nl)|0}}function l0(r,e=!1){let t=r.length,n=new Uint32Array(t),o=new Uint32Array(t);for(let i=0;i<t;i++){let{h:s,l:a}=CA(r[i],e);[n[i],o[i]]=[s,a]}return[n,o]}var Ah=(r,e,t)=>r>>>t,Eh=(r,e,t)=>r<<32-t|e>>>t,Mo=(r,e,t)=>r>>>t|e<<32-t,Ko=(r,e,t)=>r<<32-t|e>>>t,ka=(r,e,t)=>r<<64-t|e>>>t-32,Na=(r,e,t)=>r>>>t-32|e<<64-t;function Wr(r,e,t,n){let o=(e>>>0)+(n>>>0);return{h:r+t+(o/2**32|0)|0,l:o|0}}var f0=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),p0=(r,e,t,n)=>e+t+n+(r/2**32|0)|0,h0=(r,e,t,n)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0),d0=(r,e,t,n,o)=>e+t+n+o+(r/2**32|0)|0,y0=(r,e,t,n,o)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0)+(o>>>0),m0=(r,e,t,n,o,i)=>e+t+n+o+i+(r/2**32|0)|0;var IA=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Xn=new Uint32Array(64),ol=class extends Ba{constructor(e=32){super(64,e,8,!1),this.A=mn[0]|0,this.B=mn[1]|0,this.C=mn[2]|0,this.D=mn[3]|0,this.E=mn[4]|0,this.F=mn[5]|0,this.G=mn[6]|0,this.H=mn[7]|0}get(){let{A:e,B:t,C:n,D:o,E:i,F:s,G:a,H:c}=this;return[e,t,n,o,i,s,a,c]}set(e,t,n,o,i,s,a,c){this.A=e|0,this.B=t|0,this.C=n|0,this.D=o|0,this.E=i|0,this.F=s|0,this.G=a|0,this.H=c|0}process(e,t){for(let p=0;p<16;p++,t+=4)Xn[p]=e.getUint32(t,!1);for(let p=16;p<64;p++){let y=Xn[p-15],m=Xn[p-2],x=Er(y,7)^Er(y,18)^y>>>3,v=Er(m,17)^Er(m,19)^m>>>10;Xn[p]=v+Xn[p-7]+x+Xn[p-16]|0}let{A:n,B:o,C:i,D:s,E:a,F:c,G:l,H:f}=this;for(let p=0;p<64;p++){let y=Er(a,6)^Er(a,11)^Er(a,25),m=f+y+a0(a,c,l)+IA[p]+Xn[p]|0,v=(Er(n,2)^Er(n,13)^Er(n,22))+c0(n,o,i)|0;f=l,l=c,c=a,a=s+m|0,s=i,i=o,o=n,n=m+v|0}n=n+this.A|0,o=o+this.B|0,i=i+this.C|0,s=s+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,f=f+this.H|0,this.set(n,o,i,s,a,c,l,f)}roundClean(){Ar(Xn)}destroy(){this.set(0,0,0,0,0,0,0,0),Ar(this.buffer)}};var g0=l0(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),OA=g0[0],PA=g0[1],Zn=new Uint32Array(80),Yn=new Uint32Array(80),Ch=class extends Ba{constructor(e=64){super(128,e,16,!1),this.Ah=ft[0]|0,this.Al=ft[1]|0,this.Bh=ft[2]|0,this.Bl=ft[3]|0,this.Ch=ft[4]|0,this.Cl=ft[5]|0,this.Dh=ft[6]|0,this.Dl=ft[7]|0,this.Eh=ft[8]|0,this.El=ft[9]|0,this.Fh=ft[10]|0,this.Fl=ft[11]|0,this.Gh=ft[12]|0,this.Gl=ft[13]|0,this.Hh=ft[14]|0,this.Hl=ft[15]|0}get(){let{Ah:e,Al:t,Bh:n,Bl:o,Ch:i,Cl:s,Dh:a,Dl:c,Eh:l,El:f,Fh:p,Fl:y,Gh:m,Gl:x,Hh:v,Hl:d}=this;return[e,t,n,o,i,s,a,c,l,f,p,y,m,x,v,d]}set(e,t,n,o,i,s,a,c,l,f,p,y,m,x,v,d){this.Ah=e|0,this.Al=t|0,this.Bh=n|0,this.Bl=o|0,this.Ch=i|0,this.Cl=s|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=f|0,this.Fh=p|0,this.Fl=y|0,this.Gh=m|0,this.Gl=x|0,this.Hh=v|0,this.Hl=d|0}process(e,t){for(let j=0;j<16;j++,t+=4)Zn[j]=e.getUint32(t),Yn[j]=e.getUint32(t+=4);for(let j=16;j<80;j++){let Z=Zn[j-15]|0,P=Yn[j-15]|0,M=Mo(Z,P,1)^Mo(Z,P,8)^Ah(Z,P,7),V=Ko(Z,P,1)^Ko(Z,P,8)^Eh(Z,P,7),K=Zn[j-2]|0,g=Yn[j-2]|0,T=Mo(K,g,19)^ka(K,g,61)^Ah(K,g,6),E=Ko(K,g,19)^Na(K,g,61)^Eh(K,g,6),O=h0(V,E,Yn[j-7],Yn[j-16]),B=d0(O,M,T,Zn[j-7],Zn[j-16]);Zn[j]=B|0,Yn[j]=O|0}let{Ah:n,Al:o,Bh:i,Bl:s,Ch:a,Cl:c,Dh:l,Dl:f,Eh:p,El:y,Fh:m,Fl:x,Gh:v,Gl:d,Hh:I,Hl:D}=this;for(let j=0;j<80;j++){let Z=Mo(p,y,14)^Mo(p,y,18)^ka(p,y,41),P=Ko(p,y,14)^Ko(p,y,18)^Na(p,y,41),M=p&m^~p&v,V=y&x^~y&d,K=y0(D,P,V,PA[j],Yn[j]),g=m0(K,I,Z,M,OA[j],Zn[j]),T=K|0,E=Mo(n,o,28)^ka(n,o,34)^ka(n,o,39),O=Ko(n,o,28)^Na(n,o,34)^Na(n,o,39),B=n&i^n&a^i&a,R=o&s^o&c^s&c;I=v|0,D=d|0,v=m|0,d=x|0,m=p|0,x=y|0,{h:p,l:y}=Wr(l|0,f|0,g|0,T|0),l=a|0,f=c|0,a=i|0,c=s|0,i=n|0,s=o|0;let N=f0(T,O,R);n=p0(N,g,E,B),o=N|0}({h:n,l:o}=Wr(this.Ah|0,this.Al|0,n|0,o|0)),{h:i,l:s}=Wr(this.Bh|0,this.Bl|0,i|0,s|0),{h:a,l:c}=Wr(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:f}=Wr(this.Dh|0,this.Dl|0,l|0,f|0),{h:p,l:y}=Wr(this.Eh|0,this.El|0,p|0,y|0),{h:m,l:x}=Wr(this.Fh|0,this.Fl|0,m|0,x|0),{h:v,l:d}=Wr(this.Gh|0,this.Gl|0,v|0,d|0),{h:I,l:D}=Wr(this.Hh|0,this.Hl|0,I|0,D|0),this.set(n,o,i,s,a,c,l,f,p,y,m,x,v,d,I,D)}roundClean(){Ar(Zn,Yn)}destroy(){Ar(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};var il=Sh(()=>new ol);var w0=Sh(()=>new Ch);var Oh=BigInt(0),Ih=BigInt(1);function gn(r,e){if(typeof e!="boolean")throw new Error(r+" boolean expected, got "+e)}function Da(r){let e=r.toString(16);return e.length&1?"0"+e:e}function b0(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return r===""?Oh:BigInt("0x"+r)}function us(r){return b0(Fr(r))}function Gr(r){return Et(r),b0(Fr(Uint8Array.from(r).reverse()))}function sl(r,e){return cs(r.toString(16).padStart(e*2,"0"))}function Jn(r,e){return sl(r,e).reverse()}function ke(r,e,t){let n;if(typeof e=="string")try{n=cs(e)}catch(i){throw new Error(r+" must be hex string or Uint8Array, cause: "+i)}else if(ss(e))n=Uint8Array.from(e);else throw new Error(r+" must be hex string or Uint8Array");let o=n.length;if(typeof t=="number"&&o!==t)throw new Error(r+" of length "+t+" expected, got "+o);return n}var Th=r=>typeof r=="bigint"&&Oh<=r;function x0(r,e,t){return Th(r)&&Th(e)&&Th(t)&&e<=r&&r<t}function Cr(r,e,t,n){if(!x0(e,t,n))throw new Error("expected valid "+r+": "+t+" <= n < "+n+", got "+e)}function v0(r){let e;for(e=0;r>Oh;r>>=Ih,e+=1);return e}var Ho=r=>(Ih<<BigInt(r))-Ih;function _0(r,e,t){if(typeof r!="number"||r<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof t!="function")throw new Error("hmacFn must be a function");let n=m=>new Uint8Array(m),o=m=>Uint8Array.of(m),i=n(r),s=n(r),a=0,c=()=>{i.fill(1),s.fill(0),a=0},l=(...m)=>t(s,i,...m),f=(m=n(0))=>{s=l(o(0),m),i=l(),m.length!==0&&(s=l(o(1),m),i=l())},p=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let m=0,x=[];for(;m<e;){i=l();let v=i.slice();x.push(v),m+=i.length}return Jt(...x)};return(m,x)=>{c(),f(m);let v;for(;!(v=x(p()));)f();return c(),v}}function qr(r,e,t={}){if(!r||typeof r!="object")throw new Error("expected valid options object");function n(o,i,s){let a=r[o];if(s&&a===void 0)return;let c=typeof a;if(c!==i||a===null)throw new Error(`param "${o}" is invalid: expected ${i}, got ${c}`)}Object.entries(e).forEach(([o,i])=>n(o,i,!1)),Object.entries(t).forEach(([o,i])=>n(o,i,!0))}function ls(r){let e=new WeakMap;return(t,...n)=>{let o=e.get(t);if(o!==void 0)return o;let i=r(t,...n);return e.set(t,i),i}}var Nt=BigInt(0),ct=BigInt(1),Vo=BigInt(2),BA=BigInt(3),E0=BigInt(4),C0=BigInt(5),T0=BigInt(8);function je(r,e){let t=r%e;return t>=Nt?t:e+t}function Me(r,e,t){let n=r;for(;e-- >Nt;)n*=n,n%=t;return n}function S0(r,e){if(r===Nt)throw new Error("invert: expected non-zero number");if(e<=Nt)throw new Error("invert: expected positive modulus, got "+e);let t=je(r,e),n=e,o=Nt,i=ct,s=ct,a=Nt;for(;t!==Nt;){let l=n/t,f=n%t,p=o-s*l,y=i-a*l;n=t,t=f,o=s,i=a,s=p,a=y}if(n!==ct)throw new Error("invert: does not exist");return je(o,e)}function I0(r,e){let t=(r.ORDER+ct)/E0,n=r.pow(e,t);if(!r.eql(r.sqr(n),e))throw new Error("Cannot find square root");return n}function kA(r,e){let t=(r.ORDER-C0)/T0,n=r.mul(e,Vo),o=r.pow(n,t),i=r.mul(e,o),s=r.mul(r.mul(i,Vo),o),a=r.mul(i,r.sub(s,r.ONE));if(!r.eql(r.sqr(a),e))throw new Error("Cannot find square root");return a}function NA(r){if(r<BigInt(3))throw new Error("sqrt is not defined for small field");let e=r-ct,t=0;for(;e%Vo===Nt;)e/=Vo,t++;let n=Vo,o=Tr(r);for(;A0(o,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(t===1)return I0;let i=o.pow(n,e),s=(e+ct)/Vo;return function(c,l){if(c.is0(l))return l;if(A0(c,l)!==1)throw new Error("Cannot find square root");let f=t,p=c.mul(c.ONE,i),y=c.pow(l,e),m=c.pow(l,s);for(;!c.eql(y,c.ONE);){if(c.is0(y))return c.ZERO;let x=1,v=c.sqr(y);for(;!c.eql(v,c.ONE);)if(x++,v=c.sqr(v),x===f)throw new Error("Cannot find square root");let d=ct<<BigInt(f-x-1),I=c.pow(p,d);f=x,p=c.sqr(I),y=c.mul(y,p),m=c.mul(m,I)}return m}}function DA(r){return r%E0===BA?I0:r%T0===C0?kA:NA(r)}var O0=(r,e)=>(je(r,e)&ct)===ct,jA=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Ph(r){let e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},t=jA.reduce((n,o)=>(n[o]="function",n),e);return qr(r,t),r}function RA(r,e,t){if(t<Nt)throw new Error("invalid exponent, negatives unsupported");if(t===Nt)return r.ONE;if(t===ct)return e;let n=r.ONE,o=e;for(;t>Nt;)t&ct&&(n=r.mul(n,o)),o=r.sqr(o),t>>=ct;return n}function ja(r,e,t=!1){let n=new Array(e.length).fill(t?r.ZERO:void 0),o=e.reduce((s,a,c)=>r.is0(a)?s:(n[c]=s,r.mul(s,a)),r.ONE),i=r.inv(o);return e.reduceRight((s,a,c)=>r.is0(a)?s:(n[c]=r.mul(s,n[c]),r.mul(s,a)),i),n}function A0(r,e){let t=(r.ORDER-ct)/Vo,n=r.pow(e,t),o=r.eql(n,r.ONE),i=r.eql(n,r.ZERO),s=r.eql(n,r.neg(r.ONE));if(!o&&!i&&!s)throw new Error("invalid Legendre symbol result");return o?1:i?0:-1}function P0(r,e){e!==void 0&&Lo(e);let t=e!==void 0?e:r.toString(2).length,n=Math.ceil(t/8);return{nBitLength:t,nByteLength:n}}function Tr(r,e,t=!1,n={}){if(r<=Nt)throw new Error("invalid field: expected ORDER > 0, got "+r);let o,i;if(typeof e=="object"&&e!=null){if(n.sqrt||t)throw new Error("cannot specify opts in two arguments");let f=e;f.BITS&&(o=f.BITS),f.sqrt&&(i=f.sqrt),typeof f.isLE=="boolean"&&(t=f.isLE)}else typeof e=="number"&&(o=e),n.sqrt&&(i=n.sqrt);let{nBitLength:s,nByteLength:a}=P0(r,o);if(a>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let c,l=Object.freeze({ORDER:r,isLE:t,BITS:s,BYTES:a,MASK:Ho(s),ZERO:Nt,ONE:ct,create:f=>je(f,r),isValid:f=>{if(typeof f!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof f);return Nt<=f&&f<r},is0:f=>f===Nt,isValidNot0:f=>!l.is0(f)&&l.isValid(f),isOdd:f=>(f&ct)===ct,neg:f=>je(-f,r),eql:(f,p)=>f===p,sqr:f=>je(f*f,r),add:(f,p)=>je(f+p,r),sub:(f,p)=>je(f-p,r),mul:(f,p)=>je(f*p,r),pow:(f,p)=>RA(l,f,p),div:(f,p)=>je(f*S0(p,r),r),sqrN:f=>f*f,addN:(f,p)=>f+p,subN:(f,p)=>f-p,mulN:(f,p)=>f*p,inv:f=>S0(f,r),sqrt:i||(f=>(c||(c=DA(r)),c(l,f))),toBytes:f=>t?Jn(f,a):sl(f,a),fromBytes:f=>{if(f.length!==a)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+f.length);return t?Gr(f):us(f)},invertBatch:f=>ja(l,f),cmov:(f,p,y)=>y?p:f});return Object.freeze(l)}function B0(r){if(typeof r!="bigint")throw new Error("field order must be bigint");let e=r.toString(2).length;return Math.ceil(e/8)}function Bh(r){let e=B0(r);return e+Math.ceil(e/2)}function k0(r,e,t=!1){let n=r.length,o=B0(e),i=Bh(e);if(n<16||n<i||n>1024)throw new Error("expected "+i+"-1024 bytes of input, got "+n);let s=t?Gr(r):us(r),a=je(s,e-ct)+ct;return t?Jn(a,o):sl(a,o)}var ps=BigInt(0),$o=BigInt(1);function fs(r,e){let t=e.negate();return r?t:e}function al(r,e,t){let n=e==="pz"?s=>s.pz:s=>s.ez,o=ja(r.Fp,t.map(n));return t.map((s,a)=>s.toAffine(o[a])).map(r.fromAffine)}function R0(r,e){if(!Number.isSafeInteger(r)||r<=0||r>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+r)}function kh(r,e){R0(r,e);let t=Math.ceil(e/r)+1,n=2**(r-1),o=2**r,i=Ho(r),s=BigInt(r);return{windows:t,windowSize:n,mask:i,maxNumber:o,shiftBy:s}}function N0(r,e,t){let{windowSize:n,mask:o,maxNumber:i,shiftBy:s}=t,a=Number(r&o),c=r>>s;a>n&&(a-=i,c+=$o);let l=e*n,f=l+Math.abs(a)-1,p=a===0,y=a<0,m=e%2!==0;return{nextN:c,offset:f,isZero:p,isNeg:y,isNegF:m,offsetF:l}}function LA(r,e){if(!Array.isArray(r))throw new Error("array expected");r.forEach((t,n)=>{if(!(t instanceof e))throw new Error("invalid point at index "+n)})}function UA(r,e){if(!Array.isArray(r))throw new Error("array of scalars expected");r.forEach((t,n)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+n)})}var Nh=new WeakMap,L0=new WeakMap;function Dh(r){return L0.get(r)||1}function D0(r){if(r!==ps)throw new Error("invalid wNAF")}function cl(r,e){return{constTimeNegate:fs,hasPrecomputes(t){return Dh(t)!==1},unsafeLadder(t,n,o=r.ZERO){let i=t;for(;n>ps;)n&$o&&(o=o.add(i)),i=i.double(),n>>=$o;return o},precomputeWindow(t,n){let{windows:o,windowSize:i}=kh(n,e),s=[],a=t,c=a;for(let l=0;l<o;l++){c=a,s.push(c);for(let f=1;f<i;f++)c=c.add(a),s.push(c);a=c.double()}return s},wNAF(t,n,o){let i=r.ZERO,s=r.BASE,a=kh(t,e);for(let c=0;c<a.windows;c++){let{nextN:l,offset:f,isZero:p,isNeg:y,isNegF:m,offsetF:x}=N0(o,c,a);o=l,p?s=s.add(fs(m,n[x])):i=i.add(fs(y,n[f]))}return D0(o),{p:i,f:s}},wNAFUnsafe(t,n,o,i=r.ZERO){let s=kh(t,e);for(let a=0;a<s.windows&&o!==ps;a++){let{nextN:c,offset:l,isZero:f,isNeg:p}=N0(o,a,s);if(o=c,!f){let y=n[l];i=i.add(p?y.negate():y)}}return D0(o),i},getPrecomputes(t,n,o){let i=Nh.get(n);return i||(i=this.precomputeWindow(n,t),t!==1&&(typeof o=="function"&&(i=o(i)),Nh.set(n,i))),i},wNAFCached(t,n,o){let i=Dh(t);return this.wNAF(i,this.getPrecomputes(i,t,o),n)},wNAFCachedUnsafe(t,n,o,i){let s=Dh(t);return s===1?this.unsafeLadder(t,n,i):this.wNAFUnsafe(s,this.getPrecomputes(s,t,o),n,i)},setWindowSize(t,n){R0(n,e),L0.set(t,n),Nh.delete(t)}}}function U0(r,e,t,n){let o=e,i=r.ZERO,s=r.ZERO;for(;t>ps||n>ps;)t&$o&&(i=i.add(o)),n&$o&&(s=s.add(o)),o=o.double(),t>>=$o,n>>=$o;return{p1:i,p2:s}}function ul(r,e,t,n){LA(t,r),UA(n,e);let o=t.length,i=n.length;if(o!==i)throw new Error("arrays of points and scalars must have equal length");let s=r.ZERO,a=v0(BigInt(o)),c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);let l=Ho(c),f=new Array(Number(l)+1).fill(s),p=Math.floor((e.BITS-1)/c)*c,y=s;for(let m=p;m>=0;m-=c){f.fill(s);for(let v=0;v<i;v++){let d=n[v],I=Number(d>>BigInt(m)&l);f[I]=f[I].add(t[v])}let x=s;for(let v=f.length-1,d=s;v>0;v--)d=d.add(f[v]),x=x.add(d);if(y=y.add(x),m!==0)for(let v=0;v<c;v++)y=y.double()}return y}function j0(r,e){if(e){if(e.ORDER!==r)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return Ph(e),e}else return Tr(r)}function ll(r,e,t={}){if(!e||typeof e!="object")throw new Error(`expected valid ${r} CURVE object`);for(let a of["p","n","h"]){let c=e[a];if(!(typeof c=="bigint"&&c>ps))throw new Error(`CURVE.${a} must be positive bigint`)}let n=j0(e.p,t.Fp),o=j0(e.n,t.Fn),s=["Gx","Gy","a",r==="weierstrass"?"b":"d"];for(let a of s)if(!n.isValid(e[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return{Fp:n,Fn:o}}var zr=BigInt(0),Dt=BigInt(1),jh=BigInt(2),MA=BigInt(8),KA={zip215:!0};function HA(r,e,t,n){let o=r.sqr(t),i=r.sqr(n),s=r.add(r.mul(e.a,o),i),a=r.add(r.ONE,r.mul(e.d,r.mul(o,i)));return r.eql(s,a)}function VA(r,e={}){let{Fp:t,Fn:n}=ll("edwards",r,e),{h:o,n:i}=r;qr(e,{},{uvRatio:"function"});let s=jh<<BigInt(n.BYTES*8)-Dt,a=v=>t.create(v),c=e.uvRatio||((v,d)=>{try{return{isValid:!0,value:t.sqrt(t.div(v,d))}}catch{return{isValid:!1,value:zr}}});if(!HA(t,r,r.Gx,r.Gy))throw new Error("bad curve params: generator point");function l(v,d,I=!1){let D=I?Dt:zr;return Cr("coordinate "+v,d,D,s),d}function f(v){if(!(v instanceof m))throw new Error("ExtendedPoint expected")}let p=ls((v,d)=>{let{ex:I,ey:D,ez:j}=v,Z=v.is0();d==null&&(d=Z?MA:t.inv(j));let P=a(I*d),M=a(D*d),V=a(j*d);if(Z)return{x:zr,y:Dt};if(V!==Dt)throw new Error("invZ was invalid");return{x:P,y:M}}),y=ls(v=>{let{a:d,d:I}=r;if(v.is0())throw new Error("bad point: ZERO");let{ex:D,ey:j,ez:Z,et:P}=v,M=a(D*D),V=a(j*j),K=a(Z*Z),g=a(K*K),T=a(M*d),E=a(K*a(T+V)),O=a(g+a(I*a(M*V)));if(E!==O)throw new Error("bad point: equation left != right (1)");let B=a(D*j),R=a(Z*P);if(B!==R)throw new Error("bad point: equation left != right (2)");return!0});class m{constructor(d,I,D,j){this.ex=l("x",d),this.ey=l("y",I),this.ez=l("z",D,!0),this.et=l("t",j),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(d){if(d instanceof m)throw new Error("extended point not allowed");let{x:I,y:D}=d||{};return l("x",I),l("y",D),new m(I,D,Dt,a(I*D))}static normalizeZ(d){return al(m,"ez",d)}static msm(d,I){return ul(m,n,d,I)}_setWindowSize(d){this.precompute(d)}precompute(d=8,I=!0){return x.setWindowSize(this,d),I||this.multiply(jh),this}assertValidity(){y(this)}equals(d){f(d);let{ex:I,ey:D,ez:j}=this,{ex:Z,ey:P,ez:M}=d,V=a(I*M),K=a(Z*j),g=a(D*M),T=a(P*j);return V===K&&g===T}is0(){return this.equals(m.ZERO)}negate(){return new m(a(-this.ex),this.ey,this.ez,a(-this.et))}double(){let{a:d}=r,{ex:I,ey:D,ez:j}=this,Z=a(I*I),P=a(D*D),M=a(jh*a(j*j)),V=a(d*Z),K=I+D,g=a(a(K*K)-Z-P),T=V+P,E=T-M,O=V-P,B=a(g*E),R=a(T*O),N=a(g*O),L=a(E*T);return new m(B,R,L,N)}add(d){f(d);let{a:I,d:D}=r,{ex:j,ey:Z,ez:P,et:M}=this,{ex:V,ey:K,ez:g,et:T}=d,E=a(j*V),O=a(Z*K),B=a(M*D*T),R=a(P*g),N=a((j+Z)*(V+K)-E-O),L=R-B,W=R+B,X=a(O-I*E),G=a(N*L),ie=a(W*X),Y=a(N*X),U=a(L*W);return new m(G,ie,U,Y)}subtract(d){return this.add(d.negate())}multiply(d){let I=d;Cr("scalar",I,Dt,i);let{p:D,f:j}=x.wNAFCached(this,I,m.normalizeZ);return m.normalizeZ([D,j])[0]}multiplyUnsafe(d,I=m.ZERO){let D=d;return Cr("scalar",D,zr,i),D===zr?m.ZERO:this.is0()||D===Dt?this:x.wNAFCachedUnsafe(this,D,m.normalizeZ,I)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}isTorsionFree(){return x.wNAFCachedUnsafe(this,i).is0()}toAffine(d){return p(this,d)}clearCofactor(){return o===Dt?this:this.multiplyUnsafe(o)}static fromBytes(d,I=!1){return Et(d),this.fromHex(d,I)}static fromHex(d,I=!1){let{d:D,a:j}=r,Z=t.BYTES;d=ke("pointHex",d,Z),gn("zip215",I);let P=d.slice(),M=d[Z-1];P[Z-1]=M&-129;let V=Gr(P),K=I?s:t.ORDER;Cr("pointHex.y",V,zr,K);let g=a(V*V),T=a(g-Dt),E=a(D*g-j),{isValid:O,value:B}=c(T,E);if(!O)throw new Error("Point.fromHex: invalid y coordinate");let R=(B&Dt)===Dt,N=(M&128)!==0;if(!I&&B===zr&&N)throw new Error("Point.fromHex: x=0 and x_0=1");return N!==R&&(B=a(-B)),m.fromAffine({x:B,y:V})}static fromPrivateScalar(d){return m.BASE.multiply(d)}toBytes(){let{x:d,y:I}=this.toAffine(),D=Jn(I,t.BYTES);return D[D.length-1]|=d&Dt?128:0,D}toRawBytes(){return this.toBytes()}toHex(){return Fr(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}m.BASE=new m(r.Gx,r.Gy,Dt,a(r.Gx*r.Gy)),m.ZERO=new m(zr,Dt,Dt,zr),m.Fp=t,m.Fn=n;let x=cl(m,n.BYTES*8);return m}function $A(r,e){qr(e,{hash:"function"},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});let{prehash:t,hash:n}=e,{BASE:o,Fp:i,Fn:s}=r,a=s.ORDER,c=e.randomBytes||Uo,l=e.adjustScalarBytes||(P=>P),f=e.domain||((P,M,V)=>{if(gn("phflag",V),M.length||V)throw new Error("Contexts/pre-hash are not supported");return P});function p(P){return s.create(P)}function y(P){return p(Gr(P))}function m(P){let M=i.BYTES;P=ke("private key",P,M);let V=ke("hashed private key",n(P),2*M),K=l(V.slice(0,M)),g=V.slice(M,2*M),T=y(K);return{head:K,prefix:g,scalar:T}}function x(P){let{head:M,prefix:V,scalar:K}=m(P),g=o.multiply(K),T=g.toBytes();return{head:M,prefix:V,scalar:K,point:g,pointBytes:T}}function v(P){return x(P).pointBytes}function d(P=Uint8Array.of(),...M){let V=Jt(...M);return y(n(f(V,ke("context",P),!!t)))}function I(P,M,V={}){P=ke("message",P),t&&(P=t(P));let{prefix:K,scalar:g,pointBytes:T}=x(M),E=d(V.context,K,P),O=o.multiply(E).toBytes(),B=d(V.context,O,T,P),R=p(E+B*g);Cr("signature.s",R,zr,a);let N=i.BYTES,L=Jt(O,Jn(R,N));return ke("result",L,N*2)}let D=KA;function j(P,M,V,K=D){let{context:g,zip215:T}=K,E=i.BYTES;P=ke("signature",P,2*E),M=ke("message",M),V=ke("publicKey",V,E),T!==void 0&&gn("zip215",T),t&&(M=t(M));let O=Gr(P.slice(E,2*E)),B,R,N;try{B=r.fromHex(V,T),R=r.fromHex(P.slice(0,E),T),N=o.multiplyUnsafe(O)}catch{return!1}if(!T&&B.isSmallOrder())return!1;let L=d(g,R.toBytes(),B.toBytes(),M);return R.add(B.multiplyUnsafe(L)).subtract(N).clearCofactor().is0()}return o.precompute(8),{getPublicKey:v,sign:I,verify:j,utils:{getExtendedPublicKey:x,randomPrivateKey:()=>c(i.BYTES),precompute(P=8,M=r.BASE){return M.precompute(P,!1)}},Point:r}}function FA(r){let e={a:r.a,d:r.d,p:r.Fp.ORDER,n:r.n,h:r.h,Gx:r.Gx,Gy:r.Gy},t=r.Fp,n=Tr(e.n,r.nBitLength,!0),o={Fp:t,Fn:n,uvRatio:r.uvRatio},i={hash:r.hash,randomBytes:r.randomBytes,adjustScalarBytes:r.adjustScalarBytes,domain:r.domain,prehash:r.prehash,mapToCurve:r.mapToCurve};return{CURVE:e,curveOpts:o,eddsaOpts:i}}function WA(r,e){return Object.assign({},e,{ExtendedPoint:e.Point,CURVE:r})}function M0(r){let{CURVE:e,curveOpts:t,eddsaOpts:n}=FA(r),o=VA(e,t),i=$A(o,n);return WA(r,i)}var Ra=BigInt(0),hs=BigInt(1),fl=BigInt(2);function GA(r){return qr(r,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...r})}function K0(r){let e=GA(r),{P:t,type:n,adjustScalarBytes:o,powPminus2:i,randomBytes:s}=e,a=n==="x25519";if(!a&&n!=="x448")throw new Error("invalid type");let c=s||Uo,l=a?255:448,f=a?32:56,p=BigInt(a?9:5),y=BigInt(a?121665:39081),m=a?fl**BigInt(254):fl**BigInt(447),x=a?BigInt(8)*fl**BigInt(251)-hs:BigInt(4)*fl**BigInt(445)-hs,v=m+x+hs,d=g=>je(g,t),I=D(p);function D(g){return Jn(d(g),f)}function j(g){let T=ke("u coordinate",g,f);return a&&(T[31]&=127),d(Gr(T))}function Z(g){return Gr(o(ke("scalar",g,f)))}function P(g,T){let E=K(j(T),Z(g));if(E===Ra)throw new Error("invalid private or public key received");return D(E)}function M(g){return P(g,I)}function V(g,T,E){let O=d(g*(T-E));return T=d(T-O),E=d(E+O),{x_2:T,x_3:E}}function K(g,T){Cr("u",g,Ra,t),Cr("scalar",T,m,v);let E=T,O=g,B=hs,R=Ra,N=g,L=hs,W=Ra;for(let G=BigInt(l-1);G>=Ra;G--){let ie=E>>G&hs;W^=ie,{x_2:B,x_3:N}=V(W,B,N),{x_2:R,x_3:L}=V(W,R,L),W=ie;let Y=B+R,U=d(Y*Y),de=B-R,Oe=d(de*de),se=U-Oe,De=N+L,_t=N-L,tt=d(_t*Y),rt=d(De*de),lt=tt+rt,ir=tt-rt;N=d(lt*lt),L=d(O*d(ir*ir)),B=d(U*Oe),R=d(se*(U+d(y*se)))}({x_2:B,x_3:N}=V(W,B,N)),{x_2:R,x_3:L}=V(W,R,L);let X=i(R);return d(B*X)}return{scalarMult:P,scalarMultBase:M,getSharedSecret:(g,T)=>P(g,T),getPublicKey:g=>M(g),utils:{randomPrivateKey:()=>c(f)},GuBytes:I.slice()}}var OP=BigInt(0),qA=BigInt(1),H0=BigInt(2),zA=BigInt(3),XA=BigInt(5),ZA=BigInt(8),La={p:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:ZA,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function $0(r){let e=BigInt(10),t=BigInt(20),n=BigInt(40),o=BigInt(80),i=La.p,a=r*r%i*r%i,c=Me(a,H0,i)*a%i,l=Me(c,qA,i)*r%i,f=Me(l,XA,i)*l%i,p=Me(f,e,i)*f%i,y=Me(p,t,i)*p%i,m=Me(y,n,i)*y%i,x=Me(m,o,i)*m%i,v=Me(x,o,i)*m%i,d=Me(v,e,i)*f%i;return{pow_p_5_8:Me(d,H0,i)*r%i,b2:a}}function F0(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}var V0=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function YA(r,e){let t=La.p,n=je(e*e*e,t),o=je(n*n*e,t),i=$0(r*o).pow_p_5_8,s=je(r*n*i,t),a=je(e*s*s,t),c=s,l=je(s*V0,t),f=a===r,p=a===je(-r,t),y=a===je(-r*V0,t);return f&&(s=c),(p||y)&&(s=l),O0(s,t)&&(s=je(-s,t)),{isValid:f||p,value:s}}var JA=Tr(La.p,void 0,!0),QA={...La,Fp:JA,hash:w0,adjustScalarBytes:F0,uvRatio:YA},Ua=M0(QA);var Ma=(()=>{let r=La.p;return K0({P:r,type:"x25519",powPminus2:e=>{let{pow_p_5_8:t,b2:n}=$0(e);return je(Me(t,zA,r)*n,r)},adjustScalarBytes:F0})})();var Ka=class extends Error{constructor(e="An error occurred while signing a message"){super(e),this.name="SigningError"}},Ha=class extends Error{constructor(e="An error occurred while verifying a message"){super(e),this.name="VerificationError"}},pl=class extends Error{constructor(e="Missing Web Crypto API"){super(e),this.name="WebCryptoMissingError"}};var W0={get(r=globalThis){let e=r.crypto;if(e?.subtle==null)throw new pl("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api");return e}};var Ut=W0;var hl=32,Va=64,Rh=32;var ds,G0=(async()=>{try{return await Ut.get().subtle.generateKey({name:"Ed25519"},!0,["sign","verify"]),!0}catch{return!1}})();function q0(){let r=Ua.utils.randomPrivateKey(),e=Ua.getPublicKey(r);return{privateKey:oE(r,e),publicKey:e}}async function eE(r,e){let t;r.length===Va?t=r.subarray(0,32):t=r;let n={crv:"Ed25519",kty:"OKP",x:le(r.subarray(32),"base64url"),d:le(t,"base64url"),ext:!0,key_ops:["sign"]},o=await Ut.get().subtle.importKey("jwk",n,{name:"Ed25519"},!0,["sign"]),i=await Ut.get().subtle.sign({name:"Ed25519"},o,e instanceof Uint8Array?e:e.subarray());return new Uint8Array(i,0,i.byteLength)}function tE(r,e){let t=r.subarray(0,Rh);return Ua.sign(e instanceof Uint8Array?e:e.subarray(),t)}async function z0(r,e){return ds==null&&(ds=await G0),ds?eE(r,e):tE(r,e)}async function rE(r,e,t){if(r.buffer instanceof ArrayBuffer){let n=await Ut.get().subtle.importKey("raw",r.buffer,{name:"Ed25519"},!1,["verify"]);return await Ut.get().subtle.verify({name:"Ed25519"},n,e,t instanceof Uint8Array?t:t.subarray())}throw new TypeError("WebCrypto does not support SharedArrayBuffer for Ed25519 keys")}function nE(r,e,t){return Ua.verify(e,t instanceof Uint8Array?t:t.subarray(),r)}async function X0(r,e,t){return ds==null&&(ds=await G0),ds?rE(r,e,t):nE(r,e,t)}function oE(r,e){let t=new Uint8Array(Va);for(let n=0;n<Rh;n++)t[n]=r[n],t[Rh+n]=e[n];return t}function ys(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}var $a=class{type="Ed25519";raw;constructor(e){this.raw=yl(e,hl)}toMultihash(){return _r.digest(qn(this))}toCID(){return Ze.createV1(114,this.toMultihash())}toString(){return Ke.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:We(this.raw,e.raw)}verify(e,t,n){n?.signal?.throwIfAborted();let o=X0(this.raw,t,e);return ys(o)?o.then(i=>(n?.signal?.throwIfAborted(),i)):o}},dl=class{type="Ed25519";raw;publicKey;constructor(e,t){this.raw=yl(e,Va),this.publicKey=new $a(t)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:We(this.raw,e.raw)}sign(e,t){t?.signal?.throwIfAborted();let n=z0(this.raw,e);return ys(n)?n.then(o=>(t?.signal?.throwIfAborted(),o)):(t?.signal?.throwIfAborted(),n)}};function Lh(r){return r=yl(r,hl),new $a(r)}async function Y0(){let{privateKey:r,publicKey:e}=q0();return new dl(r,e)}function yl(r,e){if(r=Uint8Array.from(r??[]),r.length!==e)throw new Ie(`Key must be a Uint8Array of length ${e}, got ${r.length}`);return r}var iE=Math.pow(2,7),sE=Math.pow(2,14),aE=Math.pow(2,21),Uh=Math.pow(2,28),Mh=Math.pow(2,35),Kh=Math.pow(2,42),Hh=Math.pow(2,49),Ce=128,Ct=127;function Ve(r){if(r<iE)return 1;if(r<sE)return 2;if(r<aE)return 3;if(r<Uh)return 4;if(r<Mh)return 5;if(r<Kh)return 6;if(r<Hh)return 7;if(Number.MAX_SAFE_INTEGER!=null&&r>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function ms(r,e,t=0){switch(Ve(r)){case 8:e[t++]=r&255|Ce,r/=128;case 7:e[t++]=r&255|Ce,r/=128;case 6:e[t++]=r&255|Ce,r/=128;case 5:e[t++]=r&255|Ce,r/=128;case 4:e[t++]=r&255|Ce,r>>>=7;case 3:e[t++]=r&255|Ce,r>>>=7;case 2:e[t++]=r&255|Ce,r>>>=7;case 1:{e[t++]=r&255,r>>>=7;break}default:throw new Error("unreachable")}return e}function cE(r,e,t=0){switch(Ve(r)){case 8:e.set(t++,r&255|Ce),r/=128;case 7:e.set(t++,r&255|Ce),r/=128;case 6:e.set(t++,r&255|Ce),r/=128;case 5:e.set(t++,r&255|Ce),r/=128;case 4:e.set(t++,r&255|Ce),r>>>=7;case 3:e.set(t++,r&255|Ce),r>>>=7;case 2:e.set(t++,r&255|Ce),r>>>=7;case 1:{e.set(t++,r&255),r>>>=7;break}default:throw new Error("unreachable")}return e}function Vh(r,e){let t=r[e],n=0;if(n+=t&Ct,t<Ce||(t=r[e+1],n+=(t&Ct)<<7,t<Ce)||(t=r[e+2],n+=(t&Ct)<<14,t<Ce)||(t=r[e+3],n+=(t&Ct)<<21,t<Ce)||(t=r[e+4],n+=(t&Ct)*Uh,t<Ce)||(t=r[e+5],n+=(t&Ct)*Mh,t<Ce)||(t=r[e+6],n+=(t&Ct)*Kh,t<Ce)||(t=r[e+7],n+=(t&Ct)*Hh,t<Ce))return n;throw new RangeError("Could not decode varint")}function uE(r,e){let t=r.get(e),n=0;if(n+=t&Ct,t<Ce||(t=r.get(e+1),n+=(t&Ct)<<7,t<Ce)||(t=r.get(e+2),n+=(t&Ct)<<14,t<Ce)||(t=r.get(e+3),n+=(t&Ct)<<21,t<Ce)||(t=r.get(e+4),n+=(t&Ct)*Uh,t<Ce)||(t=r.get(e+5),n+=(t&Ct)*Mh,t<Ce)||(t=r.get(e+6),n+=(t&Ct)*Kh,t<Ce)||(t=r.get(e+7),n+=(t&Ct)*Hh,t<Ce))return n;throw new RangeError("Could not decode varint")}function ml(r,e,t=0){return e==null&&(e=it(Ve(r))),e instanceof Uint8Array?ms(r,e,t):cE(r,e,t)}function Fo(r,e=0){return r instanceof Uint8Array?Vh(r,e):uE(r,e)}var $h=new Float32Array([-0]),Qn=new Uint8Array($h.buffer);function J0(r,e,t){$h[0]=r,e[t]=Qn[0],e[t+1]=Qn[1],e[t+2]=Qn[2],e[t+3]=Qn[3]}function Q0(r,e){return Qn[0]=r[e],Qn[1]=r[e+1],Qn[2]=r[e+2],Qn[3]=r[e+3],$h[0]}var Fh=new Float64Array([-0]),Tt=new Uint8Array(Fh.buffer);function ew(r,e,t){Fh[0]=r,e[t]=Tt[0],e[t+1]=Tt[1],e[t+2]=Tt[2],e[t+3]=Tt[3],e[t+4]=Tt[4],e[t+5]=Tt[5],e[t+6]=Tt[6],e[t+7]=Tt[7]}function tw(r,e){return Tt[0]=r[e],Tt[1]=r[e+1],Tt[2]=r[e+2],Tt[3]=r[e+3],Tt[4]=r[e+4],Tt[5]=r[e+5],Tt[6]=r[e+6],Tt[7]=r[e+7],Fh[0]}var lE=BigInt(Number.MAX_SAFE_INTEGER),fE=BigInt(Number.MIN_SAFE_INTEGER),Qt=class r{lo;hi;constructor(e,t){this.lo=e|0,this.hi=t|0}toNumber(e=!1){if(!e&&this.hi>>>31>0){let t=~this.lo+1>>>0,n=~this.hi>>>0;return t===0&&(n=n+1>>>0),-(t+n*4294967296)}return this.lo+this.hi*4294967296}toBigInt(e=!1){if(e)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){let t=~this.lo+1>>>0,n=~this.hi>>>0;return t===0&&(n=n+1>>>0),-(BigInt(t)+(BigInt(n)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(e=!1){return this.toBigInt(e).toString()}zzEncode(){let e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this}zzDecode(){let e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this}length(){let e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}static fromBigInt(e){if(e===0n)return Wo;if(e<lE&&e>fE)return this.fromNumber(Number(e));let t=e<0n;t&&(e=-e);let n=e>>32n,o=e-(n<<32n);return t&&(n=~n|0n,o=~o|0n,++o>rw&&(o=0n,++n>rw&&(n=0n))),new r(Number(o),Number(n))}static fromNumber(e){if(e===0)return Wo;let t=e<0;t&&(e=-e);let n=e>>>0,o=(e-n)/4294967296>>>0;return t&&(o=~o>>>0,n=~n>>>0,++n>4294967295&&(n=0,++o>4294967295&&(o=0))),new r(n,o)}static from(e){return typeof e=="number"?r.fromNumber(e):typeof e=="bigint"?r.fromBigInt(e):typeof e=="string"?r.fromBigInt(BigInt(e)):e.low!=null||e.high!=null?new r(e.low>>>0,e.high>>>0):Wo}},Wo=new Qt(0,0);Wo.toBigInt=function(){return 0n};Wo.zzEncode=Wo.zzDecode=function(){return this};Wo.length=function(){return 1};var rw=4294967296n;function nw(r){let e=0,t=0;for(let n=0;n<r.length;++n)t=r.charCodeAt(n),t<128?e+=1:t<2048?e+=2:(t&64512)===55296&&(r.charCodeAt(n+1)&64512)===56320?(++n,e+=4):e+=3;return e}function ow(r,e,t){if(t-e<1)return"";let o,i=[],s=0,a;for(;e<t;)a=r[e++],a<128?i[s++]=a:a>191&&a<224?i[s++]=(a&31)<<6|r[e++]&63:a>239&&a<365?(a=((a&7)<<18|(r[e++]&63)<<12|(r[e++]&63)<<6|r[e++]&63)-65536,i[s++]=55296+(a>>10),i[s++]=56320+(a&1023)):i[s++]=(a&15)<<12|(r[e++]&63)<<6|r[e++]&63,s>8191&&((o??(o=[])).push(String.fromCharCode.apply(String,i)),s=0);return o!=null?(s>0&&o.push(String.fromCharCode.apply(String,i.slice(0,s))),o.join("")):String.fromCharCode.apply(String,i.slice(0,s))}function Wh(r,e,t){let n=t,o,i;for(let s=0;s<r.length;++s)o=r.charCodeAt(s),o<128?e[t++]=o:o<2048?(e[t++]=o>>6|192,e[t++]=o&63|128):(o&64512)===55296&&((i=r.charCodeAt(s+1))&64512)===56320?(o=65536+((o&1023)<<10)+(i&1023),++s,e[t++]=o>>18|240,e[t++]=o>>12&63|128,e[t++]=o>>6&63|128,e[t++]=o&63|128):(e[t++]=o>>12|224,e[t++]=o>>6&63|128,e[t++]=o&63|128);return t-n}function Ir(r,e){return RangeError(`index out of range: ${r.pos} + ${e??1} > ${r.len}`)}function wl(r,e){return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0}var Gh=class{buf;pos;len;_slice=Uint8Array.prototype.subarray;constructor(e){this.buf=e,this.pos=0,this.len=e.length}uint32(){let e=4294967295;if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,Ir(this,10);return e}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw Ir(this,4);return wl(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw Ir(this,4);return wl(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw Ir(this,4);let e=Q0(this.buf,this.pos);return this.pos+=4,e}double(){if(this.pos+8>this.len)throw Ir(this,4);let e=tw(this.buf,this.pos);return this.pos+=8,e}bytes(){let e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw Ir(this,e);return this.pos+=e,t===n?new Uint8Array(0):this.buf.subarray(t,n)}string(){let e=this.bytes();return ow(e,0,e.length)}skip(e){if(typeof e=="number"){if(this.pos+e>this.len)throw Ir(this,e);this.pos+=e}else do if(this.pos>=this.len)throw Ir(this);while((this.buf[this.pos++]&128)!==0);return this}skipType(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(e=this.uint32()&7)!==4;)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${e} at offset ${this.pos}`)}return this}readLongVarint(){let e=new Qt(0,0),t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(this.buf[this.pos]&127)<<28)>>>0,e.hi=(e.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw Ir(this);if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(this.buf[this.pos++]&127)<<t*7)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw Ir(this);if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw Ir(this,8);let e=wl(this.buf,this.pos+=4),t=wl(this.buf,this.pos+=4);return new Qt(e,t)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){let e=Vh(this.buf,this.pos);return this.pos+=Ve(e),e}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}};function qh(r){return new Gh(r instanceof Uint8Array?r:r.subarray())}function Or(r,e,t){let n=qh(r);return e.decode(n,void 0,t)}function zh(r){let e=r??8192,t=e>>>1,n,o=e;return function(s){if(s<1||s>t)return it(s);o+s>e&&(n=it(e),o=0);let a=n.subarray(o,o+=s);return(o&7)!==0&&(o=(o|7)+1),a}}var Go=class{fn;len;next;val;constructor(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}};function Xh(){}var Yh=class{head;tail;len;next;constructor(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}},pE=zh();function hE(r){return globalThis.Buffer!=null?it(r):pE(r)}var Wa=class{len;head;tail;states;constructor(){this.len=0,this.head=new Go(Xh,0,0),this.tail=this.head,this.states=null}_push(e,t,n){return this.tail=this.tail.next=new Go(e,t,n),this.len+=t,this}uint32(e){return this.len+=(this.tail=this.tail.next=new Jh((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this}int32(e){return e<0?this._push(bl,10,Qt.fromNumber(e)):this.uint32(e)}sint32(e){return this.uint32((e<<1^e>>31)>>>0)}uint64(e){let t=Qt.fromBigInt(e);return this._push(bl,t.length(),t)}uint64Number(e){return this._push(ms,Ve(e),e)}uint64String(e){return this.uint64(BigInt(e))}int64(e){return this.uint64(e)}int64Number(e){return this.uint64Number(e)}int64String(e){return this.uint64String(e)}sint64(e){let t=Qt.fromBigInt(e).zzEncode();return this._push(bl,t.length(),t)}sint64Number(e){let t=Qt.fromNumber(e).zzEncode();return this._push(bl,t.length(),t)}sint64String(e){return this.sint64(BigInt(e))}bool(e){return this._push(Zh,1,e?1:0)}fixed32(e){return this._push(Fa,4,e>>>0)}sfixed32(e){return this.fixed32(e)}fixed64(e){let t=Qt.fromBigInt(e);return this._push(Fa,4,t.lo)._push(Fa,4,t.hi)}fixed64Number(e){let t=Qt.fromNumber(e);return this._push(Fa,4,t.lo)._push(Fa,4,t.hi)}fixed64String(e){return this.fixed64(BigInt(e))}sfixed64(e){return this.fixed64(e)}sfixed64Number(e){return this.fixed64Number(e)}sfixed64String(e){return this.fixed64String(e)}float(e){return this._push(J0,4,e)}double(e){return this._push(ew,8,e)}bytes(e){let t=e.length>>>0;return t===0?this._push(Zh,1,0):this.uint32(t)._push(yE,t,e)}string(e){let t=nw(e);return t!==0?this.uint32(t)._push(Wh,t,e):this._push(Zh,1,0)}fork(){return this.states=new Yh(this),this.head=this.tail=new Go(Xh,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Go(Xh,0,0),this.len=0),this}ldelim(){let e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n!==0&&(this.tail.next=e.next,this.tail=t,this.len+=n),this}finish(){let e=this.head.next,t=hE(this.len),n=0;for(;e!=null;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t}};function Zh(r,e,t){e[t]=r&255}function dE(r,e,t){for(;r>127;)e[t++]=r&127|128,r>>>=7;e[t]=r}var Jh=class extends Go{next;constructor(e,t){super(dE,e,t),this.next=void 0}};function bl(r,e,t){for(;r.hi!==0;)e[t++]=r.lo&127|128,r.lo=(r.lo>>>7|r.hi<<25)>>>0,r.hi>>>=7;for(;r.lo>127;)e[t++]=r.lo&127|128,r.lo=r.lo>>>7;e[t++]=r.lo}function Fa(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}function yE(r,e,t){e.set(r,t)}globalThis.Buffer!=null&&(Wa.prototype.bytes=function(r){let e=r.length>>>0;return this.uint32(e),e>0&&this._push(mE,e,r),this},Wa.prototype.string=function(r){let e=globalThis.Buffer.byteLength(r);return this.uint32(e),e>0&&this._push(gE,e,r),this});function mE(r,e,t){e.set(r,t)}function gE(r,e,t){r.length<40?Wh(r,e,t):e.utf8Write!=null?e.utf8Write(r,t):e.set(he(r),t)}function Qh(){return new Wa}function Pr(r,e){let t=Qh();return e.encode(r,t,{lengthDelimited:!1}),t.finish()}var gs;(function(r){r[r.VARINT=0]="VARINT",r[r.BIT64=1]="BIT64",r[r.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",r[r.START_GROUP=3]="START_GROUP",r[r.END_GROUP=4]="END_GROUP",r[r.BIT32=5]="BIT32"})(gs||(gs={}));function xl(r,e,t,n){return{name:r,type:e,encode:t,decode:n}}function qo(r){function e(o){if(r[o.toString()]==null)throw new Error("Invalid enum value");return r[o]}let t=function(i,s){let a=e(i);s.int32(a)},n=function(i){let s=i.int32();return e(s)};return xl("enum",gs.VARINT,t,n)}function Br(r,e){return xl("message",gs.LENGTH_DELIMITED,r,e)}var Ga=class extends Error{code="ERR_MAX_LENGTH";name="MaxLengthError"};var Ye;(function(r){r.RSA="RSA",r.Ed25519="Ed25519",r.secp256k1="secp256k1",r.ECDSA="ECDSA"})(Ye||(Ye={}));var ed;(function(r){r[r.RSA=0]="RSA",r[r.Ed25519=1]="Ed25519",r[r.secp256k1=2]="secp256k1",r[r.ECDSA=3]="ECDSA"})(ed||(ed={}));(function(r){r.codec=()=>qo(ed)})(Ye||(Ye={}));var Xr;(function(r){let e;r.codec=()=>(e==null&&(e=Br((t,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),t.Type!=null&&(n.uint32(8),Ye.codec().encode(t.Type,n)),t.Data!=null&&(n.uint32(18),n.bytes(t.Data)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.Type=Ye.codec().decode(t);break}case 2:{i.Data=t.bytes();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>Pr(t,r.codec()),r.decode=(t,n)=>Or(t,r.codec(),n)})(Xr||(Xr={}));var td;(function(r){let e;r.codec=()=>(e==null&&(e=Br((t,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),t.Type!=null&&(n.uint32(8),Ye.codec().encode(t.Type,n)),t.Data!=null&&(n.uint32(18),n.bytes(t.Data)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.Type=Ye.codec().decode(t);break}case 2:{i.Data=t.bytes();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>Pr(t,r.codec()),r.decode=(t,n)=>Or(t,r.codec(),n)})(td||(td={}));var za={};St(za,{MAX_RSA_KEY_SIZE:()=>rd,generateRSAKeyPair:()=>fd,jwkToJWKKeyPair:()=>lw,jwkToPkcs1:()=>vE,jwkToPkix:()=>sd,jwkToRSAPrivateKey:()=>ld,pkcs1MessageToJwk:()=>od,pkcs1MessageToRSAPrivateKey:()=>ad,pkcs1ToJwk:()=>xE,pkcs1ToRSAPrivateKey:()=>uw,pkixMessageToJwk:()=>id,pkixMessageToRSAPublicKey:()=>ud,pkixToJwk:()=>_E,pkixToRSAPublicKey:()=>cd});var eo=il;var ws=class{type="RSA";jwk;_raw;_multihash;constructor(e,t){this.jwk=e,this._multihash=t}get raw(){return this._raw==null&&(this._raw=za.jwkToPkix(this.jwk)),this._raw}toMultihash(){return this._multihash}toCID(){return Ze.createV1(114,this._multihash)}toString(){return Ke.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:We(this.raw,e.raw)}verify(e,t,n){return cw(this.jwk,t,e,n)}},qa=class{type="RSA";jwk;_raw;publicKey;constructor(e,t){this.jwk=e,this.publicKey=t}get raw(){return this._raw==null&&(this._raw=za.jwkToPkcs1(this.jwk)),this._raw}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:We(this.raw,e.raw)}sign(e,t){return aw(this.jwk,e,t)}};var rd=8192,nd=18,wE=1062,bE=Uint8Array.from([48,13,6,9,42,134,72,134,247,13,1,1,1,5,0]);function xE(r){let e=dn(r);return od(e)}function od(r){return{n:le(r[1],"base64url"),e:le(r[2],"base64url"),d:le(r[3],"base64url"),p:le(r[4],"base64url"),q:le(r[5],"base64url"),dp:le(r[6],"base64url"),dq:le(r[7],"base64url"),qi:le(r[8],"base64url"),kty:"RSA"}}function vE(r){if(r.n==null||r.e==null||r.d==null||r.p==null||r.q==null||r.dp==null||r.dq==null||r.qi==null)throw new Ie("JWK was missing components");return Sr([kt(Uint8Array.from([0])),kt(he(r.n,"base64url")),kt(he(r.e,"base64url")),kt(he(r.d,"base64url")),kt(he(r.p,"base64url")),kt(he(r.q,"base64url")),kt(he(r.dp,"base64url")),kt(he(r.dq,"base64url")),kt(he(r.qi,"base64url"))]).subarray()}function _E(r){let e=dn(r,{offset:0});return id(e)}function id(r){let e=dn(r[1],{offset:0});return{kty:"RSA",n:le(e[0],"base64url"),e:le(e[1],"base64url")}}function sd(r){if(r.n==null||r.e==null)throw new Ie("JWK was missing components");return Sr([bE,Oa(Sr([kt(he(r.n,"base64url")),kt(he(r.e,"base64url"))]))]).subarray()}function uw(r){let e=dn(r);return ad(e)}function ad(r){let e=od(r);return ld(e)}function cd(r,e){if(r.byteLength>=wE)throw new Qi("Key size is too large");let t=dn(r,{offset:0});return ud(t,r,e)}function ud(r,e,t){let n=id(r);if(t==null){let o=eo(Xr.encode({Type:Ye.RSA,Data:e}));t=At(nd,o)}return new ws(n,t)}function ld(r){if(pw(r)>rd)throw new Ie("Key size is too large");let e=lw(r),t=eo(Xr.encode({Type:Ye.RSA,Data:sd(e.publicKey)})),n=At(nd,t);return new qa(e.privateKey,new ws(e.publicKey,n))}async function fd(r){if(r>rd)throw new Ie("Key size is too large");let e=await fw(r),t=eo(Xr.encode({Type:Ye.RSA,Data:sd(e.publicKey)})),n=At(nd,t);return new qa(e.privateKey,new ws(e.publicKey,n))}function lw(r){if(r==null)throw new Ie("Missing key parameter");return{privateKey:r,publicKey:{kty:r.kty,n:r.n,e:r.e}}}async function fw(r,e){let t=await Ut.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:r,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]);e?.signal?.throwIfAborted();let n=await SE(t,e);return{privateKey:n[0],publicKey:n[1]}}async function aw(r,e,t){let n=await Ut.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]);t?.signal?.throwIfAborted();let o=await Ut.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},n,e instanceof Uint8Array?e:e.subarray());return t?.signal?.throwIfAborted(),new Uint8Array(o,0,o.byteLength)}async function cw(r,e,t,n){let o=await Ut.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);n?.signal?.throwIfAborted();let i=await Ut.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},o,e,t instanceof Uint8Array?t:t.subarray());return n?.signal?.throwIfAborted(),i}async function SE(r,e){if(r.privateKey==null||r.publicKey==null)throw new Ie("Private and public key are required");let t=await Promise.all([Ut.get().subtle.exportKey("jwk",r.privateKey),Ut.get().subtle.exportKey("jwk",r.publicKey)]);return e?.signal?.throwIfAborted(),t}function pw(r){if(r.kty!=="RSA")throw new Ie("invalid key type");if(r.n==null)throw new Ie("invalid key modulus");return he(r.n,"base64url").length*8}var vl=class extends is{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,Pa(e);let n=zn(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let o=this.blockLen,i=new Uint8Array(o);i.set(n.length>o?e.create().update(n).digest():n);for(let s=0;s<i.length;s++)i[s]^=54;this.iHash.update(i),this.oHash=e.create();for(let s=0;s<i.length;s++)i[s]^=106;this.oHash.update(i),Ar(i)}update(e){return as(this),this.iHash.update(e),this}digestInto(e){as(this),Et(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:t,iHash:n,finished:o,destroyed:i,blockLen:s,outputLen:a}=this;return e=e,e.finished=o,e.destroyed=i,e.blockLen=s,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},bs=(r,e,t)=>new vl(r,e).update(t).digest();bs.create=(r,e)=>new vl(r,e);function hw(r){r.lowS!==void 0&&gn("lowS",r.lowS),r.prehash!==void 0&&gn("prehash",r.prehash)}var pd=class extends Error{constructor(e=""){super(e)}},wn={Err:pd,_tlv:{encode:(r,e)=>{let{Err:t}=wn;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length&1)throw new t("tlv.encode: unpadded data");let n=e.length/2,o=Da(n);if(o.length/2&128)throw new t("tlv.encode: long form length too big");let i=n>127?Da(o.length/2|128):"";return Da(r)+i+o+e},decode(r,e){let{Err:t}=wn,n=0;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length<2||e[n++]!==r)throw new t("tlv.decode: wrong tlv");let o=e[n++],i=!!(o&128),s=0;if(!i)s=o;else{let c=o&127;if(!c)throw new t("tlv.decode(long): indefinite length not supported");if(c>4)throw new t("tlv.decode(long): byte length is too big");let l=e.subarray(n,n+c);if(l.length!==c)throw new t("tlv.decode: length bytes not complete");if(l[0]===0)throw new t("tlv.decode(long): zero leftmost byte");for(let f of l)s=s<<8|f;if(n+=c,s<128)throw new t("tlv.decode(long): not minimal encoding")}let a=e.subarray(n,n+s);if(a.length!==s)throw new t("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+s)}}},_int:{encode(r){let{Err:e}=wn;if(r<Xa)throw new e("integer: negative integers are not allowed");let t=Da(r);if(Number.parseInt(t[0],16)&8&&(t="00"+t),t.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return t},decode(r){let{Err:e}=wn;if(r[0]&128)throw new e("invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return us(r)}},toSig(r){let{Err:e,_int:t,_tlv:n}=wn,o=ke("signature",r),{v:i,l:s}=n.decode(48,o);if(s.length)throw new e("invalid signature: left bytes after parsing");let{v:a,l:c}=n.decode(2,i),{v:l,l:f}=n.decode(2,c);if(f.length)throw new e("invalid signature: left bytes after parsing");return{r:t.decode(a),s:t.decode(l)}},hexFromSig(r){let{_tlv:e,_int:t}=wn,n=e.encode(2,t.encode(r.r)),o=e.encode(2,t.encode(r.s)),i=n+o;return e.encode(48,i)}},Xa=BigInt(0),Za=BigInt(1),AE=BigInt(2),_l=BigInt(3),EE=BigInt(4);function CE(r,e,t){function n(o){let i=r.sqr(o),s=r.mul(i,o);return r.add(r.add(s,r.mul(o,e)),t)}return n}function dw(r,e,t){let{BYTES:n}=r;function o(i){let s;if(typeof i=="bigint")s=i;else{let a=ke("private key",i);if(e){if(!e.includes(a.length*2))throw new Error("invalid private key");let c=new Uint8Array(n);c.set(a,c.length-a.length),a=c}try{s=r.fromBytes(a)}catch{throw new Error(`invalid private key: expected ui8a of size ${n}, got ${typeof i}`)}}if(t&&(s=r.create(s)),!r.isValidNot0(s))throw new Error("invalid private key: out of range [1..N-1]");return s}return o}function TE(r,e={}){let{Fp:t,Fn:n}=ll("weierstrass",r,e),{h:o,n:i}=r;qr(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});let{endo:s}=e;if(s&&(!t.is0(r.a)||typeof s.beta!="bigint"||typeof s.splitScalar!="function"))throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function');function a(){if(!t.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function c(K,g,T){let{x:E,y:O}=g.toAffine(),B=t.toBytes(E);if(gn("isCompressed",T),T){a();let R=!t.isOdd(O);return Jt(yw(R),B)}else return Jt(Uint8Array.of(4),B,t.toBytes(O))}function l(K){Et(K);let g=t.BYTES,T=g+1,E=2*g+1,O=K.length,B=K[0],R=K.subarray(1);if(O===T&&(B===2||B===3)){let N=t.fromBytes(R);if(!t.isValid(N))throw new Error("bad point: is not on curve, wrong x");let L=y(N),W;try{W=t.sqrt(L)}catch(ie){let Y=ie instanceof Error?": "+ie.message:"";throw new Error("bad point: is not on curve, sqrt error"+Y)}a();let X=t.isOdd(W);return(B&1)===1!==X&&(W=t.neg(W)),{x:N,y:W}}else if(O===E&&B===4){let N=t.fromBytes(R.subarray(g*0,g*1)),L=t.fromBytes(R.subarray(g*1,g*2));if(!m(N,L))throw new Error("bad point: is not on curve");return{x:N,y:L}}else throw new Error(`bad point: got length ${O}, expected compressed=${T} or uncompressed=${E}`)}let f=e.toBytes||c,p=e.fromBytes||l,y=CE(t,r.a,r.b);function m(K,g){let T=t.sqr(g),E=y(K);return t.eql(T,E)}if(!m(r.Gx,r.Gy))throw new Error("bad curve params: generator point");let x=t.mul(t.pow(r.a,_l),EE),v=t.mul(t.sqr(r.b),BigInt(27));if(t.is0(t.add(x,v)))throw new Error("bad curve params: a or b");function d(K,g,T=!1){if(!t.isValid(g)||T&&t.is0(g))throw new Error(`bad point coordinate ${K}`);return g}function I(K){if(!(K instanceof P))throw new Error("ProjectivePoint expected")}let D=ls((K,g)=>{let{px:T,py:E,pz:O}=K;if(t.eql(O,t.ONE))return{x:T,y:E};let B=K.is0();g==null&&(g=B?t.ONE:t.inv(O));let R=t.mul(T,g),N=t.mul(E,g),L=t.mul(O,g);if(B)return{x:t.ZERO,y:t.ZERO};if(!t.eql(L,t.ONE))throw new Error("invZ was invalid");return{x:R,y:N}}),j=ls(K=>{if(K.is0()){if(e.allowInfinityPoint&&!t.is0(K.py))return;throw new Error("bad point: ZERO")}let{x:g,y:T}=K.toAffine();if(!t.isValid(g)||!t.isValid(T))throw new Error("bad point: x or y not field elements");if(!m(g,T))throw new Error("bad point: equation left != right");if(!K.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function Z(K,g,T,E,O){return T=new P(t.mul(T.px,K),T.py,T.pz),g=fs(E,g),T=fs(O,T),g.add(T)}class P{constructor(g,T,E){this.px=d("x",g),this.py=d("y",T,!0),this.pz=d("z",E),Object.freeze(this)}static fromAffine(g){let{x:T,y:E}=g||{};if(!g||!t.isValid(T)||!t.isValid(E))throw new Error("invalid affine point");if(g instanceof P)throw new Error("projective point not allowed");return t.is0(T)&&t.is0(E)?P.ZERO:new P(T,E,t.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(g){return al(P,"pz",g)}static fromBytes(g){return Et(g),P.fromHex(g)}static fromHex(g){let T=P.fromAffine(p(ke("pointHex",g)));return T.assertValidity(),T}static fromPrivateKey(g){let T=dw(n,e.allowedPrivateKeyLengths,e.wrapPrivateKey);return P.BASE.multiply(T(g))}static msm(g,T){return ul(P,n,g,T)}precompute(g=8,T=!0){return V.setWindowSize(this,g),T||this.multiply(_l),this}_setWindowSize(g){this.precompute(g)}assertValidity(){j(this)}hasEvenY(){let{y:g}=this.toAffine();if(!t.isOdd)throw new Error("Field doesn't support isOdd");return!t.isOdd(g)}equals(g){I(g);let{px:T,py:E,pz:O}=this,{px:B,py:R,pz:N}=g,L=t.eql(t.mul(T,N),t.mul(B,O)),W=t.eql(t.mul(E,N),t.mul(R,O));return L&&W}negate(){return new P(this.px,t.neg(this.py),this.pz)}double(){let{a:g,b:T}=r,E=t.mul(T,_l),{px:O,py:B,pz:R}=this,N=t.ZERO,L=t.ZERO,W=t.ZERO,X=t.mul(O,O),G=t.mul(B,B),ie=t.mul(R,R),Y=t.mul(O,B);return Y=t.add(Y,Y),W=t.mul(O,R),W=t.add(W,W),N=t.mul(g,W),L=t.mul(E,ie),L=t.add(N,L),N=t.sub(G,L),L=t.add(G,L),L=t.mul(N,L),N=t.mul(Y,N),W=t.mul(E,W),ie=t.mul(g,ie),Y=t.sub(X,ie),Y=t.mul(g,Y),Y=t.add(Y,W),W=t.add(X,X),X=t.add(W,X),X=t.add(X,ie),X=t.mul(X,Y),L=t.add(L,X),ie=t.mul(B,R),ie=t.add(ie,ie),X=t.mul(ie,Y),N=t.sub(N,X),W=t.mul(ie,G),W=t.add(W,W),W=t.add(W,W),new P(N,L,W)}add(g){I(g);let{px:T,py:E,pz:O}=this,{px:B,py:R,pz:N}=g,L=t.ZERO,W=t.ZERO,X=t.ZERO,G=r.a,ie=t.mul(r.b,_l),Y=t.mul(T,B),U=t.mul(E,R),de=t.mul(O,N),Oe=t.add(T,E),se=t.add(B,R);Oe=t.mul(Oe,se),se=t.add(Y,U),Oe=t.sub(Oe,se),se=t.add(T,O);let De=t.add(B,N);return se=t.mul(se,De),De=t.add(Y,de),se=t.sub(se,De),De=t.add(E,O),L=t.add(R,N),De=t.mul(De,L),L=t.add(U,de),De=t.sub(De,L),X=t.mul(G,se),L=t.mul(ie,de),X=t.add(L,X),L=t.sub(U,X),X=t.add(U,X),W=t.mul(L,X),U=t.add(Y,Y),U=t.add(U,Y),de=t.mul(G,de),se=t.mul(ie,se),U=t.add(U,de),de=t.sub(Y,de),de=t.mul(G,de),se=t.add(se,de),Y=t.mul(U,se),W=t.add(W,Y),Y=t.mul(De,se),L=t.mul(Oe,L),L=t.sub(L,Y),Y=t.mul(Oe,U),X=t.mul(De,X),X=t.add(X,Y),new P(L,W,X)}subtract(g){return this.add(g.negate())}is0(){return this.equals(P.ZERO)}multiply(g){let{endo:T}=e;if(!n.isValidNot0(g))throw new Error("invalid scalar: out of range");let E,O,B=R=>V.wNAFCached(this,R,P.normalizeZ);if(T){let{k1neg:R,k1:N,k2neg:L,k2:W}=T.splitScalar(g),{p:X,f:G}=B(N),{p:ie,f:Y}=B(W);O=G.add(Y),E=Z(T.beta,X,ie,R,L)}else{let{p:R,f:N}=B(g);E=R,O=N}return P.normalizeZ([E,O])[0]}multiplyUnsafe(g){let{endo:T}=e,E=this;if(!n.isValid(g))throw new Error("invalid scalar: out of range");if(g===Xa||E.is0())return P.ZERO;if(g===Za)return E;if(V.hasPrecomputes(this))return this.multiply(g);if(T){let{k1neg:O,k1:B,k2neg:R,k2:N}=T.splitScalar(g),{p1:L,p2:W}=U0(P,E,B,N);return Z(T.beta,L,W,O,R)}else return V.wNAFCachedUnsafe(E,g)}multiplyAndAddUnsafe(g,T,E){let O=this.multiplyUnsafe(T).add(g.multiplyUnsafe(E));return O.is0()?void 0:O}toAffine(g){return D(this,g)}isTorsionFree(){let{isTorsionFree:g}=e;return o===Za?!0:g?g(P,this):V.wNAFCachedUnsafe(this,i).is0()}clearCofactor(){let{clearCofactor:g}=e;return o===Za?this:g?g(P,this):this.multiplyUnsafe(o)}toBytes(g=!0){return gn("isCompressed",g),this.assertValidity(),f(P,this,g)}toRawBytes(g=!0){return this.toBytes(g)}toHex(g=!0){return Fr(this.toBytes(g))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}P.BASE=new P(r.Gx,r.Gy,t.ONE),P.ZERO=new P(t.ZERO,t.ONE,t.ZERO),P.Fp=t,P.Fn=n;let M=n.BITS,V=cl(P,e.endo?Math.ceil(M/2):M);return P}function yw(r){return Uint8Array.of(r?2:3)}function IE(r,e,t={}){qr(e,{hash:"function"},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});let n=e.randomBytes||Uo,o=e.hmac||((E,...O)=>bs(e.hash,E,Jt(...O))),{Fp:i,Fn:s}=r,{ORDER:a,BITS:c}=s;function l(E){let O=a>>Za;return E>O}function f(E){return l(E)?s.neg(E):E}function p(E,O){if(!s.isValidNot0(O))throw new Error(`invalid signature ${E}: out of range 1..CURVE.n`)}class y{constructor(O,B,R){p("r",O),p("s",B),this.r=O,this.s=B,R!=null&&(this.recovery=R),Object.freeze(this)}static fromCompact(O){let B=s.BYTES,R=ke("compactSignature",O,B*2);return new y(s.fromBytes(R.subarray(0,B)),s.fromBytes(R.subarray(B,B*2)))}static fromDER(O){let{r:B,s:R}=wn.toSig(ke("DER",O));return new y(B,R)}assertValidity(){}addRecoveryBit(O){return new y(this.r,this.s,O)}recoverPublicKey(O){let B=i.ORDER,{r:R,s:N,recovery:L}=this;if(L==null||![0,1,2,3].includes(L))throw new Error("recovery id invalid");if(a*AE<B&&L>1)throw new Error("recovery id is ambiguous for h>1 curve");let X=L===2||L===3?R+a:R;if(!i.isValid(X))throw new Error("recovery id 2 or 3 invalid");let G=i.toBytes(X),ie=r.fromHex(Jt(yw((L&1)===0),G)),Y=s.inv(X),U=j(ke("msgHash",O)),de=s.create(-U*Y),Oe=s.create(N*Y),se=r.BASE.multiplyUnsafe(de).add(ie.multiplyUnsafe(Oe));if(se.is0())throw new Error("point at infinify");return se.assertValidity(),se}hasHighS(){return l(this.s)}normalizeS(){return this.hasHighS()?new y(this.r,s.neg(this.s),this.recovery):this}toBytes(O){if(O==="compact")return Jt(s.toBytes(this.r),s.toBytes(this.s));if(O==="der")return cs(wn.hexFromSig(this));throw new Error("invalid format")}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return Fr(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return Fr(this.toBytes("compact"))}}let m=dw(s,t.allowedPrivateKeyLengths,t.wrapPrivateKey),x={isValidPrivateKey(E){try{return m(E),!0}catch{return!1}},normPrivateKeyToScalar:m,randomPrivateKey:()=>{let E=a;return k0(n(Bh(E)),E)},precompute(E=8,O=r.BASE){return O.precompute(E,!1)}};function v(E,O=!0){return r.fromPrivateKey(E).toBytes(O)}function d(E){if(typeof E=="bigint")return!1;if(E instanceof r)return!0;let B=ke("key",E).length,R=i.BYTES,N=R+1,L=2*R+1;if(!(t.allowedPrivateKeyLengths||s.BYTES===N))return B===N||B===L}function I(E,O,B=!0){if(d(E)===!0)throw new Error("first arg must be private key");if(d(O)===!1)throw new Error("second arg must be public key");return r.fromHex(O).multiply(m(E)).toBytes(B)}let D=e.bits2int||function(E){if(E.length>8192)throw new Error("input is too large");let O=us(E),B=E.length*8-c;return B>0?O>>BigInt(B):O},j=e.bits2int_modN||function(E){return s.create(D(E))},Z=Ho(c);function P(E){return Cr("num < 2^"+c,E,Xa,Z),s.toBytes(E)}function M(E,O,B=V){if(["recovered","canonical"].some(Oe=>Oe in B))throw new Error("sign() legacy options not supported");let{hash:R}=e,{lowS:N,prehash:L,extraEntropy:W}=B;N==null&&(N=!0),E=ke("msgHash",E),hw(B),L&&(E=ke("prehashed msgHash",R(E)));let X=j(E),G=m(O),ie=[P(G),P(X)];if(W!=null&&W!==!1){let Oe=W===!0?n(i.BYTES):W;ie.push(ke("extraEntropy",Oe))}let Y=Jt(...ie),U=X;function de(Oe){let se=D(Oe);if(!s.isValidNot0(se))return;let De=s.inv(se),_t=r.BASE.multiply(se).toAffine(),tt=s.create(_t.x);if(tt===Xa)return;let rt=s.create(De*s.create(U+tt*G));if(rt===Xa)return;let lt=(_t.x===tt?0:2)|Number(_t.y&Za),ir=rt;return N&&l(rt)&&(ir=f(rt),lt^=1),new y(tt,ir,lt)}return{seed:Y,k2sig:de}}let V={lowS:e.lowS,prehash:!1},K={lowS:e.lowS,prehash:!1};function g(E,O,B=V){let{seed:R,k2sig:N}=M(E,O,B);return _0(e.hash.outputLen,s.BYTES,o)(R,N)}r.BASE.precompute(8);function T(E,O,B,R=K){let N=E;O=ke("msgHash",O),B=ke("publicKey",B),hw(R);let{lowS:L,prehash:W,format:X}=R;if("strict"in R)throw new Error("options.strict was renamed to lowS");if(X!==void 0&&!["compact","der","js"].includes(X))throw new Error('format must be "compact", "der" or "js"');let G=typeof N=="string"||ss(N),ie=!G&&!X&&typeof N=="object"&&N!==null&&typeof N.r=="bigint"&&typeof N.s=="bigint";if(!G&&!ie)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let Y,U;try{if(ie)if(X===void 0||X==="js")Y=new y(N.r,N.s);else throw new Error("invalid format");if(G){try{X!=="compact"&&(Y=y.fromDER(N))}catch(ir){if(!(ir instanceof wn.Err))throw ir}!Y&&X!=="der"&&(Y=y.fromCompact(N))}U=r.fromHex(B)}catch{return!1}if(!Y||L&&Y.hasHighS())return!1;W&&(O=e.hash(O));let{r:de,s:Oe}=Y,se=j(O),De=s.inv(Oe),_t=s.create(se*De),tt=s.create(de*De),rt=r.BASE.multiplyUnsafe(_t).add(U.multiplyUnsafe(tt));return rt.is0()?!1:s.create(rt.x)===de}return Object.freeze({getPublicKey:v,getSharedSecret:I,sign:g,verify:T,utils:x,Point:r,Signature:y})}function OE(r){let e={a:r.a,b:r.b,p:r.Fp.ORDER,n:r.n,h:r.h,Gx:r.Gx,Gy:r.Gy},t=r.Fp,n=Tr(e.n,r.nBitLength),o={Fp:t,Fn:n,allowedPrivateKeyLengths:r.allowedPrivateKeyLengths,allowInfinityPoint:r.allowInfinityPoint,endo:r.endo,wrapPrivateKey:r.wrapPrivateKey,isTorsionFree:r.isTorsionFree,clearCofactor:r.clearCofactor,fromBytes:r.fromBytes,toBytes:r.toBytes};return{CURVE:e,curveOpts:o}}function PE(r){let{CURVE:e,curveOpts:t}=OE(r),n={hash:r.hash,hmac:r.hmac,randomBytes:r.randomBytes,lowS:r.lowS,bits2int:r.bits2int,bits2int_modN:r.bits2int_modN};return{CURVE:e,curveOpts:t,ecdsaOpts:n}}function BE(r,e){return Object.assign({},e,{ProjectivePoint:e.Point,CURVE:r})}function mw(r){let{CURVE:e,curveOpts:t,ecdsaOpts:n}=PE(r),o=TE(e,t),i=IE(o,n,t);return BE(r,i)}function gw(r,e){let t=n=>mw({...r,hash:n});return{...t(e),create:t}}var Sl={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},p8=BigInt(0),kE=BigInt(1),hd=BigInt(2),ww=(r,e)=>(r+e/hd)/e;function NE(r){let e=Sl.p,t=BigInt(3),n=BigInt(6),o=BigInt(11),i=BigInt(22),s=BigInt(23),a=BigInt(44),c=BigInt(88),l=r*r*r%e,f=l*l*r%e,p=Me(f,t,e)*f%e,y=Me(p,t,e)*f%e,m=Me(y,hd,e)*l%e,x=Me(m,o,e)*m%e,v=Me(x,i,e)*x%e,d=Me(v,a,e)*v%e,I=Me(d,c,e)*d%e,D=Me(I,a,e)*v%e,j=Me(D,t,e)*f%e,Z=Me(j,s,e)*x%e,P=Me(Z,n,e)*l%e,M=Me(P,hd,e);if(!dd.eql(dd.sqr(M),r))throw new Error("Cannot find square root");return M}var dd=Tr(Sl.p,void 0,void 0,{sqrt:NE}),kr=gw({...Sl,Fp:dd,lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:r=>{let e=Sl.n,t=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-kE*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=t,s=BigInt("0x100000000000000000000000000000000"),a=ww(i*r,e),c=ww(-n*r,e),l=je(r-a*t-c*o,e),f=je(-a*n-c*i,e),p=l>s,y=f>s;if(p&&(l=e-l),y&&(f=e-f),l>s||f>s)throw new Error("splitScalar: Endomorphism failed, k="+r);return{k1neg:p,k1:l,k2neg:y,k2:f}}}},il);function bw(r,e,t){let n=sr.digest(e instanceof Uint8Array?e:e.subarray());if(ys(n))return n.then(({digest:o})=>(t?.signal?.throwIfAborted(),kr.sign(o,r).toDERRawBytes())).catch(o=>{throw o.name==="AbortError"?o:new Ka(String(o))});try{return kr.sign(n.digest,r).toDERRawBytes()}catch(o){throw new Ka(String(o))}}function xw(r,e,t,n){let o=sr.digest(t instanceof Uint8Array?t:t.subarray());if(ys(o))return o.then(({digest:i})=>(n?.signal?.throwIfAborted(),kr.verify(e,i,r))).catch(i=>{throw i.name==="AbortError"?i:new Ha(String(i))});try{return n?.signal?.throwIfAborted(),kr.verify(e,o.digest,r)}catch(i){throw new Ha(String(i))}}var Ya=class{type="secp256k1";raw;_key;constructor(e){this._key=Sw(e),this.raw=vw(this._key)}toMultihash(){return _r.digest(qn(this))}toCID(){return Ze.createV1(114,this.toMultihash())}toString(){return Ke.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:We(this.raw,e.raw)}verify(e,t,n){return xw(this._key,t,e,n)}},Al=class{type="secp256k1";raw;publicKey;constructor(e,t){this.raw=_w(e),this.publicKey=new Ya(t??Aw(e))}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:We(this.raw,e.raw)}sign(e,t){return bw(this.raw,e,t)}};function yd(r){return new Ya(r)}async function Ew(){let r=DE();return new Al(r)}function vw(r){return kr.ProjectivePoint.fromHex(r).toRawBytes(!0)}function _w(r){try{return kr.getPublicKey(r,!0),r}catch(e){throw new _a(String(e))}}function Sw(r){try{return kr.ProjectivePoint.fromHex(r),r}catch(e){throw new Qi(String(e))}}function Aw(r){try{return kr.getPublicKey(r,!0)}catch(e){throw new _a(String(e))}}function DE(){return kr.utils.randomPrivateKey()}async function Cw(r,e){if(r==="Ed25519")return Y0();if(r==="secp256k1")return Ew();if(r==="RSA")return fd(jE(e));if(r==="ECDSA")return r0(RE(e));throw new $n}function Ja(r,e){let{Type:t,Data:n}=Xr.decode(r),o=n??new Uint8Array;switch(t){case Ye.RSA:return cd(o,e);case Ye.Ed25519:return Lh(o);case Ye.secp256k1:return yd(o);case Ye.ECDSA:return _h(o);default:throw new $n}}function Tw(r){let{Type:e,Data:t}=Xr.decode(r.digest),n=t??new Uint8Array;switch(e){case Ye.Ed25519:return Lh(n);case Ye.secp256k1:return yd(n);case Ye.ECDSA:return _h(n);default:throw new $n}}function qn(r){return Xr.encode({Type:Ye[r.type],Data:r.raw})}function jE(r){return r==null?2048:parseInt(r,10)}function RE(r){if(r==="P-256"||r==null)return"P-256";if(r==="P-384")return"P-384";if(r==="P-521")return"P-521";throw new Ie("Unsupported curve, should be P-256, P-384 or P-521")}async function El(r){if(r.type==="RSA")return{privateKey:await crypto.subtle.importKey("jwk",r.jwk,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),publicKey:await crypto.subtle.importKey("jwk",r.publicKey.jwk,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])};if(r.type==="ECDSA")return{privateKey:await crypto.subtle.importKey("jwk",r.jwk,{name:"ECDSA",namedCurve:r.jwk.crv??"P-256"},!0,["sign"]),publicKey:await crypto.subtle.importKey("jwk",r.publicKey.jwk,{name:"ECDSA",namedCurve:r.publicKey.jwk.crv??"P-256"},!0,["verify"])};throw new Ie("Only RSA and ECDSA keys are supported")}var Iw=Symbol.for("nodejs.util.inspect.custom"),LE=114,Qa=class{type;multihash;publicKey;string;constructor(e){this.type=e.type,this.multihash=e.multihash,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[Xp]=!0;toString(){return this.string==null&&(this.string=Ke.encode(this.multihash.bytes).slice(1)),this.string}toMultihash(){return this.multihash}toCID(){return Ze.createV1(LE,this.multihash)}toJSON(){return this.toString()}equals(e){if(e==null)return!1;if(e instanceof Uint8Array)return We(this.multihash.bytes,e);if(typeof e=="string")return this.toString()===e;if(e?.toMultihash()?.bytes!=null)return We(this.multihash.bytes,e.toMultihash().bytes);throw new Error("not valid Id")}[Iw](){return`PeerId(${this.toString()})`}},ec=class extends Qa{type="RSA";publicKey;constructor(e){super({...e,type:"RSA"}),this.publicKey=e.publicKey}},tc=class extends Qa{type="Ed25519";publicKey;constructor(e){super({...e,type:"Ed25519"}),this.publicKey=e.publicKey}},rc=class extends Qa{type="secp256k1";publicKey;constructor(e){super({...e,type:"secp256k1"}),this.publicKey=e.publicKey}},UE=2336,nc=class{type="url";multihash;publicKey;url;constructor(e){this.url=e.toString(),this.multihash=_r.digest(he(this.url))}[Iw](){return`PeerId(${this.url})`}[Xp]=!0;toString(){return this.toCID().toString()}toMultihash(){return this.multihash}toCID(){return Ze.createV1(UE,this.toMultihash())}toJSON(){return this.toString()}equals(e){return e==null?!1:(e instanceof Uint8Array&&(e=le(e)),e.toString()===this.toString())}};var ME=114,Ow=2336;function Cl(r,e){let t;if(r.charAt(0)==="1"||r.charAt(0)==="Q")t=os(Ke.decode(`z${r}`));else{if(r.startsWith("k51qzi5uqu5")||r.startsWith("kzwfwjn5ji4")||r.startsWith("k2k4r8")||r.startsWith("bafz"))return KE(Ze.parse(r));if(e==null)throw new Ie('Please pass a multibase decoder for strings that do not start with "1" or "Q"');t=os(e.decode(r))}return Pw(t)}function md(r){if(r.type==="Ed25519")return new tc({multihash:r.toCID().multihash,publicKey:r});if(r.type==="secp256k1")return new rc({multihash:r.toCID().multihash,publicKey:r});if(r.type==="RSA")return new ec({multihash:r.toCID().multihash,publicKey:r});throw new $n}function Pw(r){if(VE(r))return new ec({multihash:r});if(HE(r))try{let e=Tw(r);if(e.type==="Ed25519")return new tc({multihash:r,publicKey:e});if(e.type==="secp256k1")return new rc({multihash:r,publicKey:e})}catch{let t=le(r.digest);return new nc(new URL(t))}throw new qu("Supplied PeerID Multihash is invalid")}function KE(r){if(r?.multihash==null||r.version==null||r.version===1&&r.code!==ME&&r.code!==Ow)throw new Gu("Supplied PeerID CID is invalid");if(r.code===Ow){let e=le(r.multihash.digest);return new nc(new URL(e))}return Pw(r.multihash)}function HE(r){return r.code===_r.code}function VE(r){return r.code===sr.code}var pt=class extends Error{static name="InvalidMultiaddrError";name="InvalidMultiaddrError"},bn=class extends Error{static name="ValidationError";name="ValidationError"},oc=class extends Error{static name="InvalidParametersError";name="InvalidParametersError"},Tl=class extends Error{static name="UnknownProtocolError";name="UnknownProtocolError"};var Il=class{index=0;input="";new(e){return this.index=0,this.input=e,this}readAtomically(e){let t=this.index,n=e();return n===void 0&&(this.index=t),n}parseWith(e){let t=e();if(this.index===this.input.length)return t}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(e){return this.readAtomically(()=>{let t=this.readChar();if(t===e)return t})}readSeparator(e,t,n){return this.readAtomically(()=>{if(!(t>0&&this.readGivenChar(e)===void 0))return n()})}readNumber(e,t,n,o){return this.readAtomically(()=>{let i=0,s=0,a=this.peekChar();if(a===void 0)return;let c=a==="0",l=2**(8*o)-1;for(;;){let f=this.readAtomically(()=>{let p=this.readChar();if(p===void 0)return;let y=Number.parseInt(p,e);if(!Number.isNaN(y))return y});if(f===void 0)break;if(i*=e,i+=f,i>l||(s+=1,t!==void 0&&s>t))return}if(s!==0)return!n&&c&&s>1?void 0:i})}readIPv4Addr(){return this.readAtomically(()=>{let e=new Uint8Array(4);for(let t=0;t<e.length;t++){let n=this.readSeparator(".",t,()=>this.readNumber(10,3,!1,1));if(n===void 0)return;e[t]=n}return e})}readIPv6Addr(){let e=t=>{for(let n=0;n<t.length/2;n++){let o=n*2;if(n<t.length-3){let s=this.readSeparator(":",n,()=>this.readIPv4Addr());if(s!==void 0)return t[o]=s[0],t[o+1]=s[1],t[o+2]=s[2],t[o+3]=s[3],[o+4,!0]}let i=this.readSeparator(":",n,()=>this.readNumber(16,4,!0,2));if(i===void 0)return[o,!1];t[o]=i>>8,t[o+1]=i&255}return[t.length,!1]};return this.readAtomically(()=>{let t=new Uint8Array(16),[n,o]=e(t);if(n===16)return t;if(o||this.readGivenChar(":")===void 0||this.readGivenChar(":")===void 0)return;let i=new Uint8Array(14),s=16-(n+2),[a]=e(i.subarray(0,s));return t.set(i.subarray(0,a),16-a),t})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}};var $E=45,FE=15,Ol=new Il;function gd(r){if(!(r.length>FE))return Ol.new(r).parseWith(()=>Ol.readIPv4Addr())}function wd(r){if(r.includes("%")&&(r=r.split("%")[0]),!(r.length>$E))return Ol.new(r).parseWith(()=>Ol.readIPv6Addr())}function Pl(r){return!!gd(r)}function kw(r){return!!wd(r)}function xd(r){return e=>le(e,r)}function vd(r){return e=>he(e,r)}function xs(r){return new DataView(r.buffer).getUint16(r.byteOffset).toString()}function zo(r){let e=new ArrayBuffer(2);return new DataView(e).setUint16(0,typeof r=="string"?parseInt(r):r),new Uint8Array(e)}function Nw(r){let e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);let t=he(e[0],"base32"),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let o=zo(n);return Bt([t,o],t.length+o.length)}function Dw(r){let e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);let t=Gn.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let o=zo(n);return Bt([t,o],t.length+o.length)}function _d(r){let e=r.subarray(0,r.length-2),t=r.subarray(r.length-2),n=le(e,"base32"),o=xs(t);return`${n}:${o}`}var Sd=function(r){r=r.toString().trim();let e=new Uint8Array(4);return r.split(/\./g).forEach((t,n)=>{let o=parseInt(t,10);if(isNaN(o)||o<0||o>255)throw new pt("Invalid byte value in IP address");e[n]=o}),e},jw=function(r){let e=0;r=r.toString().trim();let t=r.split(":",8),n;for(n=0;n<t.length;n++){let i=Pl(t[n]),s;i&&(s=Sd(t[n]),t[n]=le(s.subarray(0,2),"base16")),s!=null&&++n<8&&t.splice(n,0,le(s.subarray(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(n=0;n<t.length&&t[n]!=="";n++);let i=[n,1];for(n=9-t.length;n>0;n--)i.push("0");t.splice.apply(t,i)}let o=new Uint8Array(e+16);for(n=0;n<t.length;n++){t[n]===""&&(t[n]="0");let i=parseInt(t[n],16);if(isNaN(i)||i<0||i>65535)throw new pt("Invalid byte value in IP address");o[e++]=i>>8&255,o[e++]=i&255}return o},Rw=function(r){if(r.byteLength!==4)throw new pt("IPv4 address was incorrect length");let e=[];for(let t=0;t<r.byteLength;t++)e.push(r[t]);return e.join(".")},Lw=function(r){if(r.byteLength!==16)throw new pt("IPv6 address was incorrect length");let e=[];for(let n=0;n<r.byteLength;n+=2){let o=r[n],i=r[n+1],s=`${o.toString(16).padStart(2,"0")}${i.toString(16).padStart(2,"0")}`;e.push(s)}let t=e.join(":");try{let n=new URL(`http://[${t}]`);return n.hostname.substring(1,n.hostname.length-1)}catch{throw new pt(`Invalid IPv6 address "${t}"`)}};function Uw(r){try{let e=new URL(`http://[${r}]`);return e.hostname.substring(1,e.hostname.length-1)}catch{throw new pt(`Invalid IPv6 address "${r}"`)}}var bd=Object.values(Do).map(r=>r.decoder),WE=function(){let r=bd[0].or(bd[1]);return bd.slice(2).forEach(e=>r=r.or(e)),r}();function Mw(r){return WE.decode(r)}function Kw(r){return e=>r.encoder.encode(e)}function GE(r){if(parseInt(r).toString()!==r)throw new bn("Value must be an integer")}function qE(r){if(r<0)throw new bn("Value must be a positive integer, or zero")}function zE(r){return e=>{if(e>r)throw new bn(`Value must be smaller than or equal to ${r}`)}}function XE(...r){return e=>{for(let t of r)t(e)}}var ic=XE(GE,qE,zE(65535));var ut=-1,Ad=class{protocolsByCode=new Map;protocolsByName=new Map;getProtocol(e){let t;if(typeof e=="string"?t=this.protocolsByName.get(e):t=this.protocolsByCode.get(e),t==null)throw new Tl(`Protocol ${e} was unknown`);return t}addProtocol(e){this.protocolsByCode.set(e.code,e),this.protocolsByName.set(e.name,e),e.aliases?.forEach(t=>{this.protocolsByName.set(t,e)})}removeProtocol(e){let t=this.protocolsByCode.get(e);t!=null&&(this.protocolsByCode.delete(t.code),this.protocolsByName.delete(t.name),t.aliases?.forEach(n=>{this.protocolsByName.delete(n)}))}},er=new Ad,l2=[{code:4,name:"ip4",size:32,valueToBytes:Sd,bytesToValue:Rw,validate:r=>{if(!Pl(r))throw new bn(`Invalid IPv4 address "${r}"`)}},{code:6,name:"tcp",size:16,valueToBytes:zo,bytesToValue:xs,validate:ic},{code:273,name:"udp",size:16,valueToBytes:zo,bytesToValue:xs,validate:ic},{code:33,name:"dccp",size:16,valueToBytes:zo,bytesToValue:xs,validate:ic},{code:41,name:"ip6",size:128,valueToBytes:jw,bytesToValue:Lw,stringToValue:Uw,validate:r=>{if(!kw(r))throw new bn(`Invalid IPv6 address "${r}"`)}},{code:42,name:"ip6zone",size:ut},{code:43,name:"ipcidr",size:8,bytesToValue:xd("base10"),valueToBytes:vd("base10")},{code:53,name:"dns",size:ut,resolvable:!0},{code:54,name:"dns4",size:ut,resolvable:!0},{code:55,name:"dns6",size:ut,resolvable:!0},{code:56,name:"dnsaddr",size:ut,resolvable:!0},{code:132,name:"sctp",size:16,valueToBytes:zo,bytesToValue:xs,validate:ic},{code:301,name:"udt"},{code:302,name:"utp"},{code:400,name:"unix",size:ut,path:!0,stringToValue:r=>decodeURIComponent(r),valueToString:r=>encodeURIComponent(r)},{code:421,name:"p2p",aliases:["ipfs"],size:ut,bytesToValue:xd("base58btc"),valueToBytes:r=>r.startsWith("Q")||r.startsWith("1")?vd("base58btc")(r):Ze.parse(r).multihash.bytes},{code:444,name:"onion",size:96,bytesToValue:_d,valueToBytes:Nw},{code:445,name:"onion3",size:296,bytesToValue:_d,valueToBytes:Dw},{code:446,name:"garlic64",size:ut},{code:447,name:"garlic32",size:ut},{code:448,name:"tls"},{code:449,name:"sni",size:ut},{code:454,name:"noise"},{code:460,name:"quic"},{code:461,name:"quic-v1"},{code:465,name:"webtransport"},{code:466,name:"certhash",size:ut,bytesToValue:Kw(No),valueToBytes:Mw},{code:480,name:"http"},{code:481,name:"http-path",size:ut,stringToValue:r=>`/${decodeURIComponent(r)}`,valueToString:r=>encodeURIComponent(r.substring(1))},{code:443,name:"https"},{code:477,name:"ws"},{code:478,name:"wss"},{code:479,name:"p2p-websocket-star"},{code:277,name:"p2p-stardust"},{code:275,name:"p2p-webrtc-star"},{code:276,name:"p2p-webrtc-direct"},{code:280,name:"webrtc-direct"},{code:281,name:"webrtc"},{code:290,name:"p2p-circuit"},{code:777,name:"memory",size:ut}];l2.forEach(r=>{er.addProtocol(r)});function Hw(r){let e=[],t=0;for(;t<r.length;){let n=Fo(r,t),o=er.getProtocol(n),i=Ve(n),s=f2(o,r,t+i),a=0;s>0&&o.size===ut&&(a=Ve(s));let c=i+a+s,l={code:n,name:o.name,bytes:r.subarray(t,t+c)};if(s>0){let f=t+i+a,p=r.subarray(f,f+s);l.value=o.bytesToValue?.(p)??le(p)}e.push(l),t+=c}return e}function Vw(r){let e=0,t=[];for(let n of r){if(n.bytes==null){let o=er.getProtocol(n.code),i=Ve(n.code),s,a=0,c=0;n.value!=null&&(s=o.valueToBytes?.(n.value)??he(n.value),a=s.byteLength,o.size===ut&&(c=Ve(a)));let l=new Uint8Array(i+c+a),f=0;ms(n.code,l,f),f+=i,s!=null&&(o.size===ut&&(ms(a,l,f),f+=c),l.set(s,f)),n.bytes=l}t.push(n.bytes),e+=n.bytes.byteLength}return Bt(t,e)}function $w(r){if(r.charAt(0)!=="/")throw new pt('String multiaddr must start with "/"');let e=[],t="protocol",n="",o="";for(let i=1;i<r.length;i++){let s=r.charAt(i);s!=="/"&&(t==="protocol"?o+=r.charAt(i):n+=r.charAt(i));let a=i===r.length-1;if(s==="/"||a){let c=er.getProtocol(o);if(t==="protocol"){if(c.size==null||c.size===0){e.push({code:c.code,name:c.name}),n="",o="",t="protocol";continue}else if(a)throw new pt(`Component ${o} was missing value`);t="value"}else if(t==="value"){let l={code:c.code,name:c.name};if(c.size!=null&&c.size!==0){if(n==="")throw new pt(`Component ${o} was missing value`);l.value=c.stringToValue?.(n)??n}e.push(l),n="",o="",t="protocol"}}}if(o!==""&&n!=="")throw new pt("Incomplete multiaddr");return e}function Fw(r){return`/${r.flatMap(e=>{if(e.value==null)return e.name;let t=er.getProtocol(e.code);if(t==null)throw new pt(`Unknown protocol code ${e.code}`);return[e.name,t.valueToString?.(e.value)??e.value]}).join("/")}`}function f2(r,e,t){return r.size==null||r.size===0?0:r.size>0?r.size/8:Fo(e,t)}var p2=Symbol.for("nodejs.util.inspect.custom"),Dd=Symbol.for("@multiformats/multiaddr"),h2=[53,54,55,56],Nd=class extends Error{constructor(e="No available resolver"){super(e),this.name="NoAvailableResolverError"}};function d2(r){if(r==null&&(r="/"),Gw(r))return r.getComponents();if(r instanceof Uint8Array)return Hw(r);if(typeof r=="string")return r=r.replace(/\/(\/)+/,"/").replace(/(\/)+$/,""),r===""&&(r="/"),$w(r);if(Array.isArray(r))return r;throw new pt("Must be a string, Uint8Array, Component[], or another Multiaddr")}var Dl=class r{[Dd]=!0;#e;#t;#r;constructor(e="/",t={}){this.#e=d2(e),t.validate!==!1&&y2(this)}get bytes(){return this.#r==null&&(this.#r=Vw(this.#e)),this.#r}toString(){return this.#t==null&&(this.#t=Fw(this.#e)),this.#t}toJSON(){return this.toString()}toOptions(){let e,t,n,o,i="";for(let{code:a,name:c,value:l}of this.#e)a===42&&(i=`%${l??""}`),h2.includes(a)&&(t="tcp",o=443,n=`${l??""}${i}`,e=a===55?6:4),(a===6||a===273)&&(t=c==="tcp"?"tcp":"udp",o=parseInt(l??"")),(a===4||a===41)&&(t="tcp",n=`${l??""}${i}`,e=a===41?6:4);if(e==null||t==null||n==null||o==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:n,transport:t,port:o}}getComponents(){return[...this.#e]}protos(){return this.#e.map(({code:e,value:t})=>{let n=er.getProtocol(e);return{code:e,size:n.size??0,name:n.name,resolvable:!!n.resolvable,path:!!n.path}})}protoCodes(){return this.#e.map(({code:e})=>e)}protoNames(){return this.#e.map(({name:e})=>e)}tuples(){return this.#e.map(({code:e,value:t})=>{if(t==null)return[e];let n=er.getProtocol(e),o=[e];return t!=null&&o.push(n.valueToBytes?.(t)??he(t)),o})}stringTuples(){return this.#e.map(({code:e,value:t})=>t==null?[e]:[e,t])}encapsulate(e){let t=new r(e);return new r([...this.#e,...t.getComponents()],{validate:!1})}decapsulate(e){let t=e.toString(),n=this.toString(),o=n.lastIndexOf(t);if(o<0)throw new oc(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new r(n.slice(0,o),{validate:!1})}decapsulateCode(e){let t;for(let n=this.#e.length-1;n>-1;n--)if(this.#e[n].code===e){t=n;break}return new r(this.#e.slice(0,t),{validate:!1})}getPeerId(){try{let e=[];this.#e.forEach(({code:n,value:o})=>{n===421&&e.push([n,o]),n===290&&(e=[])});let t=e.pop();if(t?.[1]!=null){let n=t[1];return n[0]==="Q"||n[0]==="1"?le(Ke.decode(`z${n}`),"base58btc"):le(Ze.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){for(let e of this.#e)if(er.getProtocol(e.code).path)return e.value??null;return null}equals(e){return We(this.bytes,e.bytes)}async resolve(e){let t=this.protos().find(i=>i.resolvable);if(t==null)return[this];let n=Ww.get(t.name);if(n==null)throw new Nd(`no available resolver for ${t.name}`);return(await n(this,e)).map(i=>xn(i))}nodeAddress(){let e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(){return!(this.#e.length!==2||this.#e[0].code!==4&&this.#e[0].code!==41||this.#e[1].code!==6&&this.#e[1].code!==273)}[p2](){return`Multiaddr(${this.toString()})`}};function y2(r){r.getComponents().forEach(e=>{let t=er.getProtocol(e.code);e.value!=null&&t.validate?.(e.value)})}var Q6=parseInt("0xFFFF",16),e5=new Uint8Array([0,0,0,0,0,0,0,0,0,0,255,255]);var Ww=new Map;function Gw(r){return!!r?.[Dd]}function xn(r){return new Dl(r)}var Re=r=>({match:e=>{let t=e[0];return t==null||t.code!==r||t.value!=null?!1:e.slice(1)}}),fe=(r,e)=>({match:t=>{let n=t[0];return n?.code!==r||n.value==null||e!=null&&n.value!==e?!1:t.slice(1)}}),ve=r=>({match:e=>{let t=r.match(e);return t===!1?e:t}}),It=(...r)=>({match:e=>{let t;for(let n of r){let o=n.match(e);o!==!1&&(t==null||o.length<t.length)&&(t=o)}return t??!1}}),Te=(...r)=>({match:e=>{for(let t of r){let n=t.match(e);if(n===!1)return!1;e=n}return e}});function Ne(...r){function e(o){let i=o.getComponents();for(let s of r){let a=s.match(i);if(a===!1)return!1;i=a}return i}function t(o){return e(o)!==!1}function n(o){let i=e(o);return i===!1?!1:i.length===0}return{matchers:r,matches:t,exactMatch:n}}var x2=fe(421),V5=Ne(x2),Rl=fe(54),Ll=fe(55),Ul=fe(56),Rd=fe(53),$5=Ne(Rl,ve(fe(421))),F5=Ne(Ll,ve(fe(421))),W5=Ne(Ul,ve(fe(421))),G5=Ne(It(Rd,Ul,Rl,Ll),ve(fe(421))),Xw=Te(fe(4),ve(fe(43))),Zw=Te(ve(fe(42)),fe(41),ve(fe(43))),Ld=It(Xw,Zw),Yo=It(Ld,Rd,Rl,Ll,Ul),q5=Ne(It(Ld,Te(It(Rd,Ul,Rl,Ll),ve(fe(421))))),z5=Ne(Xw),X5=Ne(Zw),Z5=Ne(Ld),Ud=Te(Yo,fe(6)),fc=Te(Yo,fe(273)),Y5=Ne(Te(Ud,ve(fe(421)))),J5=Ne(fc),Md=Te(fc,Re(460),ve(fe(421))),Ml=Te(fc,Re(461),ve(fe(421))),v2=It(Md,Ml),Q5=Ne(Md),e4=Ne(Ml),jd=It(Yo,Ud,fc,Md,Ml),Yw=It(Te(jd,Re(477),ve(fe(421)))),t4=Ne(Yw),Jw=It(Te(jd,Re(478),ve(fe(421))),Te(jd,Re(448),ve(fe(449)),Re(477),ve(fe(421)))),r4=Ne(Jw),Qw=Te(fc,Re(280),ve(fe(466)),ve(fe(466)),ve(fe(421))),eb=Ne(Qw),tb=Te(Ml,Re(465),ve(fe(466)),ve(fe(466)),ve(fe(421))),n4=Ne(tb),jl=It(Yw,Jw,Te(Ud,ve(fe(421))),Te(v2,ve(fe(421))),Te(Yo,ve(fe(421))),Qw,tb,fe(421)),rb=Ne(jl),_2=Te(jl,Re(290),fe(421)),o4=Ne(_2),S2=It(Te(jl,Re(290),Re(281),ve(fe(421))),Te(jl,Re(281),ve(fe(421))),Te(Re(281),ve(fe(421)))),nb=Ne(S2),A2=It(Te(Yo,fe(6),Re(480),ve(fe(421))),Te(Yo,Re(480),ve(fe(421)))),i4=Ne(A2),E2=Te(Yo,It(Te(fe(6,"443"),Re(480)),Te(fe(6),Re(443)),Te(fe(6),Re(448),Re(480)),Te(Re(448),Re(480)),Re(448),Re(443)),ve(fe(421))),s4=Ne(E2),C2=It(Te(fe(777),ve(fe(421)))),a4=Ne(C2),T2=It(Te(fe(400),ve(fe(421)))),c4=Ne(T2);var Ot;(function(r){let e;(function(o){o.FIN="FIN",o.STOP_SENDING="STOP_SENDING",o.RESET="RESET",o.FIN_ACK="FIN_ACK"})(e=r.Flag||(r.Flag={}));let t;(function(o){o[o.FIN=0]="FIN",o[o.STOP_SENDING=1]="STOP_SENDING",o[o.RESET=2]="RESET",o[o.FIN_ACK=3]="FIN_ACK"})(t||(t={})),function(o){o.codec=()=>qo(t)}(e=r.Flag||(r.Flag={}));let n;r.codec=()=>(n==null&&(n=Br((o,i,s={})=>{s.lengthDelimited!==!1&&i.fork(),o.flag!=null&&(i.uint32(8),r.Flag.codec().encode(o.flag,i)),o.message!=null&&(i.uint32(18),i.bytes(o.message)),s.lengthDelimited!==!1&&i.ldelim()},(o,i,s={})=>{let a={},c=i==null?o.len:o.pos+i;for(;o.pos<c;){let l=o.uint32();switch(l>>>3){case 1:{a.flag=r.Flag.codec().decode(o);break}case 2:{a.message=o.bytes();break}default:{o.skipType(l&7);break}}}return a})),n),r.encode=o=>Pr(o,r.codec()),r.decode=(o,i)=>Or(o,r.codec(),i)})(Ot||(Ot={}));var ob=["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478","stun:stun.cloudflare.com:3478","stun:stun.services.mozilla.com:3478"],Kd=Array.from("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890"),ib="libp2p+webrtc+v1/";var sb=466,ab=2*1024*1024,cb=30*1e3,Cs=16*1024;function I2(r=Cs){let e=Ve(r-Ve(r)),t=1+Ve(Object.keys(Ot.Flag).length-1),n=1,o=r-e-t-n,i=Ve(o);return e+t+n+i}var ub=I2(),lb=5e3,fb=5e3,pb=3e4,Hd="/webrtc",pc="/webrtc-signaling/0.0.1",hb="/libp2p/webrtc-direct/certificate",db="webrtc-direct-certificate-private-key";var yb=12096e5,Vd=864e5;var mb=function(r,e,t){if(t||arguments.length===2)for(var n=0,o=e.length,i;n<o;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))},O2=function(){function r(e,t,n){this.name=e,this.version=t,this.os=n,this.type="browser"}return r}();var P2=function(){function r(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return r}();var B2=function(){function r(e,t,n,o){this.name=e,this.version=t,this.os=n,this.bot=o,this.type="bot-device"}return r}();var k2=function(){function r(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return r}();var N2=function(){function r(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return r}();var D2=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,j2=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,gb=3,R2=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",D2]],wb=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function xb(r){return r?bb(r):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new N2:typeof navigator<"u"?bb(navigator.userAgent):M2()}function L2(r){return r!==""&&R2.reduce(function(e,t){var n=t[0],o=t[1];if(e)return e;var i=o.exec(r);return!!i&&[n,i]},!1)}function bb(r){var e=L2(r);if(!e)return null;var t=e[0],n=e[1];if(t==="searchbot")return new k2;var o=n[1]&&n[1].split(".").join("_").split("_").slice(0,3);o?o.length<gb&&(o=mb(mb([],o,!0),K2(gb-o.length),!0)):o=[];var i=o.join("."),s=U2(r),a=j2.exec(r);return a&&a[1]?new B2(t,i,s,a[1]):new O2(t,i,s)}function U2(r){for(var e=0,t=wb.length;e<t;e++){var n=wb[e],o=n[0],i=n[1],s=i.exec(r);if(s)return o}return null}function M2(){var r=typeof process<"u"&&process.version;return r?new P2(process.version.slice(1)):null}function K2(r){for(var e=[],t=0;t<r;t++)e.push("0");return e}function Je(){let r={};return r.promise=new Promise((e,t)=>{r.resolve=e,r.reject=t}),r}var $d=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},Fd=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}},vb=r=>globalThis.DOMException===void 0?new Fd(r):new DOMException(r),_b=r=>{let e=r.reason===void 0?vb("This operation was aborted."):r.reason;return e instanceof Error?e:vb(e)};function hc(r,e){let{milliseconds:t,fallback:n,message:o,customTimers:i={setTimeout,clearTimeout}}=e,s,a,l=new Promise((f,p)=>{if(typeof t!="number"||Math.sign(t)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(e.signal){let{signal:m}=e;m.aborted&&p(_b(m)),a=()=>{p(_b(m))},m.addEventListener("abort",a,{once:!0})}if(t===Number.POSITIVE_INFINITY){r.then(f,p);return}let y=new $d;s=i.setTimeout.call(void 0,()=>{if(n){try{f(n())}catch(m){p(m)}return}typeof r.cancel=="function"&&r.cancel(),o===!1?f():o instanceof Error?p(o):(y.message=o??`Promise timed out after ${t} milliseconds`,p(y))},t),(async()=>{try{f(await r)}catch(m){p(m)}})()}).finally(()=>{l.clear(),a&&e.signal&&e.signal.removeEventListener("abort",a)});return l.clear=()=>{i.clearTimeout.call(void 0,s),s=void 0},l}var Sb=xb(),dc=Sb!=null&&Sb.name==="firefox",Kl=async function*(){},Hl=async r=>{};function Ab(r,e,t=pb,n){r.readyState==="open"&&Promise.resolve().then(async()=>{if(r.bufferedAmount>0){n.log("%s drain channel with %d buffered bytes",e,r.bufferedAmount);let o=Je(),i=!1;r.bufferedAmountLowThreshold=0;let s=()=>{i||(n.log("%s drain channel closed before drain",e),o.resolve())};r.addEventListener("close",s,{once:!0}),r.addEventListener("bufferedamountlow",()=>{i=!0,r.removeEventListener("close",s),o.resolve()}),await hc(o.promise,{milliseconds:t})}}).then(async()=>{r.readyState==="open"&&r.close()}).catch(o=>{n.log.error("error closing outbound stream",o)})}async function Wd(r){return r=r??{},typeof r=="function"&&(r=await r()),r.iceServers=r.iceServers??ob.map(e=>({urls:[e]})),r}var Eb=(r=32)=>ib+[...Array(r)].map(()=>Kd.at(Math.floor(Math.random()*Kd.length))).join("");var Jo=class{log;peerConnection;remoteAddr;timeline;metrics;source=Kl();sink=Hl;constructor(e,t){this.log=e.logger.forComponent("libp2p:webrtc:maconn"),this.remoteAddr=t.remoteAddr,this.timeline=t.timeline,this.peerConnection=t.peerConnection;let n=this.peerConnection,o=n.connectionState;this.peerConnection.onconnectionstatechange=()=>{this.log.trace("peer connection state change",n.connectionState,"initial state",o),(n.connectionState==="disconnected"||n.connectionState==="failed"||n.connectionState==="closed")&&(this.timeline.close=Date.now())}}async close(e){this.log.trace("closing connection"),this.peerConnection.close(),this.timeline.close=Date.now(),this.metrics?.increment({close:!0})}abort(e){this.log.error("closing connection due to error",e),this.peerConnection.close(),this.timeline.close=Date.now(),this.metrics?.increment({abort:!0})}};var Vl=class{buffer;mask;top;btm;next;constructor(e){if(!(e>0)||(e-1&e)!==0)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){let e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return this.buffer[this.btm]===void 0}},Ts=class{size;hwm;head;tail;constructor(e={}){this.hwm=e.splitLimit??16,this.head=new Vl(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return e?.byteLength!=null?e.byteLength:1}push(e){if(e?.value!=null&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){let t=this.head;this.head=t.next=new Vl(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(e===void 0&&this.tail.next!=null){let t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return e?.value!=null&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}};var Gd=class extends Error{type;code;constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}};function Is(r={}){return H2(t=>{let n=t.shift();if(n==null)return{done:!0};if(n.error!=null)throw n.error;return{done:n.done===!0,value:n.value}},r)}function H2(r,e){e=e??{};let t=e.onEnd,n=new Ts,o,i,s,a=Je(),c=async()=>{try{return n.isEmpty()?s?{done:!0}:await new Promise((d,I)=>{i=D=>{i=null,n.push(D);try{d(r(n))}catch(j){I(j)}return o}}):r(n)}finally{n.isEmpty()&&queueMicrotask(()=>{a.resolve(),a=Je()})}},l=d=>i!=null?i(d):(n.push(d),o),f=d=>(n=new Ts,i!=null?i({error:d}):(n.push({error:d}),o)),p=d=>{if(s)return o;if(e?.objectMode!==!0&&d?.byteLength==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return l({done:!1,value:d})},y=d=>s?o:(s=!0,d!=null?f(d):l({done:!0})),m=()=>(n=new Ts,y(),{done:!0}),x=d=>(y(d),{done:!0});if(o={[Symbol.asyncIterator](){return this},next:c,return:m,throw:x,push:p,end:y,get readableLength(){return n.size},onEmpty:async d=>{let I=d?.signal;if(I?.throwIfAborted(),n.isEmpty())return;let D,j;I!=null&&(D=new Promise((Z,P)=>{j=()=>{P(new Gd)},I.addEventListener("abort",j)}));try{await Promise.race([a.promise,D])}finally{j!=null&&I!=null&&I?.removeEventListener("abort",j)}}},t==null)return o;let v=o;return o={[Symbol.asyncIterator](){return this},next(){return v.next()},throw(d){return v.throw(d),t!=null&&(t(d),t=void 0),{done:!0}},return(){return v.return(),t!=null&&(t(),t=void 0),{done:!0}},push:p,end(d){return v.end(d),t!=null&&(t(d),t=void 0),o},get readableLength(){return v.readableLength},onEmpty:d=>v.onEmpty(d)},o}var $l=class extends Error{type;code;constructor(e,t,n){super(e??"The operation was aborted"),this.type="aborted",this.name=n??"AbortError",this.code=t??"ABORT_ERR"}};async function ar(r,e,t){if(e==null)return r;if(e.aborted)return r.catch(()=>{}),Promise.reject(new $l(t?.errorMessage,t?.errorCode,t?.errorName));let n,o=new $l(t?.errorMessage,t?.errorCode,t?.errorName);try{return await Promise.race([r,new Promise((i,s)=>{n=()=>{s(o)},e.addEventListener("abort",n)})])}finally{n!=null&&e.removeEventListener("abort",n)}}function Cb(r){if(r!=null){if(typeof r[Symbol.iterator]=="function")return r[Symbol.iterator]();if(typeof r[Symbol.asyncIterator]=="function")return r[Symbol.asyncIterator]();if(typeof r.next=="function")return r}throw new Error("argument is not an iterator or iterable")}function Tb(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}function Ib(r,e){let t=Cb(r).return?.();Tb(t)&&t.catch(n=>{e.error("could not cause iterator to return",n)})}var V2=5e3;function qd(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}var Fl=class{id;direction;timeline;protocol;metadata;source;status;readStatus;writeStatus;log;sinkController;sinkEnd;closed;endErr;streamSource;onEnd;onCloseRead;onCloseWrite;onReset;onAbort;sendCloseWriteTimeout;sendingData;constructor(e){this.sinkController=new AbortController,this.sinkEnd=Je(),this.closed=Je(),this.log=e.log,this.status="open",this.readStatus="ready",this.writeStatus="ready",this.id=e.id,this.metadata=e.metadata??{},this.direction=e.direction,this.timeline={open:Date.now()},this.sendCloseWriteTimeout=e.sendCloseWriteTimeout??V2,this.onEnd=e.onEnd,this.onCloseRead=e.onCloseRead,this.onCloseWrite=e.onCloseWrite,this.onReset=e.onReset,this.onAbort=e.onAbort,this.source=this.streamSource=Is({onEnd:t=>{t!=null?this.log.trace("source ended with error",t):this.log.trace("source ended"),this.onSourceEnd(t)}}),this.sink=this.sink.bind(this)}async sink(e){if(this.writeStatus!=="ready")throw new Po(`writable end state is "${this.writeStatus}" not "ready"`);try{this.writeStatus="writing";let t={signal:this.sinkController.signal};if(this.direction==="outbound"){let o=this.sendNewStream(t);qd(o)&&await o}let n=()=>{Ib(e,this.log)};try{this.sinkController.signal.addEventListener("abort",n),this.log.trace("sink reading from source");for await(let o of e){o=o instanceof Uint8Array?new be(o):o;let i=this.sendData(o,t);qd(i)&&(this.sendingData=Je(),await i,this.sendingData.resolve(),this.sendingData=void 0)}}finally{this.sinkController.signal.removeEventListener("abort",n)}this.log.trace('sink finished reading from source, write status is "%s"',this.writeStatus),this.writeStatus==="writing"&&(this.writeStatus="closing",this.log.trace("send close write to remote"),await this.sendCloseWrite({signal:AbortSignal.timeout(this.sendCloseWriteTimeout)}),this.writeStatus="closed"),this.onSinkEnd()}catch(t){throw this.log.trace("sink ended with error, calling abort with error",t),this.abort(t),t}finally{this.log.trace("resolve sink end"),this.sinkEnd.resolve()}}onSourceEnd(e){this.timeline.closeRead==null&&(this.timeline.closeRead=Date.now(),this.readStatus="closed",e!=null&&this.endErr==null&&(this.endErr=e),this.onCloseRead?.(),this.timeline.closeWrite!=null?(this.log.trace("source and sink ended"),this.timeline.close=Date.now(),this.status!=="aborted"&&this.status!=="reset"&&(this.status="closed"),this.onEnd!=null&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("source ended, waiting for sink to end"))}onSinkEnd(e){this.timeline.closeWrite==null&&(this.timeline.closeWrite=Date.now(),this.writeStatus="closed",e!=null&&this.endErr==null&&(this.endErr=e),this.onCloseWrite?.(),this.timeline.closeRead!=null?(this.log.trace("sink and source ended"),this.timeline.close=Date.now(),this.status!=="aborted"&&this.status!=="reset"&&(this.status="closed"),this.onEnd!=null&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("sink ended, waiting for source to end"))}async close(e){this.status==="open"&&(this.log.trace("closing gracefully"),this.status="closing",await ar(Promise.all([this.closeWrite(e),this.closeRead(e),this.closed.promise]),e?.signal),this.status="closed",this.log.trace("closed gracefully"))}async closeRead(e={}){if(this.readStatus==="closing"||this.readStatus==="closed")return;this.log.trace('closing readable end of stream with starting read status "%s"',this.readStatus);let t=this.readStatus;this.readStatus="closing",this.status!=="reset"&&this.status!=="aborted"&&this.timeline.closeRead==null&&(this.log.trace("send close read to remote"),await this.sendCloseRead(e)),t==="ready"&&(this.log.trace("ending internal source queue with %d queued bytes",this.streamSource.readableLength),this.streamSource.end()),this.log.trace("closed readable end of stream")}async closeWrite(e={}){this.writeStatus==="closing"||this.writeStatus==="closed"||(this.log.trace('closing writable end of stream with starting write status "%s"',this.writeStatus),this.writeStatus==="ready"&&(this.log.trace("sink was never sunk, sink an empty array"),await ar(this.sink([]),e.signal)),this.writeStatus==="writing"&&(this.sendingData!=null&&await ar(this.sendingData.promise,e.signal),this.log.trace("aborting source passed to .sink"),this.sinkController.abort(),await ar(this.sinkEnd.promise,e.signal)),this.writeStatus="closed",this.log.trace("closed writable end of stream"))}abort(e){if(this.status==="closed"||this.status==="aborted"||this.status==="reset")return;this.log("abort with error",e),this.log("try to send reset to remote");let t=this.sendReset();qd(t)&&t.catch(n=>{this.log.error("error sending reset message",n)}),this.status="aborted",this.timeline.abort=Date.now(),this._closeSinkAndSource(e),this.onAbort?.(e)}reset(){if(this.status==="closed"||this.status==="aborted"||this.status==="reset")return;let e=new Wu("stream reset");this.status="reset",this.timeline.reset=Date.now(),this._closeSinkAndSource(e),this.onReset?.()}_closeSinkAndSource(e){this._closeSink(e),this._closeSource(e)}_closeSink(e){this.writeStatus==="writing"&&(this.log.trace("end sink source"),this.sinkController.abort()),this.onSinkEnd(e)}_closeSource(e){this.readStatus!=="closing"&&this.readStatus!=="closed"&&(this.log.trace("ending source with %d bytes to be read by consumer",this.streamSource.readableLength),this.readStatus="closing",this.streamSource.end(e))}remoteCloseWrite(){if(this.readStatus==="closing"||this.readStatus==="closed"){this.log("received remote close write but local source is already closed");return}this.log.trace("remote close write"),this._closeSource()}remoteCloseRead(){if(this.writeStatus==="closing"||this.writeStatus==="closed"){this.log("received remote close read but local sink is already closed");return}this.log.trace("remote close read"),this._closeSink()}destroy(){if(this.status==="closed"||this.status==="aborted"||this.status==="reset"){this.log("received destroy but we are already closed");return}this.log.trace("stream destroyed"),this._closeSinkAndSource()}sourcePush(e){this.streamSource.push(e)}sourceReadableLength(){return this.streamSource.readableLength}};function zd(r){let e=new globalThis.AbortController;function t(){e.abort();for(let i of r)i?.removeEventListener!=null&&i.removeEventListener("abort",t)}for(let i of r){if(i?.aborted===!0){t();break}i?.addEventListener!=null&&i.addEventListener("abort",t)}function n(){for(let i of r)i?.removeEventListener!=null&&i.removeEventListener("abort",t)}let o=e.signal;return o.clear=n,o}var Wl=class extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"},Os=class extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"},Gl=class extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"},yc=class extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"};function ql(r){return r[Symbol.asyncIterator]!=null}function Ob(r,e){if(r.byteLength>e)throw new Os("Message length too long")}var Xl=r=>{let e=Ve(r),t=it(e);return ml(r,t),Xl.bytes=e,t};Xl.bytes=0;function mc(r,e){e=e??{};let t=e.lengthEncoder??Xl,n=e?.maxDataLength??4194304;function*o(i){Ob(i,n);let s=t(i.byteLength);s instanceof Uint8Array?yield s:yield*s,i instanceof Uint8Array?yield i:yield*i}return ql(r)?async function*(){for await(let i of r)yield*o(i)}():function*(){for(let i of r)yield*o(i)}()}mc.single=(r,e)=>{e=e??{};let t=e.lengthEncoder??Xl,n=e?.maxDataLength??4194304;return Ob(r,n),new be(t(r.byteLength),r)};var Qo;(function(r){r[r.LENGTH=0]="LENGTH",r[r.DATA=1]="DATA"})(Qo||(Qo={}));var Xd=r=>{let e=Fo(r);return Xd.bytes=Ve(e),e};Xd.bytes=0;function ei(r,e){let t=new be,n=Qo.LENGTH,o=-1,i=e?.lengthDecoder??Xd,s=e?.maxLengthLength??8,a=e?.maxDataLength??4194304;function*c(){for(;t.byteLength>0;){if(n===Qo.LENGTH)try{if(o=i(t),o<0)throw new Wl("Invalid message length");if(o>a)throw new Os("Message length too long");let l=i.bytes;t.consume(l),e?.onLength!=null&&e.onLength(o),n=Qo.DATA}catch(l){if(l instanceof RangeError){if(t.byteLength>s)throw new Gl("Message length length too long");break}throw l}if(n===Qo.DATA){if(t.byteLength<o)break;let l=t.sublist(0,o);t.consume(o),e?.onData!=null&&e.onData(l),yield l,n=Qo.LENGTH}}}return ql(r)?async function*(){for await(let l of r)t.append(l),yield*c();if(t.byteLength>0)throw new yc("Unexpected end of input")}():function*(){for(let l of r)t.append(l),yield*c();if(t.byteLength>0)throw new yc("Unexpected end of input")}()}ei.fromReader=(r,e)=>{let t=1,n=async function*(){for(;;)try{let{done:i,value:s}=await r.next(t);if(i===!0)return;s!=null&&(yield s)}catch(i){if(i.code==="ERR_UNDER_READ")return{done:!0,value:null};throw i}finally{t=1}}();return ei(n,{...e??{},onLength:i=>{t=i}})};var Zd=class extends Error{type;code;constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.name="AbortError",this.code=t??"ABORT_ERR"}};async function gc(r,e,t,n){let o=new Zd(n?.errorMessage,n?.errorCode);return t?.aborted===!0?Promise.reject(o):new Promise((i,s)=>{function a(){t?.removeEventListener("abort",f),r.removeEventListener(e,c),n?.errorEvent!=null&&r.removeEventListener(n.errorEvent,l)}let c=p=>{try{if(n?.filter?.(p)===!1)return}catch(y){a(),s(y);return}a(),i(p)},l=p=>{a(),s(p.detail)},f=()=>{a(),s(o)};t?.addEventListener("abort",f),r.addEventListener(e,c),n?.errorEvent!=null&&r.addEventListener(n.errorEvent,l)})}var Yd=class extends Fl{channel;incomingData;maxBufferedAmount;bufferedAmountLowEventTimeout;maxMessageSize;receiveFinAck;finAckTimeout;openTimeout;closeController;constructor(e){let t=e.onEnd;switch(e.onEnd=o=>{this.log.trace('readable and writeable ends closed with status "%s"',this.status),Promise.resolve(async()=>{if(!(this.timeline.abort!=null||this.timeline.reset!==null))try{await hc(this.receiveFinAck.promise,{milliseconds:this.finAckTimeout})}catch(i){this.log.error("error receiving FIN_ACK",i)}}).then(()=>{this.incomingData.end(),t?.(o)}).catch(i=>{this.log.error("error ending stream",i)}).finally(()=>{this.channel.close()})},super(e),this.channel=e.channel,this.channel.binaryType="arraybuffer",this.incomingData=Is(),this.bufferedAmountLowEventTimeout=e.bufferedAmountLowEventTimeout??cb,this.maxBufferedAmount=e.maxBufferedAmount??ab,this.maxMessageSize=(e.maxMessageSize??Cs)-ub,this.receiveFinAck=Je(),this.finAckTimeout=e.closeTimeout??lb,this.openTimeout=e.openTimeout??fb,this.closeController=new AbortController,this.channel.readyState){case"open":this.timeline.open=new Date().getTime();break;case"closed":case"closing":(this.timeline.close===void 0||this.timeline.close===0)&&(this.timeline.close=Date.now());break;case"connecting":break;default:throw this.log.error("unknown datachannel state %s",this.channel.readyState),new Po("Unknown datachannel state")}this.channel.onopen=o=>{this.timeline.open=new Date().getTime()},this.channel.onclose=o=>{this.log.trace("received onclose event"),this.closeController.abort(),this.receiveFinAck.resolve(),this.close().catch(i=>{this.log.error("error closing stream after channel closed",i)})},this.channel.onerror=o=>{this.log.trace("received onerror event"),this.closeController.abort();let i=o.error;this.abort(i)},this.channel.onmessage=async o=>{let{data:i}=o;i===null||i.byteLength===0||this.incomingData.push(new Uint8Array(i,0,i.byteLength))};let n=this;Promise.resolve().then(async()=>{for await(let o of ei(this.incomingData)){let i=n.processIncomingProtobuf(o);i!=null&&n.sourcePush(new be(i))}}).catch(o=>{this.log.error("error processing incoming data channel messages",o)})}sendNewStream(){}async _sendMessage(e,t=!0){if(this.channel.readyState==="closed"||this.channel.readyState==="closing")throw new Po(`Invalid datachannel state - ${this.channel.readyState}`);if(this.channel.readyState!=="open"){let n=AbortSignal.timeout(this.openTimeout),o=zd([this.closeController.signal,n]);try{this.log('channel state is "%s" and not "open", waiting for "open" event before sending data',this.channel.readyState),await gc(this.channel,"open",o)}finally{o.clear()}this.log('channel state is now "%s", sending data',this.channel.readyState)}if(t&&this.channel.bufferedAmount>this.maxBufferedAmount){let n=AbortSignal.timeout(this.bufferedAmountLowEventTimeout),o=zd([this.closeController.signal,n]);try{this.log('channel buffer is %d, wait for "bufferedamountlow" event',this.channel.bufferedAmount),await gc(this.channel,"bufferedamountlow",o)}catch(i){throw n.aborted?new Xu(`Timed out waiting for DataChannel buffer to clear after ${this.bufferedAmountLowEventTimeout}ms`):i}finally{o.clear()}}try{this.log.trace('sending message, channel state "%s"',this.channel.readyState),this.channel.send(e.subarray())}catch(n){this.log.error("error while sending message",n)}}async sendData(e){let t=e.byteLength;for(e=e.sublist();e.byteLength>0;){let n=Math.min(e.byteLength,this.maxMessageSize),o=e.subarray(0,n),i=Ot.encode({message:o}),s=mc.single(i);this.log.trace("sending %d/%d bytes on channel",o.byteLength,t),await this._sendMessage(s),e.consume(n)}this.log.trace('finished sending data, channel state "%s"',this.channel.readyState)}async sendReset(){try{await this._sendFlag(Ot.Flag.RESET)}catch(e){this.log.error("failed to send reset - %e",e)}finally{this.channel.close()}}async sendCloseWrite(e){if(this.channel.readyState!=="open"){this.receiveFinAck.resolve();return}if(await this._sendFlag(Ot.Flag.FIN)){this.log.trace("awaiting FIN_ACK");try{await ar(this.receiveFinAck.promise,e?.signal,{errorMessage:"sending close-write was aborted before FIN_ACK was received",errorName:"FinAckNotReceivedError"})}catch(n){this.log.error("failed to await FIN_ACK",n)}}else this.log.trace("sending FIN failed, not awaiting FIN_ACK");this.receiveFinAck.resolve()}async sendCloseRead(){this.channel.readyState==="open"&&await this._sendFlag(Ot.Flag.STOP_SENDING)}processIncomingProtobuf(e){let t=Ot.decode(e);if(t.flag!==void 0&&(this.log.trace('incoming flag %s, write status "%s", read status "%s"',t.flag,this.writeStatus,this.readStatus),t.flag===Ot.Flag.FIN&&(this.remoteCloseWrite(),this.log.trace("sending FIN_ACK"),this._sendFlag(Ot.Flag.FIN_ACK).catch(n=>{this.log.error("error sending FIN_ACK immediately",n)})),t.flag===Ot.Flag.RESET&&this.reset(),t.flag===Ot.Flag.STOP_SENDING&&this.remoteCloseRead(),t.flag===Ot.Flag.FIN_ACK&&(this.log.trace("received FIN_ACK"),this.receiveFinAck.resolve())),this.readStatus==="ready")return t.message}async _sendFlag(e){if(this.channel.readyState!=="open")return this.log.trace('not sending flag %s because channel is "%s" and not "open"',e.toString(),this.channel.readyState),!1;this.log.trace("sending flag %s",e.toString());let t=Ot.encode({flag:e}),n=mc.single(t);try{return await this._sendMessage(n,!1),!0}catch(o){this.log.error("could not send flag %s - %e",e.toString(),o)}return!1}};function Ps(r){let{channel:e,direction:t,handshake:n}=r;return new Yd({id:`${e.id}`,log:r.logger.forComponent(`libp2p:webrtc:stream:${n===!0?"handshake":t}:${e.id}`),...r})}var ro=class{protocol;peerConnection;bufferedStreams=[];metrics;dataChannelOptions;components;log;constructor(e,t){this.components=e,this.peerConnection=t.peerConnection,this.metrics=t.metrics,this.protocol=t.protocol??Hd,this.dataChannelOptions=t.dataChannelOptions??{},this.log=e.logger.forComponent("libp2p:webrtc:muxerfactory"),this.peerConnection.ondatachannel=({channel:n})=>{if(this.log.trace('incoming early datachannel with channel id %d and label "%s"',n.id),n.label==="init"){this.log.trace("closing early init channel"),n.close();return}let o={},i=Ps({channel:n,direction:"inbound",onEnd:s=>{o.onEnd(s)},logger:e.logger,...this.dataChannelOptions});o.stream=i,o.channel=n,o.onEnd=()=>{this.bufferedStreams=this.bufferedStreams.filter(s=>s.stream.id!==i.id)},this.bufferedStreams.push(o)}}createStreamMuxer(e){return new Jd(this.components,{...e,peerConnection:this.peerConnection,dataChannelOptions:this.dataChannelOptions,metrics:this.metrics,streams:this.bufferedStreams,protocol:this.protocol})}},Jd=class{init;streams;protocol;log;peerConnection;dataChannelOptions;metrics;logger;constructor(e,t){this.init=t,this.log=e.logger.forComponent("libp2p:webrtc:muxer"),this.logger=e.logger,this.streams=t.streams.map(n=>n.stream),this.peerConnection=t.peerConnection,this.protocol=t.protocol??Hd,this.metrics=t.metrics,this.dataChannelOptions=t.dataChannelOptions??{},this.peerConnection.ondatachannel=({channel:n})=>{if(this.log.trace("incoming datachannel with channel id %d",n.id),n.label==="init"){this.log.trace("closing init channel"),n.close();return}let o=n.id,i=Ps({channel:n,direction:"inbound",onEnd:()=>{this.#e(i,n),this.log("incoming channel %s ended",o)},logger:this.logger,...this.dataChannelOptions});this.streams.push(i),this.metrics?.increment({incoming_stream:!0}),t?.onIncomingStream?.(i)},this.init.streams.length>0&&queueMicrotask(()=>{this.init.streams.forEach(n=>{n.onEnd=()=>{this.log("incoming early channel %s ended with state %s",n.channel.id,n.channel.readyState),this.#e(n.stream,n.channel)},this.metrics?.increment({incoming_stream:!0}),this.init?.onIncomingStream?.(n.stream)})})}#e(e,t){this.log.trace("stream %s %s %s onEnd",e.direction,e.id,e.protocol),Ab(t,`${e.direction} ${e.id} ${e.protocol}`,this.dataChannelOptions.drainTimeout,{log:this.log}),this.streams=this.streams.filter(n=>n.id!==e.id),this.metrics?.increment({stream_end:!0}),this.init?.onStreamEnd?.(e)}async close(e){try{await Promise.all(this.streams.map(async t=>t.close(e)))}catch(t){this.abort(t)}}abort(e){for(let t of this.streams)t.abort(e)}source=Kl();sink=Hl;newStream(){let e=this.peerConnection.createDataChannel(""),t=e.id;this.log.trace("opened outgoing datachannel with channel id %s",t);let n=Ps({channel:e,direction:"outbound",onEnd:()=>{this.#e(n,e),this.log("outgoing channel %s ended",t)},logger:this.logger,...this.dataChannelOptions});return this.streams.push(n),this.metrics?.increment({outgoing_stream:!0}),n}};var Zl=globalThis.RTCPeerConnection,Yl=globalThis.RTCSessionDescription,Pb=globalThis.RTCIceCandidate;var Qd=class{readNext;haveNext;ended;nextResult;error;constructor(){this.ended=!1,this.readNext=Je(),this.haveNext=Je()}[Symbol.asyncIterator](){return this}async next(){if(this.nextResult==null&&await this.haveNext.promise,this.nextResult==null)throw new Error("HaveNext promise resolved but nextResult was undefined");let e=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=Je(),e}async throw(e){return this.ended=!0,this.error=e,e!=null&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(e)),{done:!0,value:void 0}}async return(){let e={done:!0,value:void 0};return this.ended=!0,this.nextResult=e,this.haveNext.resolve(),e}async push(e,t){await this._push(e,t)}async end(e,t){e!=null?await this.throw(e):await this._push(void 0,t)}async _push(e,t){if(e!=null&&this.ended)throw this.error??new Error("Cannot push value onto an ended pushable");for(;this.nextResult!=null;)await this.readNext.promise;e!=null?this.nextResult={done:!1,value:e}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=Je(),await ar(this.readNext.promise,t?.signal,t)}};function Jl(){return new Qd}var Ql=class extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"};function Bb(r,e){let t=Jl();r.sink(t).catch(async s=>{await t.end(s)}),r.sink=async s=>{for await(let a of s)await t.push(a);await t.end()};let n=r.source;r.source[Symbol.iterator]!=null?n=r.source[Symbol.iterator]():r.source[Symbol.asyncIterator]!=null&&(n=r.source[Symbol.asyncIterator]());let o=new be;return{read:async s=>{if(s?.signal?.throwIfAborted(),s?.bytes==null){let{done:c,value:l}=await ar(n.next(),s?.signal);return c===!0?null:l}for(;o.byteLength<s.bytes;){let{value:c,done:l}=await ar(n.next(),s?.signal);if(l===!0)throw new Ql("unexpected end of input");o.append(c)}let a=o.sublist(0,s.bytes);return o.consume(s.bytes),a},write:async(s,a)=>{a?.signal?.throwIfAborted(),s instanceof Uint8Array?await t.push(s,a):await t.push(s.subarray(),a)},unwrap:()=>{if(o.byteLength>0){let s=r.source;r.source=async function*(){e?.yieldBytes===!1?yield o:yield*o,yield*s}()}return r}}}var ef=class extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"},tf=class extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"},rf=class extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"};function wc(r,e={}){let t=Bb(r,e);e.maxDataLength!=null&&e.maxLengthLength==null&&(e.maxLengthLength=Ve(e.maxDataLength));let n=e?.lengthDecoder??Fo,o=e?.lengthEncoder??ml;return{read:async s=>{let a=-1,c=new be;for(;;){c.append(await t.read({...s,bytes:1}));try{a=n(c)}catch(l){if(l instanceof RangeError)continue;throw l}if(a<0)throw new ef("Invalid message length");if(e?.maxLengthLength!=null&&c.byteLength>e.maxLengthLength)throw new rf("message length length too long");if(a>-1)break}if(e?.maxDataLength!=null&&a>e.maxDataLength)throw new tf("message length too long");return t.read({...s,bytes:a})},write:async(s,a)=>{await t.write(new be(o(s.byteLength),s),a)},writeV:async(s,a)=>{let c=new be(...s.flatMap(l=>[o(l.byteLength),l]));await t.write(c,a)},unwrap:()=>t.unwrap()}}function nf(r,e){let t=wc(r,e),n={read:async(o,i)=>{let s=await t.read(i);return o.decode(s)},write:async(o,i,s)=>{await t.write(i.encode(o),s)},writeV:async(o,i,s)=>{await t.writeV(o.map(a=>i.encode(a)),s)},pb:o=>({read:async i=>n.read(o,i),write:async(i,s)=>n.write(i,o,s),writeV:async(i,s)=>n.writeV(i,o,s),unwrap:()=>n}),unwrap:()=>t.unwrap()};return n}var tr=class extends Event{type;detail;constructor(e,t){super(e),this.type=e,this.detail=t}};var no=class extends Error{constructor(e){super(`WebRTC transport error: ${e}`),this.name="WebRTCTransportError"}},cr=class extends no{constructor(e="SDP handshake failed"){super(e),this.name="SDPHandshakeFailedError"}};var of=class extends no{constructor(e,t){super(`Invalid fingerprint "${e}" within ${t}`),this.name="WebRTC/InvalidFingerprintError"}};var sf=class extends no{constructor(e){super(`A method (${e}) was called though it has been intentionally left unimplemented.`),this.name="WebRTC/UnimplementedError"}},af=class extends no{constructor(e){super(`unsupported hash algorithm code: ${e} please see the codes at https://github.com/multiformats/multicodec/blob/master/table.csv `),this.name="WebRTC/UnsupportedHashAlgorithmError"}};var Mt;(function(r){let e;(function(o){o.SDP_OFFER="SDP_OFFER",o.SDP_ANSWER="SDP_ANSWER",o.ICE_CANDIDATE="ICE_CANDIDATE"})(e=r.Type||(r.Type={}));let t;(function(o){o[o.SDP_OFFER=0]="SDP_OFFER",o[o.SDP_ANSWER=1]="SDP_ANSWER",o[o.ICE_CANDIDATE=2]="ICE_CANDIDATE"})(t||(t={})),function(o){o.codec=()=>qo(t)}(e=r.Type||(r.Type={}));let n;r.codec=()=>(n==null&&(n=Br((o,i,s={})=>{s.lengthDelimited!==!1&&i.fork(),o.type!=null&&(i.uint32(8),r.Type.codec().encode(o.type,i)),o.data!=null&&(i.uint32(18),i.string(o.data)),s.lengthDelimited!==!1&&i.ldelim()},(o,i,s={})=>{let a={},c=i==null?o.len:o.pos+i;for(;o.pos<c;){let l=o.uint32();switch(l>>>3){case 1:{a.type=r.Type.codec().decode(o);break}case 2:{a.data=o.string();break}default:{o.skipType(l&7);break}}}return a})),n),r.encode=o=>Pr(o,r.codec()),r.decode=(o,i)=>Or(o,r.codec(),i)})(Mt||(Mt={}));var cf=async(r,e,t)=>{try{let n=Je();for(W2(r,n);;){let o=await Promise.race([n.promise,e.read({signal:t.signal}).catch(()=>{})]);if(o==null){t.signal?.throwIfAborted();break}if(o.type!==Mt.Type.ICE_CANDIDATE)throw new zu("ICE candidate message expected");let i=JSON.parse(o.data??"null");if(i===""||i===null){t.onProgress?.(new tr("webrtc:end-of-ice-candidates")),t.log.trace("end-of-candidates received");continue}let s=new Pb(i);t.log.trace("%s received new ICE candidate %o",t.direction,i);try{t.onProgress?.(new tr("webrtc:add-ice-candidate",s.candidate)),await r.addIceCandidate(s)}catch(a){t.log.error("%s bad candidate received",t.direction,i,a)}}}catch(n){if(t.log.error("%s error parsing ICE candidate",t.direction,n),t.signal?.aborted===!0&&uf(r)!=="connected")throw n}};function uf(r){return dc?r.iceConnectionState:r.connectionState}function W2(r,e){r[dc?"oniceconnectionstatechange":"onconnectionstatechange"]=t=>{switch(uf(r)){case"connected":e.resolve();break;case"failed":case"disconnected":case"closed":e.reject(new Fu("RTCPeerConnection was closed"));break;default:break}}}async function kb({rtcConfiguration:r,dataChannel:e,signal:t,metrics:n,multiaddr:o,connectionManager:i,transportManager:s,log:a,logger:c,onProgress:l}){let{circuitAddress:f,targetPeer:p}=Nb(o);n?.dialerEvents.increment({open:!0}),a.trace("dialing circuit address: %a",f);let y=i.getConnections(p),m;y.length===0?(l?.(new tr("webrtc:dial-relay")),m=await s.dial(f,{signal:t,onProgress:l})):(l?.(new tr("webrtc:reuse-relay-connection")),m=y[0]),l?.(new tr("webrtc:open-signaling-stream"));let x=await m.newStream(pc,{signal:t,runOnLimitedConnection:!0}),v=nf(x).pb(Mt),d=new Zl(r),I=new ro({logger:c},{peerConnection:d,dataChannelOptions:e});try{let D=d.createDataChannel("init");d.onicecandidate=({candidate:M})=>{let V=JSON.stringify(M?.toJSON()??null);a.trace("initiator sending ICE candidate %o",M),v.write({type:Mt.Type.ICE_CANDIDATE,data:V},{signal:t}).catch(K=>{a.error("error sending ICE candidate",K)})},d.onicecandidateerror=M=>{a.error("initiator ICE candidate error",M)};let j=await d.createOffer().catch(M=>{throw a.error("could not execute createOffer",M),new cr("Failed to set createOffer")});a.trace("initiator send SDP offer %s",j.sdp),l?.(new tr("webrtc:send-sdp-offer")),await v.write({type:Mt.Type.SDP_OFFER,data:j.sdp},{signal:t}),await d.setLocalDescription(j).catch(M=>{throw a.error("could not execute setLocalDescription",M),new cr("Failed to set localDescription")}),l?.(new tr("webrtc:read-sdp-answer")),a.trace("initiator read SDP answer");let Z=await v.read({signal:t});if(Z.type!==Mt.Type.SDP_ANSWER)throw new cr("Remote should send an SDP answer");a.trace("initiator received SDP answer %s",Z.data);let P=new Yl({type:"answer",sdp:Z.data});return await d.setRemoteDescription(P).catch(M=>{throw a.error("could not execute setRemoteDescription",M),new cr("Failed to set remoteDescription")}),a.trace("initiator read candidates until connected"),l?.(new tr("webrtc:read-ice-candidates")),await cf(d,v,{direction:"initiator",signal:t,log:a,onProgress:l}),a.trace("initiator connected, closing init channel"),D.close(),l?.(new tr("webrtc:close-signaling-stream")),a.trace("closing signaling channel"),await x.close({signal:t}),a.trace("initiator connected to remote address %s",o),{remoteAddress:o,peerConnection:d,muxerFactory:I}}catch(D){throw a.error("outgoing signaling error",D),d.close(),x.abort(D),D}finally{d.onicecandidate=null,d.onicecandidateerror=null}}var Db=Ne(rb.matchers[0],Re(290)),lf=class r extends Fn{transportManager;shutdownController;events;constructor(e,t){super(),this.transportManager=e.transportManager,this.events=e.events,this.shutdownController=t.shutdownController,this.onTransportListening=this.onTransportListening.bind(this)}async listen(){this.events.addEventListener("transport:listening",this.onTransportListening)}onTransportListening(e){e.detail.getAddrs().filter(n=>Db.exactMatch(n)).map(n=>n.encapsulate("/webrtc")).length>0&&this.safeDispatchEvent("listening")}getAddrs(){return this.transportManager.getListeners().filter(e=>!(e instanceof r)).map(e=>e.getAddrs().filter(t=>Db.exactMatch(t)).map(t=>t.encapsulate("/webrtc"))).flat()}updateAnnounceAddrs(){}async close(){this.events.removeEventListener("transport:listening",this.onTransportListening),this.shutdownController.abort(),queueMicrotask(()=>{this.safeDispatchEvent("close")})}};async function jb({peerConnection:r,stream:e,signal:t,connection:n,log:o}){o.trace("new inbound signaling stream");let i=nf(e).pb(Mt);try{r.onicecandidate=({candidate:f})=>{let p=JSON.stringify(f?.toJSON()??null);o.trace("recipient sending ICE candidate %s",p),i.write({type:Mt.Type.ICE_CANDIDATE,data:p},{signal:t}).catch(y=>{o.error("error sending ICE candidate",y)})},o.trace("recipient read SDP offer");let a=await i.read({signal:t});if(a.type!==Mt.Type.SDP_OFFER)throw new cr(`expected message type SDP_OFFER, received: ${a.type??"undefined"} `);o.trace("recipient received SDP offer %s",a.data);let c=new Yl({type:"offer",sdp:a.data});await r.setRemoteDescription(c).catch(f=>{throw o.error("could not execute setRemoteDescription",f),new cr("Failed to set remoteDescription")});let l=await r.createAnswer().catch(f=>{throw o.error("could not execute createAnswer",f),new cr("Failed to create answer")});o.trace("recipient send SDP answer %s",l.sdp),await i.write({type:Mt.Type.SDP_ANSWER,data:l.sdp},{signal:t}),await r.setLocalDescription(l).catch(f=>{throw o.error("could not execute setLocalDescription",f),new cr("Failed to set localDescription")}),o.trace("recipient read candidates until connected"),await cf(r,i,{direction:"recipient",signal:t,log:o})}catch(a){if(uf(r)!=="connected")throw o.error("error while handling signaling stream from peer %a",n.remoteAddr,a),r.close(),a;o("error while handling signaling stream from peer %a, ignoring as the RTCPeerConnection is already connected",n.remoteAddr,a)}let s=xn(`/webrtc/p2p/${n.remoteAddr.getPeerId()}`);return o.trace("recipient connected to remote address %s",s),{remoteAddress:s}}var ff=class{components;init;log;_started=!1;metrics;shutdownController;constructor(e,t={}){this.components=e,this.init=t,this.log=e.logger.forComponent("libp2p:webrtc"),this.shutdownController=new AbortController,this.shutdownController.signal,e.metrics!=null&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_webrtc_dialer_events_total",{label:"event",help:"Total count of WebRTC dialer events by type"}),listenerEvents:e.metrics.registerCounterGroup("libp2p_webrtc_listener_events_total",{label:"event",help:"Total count of WebRTC listener events by type"})})}[Hu]=!0;[Symbol.toStringTag]="@libp2p/webrtc";[es]=["@libp2p/transport"];[Eg]=["@libp2p/identify","@libp2p/circuit-relay-v2-transport"];isStarted(){return this._started}async start(){await this.components.registrar.handle(pc,e=>{let t=this.components.upgrader.createInboundAbortSignal(this.shutdownController.signal);this._onProtocol(e,t).catch(n=>{this.log.error("failed to handle incoming connect from %p",e.connection.remotePeer,n)}).finally(()=>{t.clear()})},{runOnLimitedConnection:!0}),this._started=!0}async stop(){await this.components.registrar.unhandle(pc),this._started=!1}createListener(e){return new lf(this.components,{shutdownController:this.shutdownController})}listenFilter(e){return e.filter(nb.exactMatch)}dialFilter(e){return this.listenFilter(e)}async dial(e,t){this.log.trace("dialing address: %a",e);let{remoteAddress:n,peerConnection:o,muxerFactory:i}=await kb({rtcConfiguration:await Wd(this.init.rtcConfiguration),dataChannel:this.init.dataChannel,multiaddr:e,dataChannelOptions:this.init.dataChannel,signal:t.signal,connectionManager:this.components.connectionManager,transportManager:this.components.transportManager,log:this.log,logger:this.components.logger,onProgress:t.onProgress}),s=new Jo(this.components,{peerConnection:o,timeline:{open:Date.now()},remoteAddr:n,metrics:this.metrics?.dialerEvents}),a=await t.upgrader.upgradeOutbound(s,{skipProtection:!0,skipEncryption:!0,muxerFactory:i,onProgress:t.onProgress,signal:t.signal});return this._closeOnShutdown(o,s),a}async _onProtocol({connection:e,stream:t},n){let o=new Zl(await Wd(this.init.rtcConfiguration)),i=new ro(this.components,{peerConnection:o,dataChannelOptions:this.init.dataChannel});try{let{remoteAddress:s}=await jb({peerConnection:o,connection:e,stream:t,signal:n,log:this.log});await t.close({signal:n});let a=new Jo(this.components,{peerConnection:o,timeline:{open:new Date().getTime()},remoteAddr:s,metrics:this.metrics?.listenerEvents});await this.components.upgrader.upgradeInbound(a,{skipEncryption:!0,skipProtection:!0,muxerFactory:i,signal:n}),this._closeOnShutdown(o,a)}catch(s){throw this.log.error("incoming signaling error",s),o.close(),t.abort(s),s}}_closeOnShutdown(e,t){let n=()=>{t.close().catch(o=>{this.log.error("could not close WebRTCMultiaddrConnection",o)})};this.shutdownController.signal.addEventListener("abort",n),e.addEventListener("close",()=>{this.shutdownController.signal.removeEventListener("abort",n)})}};function Nb(r){let e=r.getComponents().filter(({name:n})=>n==="p2p").map(({value:n})=>n).pop();if(e==null)throw new Ie("Destination peer id was missing");return{circuitAddress:xn(r.getComponents().filter(({name:n})=>n!=="webrtc")),targetPeer:Cl(e)}}var kz=$r(Lb());var en={};St(en,{Any:()=>Jr,BaseBlock:()=>Qe,BaseStringBlock:()=>_c,BitString:()=>jr,BmpString:()=>ii,Boolean:()=>ri,CharacterString:()=>di,Choice:()=>Ns,Constructed:()=>st,DATE:()=>Ic,DateTime:()=>Pc,Duration:()=>Bc,EndOfContent:()=>Sc,Enumerated:()=>ni,GeneralString:()=>hi,GeneralizedTime:()=>yi,GraphicString:()=>pi,HexBlock:()=>Qr,IA5String:()=>fi,Integer:()=>En,Null:()=>Nr,NumericString:()=>ai,ObjectIdentifier:()=>oi,OctetString:()=>Dr,Primitive:()=>An,PrintableString:()=>ci,RawData:()=>ny,RelativeObjectIdentifier:()=>Tc,Repeated:()=>mi,Sequence:()=>Vt,Set:()=>$t,TIME:()=>kc,TeletexString:()=>ui,TimeOfDay:()=>Oc,UTCTime:()=>ao,UniversalString:()=>si,Utf8String:()=>lr,ValueBlock:()=>ht,VideotexString:()=>li,ViewWriter:()=>ks,VisibleString:()=>so,compareSchema:()=>io,fromBER:()=>Tn,verifySchema:()=>pC});var ye=$r(_n());function ti(r,e){let t=0;if(r.length===1)return r[0];for(let n=r.length-1;n>=0;n--)t+=r[r.length-1-n]*Math.pow(2,e*n);return t}function oo(r,e,t=-1){let n=t,o=r,i=0,s=Math.pow(2,e);for(let a=1;a<8;a++){if(r<s){let c;if(n<0)c=new ArrayBuffer(a),i=a;else{if(n<a)return new ArrayBuffer(0);c=new ArrayBuffer(n),i=n}let l=new Uint8Array(c);for(let f=a-1;f>=0;f--){let p=Math.pow(2,f*e);l[i-f-1]=Math.floor(o/p),o-=l[i-f-1]*p}return c}s*=Math.pow(2,e)}return new ArrayBuffer(0)}function df(...r){let e=0,t=0;for(let i of r)e+=i.length;let n=new ArrayBuffer(e),o=new Uint8Array(n);for(let i of r)o.set(i,t),t+=i.length;return o}function ty(){let r=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){let a=r[0]===255&&r[1]&128,c=r[0]===0&&(r[1]&128)===0;(a||c)&&this.warnings.push("Needlessly long format")}let e=new ArrayBuffer(this.valueHex.byteLength),t=new Uint8Array(e);for(let a=0;a<this.valueHex.byteLength;a++)t[a]=0;t[0]=r[0]&128;let n=ti(t,8),o=new ArrayBuffer(this.valueHex.byteLength),i=new Uint8Array(o);for(let a=0;a<this.valueHex.byteLength;a++)i[a]=r[a];return i[0]&=127,ti(i,8)-n}function Ub(r){let e=r<0?r*-1:r,t=128;for(let n=1;n<8;n++){if(e<=t){if(r<0){let s=t-e,a=oo(s,8,n),c=new Uint8Array(a);return c[0]|=128,a}let o=oo(e,8,n),i=new Uint8Array(o);if(i[0]&128){let s=o.slice(0),a=new Uint8Array(s);o=new ArrayBuffer(o.byteLength+1),i=new Uint8Array(o);for(let c=0;c<s.byteLength;c++)i[c+1]=a[c];i[0]=0}return o}t*=Math.pow(2,8)}return new ArrayBuffer(0)}function Mb(r,e){if(r.byteLength!==e.byteLength)return!1;let t=new Uint8Array(r),n=new Uint8Array(e);for(let o=0;o<t.length;o++)if(t[o]!==n[o])return!1;return!0}function Kt(r,e){let t=r.toString(10);if(e<t.length)return"";let n=e-t.length,o=new Array(n);for(let s=0;s<n;s++)o[s]="0";return o.join("").concat(t)}var DN=Math.log(2);function yf(){if(typeof BigInt>"u")throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function oy(r){let e=0,t=0;for(let o=0;o<r.length;o++){let i=r[o];e+=i.byteLength}let n=new Uint8Array(e);for(let o=0;o<r.length;o++){let i=r[o];n.set(new Uint8Array(i),t),t+=i.byteLength}return n.buffer}function Cn(r,e,t,n){return e instanceof Uint8Array?e.byteLength?t<0?(r.error="Wrong parameter: inputOffset less than zero",!1):n<0?(r.error="Wrong parameter: inputLength less than zero",!1):e.byteLength-t-n<0?(r.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):!0:(r.error="Wrong parameter: inputBuffer has zero length",!1):(r.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}var ks=class{constructor(){this.items=[]}write(e){this.items.push(e)}final(){return oy(this.items)}},bc=[new Uint8Array([1])],Kb="0123456789",ry="name",Hb="valueHexView",eC="isHexOnly",tC="idBlock",rC="tagClass",nC="tagNumber",oC="isConstructed",iC="fromBER",sC="toBER",aC="local",Ht="",Rr=new ArrayBuffer(0),Pf=new Uint8Array(0),vc="EndOfContent",$b="OCTET STRING",Fb="BIT STRING";function Qr(r){var e;return e=class extends r{get valueHex(){return this.valueHexView.slice().buffer}set valueHex(n){this.valueHexView=new Uint8Array(n)}constructor(...n){var o;super(...n);let i=n[0]||{};this.isHexOnly=(o=i.isHexOnly)!==null&&o!==void 0?o:!1,this.valueHexView=i.valueHex?ye.BufferSourceConverter.toUint8Array(i.valueHex):Pf}fromBER(n,o,i){let s=n instanceof ArrayBuffer?new Uint8Array(n):n;if(!Cn(this,s,o,i))return-1;let a=o+i;return this.valueHexView=s.subarray(o,a),this.valueHexView.length?(this.blockLength=i,a):(this.warnings.push("Zero buffer length"),o)}toBER(n=!1){return this.isHexOnly?n?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",Rr)}toJSON(){return{...super.toJSON(),isHexOnly:this.isHexOnly,valueHex:ye.Convert.ToHex(this.valueHexView)}}},e.NAME="hexBlock",e}var Sn=class{static blockName(){return this.NAME}get valueBeforeDecode(){return this.valueBeforeDecodeView.slice().buffer}set valueBeforeDecode(e){this.valueBeforeDecodeView=new Uint8Array(e)}constructor({blockLength:e=0,error:t=Ht,warnings:n=[],valueBeforeDecode:o=Pf}={}){this.blockLength=e,this.error=t,this.warnings=n,this.valueBeforeDecodeView=ye.BufferSourceConverter.toUint8Array(o)}toJSON(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:ye.Convert.ToHex(this.valueBeforeDecodeView)}}};Sn.NAME="baseBlock";var ht=class extends Sn{fromBER(e,t,n){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}toBER(e,t){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}};ht.NAME="valueBlock";var mf=class extends Qr(Sn){constructor({idBlock:e={}}={}){var t,n,o,i;super(),e?(this.isHexOnly=(t=e.isHexOnly)!==null&&t!==void 0?t:!1,this.valueHexView=e.valueHex?ye.BufferSourceConverter.toUint8Array(e.valueHex):Pf,this.tagClass=(n=e.tagClass)!==null&&n!==void 0?n:-1,this.tagNumber=(o=e.tagNumber)!==null&&o!==void 0?o:-1,this.isConstructed=(i=e.isConstructed)!==null&&i!==void 0?i:!1):(this.tagClass=-1,this.tagNumber=-1,this.isConstructed=!1)}toBER(e=!1){let t=0;switch(this.tagClass){case 1:t|=0;break;case 2:t|=64;break;case 3:t|=128;break;case 4:t|=192;break;default:return this.error="Unknown tag class",Rr}if(this.isConstructed&&(t|=32),this.tagNumber<31&&!this.isHexOnly){let o=new Uint8Array(1);if(!e){let i=this.tagNumber;i&=31,t|=i,o[0]=t}return o.buffer}if(!this.isHexOnly){let o=oo(this.tagNumber,7),i=new Uint8Array(o),s=o.byteLength,a=new Uint8Array(s+1);if(a[0]=t|31,!e){for(let c=0;c<s-1;c++)a[c+1]=i[c]|128;a[s]=i[s-1]}return a.buffer}let n=new Uint8Array(this.valueHexView.byteLength+1);if(n[0]=t|31,!e){let o=this.valueHexView;for(let i=0;i<o.length-1;i++)n[i+1]=o[i]|128;n[this.valueHexView.byteLength]=o[o.length-1]}return n.buffer}fromBER(e,t,n){let o=ye.BufferSourceConverter.toUint8Array(e);if(!Cn(this,o,t,n))return-1;let i=o.subarray(t,t+n);if(i.length===0)return this.error="Zero buffer length",-1;switch(i[0]&192){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=(i[0]&32)===32,this.isHexOnly=!1;let a=i[0]&31;if(a!==31)this.tagNumber=a,this.blockLength=1;else{let c=1,l=this.valueHexView=new Uint8Array(255),f=255;for(;i[c]&128;){if(l[c-1]=i[c]&127,c++,c>=i.length)return this.error="End of input reached before message was fully decoded",-1;if(c===f){f+=255;let y=new Uint8Array(f);for(let m=0;m<l.length;m++)y[m]=l[m];l=this.valueHexView=new Uint8Array(f)}}this.blockLength=c+1,l[c-1]=i[c]&127;let p=new Uint8Array(c);for(let y=0;y<c;y++)p[y]=l[y];l=this.valueHexView=new Uint8Array(c),l.set(p),this.blockLength<=9?this.tagNumber=ti(l,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(this.tagClass===1&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}toJSON(){return{...super.toJSON(),tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed}}};mf.NAME="identificationBlock";var gf=class extends Sn{constructor({lenBlock:e={}}={}){var t,n,o;super(),this.isIndefiniteForm=(t=e.isIndefiniteForm)!==null&&t!==void 0?t:!1,this.longFormUsed=(n=e.longFormUsed)!==null&&n!==void 0?n:!1,this.length=(o=e.length)!==null&&o!==void 0?o:0}fromBER(e,t,n){let o=ye.BufferSourceConverter.toUint8Array(e);if(!Cn(this,o,t,n))return-1;let i=o.subarray(t,t+n);if(i.length===0)return this.error="Zero buffer length",-1;if(i[0]===255)return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=i[0]===128,this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(i[0]&128),this.longFormUsed===!1)return this.length=i[0],this.blockLength=1,t+this.blockLength;let s=i[0]&127;if(s>8)return this.error="Too big integer",-1;if(s+1>i.length)return this.error="End of input reached before message was fully decoded",-1;let a=t+1,c=o.subarray(a,a+s);return c[s-1]===0&&this.warnings.push("Needlessly long encoded length"),this.length=ti(c,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=s+1,t+this.blockLength}toBER(e=!1){let t,n;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return t=new ArrayBuffer(1),e===!1&&(n=new Uint8Array(t),n[0]=128),t;if(this.longFormUsed){let o=oo(this.length,8);if(o.byteLength>127)return this.error="Too big length",Rr;if(t=new ArrayBuffer(o.byteLength+1),e)return t;let i=new Uint8Array(o);n=new Uint8Array(t),n[0]=o.byteLength|128;for(let s=0;s<o.byteLength;s++)n[s+1]=i[s];return t}return t=new ArrayBuffer(1),e===!1&&(n=new Uint8Array(t),n[0]=this.length),t}toJSON(){return{...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length}}};gf.NAME="lengthBlock";var Q={},Qe=class extends Sn{constructor({name:e=Ht,optional:t=!1,primitiveSchema:n,...o}={},i){super(o),this.name=e,this.optional=t,n&&(this.primitiveSchema=n),this.idBlock=new mf(o),this.lenBlock=new gf(o),this.valueBlock=i?new i(o):new ht(o)}fromBER(e,t,n){let o=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return o===-1?(this.error=this.valueBlock.error,o):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),o)}toBER(e,t){let n=t||new ks;t||Wb(this);let o=this.idBlock.toBER(e);if(n.write(o),this.lenBlock.isIndefiniteForm)n.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(e,n),n.write(new ArrayBuffer(2));else{let i=this.valueBlock.toBER(e);this.lenBlock.length=i.byteLength;let s=this.lenBlock.toBER(e);n.write(s),n.write(i)}return t?Rr:n.final()}toJSON(){let e={...super.toJSON(),idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional};return this.primitiveSchema&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}toString(e="ascii"){return e==="ascii"?this.onAsciiEncoding():ye.Convert.ToHex(this.toBER())}onAsciiEncoding(){let e=this.constructor.NAME,t=ye.Convert.ToHex(this.valueBlock.valueBeforeDecodeView);return`${e} : ${t}`}isEqual(e){if(this===e)return!0;if(!(e instanceof this.constructor))return!1;let t=this.toBER(),n=e.toBER();return Mb(t,n)}};Qe.NAME="BaseBlock";function Wb(r){var e;if(r instanceof Q.Constructed)for(let t of r.valueBlock.value)Wb(t)&&(r.lenBlock.isIndefiniteForm=!0);return!!(!((e=r.lenBlock)===null||e===void 0)&&e.isIndefiniteForm)}var _c=class extends Qe{getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}constructor({value:e=Ht,...t}={},n){super(t,n),e&&this.fromString(e)}fromBER(e,t,n){let o=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return o===-1?(this.error=this.valueBlock.error,o):(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),o)}onAsciiEncoding(){return`${this.constructor.NAME} : '${this.valueBlock.value}'`}};_c.NAME="BaseStringBlock";var wf=class extends Qr(ht){constructor({isHexOnly:e=!0,...t}={}){super(t),this.isHexOnly=e}};wf.NAME="PrimitiveValueBlock";var Gb,An=class extends Qe{constructor(e={}){super(e,wf),this.idBlock.isConstructed=!1}};Gb=An;Q.Primitive=Gb;An.NAME="PRIMITIVE";function cC(r,e){if(r instanceof e)return r;let t=new e;return t.idBlock=r.idBlock,t.lenBlock=r.lenBlock,t.warnings=r.warnings,t.valueBeforeDecodeView=r.valueBeforeDecodeView,t}function Ds(r,e=0,t=r.length){let n=e,o=new Qe({},ht),i=new Sn;if(!Cn(i,r,e,t))return o.error=i.error,{offset:-1,result:o};if(!r.subarray(e,e+t).length)return o.error="Zero buffer length",{offset:-1,result:o};let a=o.idBlock.fromBER(r,e,t);if(o.idBlock.warnings.length&&o.warnings.concat(o.idBlock.warnings),a===-1)return o.error=o.idBlock.error,{offset:-1,result:o};if(e=a,t-=o.idBlock.blockLength,a=o.lenBlock.fromBER(r,e,t),o.lenBlock.warnings.length&&o.warnings.concat(o.lenBlock.warnings),a===-1)return o.error=o.lenBlock.error,{offset:-1,result:o};if(e=a,t-=o.lenBlock.blockLength,!o.idBlock.isConstructed&&o.lenBlock.isIndefiniteForm)return o.error="Indefinite length form used for primitive encoding form",{offset:-1,result:o};let c=Qe;switch(o.idBlock.tagClass){case 1:if(o.idBlock.tagNumber>=37&&o.idBlock.isHexOnly===!1)return o.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:o};switch(o.idBlock.tagNumber){case 0:if(o.idBlock.isConstructed&&o.lenBlock.length>0)return o.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:o};c=Q.EndOfContent;break;case 1:c=Q.Boolean;break;case 2:c=Q.Integer;break;case 3:c=Q.BitString;break;case 4:c=Q.OctetString;break;case 5:c=Q.Null;break;case 6:c=Q.ObjectIdentifier;break;case 10:c=Q.Enumerated;break;case 12:c=Q.Utf8String;break;case 13:c=Q.RelativeObjectIdentifier;break;case 14:c=Q.TIME;break;case 15:return o.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:o};case 16:c=Q.Sequence;break;case 17:c=Q.Set;break;case 18:c=Q.NumericString;break;case 19:c=Q.PrintableString;break;case 20:c=Q.TeletexString;break;case 21:c=Q.VideotexString;break;case 22:c=Q.IA5String;break;case 23:c=Q.UTCTime;break;case 24:c=Q.GeneralizedTime;break;case 25:c=Q.GraphicString;break;case 26:c=Q.VisibleString;break;case 27:c=Q.GeneralString;break;case 28:c=Q.UniversalString;break;case 29:c=Q.CharacterString;break;case 30:c=Q.BmpString;break;case 31:c=Q.DATE;break;case 32:c=Q.TimeOfDay;break;case 33:c=Q.DateTime;break;case 34:c=Q.Duration;break;default:{let l=o.idBlock.isConstructed?new Q.Constructed:new Q.Primitive;l.idBlock=o.idBlock,l.lenBlock=o.lenBlock,l.warnings=o.warnings,o=l}}break;case 2:case 3:case 4:default:c=o.idBlock.isConstructed?Q.Constructed:Q.Primitive}return o=cC(o,c),a=o.fromBER(r,e,o.lenBlock.isIndefiniteForm?t:o.lenBlock.length),o.valueBeforeDecodeView=r.subarray(n,n+o.blockLength),{offset:a,result:o}}function Tn(r){if(!r.byteLength){let e=new Qe({},ht);return e.error="Input buffer has zero length",{offset:-1,result:e}}return Ds(ye.BufferSourceConverter.toUint8Array(r).slice(),0,r.byteLength)}function uC(r,e){return r?1:e}var Yr=class extends ht{constructor({value:e=[],isIndefiniteForm:t=!1,...n}={}){super(n),this.value=e,this.isIndefiniteForm=t}fromBER(e,t,n){let o=ye.BufferSourceConverter.toUint8Array(e);if(!Cn(this,o,t,n))return-1;if(this.valueBeforeDecodeView=o.subarray(t,t+n),this.valueBeforeDecodeView.length===0)return this.warnings.push("Zero buffer length"),t;let i=t;for(;uC(this.isIndefiniteForm,n)>0;){let s=Ds(o,i,n);if(s.offset===-1)return this.error=s.result.error,this.warnings.concat(s.result.warnings),-1;if(i=s.offset,this.blockLength+=s.result.blockLength,n-=s.result.blockLength,this.value.push(s.result),this.isIndefiniteForm&&s.result.constructor.NAME===vc)break}return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===vc?this.value.pop():this.warnings.push("No EndOfContent block encoded")),i}toBER(e,t){let n=t||new ks;for(let o=0;o<this.value.length;o++)this.value[o].toBER(e,n);return t?Rr:n.final()}toJSON(){let e={...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,value:[]};for(let t of this.value)e.value.push(t.toJSON());return e}};Yr.NAME="ConstructedValueBlock";var qb,st=class extends Qe{constructor(e={}){super(e,Yr),this.idBlock.isConstructed=!0}fromBER(e,t,n){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;let o=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return o===-1?(this.error=this.valueBlock.error,o):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),o)}onAsciiEncoding(){let e=[];for(let n of this.valueBlock.value)e.push(n.toString("ascii").split(`
`).map(o=>`  ${o}`).join(`
`));let t=this.idBlock.tagClass===3?`[${this.idBlock.tagNumber}]`:this.constructor.NAME;return e.length?`${t} :
${e.join(`
`)}`:`${t} :`}};qb=st;Q.Constructed=qb;st.NAME="CONSTRUCTED";var bf=class extends ht{fromBER(e,t,n){return t}toBER(e){return Rr}};bf.override="EndOfContentValueBlock";var zb,Sc=class extends Qe{constructor(e={}){super(e,bf),this.idBlock.tagClass=1,this.idBlock.tagNumber=0}};zb=Sc;Q.EndOfContent=zb;Sc.NAME=vc;var Xb,Nr=class extends Qe{constructor(e={}){super(e,ht),this.idBlock.tagClass=1,this.idBlock.tagNumber=5}fromBER(e,t,n){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=n,t+n>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+n}toBER(e,t){let n=new ArrayBuffer(2);if(!e){let o=new Uint8Array(n);o[0]=5,o[1]=0}return t&&t.write(n),n}onAsciiEncoding(){return`${this.constructor.NAME}`}};Xb=Nr;Q.Null=Xb;Nr.NAME="NULL";var xf=class extends Qr(ht){get value(){for(let e of this.valueHexView)if(e>0)return!0;return!1}set value(e){this.valueHexView[0]=e?255:0}constructor({value:e,...t}={}){super(t),t.valueHex?this.valueHexView=ye.BufferSourceConverter.toUint8Array(t.valueHex):this.valueHexView=new Uint8Array(1),e&&(this.value=e)}fromBER(e,t,n){let o=ye.BufferSourceConverter.toUint8Array(e);return Cn(this,o,t,n)?(this.valueHexView=o.subarray(t,t+n),n>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,ty.call(this),this.blockLength=n,t+n):-1}toBER(){return this.valueHexView.slice()}toJSON(){return{...super.toJSON(),value:this.value}}};xf.NAME="BooleanValueBlock";var Zb,ri=class extends Qe{getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}constructor(e={}){super(e,xf),this.idBlock.tagClass=1,this.idBlock.tagNumber=1}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.getValue}`}};Zb=ri;Q.Boolean=Zb;ri.NAME="BOOLEAN";var vf=class extends Qr(Yr){constructor({isConstructed:e=!1,...t}={}){super(t),this.isConstructed=e}fromBER(e,t,n){let o=0;if(this.isConstructed){if(this.isHexOnly=!1,o=Yr.prototype.fromBER.call(this,e,t,n),o===-1)return o;for(let i=0;i<this.value.length;i++){let s=this.value[i].constructor.NAME;if(s===vc){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(s!==$b)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,o=super.fromBER(e,t,n),this.blockLength=n;return o}toBER(e,t){return this.isConstructed?Yr.prototype.toBER.call(this,e,t):e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),isConstructed:this.isConstructed}}};vf.NAME="OctetStringValueBlock";var iy,Dr=class extends Qe{constructor({idBlock:e={},lenBlock:t={},...n}={}){var o,i;(o=n.isConstructed)!==null&&o!==void 0||(n.isConstructed=!!(!((i=n.value)===null||i===void 0)&&i.length)),super({idBlock:{isConstructed:n.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!n.isIndefiniteForm},...n},vf),this.idBlock.tagClass=1,this.idBlock.tagNumber=4}fromBER(e,t,n){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,n===0)return this.idBlock.error.length===0&&(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length===0&&(this.blockLength+=this.lenBlock.blockLength),t;if(!this.valueBlock.isConstructed){let i=(e instanceof ArrayBuffer?new Uint8Array(e):e).subarray(t,t+n);try{if(i.byteLength){let s=Ds(i,0,i.byteLength);s.offset!==-1&&s.offset===n&&(this.valueBlock.value=[s.result])}}catch{}}return super.fromBER(e,t,n)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return st.prototype.onAsciiEncoding.call(this);let e=this.constructor.NAME,t=ye.Convert.ToHex(this.valueBlock.valueHexView);return`${e} : ${t}`}getValue(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;let e=[];for(let t of this.valueBlock.value)t instanceof iy&&e.push(t.valueBlock.valueHexView);return ye.BufferSourceConverter.concat(e)}};iy=Dr;Q.OctetString=iy;Dr.NAME=$b;var _f=class extends Qr(Yr){constructor({unusedBits:e=0,isConstructed:t=!1,...n}={}){super(n),this.unusedBits=e,this.isConstructed=t,this.blockLength=this.valueHexView.byteLength}fromBER(e,t,n){if(!n)return t;let o=-1;if(this.isConstructed){if(o=Yr.prototype.fromBER.call(this,e,t,n),o===-1)return o;for(let a of this.value){let c=a.constructor.NAME;if(c===vc){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(c!==Fb)return this.error="BIT STRING may consists of BIT STRINGs only",-1;let l=a.valueBlock;if(this.unusedBits>0&&l.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=l.unusedBits}return o}let i=ye.BufferSourceConverter.toUint8Array(e);if(!Cn(this,i,t,n))return-1;let s=i.subarray(t,t+n);if(this.unusedBits=s[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){let a=s.subarray(1);try{if(a.byteLength){let c=Ds(a,0,a.byteLength);c.offset!==-1&&c.offset===n-1&&(this.value=[c.result])}}catch{}}return this.valueHexView=s.subarray(1),this.blockLength=s.length,t+n}toBER(e,t){if(this.isConstructed)return Yr.prototype.toBER.call(this,e,t);if(e)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength)return Rr;let n=new Uint8Array(this.valueHexView.length+1);return n[0]=this.unusedBits,n.set(this.valueHexView,1),n.buffer}toJSON(){return{...super.toJSON(),unusedBits:this.unusedBits,isConstructed:this.isConstructed}}};_f.NAME="BitStringValueBlock";var Yb,jr=class extends Qe{constructor({idBlock:e={},lenBlock:t={},...n}={}){var o,i;(o=n.isConstructed)!==null&&o!==void 0||(n.isConstructed=!!(!((i=n.value)===null||i===void 0)&&i.length)),super({idBlock:{isConstructed:n.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!n.isIndefiniteForm},...n},_f),this.idBlock.tagClass=1,this.idBlock.tagNumber=3}fromBER(e,t,n){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,super.fromBER(e,t,n)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return st.prototype.onAsciiEncoding.call(this);{let e=[],t=this.valueBlock.valueHexView;for(let s of t)e.push(s.toString(2).padStart(8,"0"));let n=e.join(""),o=this.constructor.NAME,i=n.substring(0,n.length-this.valueBlock.unusedBits);return`${o} : ${i}`}}};Yb=jr;Q.BitString=Yb;jr.NAME=Fb;var Jb;function lC(r,e){let t=new Uint8Array([0]),n=new Uint8Array(r),o=new Uint8Array(e),i=n.slice(0),s=i.length-1,a=o.slice(0),c=a.length-1,l=0,f=c<s?s:c,p=0;for(let y=f;y>=0;y--,p++){switch(!0){case p<a.length:l=i[s-p]+a[c-p]+t[0];break;default:l=i[s-p]+t[0]}switch(t[0]=l/10,!0){case p>=i.length:i=df(new Uint8Array([l%10]),i);break;default:i[s-p]=l%10}}return t[0]>0&&(i=df(t,i)),i}function Vb(r){if(r>=bc.length)for(let e=bc.length;e<=r;e++){let t=new Uint8Array([0]),n=bc[e-1].slice(0);for(let o=n.length-1;o>=0;o--){let i=new Uint8Array([(n[o]<<1)+t[0]]);t[0]=i[0]/10,n[o]=i[0]%10}t[0]>0&&(n=df(t,n)),bc.push(n)}return bc[r]}function fC(r,e){let t=0,n=new Uint8Array(r),o=new Uint8Array(e),i=n.slice(0),s=i.length-1,a=o.slice(0),c=a.length-1,l,f=0;for(let p=c;p>=0;p--,f++)switch(l=i[s-f]-a[c-f]-t,!0){case l<0:t=1,i[s-f]=l+10;break;default:t=0,i[s-f]=l}if(t>0)for(let p=s-c+1;p>=0;p--,f++)if(l=i[s-f]-t,l<0)t=1,i[s-f]=l+10;else{t=0,i[s-f]=l;break}return i.slice()}var Ac=class extends Qr(ht){setValueHex(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=ty.call(this)))}constructor({value:e,...t}={}){super(t),this._valueDec=0,t.valueHex&&this.setValueHex(),e!==void 0&&(this.valueDec=e)}set valueDec(e){this._valueDec=e,this.isHexOnly=!1,this.valueHexView=new Uint8Array(Ub(e))}get valueDec(){return this._valueDec}fromDER(e,t,n,o=0){let i=this.fromBER(e,t,n);if(i===-1)return i;let s=this.valueHexView;return s[0]===0&&(s[1]&128)!==0?this.valueHexView=s.subarray(1):o!==0&&s.length<o&&(o-s.length>1&&(o=s.length+1),this.valueHexView=s.subarray(o-s.length)),i}toDER(e=!1){let t=this.valueHexView;switch(!0){case(t[0]&128)!==0:{let n=new Uint8Array(this.valueHexView.length+1);n[0]=0,n.set(t,1),this.valueHexView=n}break;case(t[0]===0&&(t[1]&128)===0):this.valueHexView=this.valueHexView.subarray(1);break}return this.toBER(e)}fromBER(e,t,n){let o=super.fromBER(e,t,n);return o===-1||this.setValueHex(),o}toBER(e){return e?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}toString(){let e=this.valueHexView.length*8-1,t=new Uint8Array(this.valueHexView.length*8/3),n=0,o,i=this.valueHexView,s="",a=!1;for(let c=i.byteLength-1;c>=0;c--){o=i[c];for(let l=0;l<8;l++){if((o&1)===1)switch(n){case e:t=fC(Vb(n),t),s="-";break;default:t=lC(t,Vb(n))}n++,o>>=1}}for(let c=0;c<t.length;c++)t[c]&&(a=!0),a&&(s+=Kb.charAt(t[c]));return a===!1&&(s+=Kb.charAt(0)),s}};Jb=Ac;Ac.NAME="IntegerValueBlock";Object.defineProperty(Jb.prototype,"valueHex",{set:function(r){this.valueHexView=new Uint8Array(r),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});var xc,En=class extends Qe{constructor(e={}){super(e,Ac),this.idBlock.tagClass=1,this.idBlock.tagNumber=2}toBigInt(){return yf(),BigInt(this.valueBlock.toString())}static fromBigInt(e){yf();let t=BigInt(e),n=new ks,o=t.toString(16).replace(/^-/,""),i=new Uint8Array(ye.Convert.FromHex(o));if(t<0){let a=new Uint8Array(i.length+(i[0]&128?1:0));a[0]|=128;let l=BigInt(`0x${ye.Convert.ToHex(a)}`)+t,f=ye.BufferSourceConverter.toUint8Array(ye.Convert.FromHex(l.toString(16)));f[0]|=128,n.write(f)}else i[0]&128&&n.write(new Uint8Array([0])),n.write(i);return new xc({valueHex:n.final()})}convertToDER(){let e=new xc({valueHex:this.valueBlock.valueHexView});return e.valueBlock.toDER(),e}convertFromDER(){return new xc({valueHex:this.valueBlock.valueHexView[0]===0?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()}`}};xc=En;Q.Integer=xc;En.NAME="INTEGER";var Qb,ni=class extends En{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=10}};Qb=ni;Q.Enumerated=Qb;ni.NAME="ENUMERATED";var Ec=class extends Qr(ht){constructor({valueDec:e=-1,isFirstSid:t=!1,...n}={}){super(n),this.valueDec=e,this.isFirstSid=t}fromBER(e,t,n){if(!n)return t;let o=ye.BufferSourceConverter.toUint8Array(e);if(!Cn(this,o,t,n))return-1;let i=o.subarray(t,t+n);this.valueHexView=new Uint8Array(n);for(let a=0;a<n&&(this.valueHexView[a]=i[a]&127,this.blockLength++,(i[a]&128)!==0);a++);let s=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength;a++)s[a]=this.valueHexView[a];return this.valueHexView=s,(i[this.blockLength-1]&128)!==0?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=ti(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}set valueBigInt(e){yf();let t=BigInt(e).toString(2);for(;t.length%7;)t="0"+t;let n=new Uint8Array(t.length/7);for(let o=0;o<n.length;o++)n[o]=parseInt(t.slice(o*7,o*7+7),2)+(o+1<n.length?128:0);this.fromBER(n.buffer,0,n.length)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);let o=this.valueHexView,i=new Uint8Array(this.blockLength);for(let s=0;s<this.blockLength-1;s++)i[s]=o[s]|128;return i[this.blockLength-1]=o[this.blockLength-1],i.buffer}let t=oo(this.valueDec,7);if(t.byteLength===0)return this.error="Error during encoding SID value",Rr;let n=new Uint8Array(t.byteLength);if(!e){let o=new Uint8Array(t),i=t.byteLength-1;for(let s=0;s<i;s++)n[s]=o[s]|128;n[i]=o[i]}return n}toString(){let e="";if(this.isHexOnly)e=ye.Convert.ToHex(this.valueHexView);else if(this.isFirstSid){let t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec,isFirstSid:this.isFirstSid}}};Ec.NAME="sidBlock";var Sf=class extends ht{constructor({value:e=Ht,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,n){let o=t;for(;n>0;){let i=new Ec;if(o=i.fromBER(e,o,n),o===-1)return this.blockLength=0,this.error=i.error,o;this.value.length===0&&(i.isFirstSid=!0),this.blockLength+=i.blockLength,n-=i.blockLength,this.value.push(i)}return o}toBER(e){let t=[];for(let n=0;n<this.value.length;n++){let o=this.value[n].toBER(e);if(o.byteLength===0)return this.error=this.value[n].error,Rr;t.push(o)}return oy(t)}fromString(e){this.value=[];let t=0,n=0,o="",i=!1;do if(n=e.indexOf(".",t),n===-1?o=e.substring(t):o=e.substring(t,n),t=n+1,i){let s=this.value[0],a=0;switch(s.valueDec){case 0:break;case 1:a=40;break;case 2:a=80;break;default:this.value=[];return}let c=parseInt(o,10);if(isNaN(c))return;s.valueDec=c+a,i=!1}else{let s=new Ec;if(o>Number.MAX_SAFE_INTEGER){yf();let a=BigInt(o);s.valueBigInt=a}else if(s.valueDec=parseInt(o,10),isNaN(s.valueDec))return;this.value.length||(s.isFirstSid=!0,i=!0),this.value.push(s)}while(n!==-1)}toString(){let e="",t=!1;for(let n=0;n<this.value.length;n++){t=this.value[n].isHexOnly;let o=this.value[n].toString();n!==0&&(e=`${e}.`),t?(o=`{${o}}`,this.value[n].isFirstSid?e=`2.{${o} - 80}`:e+=o):e+=o}return e}toJSON(){let e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}};Sf.NAME="ObjectIdentifierValueBlock";var ex,oi=class extends Qe{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,Sf),this.idBlock.tagClass=1,this.idBlock.tagNumber=6}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}};ex=oi;Q.ObjectIdentifier=ex;oi.NAME="OBJECT IDENTIFIER";var Cc=class extends Qr(Sn){constructor({valueDec:e=0,...t}={}){super(t),this.valueDec=e}fromBER(e,t,n){if(n===0)return t;let o=ye.BufferSourceConverter.toUint8Array(e);if(!Cn(this,o,t,n))return-1;let i=o.subarray(t,t+n);this.valueHexView=new Uint8Array(n);for(let a=0;a<n&&(this.valueHexView[a]=i[a]&127,this.blockLength++,(i[a]&128)!==0);a++);let s=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength;a++)s[a]=this.valueHexView[a];return this.valueHexView=s,(i[this.blockLength-1]&128)!==0?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=ti(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);let o=this.valueHexView,i=new Uint8Array(this.blockLength);for(let s=0;s<this.blockLength-1;s++)i[s]=o[s]|128;return i[this.blockLength-1]=o[this.blockLength-1],i.buffer}let t=oo(this.valueDec,7);if(t.byteLength===0)return this.error="Error during encoding SID value",Rr;let n=new Uint8Array(t.byteLength);if(!e){let o=new Uint8Array(t),i=t.byteLength-1;for(let s=0;s<i;s++)n[s]=o[s]|128;n[i]=o[i]}return n.buffer}toString(){let e="";return this.isHexOnly?e=ye.Convert.ToHex(this.valueHexView):e=this.valueDec.toString(),e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}};Cc.NAME="relativeSidBlock";var Af=class extends ht{constructor({value:e=Ht,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,n){let o=t;for(;n>0;){let i=new Cc;if(o=i.fromBER(e,o,n),o===-1)return this.blockLength=0,this.error=i.error,o;this.blockLength+=i.blockLength,n-=i.blockLength,this.value.push(i)}return o}toBER(e,t){let n=[];for(let o=0;o<this.value.length;o++){let i=this.value[o].toBER(e);if(i.byteLength===0)return this.error=this.value[o].error,Rr;n.push(i)}return oy(n)}fromString(e){this.value=[];let t=0,n=0,o="";do{n=e.indexOf(".",t),n===-1?o=e.substring(t):o=e.substring(t,n),t=n+1;let i=new Cc;if(i.valueDec=parseInt(o,10),isNaN(i.valueDec))return!0;this.value.push(i)}while(n!==-1);return!0}toString(){let e="",t=!1;for(let n=0;n<this.value.length;n++){t=this.value[n].isHexOnly;let o=this.value[n].toString();n!==0&&(e=`${e}.`),t&&(o=`{${o}}`),e+=o}return e}toJSON(){let e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}};Af.NAME="RelativeObjectIdentifierValueBlock";var tx,Tc=class extends Qe{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,Af),this.idBlock.tagClass=1,this.idBlock.tagNumber=13}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}};tx=Tc;Q.RelativeObjectIdentifier=tx;Tc.NAME="RelativeObjectIdentifier";var rx,Vt=class extends st{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=16}};rx=Vt;Q.Sequence=rx;Vt.NAME="SEQUENCE";var nx,$t=class extends st{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=17}};nx=$t;Q.Set=nx;$t.NAME="SET";var Ef=class extends Qr(ht){constructor({...e}={}){super(e),this.isHexOnly=!0,this.value=Ht}toJSON(){return{...super.toJSON(),value:this.value}}};Ef.NAME="StringValueBlock";var Cf=class extends Ef{};Cf.NAME="SimpleStringValueBlock";var jt=class extends _c{constructor({...e}={}){super(e,Cf)}fromBuffer(e){this.valueBlock.value=String.fromCharCode.apply(null,ye.BufferSourceConverter.toUint8Array(e))}fromString(e){let t=e.length,n=this.valueBlock.valueHexView=new Uint8Array(t);for(let o=0;o<t;o++)n[o]=e.charCodeAt(o);this.valueBlock.value=e}};jt.NAME="SIMPLE STRING";var Tf=class extends jt{fromBuffer(e){this.valueBlock.valueHexView=ye.BufferSourceConverter.toUint8Array(e);try{this.valueBlock.value=ye.Convert.ToUtf8String(e)}catch(t){this.warnings.push(`Error during "decodeURIComponent": ${t}, using raw string`),this.valueBlock.value=ye.Convert.ToBinary(e)}}fromString(e){this.valueBlock.valueHexView=new Uint8Array(ye.Convert.FromUtf8String(e)),this.valueBlock.value=e}};Tf.NAME="Utf8StringValueBlock";var ox,lr=class extends Tf{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=12}};ox=lr;Q.Utf8String=ox;lr.NAME="UTF8String";var If=class extends jt{fromBuffer(e){this.valueBlock.value=ye.Convert.ToUtf16String(e),this.valueBlock.valueHexView=ye.BufferSourceConverter.toUint8Array(e)}fromString(e){this.valueBlock.value=e,this.valueBlock.valueHexView=new Uint8Array(ye.Convert.FromUtf16String(e))}};If.NAME="BmpStringValueBlock";var ix,ii=class extends If{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=30}};ix=ii;Q.BmpString=ix;ii.NAME="BMPString";var Of=class extends jt{fromBuffer(e){let t=ArrayBuffer.isView(e)?e.slice().buffer:e.slice(0),n=new Uint8Array(t);for(let o=0;o<n.length;o+=4)n[o]=n[o+3],n[o+1]=n[o+2],n[o+2]=0,n[o+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}fromString(e){let t=e.length,n=this.valueBlock.valueHexView=new Uint8Array(t*4);for(let o=0;o<t;o++){let i=oo(e.charCodeAt(o),8),s=new Uint8Array(i);if(s.length>4)continue;let a=4-s.length;for(let c=s.length-1;c>=0;c--)n[o*4+c+a]=s[c]}this.valueBlock.value=e}};Of.NAME="UniversalStringValueBlock";var sx,si=class extends Of{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=28}};sx=si;Q.UniversalString=sx;si.NAME="UniversalString";var ax,ai=class extends jt{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=18}};ax=ai;Q.NumericString=ax;ai.NAME="NumericString";var cx,ci=class extends jt{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=19}};cx=ci;Q.PrintableString=cx;ci.NAME="PrintableString";var ux,ui=class extends jt{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=20}};ux=ui;Q.TeletexString=ux;ui.NAME="TeletexString";var lx,li=class extends jt{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=21}};lx=li;Q.VideotexString=lx;li.NAME="VideotexString";var fx,fi=class extends jt{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=22}};fx=fi;Q.IA5String=fx;fi.NAME="IA5String";var px,pi=class extends jt{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=25}};px=pi;Q.GraphicString=px;pi.NAME="GraphicString";var hx,so=class extends jt{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=26}};hx=so;Q.VisibleString=hx;so.NAME="VisibleString";var dx,hi=class extends jt{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=27}};dx=hi;Q.GeneralString=dx;hi.NAME="GeneralString";var yx,di=class extends jt{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=29}};yx=di;Q.CharacterString=yx;di.NAME="CharacterString";var mx,ao=class extends so{constructor({value:e,valueDate:t,...n}={}){if(super(n),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,e){this.fromString(e),this.valueBlock.valueHexView=new Uint8Array(e.length);for(let o=0;o<e.length;o++)this.valueBlock.valueHexView[o]=e.charCodeAt(o)}t&&(this.fromDate(t),this.valueBlock.valueHexView=new Uint8Array(this.toBuffer())),this.idBlock.tagClass=1,this.idBlock.tagNumber=23}fromBuffer(e){this.fromString(String.fromCharCode.apply(null,ye.BufferSourceConverter.toUint8Array(e)))}toBuffer(){let e=this.toString(),t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let o=0;o<e.length;o++)n[o]=e.charCodeAt(o);return t}fromDate(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}fromString(e){let n=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/ig.exec(e);if(n===null){this.error="Wrong input string for conversion";return}let o=parseInt(n[1],10);o>=50?this.year=1900+o:this.year=2e3+o,this.month=parseInt(n[2],10),this.day=parseInt(n[3],10),this.hour=parseInt(n[4],10),this.minute=parseInt(n[5],10),this.second=parseInt(n[6],10)}toString(e="iso"){if(e==="iso"){let t=new Array(7);return t[0]=Kt(this.year<2e3?this.year-1900:this.year-2e3,2),t[1]=Kt(this.month,2),t[2]=Kt(this.day,2),t[3]=Kt(this.hour,2),t[4]=Kt(this.minute,2),t[5]=Kt(this.second,2),t[6]="Z",t.join("")}return super.toString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.toDate().toISOString()}`}toJSON(){return{...super.toJSON(),year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second}}};mx=ao;Q.UTCTime=mx;ao.NAME="UTCTime";var gx,yi=class extends ao{constructor(e={}){var t;super(e),(t=this.millisecond)!==null&&t!==void 0||(this.millisecond=0),this.idBlock.tagClass=1,this.idBlock.tagNumber=24}fromDate(e){super.fromDate(e),this.millisecond=e.getUTCMilliseconds()}toDate(){let e=Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond);return new Date(e)}fromString(e){let t=!1,n="",o="",i=0,s,a=0,c=0;if(e[e.length-1]==="Z")n=e.substring(0,e.length-1),t=!0;else{let p=new Number(e[e.length-1]);if(isNaN(p.valueOf()))throw new Error("Wrong input string for conversion");n=e}if(t){if(n.indexOf("+")!==-1)throw new Error("Wrong input string for conversion");if(n.indexOf("-")!==-1)throw new Error("Wrong input string for conversion")}else{let p=1,y=n.indexOf("+"),m="";if(y===-1&&(y=n.indexOf("-"),p=-1),y!==-1){if(m=n.substring(y+1),n=n.substring(0,y),m.length!==2&&m.length!==4)throw new Error("Wrong input string for conversion");let x=parseInt(m.substring(0,2),10);if(isNaN(x.valueOf()))throw new Error("Wrong input string for conversion");if(a=p*x,m.length===4){if(x=parseInt(m.substring(2,4),10),isNaN(x.valueOf()))throw new Error("Wrong input string for conversion");c=p*x}}}let l=n.indexOf(".");if(l===-1&&(l=n.indexOf(",")),l!==-1){let p=new Number(`0${n.substring(l)}`);if(isNaN(p.valueOf()))throw new Error("Wrong input string for conversion");i=p.valueOf(),o=n.substring(0,l)}else o=n;switch(!0){case o.length===8:if(s=/(\d{4})(\d{2})(\d{2})/ig,l!==-1)throw new Error("Wrong input string for conversion");break;case o.length===10:if(s=/(\d{4})(\d{2})(\d{2})(\d{2})/ig,l!==-1){let p=60*i;this.minute=Math.floor(p),p=60*(p-this.minute),this.second=Math.floor(p),p=1e3*(p-this.second),this.millisecond=Math.floor(p)}break;case o.length===12:if(s=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/ig,l!==-1){let p=60*i;this.second=Math.floor(p),p=1e3*(p-this.second),this.millisecond=Math.floor(p)}break;case o.length===14:if(s=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/ig,l!==-1){let p=1e3*i;this.millisecond=Math.floor(p)}break;default:throw new Error("Wrong input string for conversion")}let f=s.exec(o);if(f===null)throw new Error("Wrong input string for conversion");for(let p=1;p<f.length;p++)switch(p){case 1:this.year=parseInt(f[p],10);break;case 2:this.month=parseInt(f[p],10);break;case 3:this.day=parseInt(f[p],10);break;case 4:this.hour=parseInt(f[p],10)+a;break;case 5:this.minute=parseInt(f[p],10)+c;break;case 6:this.second=parseInt(f[p],10);break;default:throw new Error("Wrong input string for conversion")}if(t===!1){let p=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=p.getUTCFullYear(),this.month=p.getUTCMonth(),this.day=p.getUTCDay(),this.hour=p.getUTCHours(),this.minute=p.getUTCMinutes(),this.second=p.getUTCSeconds(),this.millisecond=p.getUTCMilliseconds()}}toString(e="iso"){if(e==="iso"){let t=[];return t.push(Kt(this.year,4)),t.push(Kt(this.month,2)),t.push(Kt(this.day,2)),t.push(Kt(this.hour,2)),t.push(Kt(this.minute,2)),t.push(Kt(this.second,2)),this.millisecond!==0&&(t.push("."),t.push(Kt(this.millisecond,3))),t.push("Z"),t.join("")}return super.toString(e)}toJSON(){return{...super.toJSON(),millisecond:this.millisecond}}};gx=yi;Q.GeneralizedTime=gx;yi.NAME="GeneralizedTime";var wx,Ic=class extends lr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=31}};wx=Ic;Q.DATE=wx;Ic.NAME="DATE";var bx,Oc=class extends lr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=32}};bx=Oc;Q.TimeOfDay=bx;Oc.NAME="TimeOfDay";var xx,Pc=class extends lr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=33}};xx=Pc;Q.DateTime=xx;Pc.NAME="DateTime";var vx,Bc=class extends lr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=34}};vx=Bc;Q.Duration=vx;Bc.NAME="Duration";var _x,kc=class extends lr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=14}};_x=kc;Q.TIME=_x;kc.NAME="TIME";var Jr=class{constructor({name:e=Ht,optional:t=!1}={}){this.name=e,this.optional=t}},Ns=class extends Jr{constructor({value:e=[],...t}={}){super(t),this.value=e}},mi=class extends Jr{constructor({value:e=new Jr,local:t=!1,...n}={}){super(n),this.value=e,this.local=t}},ny=class{get data(){return this.dataView.slice().buffer}set data(e){this.dataView=ye.BufferSourceConverter.toUint8Array(e)}constructor({data:e=Pf}={}){this.dataView=ye.BufferSourceConverter.toUint8Array(e)}fromBER(e,t,n){let o=t+n;return this.dataView=ye.BufferSourceConverter.toUint8Array(e).subarray(t,o),o}toBER(e){return this.dataView.slice().buffer}};function io(r,e,t){if(t instanceof Ns){for(let i of t.value)if(io(r,e,i).verified)return{verified:!0,result:r};{let i={verified:!1,result:{error:"Wrong values for Choice type"}};return t.hasOwnProperty(ry)&&(i.name=t.name),i}}if(t instanceof Jr)return t.hasOwnProperty(ry)&&(r[t.name]=e),{verified:!0,result:r};if(!(r instanceof Object))return{verified:!1,result:{error:"Wrong root object"}};if(!(e instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 data"}};if(!(t instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(tC in t))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(iC in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(sC in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};let n=t.idBlock.toBER(!1);if(n.byteLength===0)return{verified:!1,result:{error:"Error encoding idBlock for ASN.1 schema"}};if(t.idBlock.fromBER(n,0,n.byteLength)===-1)return{verified:!1,result:{error:"Error decoding idBlock for ASN.1 schema"}};if(t.idBlock.hasOwnProperty(rC)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.tagClass!==e.idBlock.tagClass)return{verified:!1,result:r};if(t.idBlock.hasOwnProperty(nC)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.tagNumber!==e.idBlock.tagNumber)return{verified:!1,result:r};if(t.idBlock.hasOwnProperty(oC)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.isConstructed!==e.idBlock.isConstructed)return{verified:!1,result:r};if(!(eC in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.isHexOnly!==e.idBlock.isHexOnly)return{verified:!1,result:r};if(t.idBlock.isHexOnly){if(!(Hb in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};let i=t.idBlock.valueHexView,s=e.idBlock.valueHexView;if(i.length!==s.length)return{verified:!1,result:r};for(let a=0;a<i.length;a++)if(i[a]!==s[1])return{verified:!1,result:r}}if(t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Ht),t.name&&(r[t.name]=e)),t instanceof Q.Constructed){let i=0,s={verified:!1,result:{error:"Unknown error"}},a=t.valueBlock.value.length;if(a>0&&t.valueBlock.value[0]instanceof mi&&(a=e.valueBlock.value.length),a===0)return{verified:!0,result:r};if(e.valueBlock.value.length===0&&t.valueBlock.value.length!==0){let c=!0;for(let l=0;l<t.valueBlock.value.length;l++)c=c&&(t.valueBlock.value[l].optional||!1);return c?{verified:!0,result:r}:(t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Ht),t.name&&delete r[t.name]),r.error="Inconsistent object length",{verified:!1,result:r})}for(let c=0;c<a;c++)if(c-i>=e.valueBlock.value.length){if(t.valueBlock.value[c].optional===!1){let l={verified:!1,result:r};return r.error="Inconsistent length between ASN.1 data and schema",t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Ht),t.name&&(delete r[t.name],l.name=t.name)),l}}else if(t.valueBlock.value[0]instanceof mi){if(s=io(r,e.valueBlock.value[c],t.valueBlock.value[0].value),s.verified===!1)if(t.valueBlock.value[0].optional)i++;else return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Ht),t.name&&delete r[t.name]),s;if(ry in t.valueBlock.value[0]&&t.valueBlock.value[0].name.length>0){let l={};aC in t.valueBlock.value[0]&&t.valueBlock.value[0].local?l=e:l=r,typeof l[t.valueBlock.value[0].name]>"u"&&(l[t.valueBlock.value[0].name]=[]),l[t.valueBlock.value[0].name].push(e.valueBlock.value[c])}}else if(s=io(r,e.valueBlock.value[c-i],t.valueBlock.value[c]),s.verified===!1)if(t.valueBlock.value[c].optional)i++;else return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Ht),t.name&&delete r[t.name]),s;if(s.verified===!1){let c={verified:!1,result:r};return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Ht),t.name&&(delete r[t.name],c.name=t.name)),c}return{verified:!0,result:r}}if(t.primitiveSchema&&Hb in e.valueBlock){let i=Ds(e.valueBlock.valueHexView);if(i.offset===-1){let s={verified:!1,result:i.result};return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Ht),t.name&&(delete r[t.name],s.name=t.name)),s}return io(r,i.result,t.primitiveSchema)}return{verified:!0,result:r}}function pC(r,e){if(!(e instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 schema type"}};let t=Ds(ye.BufferSourceConverter.toUint8Array(r));return t.offset===-1?{verified:!1,result:t.result}:io(t.result,t.result,e)}var _;(function(r){r[r.Sequence=0]="Sequence",r[r.Set=1]="Set",r[r.Choice=2]="Choice"})(_||(_={}));var h;(function(r){r[r.Any=1]="Any",r[r.Boolean=2]="Boolean",r[r.OctetString=3]="OctetString",r[r.BitString=4]="BitString",r[r.Integer=5]="Integer",r[r.Enumerated=6]="Enumerated",r[r.ObjectIdentifier=7]="ObjectIdentifier",r[r.Utf8String=8]="Utf8String",r[r.BmpString=9]="BmpString",r[r.UniversalString=10]="UniversalString",r[r.NumericString=11]="NumericString",r[r.PrintableString=12]="PrintableString",r[r.TeletexString=13]="TeletexString",r[r.VideotexString=14]="VideotexString",r[r.IA5String=15]="IA5String",r[r.GraphicString=16]="GraphicString",r[r.VisibleString=17]="VisibleString",r[r.GeneralString=18]="GeneralString",r[r.CharacterString=19]="CharacterString",r[r.UTCTime=20]="UTCTime",r[r.GeneralizedTime=21]="GeneralizedTime",r[r.DATE=22]="DATE",r[r.TimeOfDay=23]="TimeOfDay",r[r.DateTime=24]="DateTime",r[r.Duration=25]="Duration",r[r.TIME=26]="TIME",r[r.Null=27]="Null"})(h||(h={}));var sy=$r(_n()),tn=class{constructor(e,t=0){if(this.unusedBits=0,this.value=new ArrayBuffer(0),e)if(typeof e=="number")this.fromNumber(e);else if(sy.BufferSourceConverter.isBufferSource(e))this.unusedBits=t,this.value=sy.BufferSourceConverter.toArrayBuffer(e);else throw TypeError("Unsupported type of 'params' argument for BitString")}fromASN(e){if(!(e instanceof jr))throw new TypeError("Argument 'asn' is not instance of ASN.1 BitString");return this.unusedBits=e.valueBlock.unusedBits,this.value=e.valueBlock.valueHex,this}toASN(){return new jr({unusedBits:this.unusedBits,valueHex:this.value})}toSchema(e){return new jr({name:e})}toNumber(){let e="",t=new Uint8Array(this.value);for(let n of t)e+=n.toString(2).padStart(8,"0");return e=e.split("").reverse().join(""),this.unusedBits&&(e=e.slice(this.unusedBits).padStart(this.unusedBits,"0")),parseInt(e,2)}fromNumber(e){let t=e.toString(2),n=t.length+7>>3;this.unusedBits=(n<<3)-t.length;let o=new Uint8Array(n);t=t.padStart(n<<3,"0").split("").reverse().join("");let i=0;for(;i<n;)o[i]=parseInt(t.slice(i<<3,(i<<3)+8),2),i++;this.value=o.buffer}};var ay=$r(_n()),ae=class{get byteLength(){return this.buffer.byteLength}get byteOffset(){return 0}constructor(e){typeof e=="number"?this.buffer=new ArrayBuffer(e):ay.BufferSourceConverter.isBufferSource(e)?this.buffer=ay.BufferSourceConverter.toArrayBuffer(e):Array.isArray(e)?this.buffer=new Uint8Array(e):this.buffer=new ArrayBuffer(0)}fromASN(e){if(!(e instanceof Dr))throw new TypeError("Argument 'asn' is not instance of ASN.1 OctetString");return this.buffer=e.valueBlock.valueHex,this}toASN(){return new Dr({valueHex:this.buffer})}toSchema(e){return new Dr({name:e})}};var hC={fromASN:r=>r instanceof Nr?null:r.valueBeforeDecodeView,toASN:r=>{if(r===null)return new Nr;let e=Tn(r);if(e.result.error)throw new Error(e.result.error);return e.result}},dC={fromASN:r=>r.valueBlock.valueHexView.byteLength>=4?r.valueBlock.toString():r.valueBlock.valueDec,toASN:r=>new En({value:+r})},yC={fromASN:r=>r.valueBlock.valueDec,toASN:r=>new ni({value:r})},me={fromASN:r=>r.valueBlock.valueHexView,toASN:r=>new En({valueHex:r})};var mC={fromASN:r=>r.valueBlock.valueHexView,toASN:r=>new jr({valueHex:r})},gC={fromASN:r=>r.valueBlock.toString(),toASN:r=>new oi({value:r})},wC={fromASN:r=>r.valueBlock.value,toASN:r=>new ri({value:r})},js={fromASN:r=>r.valueBlock.valueHexView,toASN:r=>new Dr({valueHex:r})},Sx={fromASN:r=>new ae(r.getValue()),toASN:r=>r.toASN()};function fr(r){return{fromASN:e=>e.valueBlock.value,toASN:e=>new r({value:e})}}var cy=fr(lr),bC=fr(ii),xC=fr(si),vC=fr(ai),_C=fr(ci),SC=fr(ui),AC=fr(li),EC=fr(fi),CC=fr(pi),TC=fr(so),IC=fr(hi),OC=fr(di),PC={fromASN:r=>r.toDate(),toASN:r=>new ao({valueDate:r})},BC={fromASN:r=>r.toDate(),toASN:r=>new yi({valueDate:r})},kC={fromASN:()=>null,toASN:()=>new Nr};function Rs(r){switch(r){case h.Any:return hC;case h.BitString:return mC;case h.BmpString:return bC;case h.Boolean:return wC;case h.CharacterString:return OC;case h.Enumerated:return yC;case h.GeneralString:return IC;case h.GeneralizedTime:return BC;case h.GraphicString:return CC;case h.IA5String:return EC;case h.Integer:return dC;case h.Null:return kC;case h.NumericString:return vC;case h.ObjectIdentifier:return gC;case h.OctetString:return js;case h.PrintableString:return _C;case h.TeletexString:return SC;case h.UTCTime:return PC;case h.UniversalString:return xC;case h.Utf8String:return cy;case h.VideotexString:return AC;case h.VisibleString:return TC;default:return null}}function pr(r){return typeof r=="function"&&r.prototype?r.prototype.toASN&&r.prototype.fromASN?!0:pr(r.prototype):!!(r&&typeof r=="object"&&"toASN"in r&&"fromASN"in r)}function ly(r){var e;if(r){let t=Object.getPrototypeOf(r);return((e=t?.prototype)===null||e===void 0?void 0:e.constructor)===Array?!0:ly(t)}return!1}function Ax(r,e){if(!(r&&e)||r.byteLength!==e.byteLength)return!1;let t=new Uint8Array(r),n=new Uint8Array(e);for(let o=0;o<r.byteLength;o++)if(t[o]!==n[o])return!1;return!0}var Bf=class{constructor(){this.items=new WeakMap}has(e){return this.items.has(e)}get(e,t=!1){let n=this.items.get(e);if(!n)throw new Error(`Cannot get schema for '${e.prototype.constructor.name}' target`);if(t&&!n.schema)throw new Error(`Schema '${e.prototype.constructor.name}' doesn't contain ASN.1 schema. Call 'AsnSchemaStorage.cache'.`);return n}cache(e){let t=this.get(e);t.schema||(t.schema=this.create(e,!0))}createDefault(e){let t={type:_.Sequence,items:{}},n=this.findParentSchema(e);return n&&(Object.assign(t,n),t.items=Object.assign({},t.items,n.items)),t}create(e,t){let n=this.items.get(e)||this.createDefault(e),o=[];for(let i in n.items){let s=n.items[i],a=t?i:"",c;if(typeof s.type=="number"){let f=h[s.type],p=en[f];if(!p)throw new Error(`Cannot get ASN1 class by name '${f}'`);c=new p({name:a})}else pr(s.type)?c=new s.type().toSchema(a):s.optional?this.get(s.type).type===_.Choice?c=new Jr({name:a}):(c=this.create(s.type,!1),c.name=a):c=new Jr({name:a});let l=!!s.optional||s.defaultValue!==void 0;if(s.repeated){c.name="";let f=s.repeated==="set"?$t:Vt;c=new f({name:"",value:[new mi({name:a,value:c})]})}if(s.context!==null&&s.context!==void 0)if(s.implicit)if(typeof s.type=="number"||pr(s.type)){let f=s.repeated?st:An;o.push(new f({name:a,optional:l,idBlock:{tagClass:3,tagNumber:s.context}}))}else{this.cache(s.type);let f=!!s.repeated,p=f?c:this.get(s.type,!0).schema;p="valueBlock"in p?p.valueBlock.value:p.value,o.push(new st({name:f?"":a,optional:l,idBlock:{tagClass:3,tagNumber:s.context},value:p}))}else o.push(new st({optional:l,idBlock:{tagClass:3,tagNumber:s.context},value:[c]}));else c.optional=l,o.push(c)}switch(n.type){case _.Sequence:return new Vt({value:o,name:""});case _.Set:return new $t({value:o,name:""});case _.Choice:return new Ns({value:o,name:""});default:throw new Error("Unsupported ASN1 type in use")}}set(e,t){return this.items.set(e,t),this}findParentSchema(e){let t=Object.getPrototypeOf(e);return t?this.items.get(t)||this.findParentSchema(t):null}};var Rt=new Bf;var A=r=>e=>{let t;Rt.has(e)?t=Rt.get(e):(t=Rt.createDefault(e),Rt.set(e,t)),Object.assign(t,r)};var u=r=>(e,t)=>{let n;Rt.has(e.constructor)?n=Rt.get(e.constructor):(n=Rt.createDefault(e.constructor),Rt.set(e.constructor,n));let o=Object.assign({},r);if(typeof o.type=="number"&&!o.converter){let i=Rs(r.type);if(!i)throw new Error(`Cannot get default converter for property '${t}' of ${e.constructor.name}`);o.converter=i}n.items[t]=o};var Nc=class extends Error{constructor(){super(...arguments),this.schemas=[]}};var Dc=class{static parse(e,t){let n=Tn(e);if(n.result.error)throw new Error(n.result.error);return this.fromASN(n.result,t)}static fromASN(e,t){var n;try{if(pr(t))return new t().fromASN(e);let o=Rt.get(t);Rt.cache(t);let i=o.schema;if(e.constructor===st&&o.type!==_.Choice){i=new st({idBlock:{tagClass:3,tagNumber:e.idBlock.tagNumber},value:o.schema.valueBlock.value});for(let c in o.items)delete e[c]}let s=io({},e,i);if(!s.verified)throw new Nc(`Data does not match to ${t.name} ASN1 schema. ${s.result.error}`);let a=new t;if(ly(t)){if(!("value"in e.valueBlock&&Array.isArray(e.valueBlock.value)))throw new Error("Cannot get items from the ASN.1 parsed value. ASN.1 object is not constructed.");let c=o.itemType;if(typeof c=="number"){let l=Rs(c);if(!l)throw new Error(`Cannot get default converter for array item of ${t.name} ASN1 schema`);return t.from(e.valueBlock.value,f=>l.fromASN(f))}else return t.from(e.valueBlock.value,l=>this.fromASN(l,c))}for(let c in o.items){let l=s.result[c];if(!l)continue;let f=o.items[c],p=f.type;if(typeof p=="number"||pr(p)){let y=(n=f.converter)!==null&&n!==void 0?n:pr(p)?new p:null;if(!y)throw new Error("Converter is empty");if(f.repeated)if(f.implicit){let m=f.repeated==="sequence"?Vt:$t,x=new m;x.valueBlock=l.valueBlock;let v=Tn(x.toBER(!1));if(v.offset===-1)throw new Error(`Cannot parse the child item. ${v.result.error}`);if(!("value"in v.result.valueBlock&&Array.isArray(v.result.valueBlock.value)))throw new Error("Cannot get items from the ASN.1 parsed value. ASN.1 object is not constructed.");let d=v.result.valueBlock.value;a[c]=Array.from(d,I=>y.fromASN(I))}else a[c]=Array.from(l,m=>y.fromASN(m));else{let m=l;if(f.implicit){let x;if(pr(p))x=new p().toSchema("");else{let v=h[p],d=en[v];if(!d)throw new Error(`Cannot get '${v}' class from asn1js module`);x=new d}x.valueBlock=m.valueBlock,m=Tn(x.toBER(!1)).result}a[c]=y.fromASN(m)}}else if(f.repeated){if(!Array.isArray(l))throw new Error("Cannot get list of items from the ASN.1 parsed value. ASN.1 value should be iterable.");a[c]=Array.from(l,y=>this.fromASN(y,p))}else a[c]=this.fromASN(l,p)}return a}catch(o){throw o instanceof Nc&&o.schemas.push(t.name),o}}};var jc=class r{static serialize(e){return e instanceof Qe?e.toBER(!1):this.toASN(e).toBER(!1)}static toASN(e){if(e&&typeof e=="object"&&pr(e))return e.toASN();if(!(e&&typeof e=="object"))throw new TypeError("Parameter 1 should be type of Object.");let t=e.constructor,n=Rt.get(t);Rt.cache(t);let o=[];if(n.itemType){if(!Array.isArray(e))throw new TypeError("Parameter 1 should be type of Array.");if(typeof n.itemType=="number"){let s=Rs(n.itemType);if(!s)throw new Error(`Cannot get default converter for array item of ${t.name} ASN1 schema`);o=e.map(a=>s.toASN(a))}else o=e.map(s=>this.toAsnItem({type:n.itemType},"[]",t,s))}else for(let s in n.items){let a=n.items[s],c=e[s];if(c===void 0||a.defaultValue===c||typeof a.defaultValue=="object"&&typeof c=="object"&&Ax(this.serialize(a.defaultValue),this.serialize(c)))continue;let l=r.toAsnItem(a,s,t,c);if(typeof a.context=="number")if(a.implicit)if(!a.repeated&&(typeof a.type=="number"||pr(a.type))){let f={};f.valueHex=l instanceof Nr?l.valueBeforeDecodeView:l.valueBlock.toBER(),o.push(new An({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context},...f}))}else o.push(new st({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context},value:l.valueBlock.value}));else o.push(new st({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context},value:[l]}));else a.repeated?o=o.concat(l):o.push(l)}let i;switch(n.type){case _.Sequence:i=new Vt({value:o});break;case _.Set:i=new $t({value:o});break;case _.Choice:if(!o[0])throw new Error(`Schema '${t.name}' has wrong data. Choice cannot be empty.`);i=o[0];break}return i}static toAsnItem(e,t,n,o){let i;if(typeof e.type=="number"){let s=e.converter;if(!s)throw new Error(`Property '${t}' doesn't have converter for type ${h[e.type]} in schema '${n.name}'`);if(e.repeated){if(!Array.isArray(o))throw new TypeError("Parameter 'objProp' should be type of Array.");let a=Array.from(o,l=>s.toASN(l)),c=e.repeated==="sequence"?Vt:$t;i=new c({value:a})}else i=s.toASN(o)}else if(e.repeated){if(!Array.isArray(o))throw new TypeError("Parameter 'objProp' should be type of Array.");let s=Array.from(o,c=>this.toASN(c)),a=e.repeated==="sequence"?Vt:$t;i=new a({value:s})}else i=this.toASN(o);return i}};var oe=class extends Array{constructor(e=[]){if(typeof e=="number")super(e);else{super();for(let t of e)this.push(t)}}};var fy=$r(_n());var q=class r{static serialize(e){return jc.serialize(e)}static parse(e,t){return Dc.parse(e,t)}static toString(e){let t=fy.BufferSourceConverter.isBufferSource(e)?fy.BufferSourceConverter.toArrayBuffer(e):r.serialize(e),n=Tn(t);if(n.offset===-1)throw new Error(`Cannot decode ASN.1 data. ${n.result.error}`);return n.result.toString()}};function w(r,e,t,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(i=(o<3?s(i):o>3?s(e,t,i):s(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i}var Ex=$r(_n()),Rc=class{static isIPv4(e){return/^(\d{1,3}\.){3}\d{1,3}$/.test(e)}static parseIPv4(e){let t=e.split(".");if(t.length!==4)throw new Error("Invalid IPv4 address");return t.map(n=>{let o=parseInt(n,10);if(isNaN(o)||o<0||o>255)throw new Error("Invalid IPv4 address part");return o})}static parseIPv6(e){let n=this.expandIPv6(e).split(":");if(n.length!==8)throw new Error("Invalid IPv6 address");return n.reduce((o,i)=>{let s=parseInt(i,16);if(isNaN(s)||s<0||s>65535)throw new Error("Invalid IPv6 address part");return o.push(s>>8&255),o.push(s&255),o},[])}static expandIPv6(e){if(!e.includes("::"))return e;let t=e.split("::");if(t.length>2)throw new Error("Invalid IPv6 address");let n=t[0]?t[0].split(":"):[],o=t[1]?t[1].split(":"):[],i=8-(n.length+o.length);if(i<0)throw new Error("Invalid IPv6 address");return[...n,...Array(i).fill("0"),...o].join(":")}static formatIPv6(e){let t=[];for(let n=0;n<16;n+=2)t.push((e[n]<<8|e[n+1]).toString(16));return this.compressIPv6(t.join(":"))}static compressIPv6(e){let t=e.split(":"),n=-1,o=0,i=-1,s=0;for(let a=0;a<t.length;a++)t[a]==="0"?(i===-1&&(i=a),s++):(s>o&&(n=i,o=s),i=-1,s=0);if(s>o&&(n=i,o=s),o>1){let a=t.slice(0,n).join(":"),c=t.slice(n+o).join(":");return`${a}::${c}`}return e}static parseCIDR(e){let[t,n]=e.split("/"),o=parseInt(n,10);if(this.isIPv4(t)){if(o<0||o>32)throw new Error("Invalid IPv4 prefix length");return[this.parseIPv4(t),o]}else{if(o<0||o>128)throw new Error("Invalid IPv6 prefix length");return[this.parseIPv6(t),o]}}static decodeIP(e){if(e.length===64&&parseInt(e,16)===0)return"::/0";if(e.length!==16)return e;let t=parseInt(e.slice(8),16).toString(2).split("").reduce((o,i)=>o+ +i,0),n=e.slice(0,8).replace(/(.{2})/g,o=>`${parseInt(o,16)}.`);return n=n.slice(0,-1),`${n}/${t}`}static toString(e){let t=new Uint8Array(e);if(t.length===4)return Array.from(t).join(".");if(t.length===16)return this.formatIPv6(t);if(t.length===8||t.length===32){let n=t.length/2,o=t.slice(0,n),i=t.slice(n);if(t.every(c=>c===0))return t.length===8?"0.0.0.0/0":"::/0";let a=i.reduce((c,l)=>c+(l.toString(2).match(/1/g)||[]).length,0);return t.length===8?`${Array.from(o).join(".")}/${a}`:`${this.formatIPv6(o)}/${a}`}return this.decodeIP(Ex.Convert.ToHex(e))}static fromString(e){if(e.includes("/")){let[n,o]=this.parseCIDR(e),i=new Uint8Array(n.length),s=o;for(let c=0;c<i.length;c++)s>=8?(i[c]=255,s-=8):s>0&&(i[c]=255<<8-s,s=0);let a=new Uint8Array(n.length*2);return a.set(n,0),a.set(i,n.length),a.buffer}let t=this.isIPv4(e)?this.parseIPv4(e):this.parseIPv6(e);return new Uint8Array(t).buffer}};var Cx=$r(_n()),py,hy,dy,et=class{constructor(e={}){Object.assign(this,e)}toString(){return this.bmpString||this.printableString||this.teletexString||this.universalString||this.utf8String||""}};w([u({type:h.TeletexString})],et.prototype,"teletexString",void 0);w([u({type:h.PrintableString})],et.prototype,"printableString",void 0);w([u({type:h.UniversalString})],et.prototype,"universalString",void 0);w([u({type:h.Utf8String})],et.prototype,"utf8String",void 0);w([u({type:h.BmpString})],et.prototype,"bmpString",void 0);et=w([A({type:_.Choice})],et);var Ls=class extends et{constructor(e={}){super(e),Object.assign(this,e)}toString(){return this.ia5String||(this.anyValue?Cx.Convert.ToHex(this.anyValue):super.toString())}};w([u({type:h.IA5String})],Ls.prototype,"ia5String",void 0);w([u({type:h.Any})],Ls.prototype,"anyValue",void 0);Ls=w([A({type:_.Choice})],Ls);var gi=class{constructor(e={}){this.type="",this.value=new Ls,Object.assign(this,e)}};w([u({type:h.ObjectIdentifier})],gi.prototype,"type",void 0);w([u({type:Ls})],gi.prototype,"value",void 0);var co=py=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,py.prototype)}};co=py=w([A({type:_.Set,itemType:gi})],co);var yy=hy=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,hy.prototype)}};yy=hy=w([A({type:_.Sequence,itemType:co})],yy);var Pe=dy=class extends yy{constructor(e){super(e),Object.setPrototypeOf(this,dy.prototype)}};Pe=dy=w([A({type:_.Sequence})],Pe);var NC={fromASN:r=>Rc.toString(js.fromASN(r)),toASN:r=>js.toASN(Rc.fromString(r))},uo=class{constructor(e={}){this.typeId="",this.value=new ArrayBuffer(0),Object.assign(this,e)}};w([u({type:h.ObjectIdentifier})],uo.prototype,"typeId",void 0);w([u({type:h.Any,context:0})],uo.prototype,"value",void 0);var Lc=class{constructor(e={}){this.partyName=new et,Object.assign(this,e)}};w([u({type:et,optional:!0,context:0,implicit:!0})],Lc.prototype,"nameAssigner",void 0);w([u({type:et,context:1,implicit:!0})],Lc.prototype,"partyName",void 0);var ue=class{constructor(e={}){Object.assign(this,e)}};w([u({type:uo,context:0,implicit:!0})],ue.prototype,"otherName",void 0);w([u({type:h.IA5String,context:1,implicit:!0})],ue.prototype,"rfc822Name",void 0);w([u({type:h.IA5String,context:2,implicit:!0})],ue.prototype,"dNSName",void 0);w([u({type:h.Any,context:3,implicit:!0})],ue.prototype,"x400Address",void 0);w([u({type:Pe,context:4,implicit:!1})],ue.prototype,"directoryName",void 0);w([u({type:Lc,context:5})],ue.prototype,"ediPartyName",void 0);w([u({type:h.IA5String,context:6,implicit:!0})],ue.prototype,"uniformResourceIdentifier",void 0);w([u({type:h.OctetString,context:7,implicit:!0,converter:NC})],ue.prototype,"iPAddress",void 0);w([u({type:h.ObjectIdentifier,context:8,implicit:!0})],ue.prototype,"registeredID",void 0);ue=w([A({type:_.Choice})],ue);var lo="1.3.6.1.5.5.7",fo=`${lo}.1`,Tx=`${lo}.2`,wi=`${lo}.3`,kf=`${lo}.48`,F3=`${Tx}.1`,W3=`${Tx}.2`,my=`${kf}.1`,gy=`${kf}.2`,wy=`${kf}.3`,by=`${kf}.5`,pe="2.5.29";var xy,Nf=`${fo}.1`,In=class{constructor(e={}){this.accessMethod="",this.accessLocation=new ue,Object.assign(this,e)}};w([u({type:h.ObjectIdentifier})],In.prototype,"accessMethod",void 0);w([u({type:ue})],In.prototype,"accessLocation",void 0);var bi=xy=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,xy.prototype)}};bi=xy=w([A({type:_.Sequence,itemType:In})],bi);var Df=`${pe}.35`,xi=class extends ae{},rn=class{constructor(e={}){e&&Object.assign(this,e)}};w([u({type:xi,context:0,optional:!0,implicit:!0})],rn.prototype,"keyIdentifier",void 0);w([u({type:ue,context:1,optional:!0,implicit:!0,repeated:"sequence"})],rn.prototype,"authorityCertIssuer",void 0);w([u({type:h.Integer,context:2,optional:!0,implicit:!0,converter:me})],rn.prototype,"authorityCertSerialNumber",void 0);var jf=`${pe}.19`,vi=class{constructor(e={}){this.cA=!1,Object.assign(this,e)}};w([u({type:h.Boolean,defaultValue:!1})],vi.prototype,"cA",void 0);w([u({type:h.Integer,optional:!0})],vi.prototype,"pathLenConstraint",void 0);var vy,He=vy=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,vy.prototype)}};He=vy=w([A({type:_.Sequence,itemType:ue})],He);var _y,DC=`${pe}.29`,Ix=_y=class extends He{constructor(e){super(e),Object.setPrototypeOf(this,_y.prototype)}};Ix=_y=w([A({type:_.Sequence})],Ix);var Sy,Lf=`${pe}.32`,SD=`${Lf}.0`,On=class{constructor(e={}){Object.assign(this,e)}toString(){return this.ia5String||this.visibleString||this.bmpString||this.utf8String||""}};w([u({type:h.IA5String})],On.prototype,"ia5String",void 0);w([u({type:h.VisibleString})],On.prototype,"visibleString",void 0);w([u({type:h.BmpString})],On.prototype,"bmpString",void 0);w([u({type:h.Utf8String})],On.prototype,"utf8String",void 0);On=w([A({type:_.Choice})],On);var Uc=class{constructor(e={}){this.organization=new On,this.noticeNumbers=[],Object.assign(this,e)}};w([u({type:On})],Uc.prototype,"organization",void 0);w([u({type:h.Integer,repeated:"sequence"})],Uc.prototype,"noticeNumbers",void 0);var Mc=class{constructor(e={}){Object.assign(this,e)}};w([u({type:Uc,optional:!0})],Mc.prototype,"noticeRef",void 0);w([u({type:On,optional:!0})],Mc.prototype,"explicitText",void 0);var Rf=class{constructor(e={}){Object.assign(this,e)}};w([u({type:h.IA5String})],Rf.prototype,"cPSuri",void 0);w([u({type:Mc})],Rf.prototype,"userNotice",void 0);Rf=w([A({type:_.Choice})],Rf);var Kc=class{constructor(e={}){this.policyQualifierId="",this.qualifier=new ArrayBuffer(0),Object.assign(this,e)}};w([u({type:h.ObjectIdentifier})],Kc.prototype,"policyQualifierId",void 0);w([u({type:h.Any})],Kc.prototype,"qualifier",void 0);var _i=class{constructor(e={}){this.policyIdentifier="",Object.assign(this,e)}};w([u({type:h.ObjectIdentifier})],_i.prototype,"policyIdentifier",void 0);w([u({type:Kc,repeated:"sequence",optional:!0})],_i.prototype,"policyQualifiers",void 0);var Hc=Sy=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,Sy.prototype)}};Hc=Sy=w([A({type:_.Sequence,itemType:_i})],Hc);var BD=`${pe}.20`,Vc=class{constructor(e=0){this.value=e}};w([u({type:h.Integer})],Vc.prototype,"value",void 0);Vc=w([A({type:_.Choice})],Vc);var UD=`${pe}.27`,Ox=class extends Vc{};Ox=w([A({type:_.Choice})],Ox);var Ay,Uf=`${pe}.31`,Lr;(function(r){r[r.unused=1]="unused",r[r.keyCompromise=2]="keyCompromise",r[r.cACompromise=4]="cACompromise",r[r.affiliationChanged=8]="affiliationChanged",r[r.superseded=16]="superseded",r[r.cessationOfOperation=32]="cessationOfOperation",r[r.certificateHold=64]="certificateHold",r[r.privilegeWithdrawn=128]="privilegeWithdrawn",r[r.aACompromise=256]="aACompromise"})(Lr||(Lr={}));var $c=class extends tn{toJSON(){let e=[],t=this.toNumber();return t&Lr.aACompromise&&e.push("aACompromise"),t&Lr.affiliationChanged&&e.push("affiliationChanged"),t&Lr.cACompromise&&e.push("cACompromise"),t&Lr.certificateHold&&e.push("certificateHold"),t&Lr.cessationOfOperation&&e.push("cessationOfOperation"),t&Lr.keyCompromise&&e.push("keyCompromise"),t&Lr.privilegeWithdrawn&&e.push("privilegeWithdrawn"),t&Lr.superseded&&e.push("superseded"),t&Lr.unused&&e.push("unused"),e}toString(){return`[${this.toJSON().join(", ")}]`}},Pn=class{constructor(e={}){Object.assign(this,e)}};w([u({type:ue,context:0,repeated:"sequence",implicit:!0})],Pn.prototype,"fullName",void 0);w([u({type:co,context:1,implicit:!0})],Pn.prototype,"nameRelativeToCRLIssuer",void 0);Pn=w([A({type:_.Choice})],Pn);var nn=class{constructor(e={}){Object.assign(this,e)}};w([u({type:Pn,context:0,optional:!0})],nn.prototype,"distributionPoint",void 0);w([u({type:$c,context:1,optional:!0,implicit:!0})],nn.prototype,"reasons",void 0);w([u({type:ue,context:2,optional:!0,repeated:"sequence",implicit:!0})],nn.prototype,"cRLIssuer",void 0);var po=Ay=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,Ay.prototype)}};po=Ay=w([A({type:_.Sequence,itemType:nn})],po);var Ey,QD=`${pe}.46`,Px=Ey=class extends po{constructor(e){super(e),Object.setPrototypeOf(this,Ey.prototype)}};Px=Ey=w([A({type:_.Sequence,itemType:nn})],Px);var aj=`${pe}.28`,rr=class r{constructor(e={}){this.onlyContainsUserCerts=r.ONLY,this.onlyContainsCACerts=r.ONLY,this.indirectCRL=r.ONLY,this.onlyContainsAttributeCerts=r.ONLY,Object.assign(this,e)}};rr.ONLY=!1;w([u({type:Pn,context:0,optional:!0})],rr.prototype,"distributionPoint",void 0);w([u({type:h.Boolean,context:1,defaultValue:rr.ONLY,implicit:!0})],rr.prototype,"onlyContainsUserCerts",void 0);w([u({type:h.Boolean,context:2,defaultValue:rr.ONLY,implicit:!0})],rr.prototype,"onlyContainsCACerts",void 0);w([u({type:$c,context:3,optional:!0,implicit:!0})],rr.prototype,"onlySomeReasons",void 0);w([u({type:h.Boolean,context:4,defaultValue:rr.ONLY,implicit:!0})],rr.prototype,"indirectCRL",void 0);w([u({type:h.Boolean,context:5,defaultValue:rr.ONLY,implicit:!0})],rr.prototype,"onlyContainsAttributeCerts",void 0);var Bx=`${pe}.21`,Fc;(function(r){r[r.unspecified=0]="unspecified",r[r.keyCompromise=1]="keyCompromise",r[r.cACompromise=2]="cACompromise",r[r.affiliationChanged=3]="affiliationChanged",r[r.superseded=4]="superseded",r[r.cessationOfOperation=5]="cessationOfOperation",r[r.certificateHold=6]="certificateHold",r[r.removeFromCRL=8]="removeFromCRL",r[r.privilegeWithdrawn=9]="privilegeWithdrawn",r[r.aACompromise=10]="aACompromise"})(Fc||(Fc={}));var Wc=class{constructor(e=Fc.unspecified){this.reason=Fc.unspecified,this.reason=e}toJSON(){return Fc[this.reason]}toString(){return this.toJSON()}};w([u({type:h.Enumerated})],Wc.prototype,"reason",void 0);Wc=w([A({type:_.Choice})],Wc);var Cy,Mf=`${pe}.37`,Gc=Cy=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,Cy.prototype)}};Gc=Cy=w([A({type:_.Sequence,itemType:h.ObjectIdentifier})],Gc);var wj=`${Mf}.0`,kx=`${wi}.1`,Nx=`${wi}.2`,Dx=`${wi}.3`,jx=`${wi}.4`,Rx=`${wi}.8`,Lx=`${wi}.9`;var Sj=`${pe}.54`,Ty=class{constructor(e=new ArrayBuffer(0)){this.value=e}};w([u({type:h.Integer,converter:me})],Ty.prototype,"value",void 0);Ty=w([A({type:_.Choice})],Ty);var Ux=`${pe}.24`,qc=class{constructor(e){this.value=new Date,e&&(this.value=e)}};w([u({type:h.GeneralizedTime})],qc.prototype,"value",void 0);qc=w([A({type:_.Choice})],qc);var Iy,jj=`${pe}.18`,Mx=Iy=class extends He{constructor(e){super(e),Object.setPrototypeOf(this,Iy.prototype)}};Mx=Iy=w([A({type:_.Sequence})],Mx);var Kf=`${pe}.15`,Ur;(function(r){r[r.digitalSignature=1]="digitalSignature",r[r.nonRepudiation=2]="nonRepudiation",r[r.keyEncipherment=4]="keyEncipherment",r[r.dataEncipherment=8]="dataEncipherment",r[r.keyAgreement=16]="keyAgreement",r[r.keyCertSign=32]="keyCertSign",r[r.cRLSign=64]="cRLSign",r[r.encipherOnly=128]="encipherOnly",r[r.decipherOnly=256]="decipherOnly"})(Ur||(Ur={}));var Us=class extends tn{toJSON(){let e=this.toNumber(),t=[];return e&Ur.cRLSign&&t.push("crlSign"),e&Ur.dataEncipherment&&t.push("dataEncipherment"),e&Ur.decipherOnly&&t.push("decipherOnly"),e&Ur.digitalSignature&&t.push("digitalSignature"),e&Ur.encipherOnly&&t.push("encipherOnly"),e&Ur.keyAgreement&&t.push("keyAgreement"),e&Ur.keyCertSign&&t.push("keyCertSign"),e&Ur.keyEncipherment&&t.push("keyEncipherment"),e&Ur.nonRepudiation&&t.push("nonRepudiation"),t}toString(){return`[${this.toJSON().join(", ")}]`}};var Oy,Wj=`${pe}.30`,Ms=class{constructor(e={}){this.base=new ue,this.minimum=0,Object.assign(this,e)}};w([u({type:ue})],Ms.prototype,"base",void 0);w([u({type:h.Integer,context:0,defaultValue:0,implicit:!0})],Ms.prototype,"minimum",void 0);w([u({type:h.Integer,context:1,optional:!0,implicit:!0})],Ms.prototype,"maximum",void 0);var Hf=Oy=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,Oy.prototype)}};Hf=Oy=w([A({type:_.Sequence,itemType:Ms})],Hf);var Vf=class{constructor(e={}){Object.assign(this,e)}};w([u({type:Hf,context:0,optional:!0,implicit:!0})],Vf.prototype,"permittedSubtrees",void 0);w([u({type:Hf,context:1,optional:!0,implicit:!0})],Vf.prototype,"excludedSubtrees",void 0);var Yj=`${pe}.36`,$f=class{constructor(e={}){Object.assign(this,e)}};w([u({type:h.Integer,context:0,implicit:!0,optional:!0,converter:me})],$f.prototype,"requireExplicitPolicy",void 0);w([u({type:h.Integer,context:1,implicit:!0,optional:!0,converter:me})],$f.prototype,"inhibitPolicyMapping",void 0);var Py,rR=`${pe}.33`,zc=class{constructor(e={}){this.issuerDomainPolicy="",this.subjectDomainPolicy="",Object.assign(this,e)}};w([u({type:h.ObjectIdentifier})],zc.prototype,"issuerDomainPolicy",void 0);w([u({type:h.ObjectIdentifier})],zc.prototype,"subjectDomainPolicy",void 0);var Kx=Py=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,Py.prototype)}};Kx=Py=w([A({type:_.Sequence,itemType:zc})],Kx);var By,ky=`${pe}.17`,Ff=By=class extends He{constructor(e){super(e),Object.setPrototypeOf(this,By.prototype)}};Ff=By=w([A({type:_.Sequence})],Ff);var dt=class{constructor(e={}){this.type="",this.values=[],Object.assign(this,e)}};w([u({type:h.ObjectIdentifier})],dt.prototype,"type",void 0);w([u({type:h.Any,repeated:"set"})],dt.prototype,"values",void 0);var Ny,wR=`${pe}.9`,Hx=Ny=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,Ny.prototype)}};Hx=Ny=w([A({type:_.Sequence,itemType:dt})],Hx);var Dy=`${pe}.14`,Ft=class extends xi{};var TR=`${pe}.16`,Wf=class{constructor(e={}){Object.assign(this,e)}};w([u({type:h.GeneralizedTime,context:0,implicit:!0,optional:!0})],Wf.prototype,"notBefore",void 0);w([u({type:h.GeneralizedTime,context:1,implicit:!0,optional:!0})],Wf.prototype,"notAfter",void 0);var Xc;(function(r){r[r.keyUpdateAllowed=1]="keyUpdateAllowed",r[r.newExtensions=2]="newExtensions",r[r.pKIXCertificate=4]="pKIXCertificate"})(Xc||(Xc={}));var Gf=class extends tn{toJSON(){let e=[],t=this.toNumber();return t&Xc.pKIXCertificate&&e.push("pKIXCertificate"),t&Xc.newExtensions&&e.push("newExtensions"),t&Xc.keyUpdateAllowed&&e.push("keyUpdateAllowed"),e}toString(){return`[${this.toJSON().join(", ")}]`}},qf=class{constructor(e={}){this.entrustVers="",this.entrustInfoFlags=new Gf,Object.assign(this,e)}};w([u({type:h.GeneralString})],qf.prototype,"entrustVers",void 0);w([u({type:Gf})],qf.prototype,"entrustInfoFlags",void 0);var jy,RR=`${fo}.11`,Vx=jy=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,jy.prototype)}};Vx=jy=w([A({type:_.Sequence,itemType:In})],Vx);var $x=$r(_n()),H=class r{constructor(e={}){this.algorithm="",Object.assign(this,e)}isEqual(e){return e instanceof r&&e.algorithm==this.algorithm&&(e.parameters&&this.parameters&&$x.isEqual(e.parameters,this.parameters)||e.parameters===this.parameters)}};w([u({type:h.ObjectIdentifier})],H.prototype,"algorithm",void 0);w([u({type:h.Any,optional:!0})],H.prototype,"parameters",void 0);var yt=class{constructor(e={}){this.algorithm=new H,this.subjectPublicKey=new ArrayBuffer(0),Object.assign(this,e)}};w([u({type:H})],yt.prototype,"algorithm",void 0);w([u({type:h.BitString})],yt.prototype,"subjectPublicKey",void 0);var Ge=class{constructor(e){if(e)if(typeof e=="string"||typeof e=="number"||e instanceof Date){let t=new Date(e);t.getUTCFullYear()>2049?this.generalTime=t:this.utcTime=t}else Object.assign(this,e)}getTime(){let e=this.utcTime||this.generalTime;if(!e)throw new Error("Cannot get time from CHOICE object");return e}};w([u({type:h.UTCTime})],Ge.prototype,"utcTime",void 0);w([u({type:h.GeneralizedTime})],Ge.prototype,"generalTime",void 0);Ge=w([A({type:_.Choice})],Ge);var Bn=class{constructor(e){this.notBefore=new Ge(new Date),this.notAfter=new Ge(new Date),e&&(this.notBefore=new Ge(e.notBefore),this.notAfter=new Ge(e.notAfter))}};w([u({type:Ge})],Bn.prototype,"notBefore",void 0);w([u({type:Ge})],Bn.prototype,"notAfter",void 0);var Ry,mt=class r{constructor(e={}){this.extnID="",this.critical=r.CRITICAL,this.extnValue=new ae,Object.assign(this,e)}};mt.CRITICAL=!1;w([u({type:h.ObjectIdentifier})],mt.prototype,"extnID",void 0);w([u({type:h.Boolean,defaultValue:mt.CRITICAL})],mt.prototype,"critical",void 0);w([u({type:ae})],mt.prototype,"extnValue",void 0);var nr=Ry=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,Ry.prototype)}};nr=Ry=w([A({type:_.Sequence,itemType:mt})],nr);var on;(function(r){r[r.v1=0]="v1",r[r.v2=1]="v2",r[r.v3=2]="v3"})(on||(on={}));var gt=class{constructor(e={}){this.version=on.v1,this.serialNumber=new ArrayBuffer(0),this.signature=new H,this.issuer=new Pe,this.validity=new Bn,this.subject=new Pe,this.subjectPublicKeyInfo=new yt,Object.assign(this,e)}};w([u({type:h.Integer,context:0,defaultValue:on.v1})],gt.prototype,"version",void 0);w([u({type:h.Integer,converter:me})],gt.prototype,"serialNumber",void 0);w([u({type:H})],gt.prototype,"signature",void 0);w([u({type:Pe})],gt.prototype,"issuer",void 0);w([u({type:Bn})],gt.prototype,"validity",void 0);w([u({type:Pe})],gt.prototype,"subject",void 0);w([u({type:yt})],gt.prototype,"subjectPublicKeyInfo",void 0);w([u({type:h.BitString,context:1,implicit:!0,optional:!0})],gt.prototype,"issuerUniqueID",void 0);w([u({type:h.BitString,context:2,implicit:!0,optional:!0})],gt.prototype,"subjectUniqueID",void 0);w([u({type:nr,context:3,optional:!0})],gt.prototype,"extensions",void 0);var hr=class{constructor(e={}){this.tbsCertificate=new gt,this.signatureAlgorithm=new H,this.signatureValue=new ArrayBuffer(0),Object.assign(this,e)}};w([u({type:gt})],hr.prototype,"tbsCertificate",void 0);w([u({type:H})],hr.prototype,"signatureAlgorithm",void 0);w([u({type:h.BitString})],hr.prototype,"signatureValue",void 0);var Si=class{constructor(e={}){this.userCertificate=new ArrayBuffer(0),this.revocationDate=new Ge,Object.assign(this,e)}};w([u({type:h.Integer,converter:me})],Si.prototype,"userCertificate",void 0);w([u({type:Ge})],Si.prototype,"revocationDate",void 0);w([u({type:mt,optional:!0,repeated:"sequence"})],Si.prototype,"crlEntryExtensions",void 0);var or=class{constructor(e={}){this.signature=new H,this.issuer=new Pe,this.thisUpdate=new Ge,Object.assign(this,e)}};w([u({type:h.Integer,optional:!0})],or.prototype,"version",void 0);w([u({type:H})],or.prototype,"signature",void 0);w([u({type:Pe})],or.prototype,"issuer",void 0);w([u({type:Ge})],or.prototype,"thisUpdate",void 0);w([u({type:Ge,optional:!0})],or.prototype,"nextUpdate",void 0);w([u({type:Si,repeated:"sequence",optional:!0})],or.prototype,"revokedCertificates",void 0);w([u({type:mt,optional:!0,context:0,repeated:"sequence"})],or.prototype,"crlExtensions",void 0);var Ai=class{constructor(e={}){this.tbsCertList=new or,this.signatureAlgorithm=new H,this.signature=new ArrayBuffer(0),Object.assign(this,e)}};w([u({type:or})],Ai.prototype,"tbsCertList",void 0);w([u({type:H})],Ai.prototype,"signatureAlgorithm",void 0);w([u({type:h.BitString})],Ai.prototype,"signature",void 0);var $=$r(_n());function C(r,e,t,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(i=(o<3?s(i):o>3?s(e,t,i):s(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i}var Mr=class{constructor(e={}){this.issuer=new Pe,this.serialNumber=new ArrayBuffer(0),Object.assign(this,e)}};C([u({type:Pe})],Mr.prototype,"issuer",void 0);C([u({type:h.Integer,converter:me})],Mr.prototype,"serialNumber",void 0);var Ei=class{constructor(e={}){Object.assign(this,e)}};C([u({type:Ft,context:0,implicit:!0})],Ei.prototype,"subjectKeyIdentifier",void 0);C([u({type:Mr})],Ei.prototype,"issuerAndSerialNumber",void 0);Ei=C([A({type:_.Choice})],Ei);var wt;(function(r){r[r.v0=0]="v0",r[r.v1=1]="v1",r[r.v2=2]="v2",r[r.v3=3]="v3",r[r.v4=4]="v4",r[r.v5=5]="v5"})(wt||(wt={}));var Ci=class extends H{};Ci=C([A({type:_.Sequence})],Ci);var Zc=class extends H{};Zc=C([A({type:_.Sequence})],Zc);var Wt=class extends H{};Wt=C([A({type:_.Sequence})],Wt);var Yc=class extends H{};Yc=C([A({type:_.Sequence})],Yc);var Wx=class extends H{};Wx=C([A({type:_.Sequence})],Wx);var zf=class extends H{};zf=C([A({type:_.Sequence})],zf);var Kr=class{constructor(e={}){this.attrType="",this.attrValues=[],Object.assign(this,e)}};C([u({type:h.ObjectIdentifier})],Kr.prototype,"attrType",void 0);C([u({type:h.Any,repeated:"set"})],Kr.prototype,"attrValues",void 0);var Ly,Gt=class{constructor(e={}){this.version=wt.v0,this.sid=new Ei,this.digestAlgorithm=new Ci,this.signatureAlgorithm=new Zc,this.signature=new ae,Object.assign(this,e)}};C([u({type:h.Integer})],Gt.prototype,"version",void 0);C([u({type:Ei})],Gt.prototype,"sid",void 0);C([u({type:Ci})],Gt.prototype,"digestAlgorithm",void 0);C([u({type:Kr,repeated:"set",context:0,implicit:!0,optional:!0})],Gt.prototype,"signedAttrs",void 0);C([u({type:Zc})],Gt.prototype,"signatureAlgorithm",void 0);C([u({type:ae})],Gt.prototype,"signature",void 0);C([u({type:Kr,repeated:"set",context:1,implicit:!0,optional:!0})],Gt.prototype,"unsignedAttrs",void 0);var Jc=Ly=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,Ly.prototype)}};Jc=Ly=C([A({type:_.Set,itemType:Gt})],Jc);var Gx=class extends Ge{};Gx=C([A({type:_.Choice})],Gx);var qx=class extends Gt{};qx=C([A({type:_.Sequence})],qx);function z(r,e,t,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(i=(o<3?s(i):o>3?s(e,t,i):s(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i}var Qc=class{constructor(e={}){this.acIssuer=new ue,this.acSerial=0,this.attrs=[],Object.assign(this,e)}};z([u({type:ue})],Qc.prototype,"acIssuer",void 0);z([u({type:h.Integer})],Qc.prototype,"acSerial",void 0);z([u({type:dt,repeated:"sequence"})],Qc.prototype,"attrs",void 0);var Uy,eu=Uy=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,Uy.prototype)}};eu=Uy=z([A({type:_.Sequence,itemType:h.ObjectIdentifier})],eu);var Ks=class{constructor(e={}){this.permitUnSpecified=!0,Object.assign(this,e)}};z([u({type:h.Integer,optional:!0})],Ks.prototype,"pathLenConstraint",void 0);z([u({type:eu,implicit:!0,context:0,optional:!0})],Ks.prototype,"permittedAttrs",void 0);z([u({type:eu,implicit:!0,context:1,optional:!0})],Ks.prototype,"excludedAttrs",void 0);z([u({type:h.Boolean,defaultValue:!0})],Ks.prototype,"permitUnSpecified",void 0);var dr=class{constructor(e={}){this.issuer=new He,this.serial=new ArrayBuffer(0),this.issuerUID=new ArrayBuffer(0),Object.assign(this,e)}};z([u({type:He})],dr.prototype,"issuer",void 0);z([u({type:h.Integer,converter:me})],dr.prototype,"serial",void 0);z([u({type:h.BitString,optional:!0})],dr.prototype,"issuerUID",void 0);var My;(function(r){r[r.publicKey=0]="publicKey",r[r.publicKeyCert=1]="publicKeyCert",r[r.otherObjectTypes=2]="otherObjectTypes"})(My||(My={}));var yr=class{constructor(e={}){this.digestedObjectType=My.publicKey,this.digestAlgorithm=new H,this.objectDigest=new ArrayBuffer(0),Object.assign(this,e)}};z([u({type:h.Enumerated})],yr.prototype,"digestedObjectType",void 0);z([u({type:h.ObjectIdentifier,optional:!0})],yr.prototype,"otherObjectTypeID",void 0);z([u({type:H})],yr.prototype,"digestAlgorithm",void 0);z([u({type:h.BitString})],yr.prototype,"objectDigest",void 0);var Ti=class{constructor(e={}){Object.assign(this,e)}};z([u({type:He,optional:!0})],Ti.prototype,"issuerName",void 0);z([u({type:dr,context:0,implicit:!0,optional:!0})],Ti.prototype,"baseCertificateID",void 0);z([u({type:yr,context:1,implicit:!0,optional:!0})],Ti.prototype,"objectDigestInfo",void 0);var Ii=class{constructor(e={}){Object.assign(this,e)}};z([u({type:ue,repeated:"sequence"})],Ii.prototype,"v1Form",void 0);z([u({type:Ti,context:0,implicit:!0})],Ii.prototype,"v2Form",void 0);Ii=z([A({type:_.Choice})],Ii);var Oi=class{constructor(e={}){this.notBeforeTime=new Date,this.notAfterTime=new Date,Object.assign(this,e)}};z([u({type:h.GeneralizedTime})],Oi.prototype,"notBeforeTime",void 0);z([u({type:h.GeneralizedTime})],Oi.prototype,"notAfterTime",void 0);var ho=class{constructor(e={}){Object.assign(this,e)}};z([u({type:dr,implicit:!0,context:0,optional:!0})],ho.prototype,"baseCertificateID",void 0);z([u({type:He,implicit:!0,context:1,optional:!0})],ho.prototype,"entityName",void 0);z([u({type:yr,implicit:!0,context:2,optional:!0})],ho.prototype,"objectDigestInfo",void 0);var Ky;(function(r){r[r.v2=1]="v2"})(Ky||(Ky={}));var qt=class{constructor(e={}){this.version=Ky.v2,this.holder=new ho,this.issuer=new Ii,this.signature=new H,this.serialNumber=new ArrayBuffer(0),this.attrCertValidityPeriod=new Oi,this.attributes=[],Object.assign(this,e)}};z([u({type:h.Integer})],qt.prototype,"version",void 0);z([u({type:ho})],qt.prototype,"holder",void 0);z([u({type:Ii})],qt.prototype,"issuer",void 0);z([u({type:H})],qt.prototype,"signature",void 0);z([u({type:h.Integer,converter:me})],qt.prototype,"serialNumber",void 0);z([u({type:Oi})],qt.prototype,"attrCertValidityPeriod",void 0);z([u({type:dt,repeated:"sequence"})],qt.prototype,"attributes",void 0);z([u({type:h.BitString,optional:!0})],qt.prototype,"issuerUniqueID",void 0);z([u({type:nr,optional:!0})],qt.prototype,"extensions",void 0);var Pi=class{constructor(e={}){this.acinfo=new qt,this.signatureAlgorithm=new H,this.signatureValue=new ArrayBuffer(0),Object.assign(this,e)}};z([u({type:qt})],Pi.prototype,"acinfo",void 0);z([u({type:H})],Pi.prototype,"signatureAlgorithm",void 0);z([u({type:h.BitString})],Pi.prototype,"signatureValue",void 0);var tu;(function(r){r[r.unmarked=1]="unmarked",r[r.unclassified=2]="unclassified",r[r.restricted=4]="restricted",r[r.confidential=8]="confidential",r[r.secret=16]="secret",r[r.topSecret=32]="topSecret"})(tu||(tu={}));var Hs=class extends tn{};var Vs=class{constructor(e={}){this.type="",this.value=new ArrayBuffer(0),Object.assign(this,e)}};z([u({type:h.ObjectIdentifier,implicit:!0,context:0})],Vs.prototype,"type",void 0);z([u({type:h.Any,implicit:!0,context:1})],Vs.prototype,"value",void 0);var ru=class{constructor(e={}){this.policyId="",this.classList=new Hs(tu.unclassified),Object.assign(this,e)}};z([u({type:h.ObjectIdentifier})],ru.prototype,"policyId",void 0);z([u({type:Hs,defaultValue:new Hs(tu.unclassified)})],ru.prototype,"classList",void 0);z([u({type:Vs,repeated:"set"})],ru.prototype,"securityCategories",void 0);var $s=class{constructor(e={}){Object.assign(this,e)}};z([u({type:ae})],$s.prototype,"cotets",void 0);z([u({type:h.ObjectIdentifier})],$s.prototype,"oid",void 0);z([u({type:h.Utf8String})],$s.prototype,"string",void 0);var Xf=class{constructor(e={}){this.values=[],Object.assign(this,e)}};z([u({type:He,implicit:!0,context:0,optional:!0})],Xf.prototype,"policyAuthority",void 0);z([u({type:$s,repeated:"sequence"})],Xf.prototype,"values",void 0);var w9=`${fo}.4`,b9=`${fo}.6`,x9=`${fo}.10`,v9=`${pe}.55`,nu=`${lo}.10`,_9=`${nu}.1`,S9=`${nu}.2`,A9=`${nu}.3`,E9=`${nu}.4`,C9=`${nu}.6`,Hy="2.5.4",T9=`${Hy}.72`;var Vy,Fs=class{constructor(e={}){this.targetCertificate=new dr,Object.assign(this,e)}};z([u({type:dr})],Fs.prototype,"targetCertificate",void 0);z([u({type:ue,optional:!0})],Fs.prototype,"targetName",void 0);z([u({type:yr,optional:!0})],Fs.prototype,"certDigestInfo",void 0);var Ws=class{constructor(e={}){Object.assign(this,e)}};z([u({type:ue,context:0,implicit:!0})],Ws.prototype,"targetName",void 0);z([u({type:ue,context:1,implicit:!0})],Ws.prototype,"targetGroup",void 0);z([u({type:Fs,context:2,implicit:!0})],Ws.prototype,"targetCert",void 0);Ws=z([A({type:_.Choice})],Ws);var Zf=Vy=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,Vy.prototype)}};Zf=Vy=z([A({type:_.Sequence,itemType:Ws})],Zf);var $y,zx=$y=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,$y.prototype)}};zx=$y=z([A({type:_.Sequence,itemType:Zf})],zx);var Yf=class{constructor(e={}){Object.assign(this,e)}};z([u({type:He,implicit:!0,context:0,optional:!0})],Yf.prototype,"roleAuthority",void 0);z([u({type:ue,implicit:!0,context:1})],Yf.prototype,"roleName",void 0);var ou=class{constructor(e={}){this.service=new ue,this.ident=new ue,Object.assign(this,e)}};z([u({type:ue})],ou.prototype,"service",void 0);z([u({type:ue})],ou.prototype,"ident",void 0);z([u({type:ae,optional:!0})],ou.prototype,"authInfo",void 0);var Fy,iu=class{constructor(e={}){this.otherCertFormat="",this.otherCert=new ArrayBuffer(0),Object.assign(this,e)}};C([u({type:h.ObjectIdentifier})],iu.prototype,"otherCertFormat",void 0);C([u({type:h.Any})],iu.prototype,"otherCert",void 0);var Bi=class{constructor(e={}){Object.assign(this,e)}};C([u({type:hr})],Bi.prototype,"certificate",void 0);C([u({type:Pi,context:2,implicit:!0})],Bi.prototype,"v2AttrCert",void 0);C([u({type:iu,context:3,implicit:!0})],Bi.prototype,"other",void 0);Bi=C([A({type:_.Choice})],Bi);var ki=Fy=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,Fy.prototype)}};ki=Fy=C([A({type:_.Set,itemType:Bi})],ki);var mr=class{constructor(e={}){this.contentType="",this.content=new ArrayBuffer(0),Object.assign(this,e)}};C([u({type:h.ObjectIdentifier})],mr.prototype,"contentType",void 0);C([u({type:h.Any,context:0})],mr.prototype,"content",void 0);var Gs=class{constructor(e={}){Object.assign(this,e)}};C([u({type:ae})],Gs.prototype,"single",void 0);C([u({type:h.Any})],Gs.prototype,"any",void 0);Gs=C([A({type:_.Choice})],Gs);var Ni=class{constructor(e={}){this.eContentType="",Object.assign(this,e)}};C([u({type:h.ObjectIdentifier})],Ni.prototype,"eContentType",void 0);C([u({type:Gs,context:0,optional:!0})],Ni.prototype,"eContent",void 0);var su=class{constructor(e={}){Object.assign(this,e)}};C([u({type:ae,context:0,implicit:!0,optional:!0})],su.prototype,"value",void 0);C([u({type:ae,converter:Sx,context:0,implicit:!0,optional:!0,repeated:"sequence"})],su.prototype,"constructedValue",void 0);su=C([A({type:_.Choice})],su);var yo=class{constructor(e={}){this.contentType="",this.contentEncryptionAlgorithm=new Yc,Object.assign(this,e)}};C([u({type:h.ObjectIdentifier})],yo.prototype,"contentType",void 0);C([u({type:Yc})],yo.prototype,"contentEncryptionAlgorithm",void 0);C([u({type:su,optional:!0})],yo.prototype,"encryptedContent",void 0);var mo=class{constructor(e={}){this.keyAttrId="",Object.assign(this,e)}};C([u({type:h.ObjectIdentifier})],mo.prototype,"keyAttrId",void 0);C([u({type:h.Any,optional:!0})],mo.prototype,"keyAttr",void 0);var Wy,qs=class{constructor(e={}){this.subjectKeyIdentifier=new Ft,Object.assign(this,e)}};C([u({type:Ft})],qs.prototype,"subjectKeyIdentifier",void 0);C([u({type:h.GeneralizedTime,optional:!0})],qs.prototype,"date",void 0);C([u({type:mo,optional:!0})],qs.prototype,"other",void 0);var zs=class{constructor(e={}){Object.assign(this,e)}};C([u({type:qs,context:0,implicit:!0,optional:!0})],zs.prototype,"rKeyId",void 0);C([u({type:Mr,optional:!0})],zs.prototype,"issuerAndSerialNumber",void 0);zs=C([A({type:_.Choice})],zs);var au=class{constructor(e={}){this.rid=new zs,this.encryptedKey=new ae,Object.assign(this,e)}};C([u({type:zs})],au.prototype,"rid",void 0);C([u({type:ae})],au.prototype,"encryptedKey",void 0);var Jf=Wy=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,Wy.prototype)}};Jf=Wy=C([A({type:_.Sequence,itemType:au})],Jf);var cu=class{constructor(e={}){this.algorithm=new H,this.publicKey=new ArrayBuffer(0),Object.assign(this,e)}};C([u({type:H})],cu.prototype,"algorithm",void 0);C([u({type:h.BitString})],cu.prototype,"publicKey",void 0);var Di=class{constructor(e={}){Object.assign(this,e)}};C([u({type:Ft,context:0,implicit:!0,optional:!0})],Di.prototype,"subjectKeyIdentifier",void 0);C([u({type:cu,context:1,implicit:!0,optional:!0})],Di.prototype,"originatorKey",void 0);C([u({type:Mr,optional:!0})],Di.prototype,"issuerAndSerialNumber",void 0);Di=C([A({type:_.Choice})],Di);var kn=class{constructor(e={}){this.version=wt.v3,this.originator=new Di,this.keyEncryptionAlgorithm=new Wt,this.recipientEncryptedKeys=new Jf,Object.assign(this,e)}};C([u({type:h.Integer})],kn.prototype,"version",void 0);C([u({type:Di,context:0})],kn.prototype,"originator",void 0);C([u({type:ae,context:1,optional:!0})],kn.prototype,"ukm",void 0);C([u({type:Wt})],kn.prototype,"keyEncryptionAlgorithm",void 0);C([u({type:Jf})],kn.prototype,"recipientEncryptedKeys",void 0);var Xs=class{constructor(e={}){Object.assign(this,e)}};C([u({type:Ft,context:0,implicit:!0})],Xs.prototype,"subjectKeyIdentifier",void 0);C([u({type:Mr})],Xs.prototype,"issuerAndSerialNumber",void 0);Xs=C([A({type:_.Choice})],Xs);var go=class{constructor(e={}){this.version=wt.v0,this.rid=new Xs,this.keyEncryptionAlgorithm=new Wt,this.encryptedKey=new ae,Object.assign(this,e)}};C([u({type:h.Integer})],go.prototype,"version",void 0);C([u({type:Xs})],go.prototype,"rid",void 0);C([u({type:Wt})],go.prototype,"keyEncryptionAlgorithm",void 0);C([u({type:ae})],go.prototype,"encryptedKey",void 0);var ji=class{constructor(e={}){this.keyIdentifier=new ae,Object.assign(this,e)}};C([u({type:ae})],ji.prototype,"keyIdentifier",void 0);C([u({type:h.GeneralizedTime,optional:!0})],ji.prototype,"date",void 0);C([u({type:mo,optional:!0})],ji.prototype,"other",void 0);var wo=class{constructor(e={}){this.version=wt.v4,this.kekid=new ji,this.keyEncryptionAlgorithm=new Wt,this.encryptedKey=new ae,Object.assign(this,e)}};C([u({type:h.Integer})],wo.prototype,"version",void 0);C([u({type:ji})],wo.prototype,"kekid",void 0);C([u({type:Wt})],wo.prototype,"keyEncryptionAlgorithm",void 0);C([u({type:ae})],wo.prototype,"encryptedKey",void 0);var bo=class{constructor(e={}){this.version=wt.v0,this.keyEncryptionAlgorithm=new Wt,this.encryptedKey=new ae,Object.assign(this,e)}};C([u({type:h.Integer})],bo.prototype,"version",void 0);C([u({type:zf,context:0,optional:!0})],bo.prototype,"keyDerivationAlgorithm",void 0);C([u({type:Wt})],bo.prototype,"keyEncryptionAlgorithm",void 0);C([u({type:ae})],bo.prototype,"encryptedKey",void 0);var uu=class{constructor(e={}){this.oriType="",this.oriValue=new ArrayBuffer(0),Object.assign(this,e)}};C([u({type:h.ObjectIdentifier})],uu.prototype,"oriType",void 0);C([u({type:h.Any})],uu.prototype,"oriValue",void 0);var Nn=class{constructor(e={}){Object.assign(this,e)}};C([u({type:go,optional:!0})],Nn.prototype,"ktri",void 0);C([u({type:kn,context:1,implicit:!0,optional:!0})],Nn.prototype,"kari",void 0);C([u({type:wo,context:2,implicit:!0,optional:!0})],Nn.prototype,"kekri",void 0);C([u({type:bo,context:3,implicit:!0,optional:!0})],Nn.prototype,"pwri",void 0);C([u({type:uu,context:4,implicit:!0,optional:!0})],Nn.prototype,"ori",void 0);Nn=C([A({type:_.Choice})],Nn);var Gy,lu=Gy=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,Gy.prototype)}};lu=Gy=C([A({type:_.Set,itemType:Nn})],lu);var qy,Xx=`${lo}.16`,CH=`${Xx}.2`,TH=`${Xx}.4`,Zs=class{constructor(e={}){this.otherRevInfoFormat="",this.otherRevInfo=new ArrayBuffer(0),Object.assign(this,e)}};C([u({type:h.ObjectIdentifier})],Zs.prototype,"otherRevInfoFormat",void 0);C([u({type:h.Any})],Zs.prototype,"otherRevInfo",void 0);var Qf=class{constructor(e={}){this.other=new Zs,Object.assign(this,e)}};C([u({type:Zs,context:1,implicit:!0})],Qf.prototype,"other",void 0);Qf=C([A({type:_.Choice})],Qf);var Ys=qy=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,qy.prototype)}};Ys=qy=C([A({type:_.Set,itemType:Qf})],Ys);var Js=class{constructor(e={}){Object.assign(this,e)}};C([u({type:ki,context:0,implicit:!0,optional:!0})],Js.prototype,"certs",void 0);C([u({type:Ys,context:1,implicit:!0,optional:!0})],Js.prototype,"crls",void 0);var zy,Xy=zy=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,zy.prototype)}};Xy=zy=C([A({type:_.Set,itemType:Kr})],Xy);var Ri=class{constructor(e={}){this.version=wt.v0,this.recipientInfos=new lu,this.encryptedContentInfo=new yo,Object.assign(this,e)}};C([u({type:h.Integer})],Ri.prototype,"version",void 0);C([u({type:Js,context:0,implicit:!0,optional:!0})],Ri.prototype,"originatorInfo",void 0);C([u({type:lu})],Ri.prototype,"recipientInfos",void 0);C([u({type:yo})],Ri.prototype,"encryptedContentInfo",void 0);C([u({type:Xy,context:1,implicit:!0,optional:!0})],Ri.prototype,"unprotectedAttrs",void 0);var Zx="1.2.840.113549.1.7.2";var Zy,ep=Zy=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,Zy.prototype)}};ep=Zy=C([A({type:_.Set,itemType:Ci})],ep);var Dn=class{constructor(e={}){this.version=wt.v0,this.digestAlgorithms=new ep,this.encapContentInfo=new Ni,this.signerInfos=new Jc,Object.assign(this,e)}};C([u({type:h.Integer})],Dn.prototype,"version",void 0);C([u({type:ep})],Dn.prototype,"digestAlgorithms",void 0);C([u({type:Ni})],Dn.prototype,"encapContentInfo",void 0);C([u({type:ki,context:0,implicit:!0,optional:!0})],Dn.prototype,"certificates",void 0);C([u({type:Ys,context:1,implicit:!0,optional:!0})],Dn.prototype,"crls",void 0);C([u({type:Jc})],Dn.prototype,"signerInfos",void 0);var Li="1.2.840.10045.2.1";var fu="1.2.840.10045.4.1",tp="1.2.840.10045.4.3.1",pu="1.2.840.10045.4.3.2",hu="1.2.840.10045.4.3.3",du="1.2.840.10045.4.3.4";var Yy="1.2.840.10045.3.1.7";var Jy="1.3.132.0.34";var Qy="1.3.132.0.35";function yu(r){return new H({algorithm:r})}var Jx=yu(fu),SV=yu(tp),Qx=yu(pu),ev=yu(hu),tv=yu(du);function Be(r,e,t,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(i=(o<3?s(i):o>3?s(e,t,i):s(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i}var mu=class{constructor(e={}){Object.assign(this,e)}};Be([u({type:h.ObjectIdentifier})],mu.prototype,"fieldType",void 0);Be([u({type:h.Any})],mu.prototype,"parameters",void 0);mu=Be([A({type:_.Sequence})],mu);var em=class extends ae{};var Qs=class{constructor(e={}){Object.assign(this,e)}};Be([u({type:h.OctetString})],Qs.prototype,"a",void 0);Be([u({type:h.OctetString})],Qs.prototype,"b",void 0);Be([u({type:h.BitString,optional:!0})],Qs.prototype,"seed",void 0);Qs=Be([A({type:_.Sequence})],Qs);var tm;(function(r){r[r.ecpVer1=1]="ecpVer1"})(tm||(tm={}));var sn=class{constructor(e={}){this.version=tm.ecpVer1,Object.assign(this,e)}};Be([u({type:h.Integer})],sn.prototype,"version",void 0);Be([u({type:mu})],sn.prototype,"fieldID",void 0);Be([u({type:Qs})],sn.prototype,"curve",void 0);Be([u({type:em})],sn.prototype,"base",void 0);Be([u({type:h.Integer,converter:me})],sn.prototype,"order",void 0);Be([u({type:h.Integer,optional:!0})],sn.prototype,"cofactor",void 0);sn=Be([A({type:_.Sequence})],sn);var an=class{constructor(e={}){Object.assign(this,e)}};Be([u({type:h.ObjectIdentifier})],an.prototype,"namedCurve",void 0);Be([u({type:h.Null})],an.prototype,"implicitCurve",void 0);Be([u({type:sn})],an.prototype,"specifiedCurve",void 0);an=Be([A({type:_.Choice})],an);var ea=class{constructor(e={}){this.version=1,this.privateKey=new ae,Object.assign(this,e)}};Be([u({type:h.Integer})],ea.prototype,"version",void 0);Be([u({type:ae})],ea.prototype,"privateKey",void 0);Be([u({type:an,context:0,optional:!0})],ea.prototype,"parameters",void 0);Be([u({type:h.BitString,context:1,optional:!0})],ea.prototype,"publicKey",void 0);var Ui=class{constructor(e={}){this.r=new ArrayBuffer(0),this.s=new ArrayBuffer(0),Object.assign(this,e)}};Be([u({type:h.Integer,converter:me})],Ui.prototype,"r",void 0);Be([u({type:h.Integer,converter:me})],Ui.prototype,"s",void 0);function Ee(r,e,t,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(i=(o<3?s(i):o>3?s(e,t,i):s(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i}var zt="1.2.840.113549.1.1",cn=`${zt}.1`,rv=`${zt}.7`,nv=`${zt}.9`,xo=`${zt}.10`,ov=`${zt}.2`,iv=`${zt}.4`,ta=`${zt}.5`,sv=`${zt}.14`;var rp=`${zt}.11`,ra=`${zt}.12`,na=`${zt}.13`,rm=`${zt}.15`,nm=`${zt}.16`,Mi="1.3.14.3.2.26",np="2.16.840.1.101.3.4.2.4",Ki="2.16.840.1.101.3.4.2.1",Hi="2.16.840.1.101.3.4.2.2",Vi="2.16.840.1.101.3.4.2.3",av="2.16.840.1.101.3.4.2.5",cv="2.16.840.1.101.3.4.2.6",uv="1.2.840.113549.2.2",lv="1.2.840.113549.2.5",vo=`${zt}.8`;function at(r){return new H({algorithm:r,parameters:null})}var QV=at(uv),e7=at(lv),jn=at(Mi),t7=at(np),r7=at(Ki),n7=at(Hi),o7=at(Vi),i7=at(av),s7=at(cv),op=new H({algorithm:vo,parameters:q.serialize(jn)}),om=new H({algorithm:nv,parameters:q.serialize(js.toASN(new Uint8Array([218,57,163,238,94,107,75,13,50,85,191,239,149,96,24,144,175,216,7,9]).buffer))}),a7=at(cn),c7=at(ov),u7=at(iv),l7=at(ta),f7=at(rm),p7=at(nm),h7=at(ra),d7=at(na),y7=at(rm),m7=at(nm);var oa=class{constructor(e={}){this.hashAlgorithm=new H(jn),this.maskGenAlgorithm=new H({algorithm:vo,parameters:q.serialize(jn)}),this.pSourceAlgorithm=new H(om),Object.assign(this,e)}};Ee([u({type:H,context:0,defaultValue:jn})],oa.prototype,"hashAlgorithm",void 0);Ee([u({type:H,context:1,defaultValue:op})],oa.prototype,"maskGenAlgorithm",void 0);Ee([u({type:H,context:2,defaultValue:om})],oa.prototype,"pSourceAlgorithm",void 0);var S7=new H({algorithm:rv,parameters:q.serialize(new oa)});var un=class{constructor(e={}){this.hashAlgorithm=new H(jn),this.maskGenAlgorithm=new H({algorithm:vo,parameters:q.serialize(jn)}),this.saltLength=20,this.trailerField=1,Object.assign(this,e)}};Ee([u({type:H,context:0,defaultValue:jn})],un.prototype,"hashAlgorithm",void 0);Ee([u({type:H,context:1,defaultValue:op})],un.prototype,"maskGenAlgorithm",void 0);Ee([u({type:h.Integer,context:2,defaultValue:20})],un.prototype,"saltLength",void 0);Ee([u({type:h.Integer,context:3,defaultValue:1})],un.prototype,"trailerField",void 0);var P7=new H({algorithm:xo,parameters:q.serialize(new un)});var $i=class{constructor(e={}){this.digestAlgorithm=new H,this.digest=new ae,Object.assign(this,e)}};Ee([u({type:H})],$i.prototype,"digestAlgorithm",void 0);Ee([u({type:ae})],$i.prototype,"digest",void 0);var im,ia=class{constructor(e={}){this.prime=new ArrayBuffer(0),this.exponent=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0),Object.assign(this,e)}};Ee([u({type:h.Integer,converter:me})],ia.prototype,"prime",void 0);Ee([u({type:h.Integer,converter:me})],ia.prototype,"exponent",void 0);Ee([u({type:h.Integer,converter:me})],ia.prototype,"coefficient",void 0);var ip=im=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,im.prototype)}};ip=im=Ee([A({type:_.Sequence,itemType:ia})],ip);var gr=class{constructor(e={}){this.version=0,this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),this.privateExponent=new ArrayBuffer(0),this.prime1=new ArrayBuffer(0),this.prime2=new ArrayBuffer(0),this.exponent1=new ArrayBuffer(0),this.exponent2=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0),Object.assign(this,e)}};Ee([u({type:h.Integer})],gr.prototype,"version",void 0);Ee([u({type:h.Integer,converter:me})],gr.prototype,"modulus",void 0);Ee([u({type:h.Integer,converter:me})],gr.prototype,"publicExponent",void 0);Ee([u({type:h.Integer,converter:me})],gr.prototype,"privateExponent",void 0);Ee([u({type:h.Integer,converter:me})],gr.prototype,"prime1",void 0);Ee([u({type:h.Integer,converter:me})],gr.prototype,"prime2",void 0);Ee([u({type:h.Integer,converter:me})],gr.prototype,"exponent1",void 0);Ee([u({type:h.Integer,converter:me})],gr.prototype,"exponent2",void 0);Ee([u({type:h.Integer,converter:me})],gr.prototype,"coefficient",void 0);Ee([u({type:ip,optional:!0})],gr.prototype,"otherPrimeInfos",void 0);var sa=class{constructor(e={}){this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),Object.assign(this,e)}};Ee([u({type:h.Integer,converter:me})],sa.prototype,"modulus",void 0);Ee([u({type:h.Integer,converter:me})],sa.prototype,"publicExponent",void 0);function gu(r,e,t,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(i=(o<3?s(i):o>3?s(e,t,i):s(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i}var sm;(function(r){r[r.Transient=0]="Transient",r[r.Singleton=1]="Singleton",r[r.ResolutionScoped=2]="ResolutionScoped",r[r.ContainerScoped=3]="ContainerScoped"})(sm||(sm={}));var bt=sm;var kv=$r(Bv(),1),{__extends:ca,__assign:c$,__rest:KC,__decorate:u$,__param:l$,__metadata:f$,__awaiter:Nv,__generator:Dv,__exportStar:p$,__createBinding:h$,__values:wu,__read:bu,__spread:Hr,__spreadArrays:d$,__await:y$,__asyncGenerator:m$,__asyncDelegator:g$,__asyncValues:w$,__makeTemplateObject:b$,__importStar:x$,__importDefault:v$,__classPrivateFieldGet:_$,__classPrivateFieldSet:S$}=kv.default;var HC="injectionTokens";function cm(r){var e=Reflect.getMetadata("design:paramtypes",r)||[],t=Reflect.getOwnMetadata(HC,r)||{};return Object.keys(t).forEach(function(n){e[+n]=t[n]}),e}function xu(r){return!!r.useClass}function ua(r){return!!r.useFactory}var cp=function(){function r(e){this.wrap=e,this.reflectMethods=["get","getPrototypeOf","setPrototypeOf","getOwnPropertyDescriptor","defineProperty","has","set","deleteProperty","apply","construct","ownKeys"]}return r.prototype.createProxy=function(e){var t=this,n={},o=!1,i,s=function(){return o||(i=e(t.wrap()),o=!0),i};return new Proxy(n,this.createHandler(s))},r.prototype.createHandler=function(e){var t={},n=function(o){t[o]=function(){for(var i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];i[0]=e();var a=Reflect[o];return a.apply(void 0,Hr(i))}};return this.reflectMethods.forEach(n),t},r}();function _o(r){return typeof r=="string"||typeof r=="symbol"}function um(r){return typeof r=="object"&&"token"in r&&"multiple"in r}function up(r){return typeof r=="object"&&"token"in r&&"transform"in r}function jv(r){return typeof r=="function"||r instanceof cp}function Fi(r){return!!r.useToken}function Wi(r){return r.useValue!=null}function Rv(r){return xu(r)||Wi(r)||Fi(r)||ua(r)}var VC=function(){function r(){this._registryMap=new Map}return r.prototype.entries=function(){return this._registryMap.entries()},r.prototype.getAll=function(e){return this.ensure(e),this._registryMap.get(e)},r.prototype.get=function(e){this.ensure(e);var t=this._registryMap.get(e);return t[t.length-1]||null},r.prototype.set=function(e,t){this.ensure(e),this._registryMap.get(e).push(t)},r.prototype.setAll=function(e,t){this._registryMap.set(e,t)},r.prototype.has=function(e){return this.ensure(e),this._registryMap.get(e).length>0},r.prototype.clear=function(){this._registryMap.clear()},r.prototype.ensure=function(e){this._registryMap.has(e)||this._registryMap.set(e,[])},r}(),vu=VC;var $C=function(r){ca(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(vu),Lv=$C;var FC=function(){function r(){this.scopedResolutions=new Map}return r}(),_u=FC;function WC(r,e){if(r===null)return"at position #"+e;var t=r.split(",")[e].trim();return'"'+t+'" at position #'+e}function GC(r,e,t){return t===void 0&&(t="    "),Hr([r],e.message.split(`
`).map(function(n){return t+n})).join(`
`)}function lm(r,e,t){var n=bu(r.toString().match(/constructor\(([\w, ]+)\)/)||[],2),o=n[1],i=o===void 0?null:o,s=WC(i,e);return GC("Cannot inject the dependency "+s+' of "'+r.name+'" constructor. Reason:',t)}function Uv(r){if(typeof r.dispose!="function")return!1;var e=r.dispose;return!(e.length>0)}var qC=function(r){ca(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(vu);var zC=function(r){ca(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(vu);var XC=function(){function r(){this.preResolution=new qC,this.postResolution=new zC}return r}(),Mv=XC;var fm=new Map,ZC=function(){function r(e){this.parent=e,this._registry=new Lv,this.interceptors=new Mv,this.disposed=!1,this.disposables=new Set}return r.prototype.register=function(e,t,n){n===void 0&&(n={lifecycle:bt.Transient}),this.ensureNotDisposed();var o;if(Rv(t)?o=t:o={useClass:t},Fi(o))for(var i=[e],s=o;s!=null;){var a=s.useToken;if(i.includes(a))throw new Error("Token registration cycle detected! "+Hr(i,[a]).join(" -> "));i.push(a);var c=this._registry.get(a);c&&Fi(c.provider)?s=c.provider:s=null}if((n.lifecycle===bt.Singleton||n.lifecycle==bt.ContainerScoped||n.lifecycle==bt.ResolutionScoped)&&(Wi(o)||ua(o)))throw new Error('Cannot use lifecycle "'+bt[n.lifecycle]+'" with ValueProviders or FactoryProviders');return this._registry.set(e,{provider:o,options:n}),this},r.prototype.registerType=function(e,t){return this.ensureNotDisposed(),_o(t)?this.register(e,{useToken:t}):this.register(e,{useClass:t})},r.prototype.registerInstance=function(e,t){return this.ensureNotDisposed(),this.register(e,{useValue:t})},r.prototype.registerSingleton=function(e,t){if(this.ensureNotDisposed(),_o(e)){if(_o(t))return this.register(e,{useToken:t},{lifecycle:bt.Singleton});if(t)return this.register(e,{useClass:t},{lifecycle:bt.Singleton});throw new Error('Cannot register a type name as a singleton without a "to" token')}var n=e;return t&&!_o(t)&&(n=t),this.register(e,{useClass:n},{lifecycle:bt.Singleton})},r.prototype.resolve=function(e,t,n){t===void 0&&(t=new _u),n===void 0&&(n=!1),this.ensureNotDisposed();var o=this.getRegistration(e);if(!o&&_o(e)){if(n)return;throw new Error('Attempted to resolve unregistered dependency token: "'+e.toString()+'"')}if(this.executePreResolutionInterceptor(e,"Single"),o){var i=this.resolveRegistration(o,t);return this.executePostResolutionInterceptor(e,i,"Single"),i}if(jv(e)){var i=this.construct(e,t);return this.executePostResolutionInterceptor(e,i,"Single"),i}throw new Error("Attempted to construct an undefined constructor. Could mean a circular dependency problem. Try using `delay` function.")},r.prototype.executePreResolutionInterceptor=function(e,t){var n,o;if(this.interceptors.preResolution.has(e)){var i=[];try{for(var s=wu(this.interceptors.preResolution.getAll(e)),a=s.next();!a.done;a=s.next()){var c=a.value;c.options.frequency!="Once"&&i.push(c),c.callback(e,t)}}catch(l){n={error:l}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(n)throw n.error}}this.interceptors.preResolution.setAll(e,i)}},r.prototype.executePostResolutionInterceptor=function(e,t,n){var o,i;if(this.interceptors.postResolution.has(e)){var s=[];try{for(var a=wu(this.interceptors.postResolution.getAll(e)),c=a.next();!c.done;c=a.next()){var l=c.value;l.options.frequency!="Once"&&s.push(l),l.callback(e,t,n)}}catch(f){o={error:f}}finally{try{c&&!c.done&&(i=a.return)&&i.call(a)}finally{if(o)throw o.error}}this.interceptors.postResolution.setAll(e,s)}},r.prototype.resolveRegistration=function(e,t){if(this.ensureNotDisposed(),e.options.lifecycle===bt.ResolutionScoped&&t.scopedResolutions.has(e))return t.scopedResolutions.get(e);var n=e.options.lifecycle===bt.Singleton,o=e.options.lifecycle===bt.ContainerScoped,i=n||o,s;return Wi(e.provider)?s=e.provider.useValue:Fi(e.provider)?s=i?e.instance||(e.instance=this.resolve(e.provider.useToken,t)):this.resolve(e.provider.useToken,t):xu(e.provider)?s=i?e.instance||(e.instance=this.construct(e.provider.useClass,t)):this.construct(e.provider.useClass,t):ua(e.provider)?s=e.provider.useFactory(this):s=this.construct(e.provider,t),e.options.lifecycle===bt.ResolutionScoped&&t.scopedResolutions.set(e,s),s},r.prototype.resolveAll=function(e,t,n){var o=this;t===void 0&&(t=new _u),n===void 0&&(n=!1),this.ensureNotDisposed();var i=this.getAllRegistrations(e);if(!i&&_o(e)){if(n)return[];throw new Error('Attempted to resolve unregistered dependency token: "'+e.toString()+'"')}if(this.executePreResolutionInterceptor(e,"All"),i){var s=i.map(function(c){return o.resolveRegistration(c,t)});return this.executePostResolutionInterceptor(e,s,"All"),s}var a=[this.construct(e,t)];return this.executePostResolutionInterceptor(e,a,"All"),a},r.prototype.isRegistered=function(e,t){return t===void 0&&(t=!1),this.ensureNotDisposed(),this._registry.has(e)||t&&(this.parent||!1)&&this.parent.isRegistered(e,!0)},r.prototype.reset=function(){this.ensureNotDisposed(),this._registry.clear(),this.interceptors.preResolution.clear(),this.interceptors.postResolution.clear()},r.prototype.clearInstances=function(){var e,t;this.ensureNotDisposed();try{for(var n=wu(this._registry.entries()),o=n.next();!o.done;o=n.next()){var i=bu(o.value,2),s=i[0],a=i[1];this._registry.setAll(s,a.filter(function(c){return!Wi(c.provider)}).map(function(c){return c.instance=void 0,c}))}}catch(c){e={error:c}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},r.prototype.createChildContainer=function(){var e,t;this.ensureNotDisposed();var n=new r(this);try{for(var o=wu(this._registry.entries()),i=o.next();!i.done;i=o.next()){var s=bu(i.value,2),a=s[0],c=s[1];c.some(function(l){var f=l.options;return f.lifecycle===bt.ContainerScoped})&&n._registry.setAll(a,c.map(function(l){return l.options.lifecycle===bt.ContainerScoped?{provider:l.provider,options:l.options}:l}))}}catch(l){e={error:l}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}return n},r.prototype.beforeResolution=function(e,t,n){n===void 0&&(n={frequency:"Always"}),this.interceptors.preResolution.set(e,{callback:t,options:n})},r.prototype.afterResolution=function(e,t,n){n===void 0&&(n={frequency:"Always"}),this.interceptors.postResolution.set(e,{callback:t,options:n})},r.prototype.dispose=function(){return Nv(this,void 0,void 0,function(){var e;return Dv(this,function(t){switch(t.label){case 0:return this.disposed=!0,e=[],this.disposables.forEach(function(n){var o=n.dispose();o&&e.push(o)}),[4,Promise.all(e)];case 1:return t.sent(),[2]}})})},r.prototype.getRegistration=function(e){return this.isRegistered(e)?this._registry.get(e):this.parent?this.parent.getRegistration(e):null},r.prototype.getAllRegistrations=function(e){return this.isRegistered(e)?this._registry.getAll(e):this.parent?this.parent.getAllRegistrations(e):null},r.prototype.construct=function(e,t){var n=this;if(e instanceof cp)return e.createProxy(function(i){return n.resolve(i,t)});var o=function(){var i=fm.get(e);if(!i||i.length===0){if(e.length===0)return new e;throw new Error('TypeInfo not known for "'+e.name+'"')}var s=i.map(n.resolveParams(t,e));return new(e.bind.apply(e,Hr([void 0],s)))}();return Uv(o)&&this.disposables.add(o),o},r.prototype.resolveParams=function(e,t){var n=this;return function(o,i){var s,a,c;try{return um(o)?up(o)?o.multiple?(s=n.resolve(o.transform)).transform.apply(s,Hr([n.resolveAll(o.token,new _u,o.isOptional)],o.transformArgs)):(a=n.resolve(o.transform)).transform.apply(a,Hr([n.resolve(o.token,e,o.isOptional)],o.transformArgs)):o.multiple?n.resolveAll(o.token,new _u,o.isOptional):n.resolve(o.token,e,o.isOptional):up(o)?(c=n.resolve(o.transform,e)).transform.apply(c,Hr([n.resolve(o.token,e)],o.transformArgs)):n.resolve(o,e)}catch(l){throw new Error(lm(t,i,l))}}},r.prototype.ensureNotDisposed=function(){if(this.disposed)throw new Error("This container has been disposed, you cannot interact with a disposed container")},r}(),Le=new ZC;function YC(r){return function(e){fm.set(e,cm(e)),r&&r.token&&(Array.isArray(r.token)?r.token.forEach(function(t){Le.register(t,e)}):Le.register(r.token,e))}}var So=YC;if(typeof Reflect>"u"||!Reflect.getMetadata)throw new Error(`tsyringe requires a reflect polyfill. Please add 'import "reflect-metadata"' to the top of your entry point.`);function _e(r,e,t,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(i=(o<3?s(i):o>3?s(e,t,i):s(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i}function Se(r,e,t,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(i=(o<3?s(i):o>3?s(e,t,i):s(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i}var hm,Gi=class{constructor(e={}){this.attrId="",this.attrValues=[],Object.assign(e)}};Se([u({type:h.ObjectIdentifier})],Gi.prototype,"attrId",void 0);Se([u({type:h.Any,repeated:"set"})],Gi.prototype,"attrValues",void 0);var Kv=hm=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,hm.prototype)}};Kv=hm=Se([A({type:_.Sequence,itemType:Gi})],Kv);var dm,Hv=dm=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,dm.prototype)}};Hv=dm=Se([A({type:_.Sequence,itemType:mr})],Hv);var JC="1.2.840.113549",QC=`${JC}.1`,Vv=`${QC}.12`,la=`${Vv}.1`,RW=`${la}.1`,LW=`${la}.2`,UW=`${la}.3`,MW=`${la}.4`,KW=`${la}.5`,HW=`${la}.6`,qi=`${Vv}.10.1`;var FW=`${qi}.1`,WW=`${qi}.2`,GW=`${qi}.3`,qW=`${qi}.4`,zW=`${qi}.5`,XW=`${qi}.6`,lp="1.2.840.113549.1.9";var fp=class{constructor(e={}){this.certId="",this.certValue=new ArrayBuffer(0),Object.assign(this,e)}};Se([u({type:h.ObjectIdentifier})],fp.prototype,"certId",void 0);Se([u({type:h.Any,context:0})],fp.prototype,"certValue",void 0);var $v=`${lp}.22`,eG=`${$v}.1`,tG=`${$v}.2`;var pp=class{constructor(e={}){this.crlId="",this.crltValue=new ArrayBuffer(0),Object.assign(this,e)}};Se([u({type:h.ObjectIdentifier})],pp.prototype,"crlId",void 0);Se([u({type:h.Any,context:0})],pp.prototype,"crltValue",void 0);var eT=`${lp}.23`,sG=`${eT}.1`;function Rn(r,e,t,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(i=(o<3?s(i):o>3?s(e,t,i):s(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i}var hp=class extends ae{},Ao=class{constructor(e={}){this.encryptionAlgorithm=new H,this.encryptedData=new hp,Object.assign(this,e)}};Rn([u({type:H})],Ao.prototype,"encryptionAlgorithm",void 0);Rn([u({type:hp})],Ao.prototype,"encryptedData",void 0);var ym,mm;(function(r){r[r.v1=0]="v1"})(mm||(mm={}));var dp=class extends ae{},gm=ym=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,ym.prototype)}};gm=ym=Rn([A({type:_.Sequence,itemType:dt})],gm);var Eo=class{constructor(e={}){this.version=mm.v1,this.privateKeyAlgorithm=new H,this.privateKey=new dp,Object.assign(this,e)}};Rn([u({type:h.Integer})],Eo.prototype,"version",void 0);Rn([u({type:H})],Eo.prototype,"privateKeyAlgorithm",void 0);Rn([u({type:dp})],Eo.prototype,"privateKey",void 0);Rn([u({type:gm,implicit:!0,context:0,optional:!0})],Eo.prototype,"attributes",void 0);var Fv=class extends Eo{};Fv=Se([A({type:_.Sequence})],Fv);var Wv=class extends Ao{};Wv=Se([A({type:_.Sequence})],Wv);var yp=class{constructor(e={}){this.secretTypeId="",this.secretValue=new ArrayBuffer(0),Object.assign(this,e)}};Se([u({type:h.ObjectIdentifier})],yp.prototype,"secretTypeId",void 0);Se([u({type:h.Any,context:0})],yp.prototype,"secretValue",void 0);var Co=class{constructor(e={}){this.mac=new $i,this.macSalt=new ae,this.iterations=1,Object.assign(this,e)}};Se([u({type:$i})],Co.prototype,"mac",void 0);Se([u({type:ae})],Co.prototype,"macSalt",void 0);Se([u({type:h.Integer,defaultValue:1})],Co.prototype,"iterations",void 0);var zi=class{constructor(e={}){this.version=3,this.authSafe=new mr,this.macData=new Co,Object.assign(this,e)}};Se([u({type:h.Integer})],zi.prototype,"version",void 0);Se([u({type:mr})],zi.prototype,"authSafe",void 0);Se([u({type:Co,optional:!0})],zi.prototype,"macData",void 0);var wm,fa=class{constructor(e={}){this.bagId="",this.bagValue=new ArrayBuffer(0),Object.assign(this,e)}};Se([u({type:h.ObjectIdentifier})],fa.prototype,"bagId",void 0);Se([u({type:h.Any,context:0})],fa.prototype,"bagValue",void 0);Se([u({type:Gi,repeated:"set",optional:!0})],fa.prototype,"bagAttributes",void 0);var Gv=wm=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,wm.prototype)}};Gv=wm=Se([A({type:_.Sequence,itemType:fa})],Gv);var bm,xm,vm,qe="1.2.840.113549.1.9",uq=`${qe}.0`,s1=`${qe}.24`,Au=`${qe}.25`,a1=`${qe}.26`,c1=`${qe}.27`,lq=`${s1}.1`,fq=`${s1}.2`,pq=`${qe}.1`,hq=`${qe}.2`,dq=`${qe}.3`,yq=`${qe}.4`,mq=`${qe}.5`,gq=`${qe}.6`,Om=`${qe}.7`,wq=`${qe}.8`,bq=`${qe}.9`,xq=`${qe}.13`,Eu=`${qe}.14`,vq=`${qe}.15`,_q=`${qe}.20`,Sq=`${qe}.21`;var Aq=`${Au}.1`,Eq=`${Au}.2`,Cq=`${Au}.3`,Tq=`${Au}.4`,Iq=`${Au}.5`,Cu="1.3.6.1.5.5.7.9",Oq=`${Cu}.1`,Pq=`${Cu}.2`,Bq=`${Cu}.3`,kq=`${Cu}.4`,Nq=`${Cu}.5`,Dq=`${a1}.1`,jq=`${a1}.2`,Rq=`${c1}.1`,Lq=`${c1}.2`,Uq=`${qe}.16`,Mq=`${qe}.22`,Kq=`${qe}.23`,Hq=`${Hy}.65`,mp=class extends et{constructor(e={}){super(e)}toString(){return{}.toString(),this.ia5String||super.toString()}};_e([u({type:h.IA5String})],mp.prototype,"ia5String",void 0);mp=_e([A({type:_.Choice})],mp);var qv=class extends mr{};qv=_e([A({type:_.Sequence})],qv);var zv=class extends zi{};zv=_e([A({type:_.Sequence})],zv);var Xv=class extends Ao{};Xv=_e([A({type:_.Sequence})],Xv);var _m=class{constructor(e=""){this.value=e}toString(){return this.value}};_e([u({type:h.IA5String})],_m.prototype,"value",void 0);_m=_e([A({type:_.Choice})],_m);var Zv=class extends mp{};Zv=_e([A({type:_.Choice})],Zv);var Yv=class extends et{};Yv=_e([A({type:_.Choice})],Yv);var Sm=class{constructor(e=new Date){this.value=e}};_e([u({type:h.GeneralizedTime})],Sm.prototype,"value",void 0);Sm=_e([A({type:_.Choice})],Sm);var Jv=class extends et{};Jv=_e([A({type:_.Choice})],Jv);var Am=class{constructor(e="M"){this.value=e}toString(){return this.value}};_e([u({type:h.PrintableString})],Am.prototype,"value",void 0);Am=_e([A({type:_.Choice})],Am);var gp=class{constructor(e=""){this.value=e}toString(){return this.value}};_e([u({type:h.PrintableString})],gp.prototype,"value",void 0);gp=_e([A({type:_.Choice})],gp);var Qv=class extends gp{};Qv=_e([A({type:_.Choice})],Qv);var e1=class extends et{};e1=_e([A({type:_.Choice})],e1);var Em=class{constructor(e=""){this.value=e}toString(){return this.value}};_e([u({type:h.ObjectIdentifier})],Em.prototype,"value",void 0);Em=_e([A({type:_.Choice})],Em);var t1=class extends Ge{};t1=_e([A({type:_.Choice})],t1);var Cm=class{constructor(e=0){this.value=e}toString(){return this.value.toString()}};_e([u({type:h.Integer})],Cm.prototype,"value",void 0);Cm=_e([A({type:_.Choice})],Cm);var r1=class extends Gt{};r1=_e([A({type:_.Sequence})],r1);var Su=class extends et{};Su=_e([A({type:_.Choice})],Su);var n1=bm=class extends nr{constructor(e){super(e),Object.setPrototypeOf(this,bm.prototype)}};n1=bm=_e([A({type:_.Sequence})],n1);var o1=xm=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,xm.prototype)}};o1=xm=_e([A({type:_.Set,itemType:Kr})],o1);var Tm=class{constructor(e=""){this.value=e}toString(){return this.value}};_e([u({type:h.BmpString})],Tm.prototype,"value",void 0);Tm=_e([A({type:_.Choice})],Tm);var Im=class extends H{};Im=_e([A({type:_.Sequence})],Im);var i1=vm=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,vm.prototype)}};i1=vm=_e([A({type:_.Sequence,itemType:Im})],i1);function Vr(r,e,t,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(i=(o<3?s(i):o>3?s(e,t,i):s(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i}var Pm,Tu=Pm=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,Pm.prototype)}};Tu=Pm=Vr([A({type:_.Sequence,itemType:dt})],Tu);var ln=class{constructor(e={}){this.version=0,this.subject=new Pe,this.subjectPKInfo=new yt,this.attributes=new Tu,Object.assign(this,e)}};Vr([u({type:h.Integer})],ln.prototype,"version",void 0);Vr([u({type:Pe})],ln.prototype,"subject",void 0);Vr([u({type:yt})],ln.prototype,"subjectPKInfo",void 0);Vr([u({type:Tu,implicit:!0,context:0})],ln.prototype,"attributes",void 0);var To=class{constructor(e={}){this.certificationRequestInfo=new ln,this.signatureAlgorithm=new H,this.signature=new ArrayBuffer(0),Object.assign(this,e)}};Vr([u({type:ln})],To.prototype,"certificationRequestInfo",void 0);Vr([u({type:H})],To.prototype,"signatureAlgorithm",void 0);Vr([u({type:h.BitString})],To.prototype,"signature",void 0);var Nu="crypto.algorithm",Km=class{getAlgorithms(){return Le.resolveAll(Nu)}toAsnAlgorithm(e){({...e});for(let t of this.getAlgorithms()){let n=t.toAsnAlgorithm(e);if(n)return n}if(/^[0-9.]+$/.test(e.name)){let t=new H({algorithm:e.name});if("parameters"in e){let n=e;t.parameters=n.parameters}return t}throw new Error("Cannot convert WebCrypto algorithm to ASN.1 algorithm")}toWebAlgorithm(e){for(let n of this.getAlgorithms()){let o=n.toWebAlgorithm(e);if(o)return o}return{name:e.algorithm,parameters:e.parameters}}},Xi="crypto.algorithmProvider";Le.registerSingleton(Xi,Km);var vp,Yt="1.3.36.3.3.2.8.1.1",u1=`${Yt}.1`,l1=`${Yt}.2`,f1=`${Yt}.3`,p1=`${Yt}.4`,h1=`${Yt}.5`,d1=`${Yt}.6`,y1=`${Yt}.7`,m1=`${Yt}.8`,g1=`${Yt}.9`,w1=`${Yt}.10`,b1=`${Yt}.11`,x1=`${Yt}.12`,v1=`${Yt}.13`,_1=`${Yt}.14`,S1="brainpoolP160r1",A1="brainpoolP160t1",E1="brainpoolP192r1",C1="brainpoolP192t1",T1="brainpoolP224r1",I1="brainpoolP224t1",O1="brainpoolP256r1",P1="brainpoolP256t1",B1="brainpoolP320r1",k1="brainpoolP320t1",N1="brainpoolP384r1",D1="brainpoolP384t1",j1="brainpoolP512r1",R1="brainpoolP512t1",$e="ECDSA",Ou=vp=class{toAsnAlgorithm(e){switch(e.name.toLowerCase()){case $e.toLowerCase():if("hash"in e)switch((typeof e.hash=="string"?e.hash:e.hash.name).toLowerCase()){case"sha-1":return Jx;case"sha-256":return Qx;case"sha-384":return ev;case"sha-512":return tv}else if("namedCurve"in e){let t="";switch(e.namedCurve){case"P-256":t=Yy;break;case"K-256":t=vp.SECP256K1;break;case"P-384":t=Jy;break;case"P-521":t=Qy;break;case S1:t=u1;break;case A1:t=l1;break;case E1:t=f1;break;case C1:t=p1;break;case T1:t=h1;break;case I1:t=d1;break;case O1:t=y1;break;case P1:t=m1;break;case B1:t=g1;break;case k1:t=w1;break;case N1:t=b1;break;case D1:t=x1;break;case j1:t=v1;break;case R1:t=_1;break}if(t)return new H({algorithm:Li,parameters:q.serialize(new an({namedCurve:t}))})}}return null}toWebAlgorithm(e){switch(e.algorithm){case fu:return{name:$e,hash:{name:"SHA-1"}};case pu:return{name:$e,hash:{name:"SHA-256"}};case hu:return{name:$e,hash:{name:"SHA-384"}};case du:return{name:$e,hash:{name:"SHA-512"}};case Li:{if(!e.parameters)throw new TypeError("Cannot get required parameters from EC algorithm");switch(q.parse(e.parameters,an).namedCurve){case Yy:return{name:$e,namedCurve:"P-256"};case vp.SECP256K1:return{name:$e,namedCurve:"K-256"};case Jy:return{name:$e,namedCurve:"P-384"};case Qy:return{name:$e,namedCurve:"P-521"};case u1:return{name:$e,namedCurve:S1};case l1:return{name:$e,namedCurve:A1};case f1:return{name:$e,namedCurve:E1};case p1:return{name:$e,namedCurve:C1};case h1:return{name:$e,namedCurve:T1};case d1:return{name:$e,namedCurve:I1};case y1:return{name:$e,namedCurve:O1};case m1:return{name:$e,namedCurve:P1};case g1:return{name:$e,namedCurve:B1};case w1:return{name:$e,namedCurve:k1};case b1:return{name:$e,namedCurve:N1};case x1:return{name:$e,namedCurve:D1};case v1:return{name:$e,namedCurve:j1};case _1:return{name:$e,namedCurve:R1}}}}return null}};Ou.SECP256K1="1.3.132.0.10";Ou=vp=gu([So()],Ou);Le.registerSingleton(Nu,Ou);var q1=Symbol("name"),z1=Symbol("value"),xe=class{constructor(e,t={},n=""){this[q1]=e,this[z1]=n;for(let o in t)this[o]=t[o]}};xe.NAME=q1;xe.VALUE=z1;var Hm=class{static toTextObject(e){let t=new xe("Algorithm Identifier",{},pn.toString(e.algorithm));if(e.parameters)switch(e.algorithm){case Li:{let n=new Ou().toWebAlgorithm(e);n&&"namedCurve"in n?t["Named Curve"]=n.namedCurve:t.Parameters=e.parameters;break}default:t.Parameters=e.parameters}return t}},pn=class{static toString(e){let t=this.items[e];return t||e}};pn.items={[Mi]:"sha1",[np]:"sha224",[Ki]:"sha256",[Hi]:"sha384",[Vi]:"sha512",[cn]:"rsaEncryption",[ta]:"sha1WithRSAEncryption",[sv]:"sha224WithRSAEncryption",[rp]:"sha256WithRSAEncryption",[ra]:"sha384WithRSAEncryption",[na]:"sha512WithRSAEncryption",[Li]:"ecPublicKey",[fu]:"ecdsaWithSHA1",[tp]:"ecdsaWithSHA224",[pu]:"ecdsaWithSHA256",[hu]:"ecdsaWithSHA384",[du]:"ecdsaWithSHA512",[kx]:"TLS WWW server authentication",[Nx]:"TLS WWW client authentication",[Dx]:"Code Signing",[jx]:"E-mail Protection",[Rx]:"Time Stamping",[Lx]:"OCSP Signing",[Zx]:"Signed Data"};var Un=class{static serialize(e){return this.serializeObj(e).join(`
`)}static pad(e=0){return"".padStart(2*e," ")}static serializeObj(e,t=0){let n=[],o=this.pad(t++),i="",s=e[xe.VALUE];s&&(i=` ${s}`),n.push(`${o}${e[xe.NAME]}:${i}`),o=this.pad(t);for(let a in e){if(typeof a=="symbol")continue;let c=e[a],l=a?`${a}: `:"";if(typeof c=="string"||typeof c=="number"||typeof c=="boolean")n.push(`${o}${l}${c}`);else if(c instanceof Date)n.push(`${o}${l}${c.toUTCString()}`);else if(Array.isArray(c))for(let f of c)f[xe.NAME]=a,n.push(...this.serializeObj(f,t));else if(c instanceof xe)c[xe.NAME]=a,n.push(...this.serializeObj(c,t));else if($.BufferSourceConverter.isBufferSource(c))a?(n.push(`${o}${l}`),n.push(...this.serializeBufferSource(c,t+1))):n.push(...this.serializeBufferSource(c,t));else if("toTextObject"in c){let f=c.toTextObject();f[xe.NAME]=a,n.push(...this.serializeObj(f,t))}else throw new TypeError("Cannot serialize data in text format. Unsupported type.")}return n}static serializeBufferSource(e,t=0){let n=this.pad(t),o=$.BufferSourceConverter.toUint8Array(e),i=[];for(let s=0;s<o.length;){let a=[];for(let c=0;c<16&&s<o.length;c++){c===8&&a.push("");let l=o[s++].toString(16).padStart(2,"0");a.push(l)}i.push(`${n}${a.join(" ")}`)}return i}static serializeAlgorithm(e){return this.algorithmSerializer.toTextObject(e)}};Un.oidSerializer=pn;Un.algorithmSerializer=Hm;var Io=class r{constructor(...e){if(e.length===1){let t=e[0];this.rawData=q.serialize(t),this.onInit(t)}else{let t=q.parse(e[0],e[1]);this.rawData=$.BufferSourceConverter.toArrayBuffer(e[0]),this.onInit(t)}}equal(e){return e instanceof r?(0,$.isEqual)(e.rawData,this.rawData):!1}toString(e="text"){switch(e){case"asn":return q.toString(this.rawData);case"text":return Un.serialize(this.toTextObject());case"hex":return $.Convert.ToHex(this.rawData);case"base64":return $.Convert.ToBase64(this.rawData);case"base64url":return $.Convert.ToBase64Url(this.rawData);default:throw TypeError("Argument 'format' is unsupported value")}}getTextName(){return this.constructor.NAME}toTextObject(){let e=this.toTextObjectEmpty();return e[""]=this.rawData,e}toTextObjectEmpty(e){return new xe(this.getTextName(),{},e)}};Io.NAME="ASN";var br=class r extends Io{constructor(...e){let t;$.BufferSourceConverter.isBufferSource(e[0])?t=$.BufferSourceConverter.toArrayBuffer(e[0]):t=q.serialize(new mt({extnID:e[0],critical:e[1],extnValue:new ae($.BufferSourceConverter.toArrayBuffer(e[2]))})),super(t,mt)}onInit(e){this.type=e.extnID,this.critical=e.critical,this.value=e.extnValue.buffer}toTextObject(){let e=this.toTextObjectWithoutValue();return e[""]=this.value,e}toTextObjectWithoutValue(){let e=this.toTextObjectEmpty(this.critical?"critical":void 0);return e[xe.NAME]===r.NAME&&(e[xe.NAME]=pn.toString(this.type)),e}},X1,Pu=class r{static isCryptoKeyPair(e){return e&&e.privateKey&&e.publicKey}static isCryptoKey(e){return e&&e.usages&&e.type&&e.algorithm&&e.extractable!==void 0}constructor(){this.items=new Map,this[X1]="CryptoProvider",typeof self<"u"&&typeof crypto<"u"?this.set(r.DEFAULT,crypto):typeof globalThis<"u"&&globalThis.crypto&&globalThis.crypto.subtle&&this.set(r.DEFAULT,globalThis.crypto)}clear(){this.items.clear()}delete(e){return this.items.delete(e)}forEach(e,t){return this.items.forEach(e,t)}has(e){return this.items.has(e)}get size(){return this.items.size}entries(){return this.items.entries()}keys(){return this.items.keys()}values(){return this.items.values()}[Symbol.iterator](){return this.items[Symbol.iterator]()}get(e=r.DEFAULT){let t=this.items.get(e.toLowerCase());if(!t)throw new Error(`Cannot get Crypto by name '${e}'`);return t}set(e,t){if(typeof e=="string"){if(!t)throw new TypeError("Argument 'value' is required");this.items.set(e.toLowerCase(),t)}else this.items.set(r.DEFAULT,e);return this}};X1=Symbol.toStringTag;Pu.DEFAULT="default";var xt=new Pu,oT=/^[0-2](?:\.[1-9][0-9]*)+$/;function iT(r){return new RegExp(oT).test(r)}var Sp=class{constructor(e={}){this.items={};for(let t in e)this.register(t,e[t])}get(e){return this.items[e]||null}findId(e){return iT(e)?e:this.get(e)}register(e,t){this.items[e]=t,this.items[t]=e}},Xt=new Sp;Xt.register("CN","2.5.4.3");Xt.register("L","2.5.4.7");Xt.register("ST","2.5.4.8");Xt.register("O","2.5.4.10");Xt.register("OU","2.5.4.11");Xt.register("C","2.5.4.6");Xt.register("DC","0.9.2342.19200300.100.1.25");Xt.register("E","1.2.840.113549.1.9.1");Xt.register("G","2.5.4.42");Xt.register("I","2.5.4.43");Xt.register("SN","2.5.4.4");Xt.register("T","2.5.4.12");function sT(r,e){return`\\${$.Convert.ToHex($.Convert.FromUtf8String(e)).toUpperCase()}`}function aT(r){return r.replace(/([,+"\\<>;])/g,"\\$1").replace(/^([ #])/,"\\$1").replace(/([ ]$)/,"\\$1").replace(/([\r\n\t])/,sT)}var wr=class r{static isASCII(e){for(let t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return!1;return!0}static isPrintableString(e){return/^[A-Za-z0-9 '()+,-./:=?]*$/g.test(e)}constructor(e,t={}){this.extraNames=new Sp,this.asn=new Pe;for(let n in t)if(Object.prototype.hasOwnProperty.call(t,n)){let o=t[n];this.extraNames.register(n,o)}typeof e=="string"?this.asn=this.fromString(e):e instanceof Pe?this.asn=e:$.BufferSourceConverter.isBufferSource(e)?this.asn=q.parse(e,Pe):this.asn=this.fromJSON(e)}getField(e){let t=this.extraNames.findId(e)||Xt.findId(e),n=[];for(let o of this.asn)for(let i of o)i.type===t&&n.push(i.value.toString());return n}getName(e){return this.extraNames.get(e)||Xt.get(e)}toString(){return this.asn.map(e=>e.map(t=>{let n=this.getName(t.type)||t.type,o=t.value.anyValue?`#${$.Convert.ToHex(t.value.anyValue)}`:aT(t.value.toString());return`${n}=${o}`}).join("+")).join(", ")}toJSON(){var e;let t=[];for(let n of this.asn){let o={};for(let i of n){let s=this.getName(i.type)||i.type;(e=o[s])!==null&&e!==void 0||(o[s]=[]),o[s].push(i.value.anyValue?`#${$.Convert.ToHex(i.value.anyValue)}`:i.value.toString())}t.push(o)}return t}fromString(e){let t=new Pe,n=/(\d\.[\d.]*\d|[A-Za-z]+)=((?:"")|(?:".*?[^\\]")|(?:[^,+"\\](?=[,+]|$))|(?:[^,+].*?(?:[^\\][,+]))|(?:))([,+])?/g,o=null,i=",";for(;o=n.exec(`${e},`);){let[,s,a]=o,c=a[a.length-1];(c===","||c==="+")&&(a=a.slice(0,a.length-1),o[3]=c);let l=o[3];s=this.getTypeOid(s);let f=this.createAttribute(s,a);i==="+"?t[t.length-1].push(f):t.push(new co([f])),i=l}return t}fromJSON(e){let t=new Pe;for(let n of e){let o=new co;for(let i in n){let s=this.getTypeOid(i),a=n[i];for(let c of a){let l=this.createAttribute(s,c);o.push(l)}}t.push(o)}return t}getTypeOid(e){if(/[\d.]+/.test(e)||(e=this.getName(e)||""),!e)throw new Error(`Cannot get OID for name type '${e}'`);return e}createAttribute(e,t){let n=new gi({type:e});if(typeof t=="object")for(let o in t)switch(o){case"ia5String":n.value.ia5String=t[o];break;case"utf8String":n.value.utf8String=t[o];break;case"universalString":n.value.universalString=t[o];break;case"bmpString":n.value.bmpString=t[o];break;case"printableString":n.value.printableString=t[o];break}else if(t[0]==="#")n.value.anyValue=$.Convert.FromHex(t.slice(1));else{let o=this.processStringValue(t);e===this.getName("E")||e===this.getName("DC")?n.value.ia5String=o:r.isPrintableString(o)?n.value.printableString=o:n.value.utf8String=o}return n}processStringValue(e){let t=/"(.*?[^\\])?"/.exec(e);return t&&(e=t[1]),e.replace(/\\0a/ig,`
`).replace(/\\0d/ig,"\r").replace(/\\0g/ig,"	").replace(/\\(.)/g,"$1")}toArrayBuffer(){return q.serialize(this.asn)}async getThumbprint(...e){var t;let n,o="SHA-1";return e.length>=1&&!(!((t=e[0])===null||t===void 0)&&t.subtle)?(o=e[0]||o,n=e[1]||xt.get()):n=e[0]||xt.get(),await n.subtle.digest(o,this.toArrayBuffer())}},Z1="Cannot initialize GeneralName from ASN.1 data.",L1=`${Z1} Unsupported string format in use.`,cT=`${Z1} Value doesn't match to GUID regular expression.`,U1=/^([0-9a-f]{8})-?([0-9a-f]{4})-?([0-9a-f]{4})-?([0-9a-f]{4})-?([0-9a-f]{12})$/i,M1="1.3.6.1.4.1.311.25.1",K1="1.3.6.1.4.1.311.20.2.3",Bm="dns",km="dn",Nm="email",Dm="ip",jm="url",Rm="guid",Lm="upn",wp="id",fn=class extends Io{constructor(...e){let t;if(e.length===2)switch(e[0]){case km:{let n=new wr(e[1]).toArrayBuffer(),o=q.parse(n,Pe);t=new ue({directoryName:o});break}case Bm:t=new ue({dNSName:e[1]});break;case Nm:t=new ue({rfc822Name:e[1]});break;case Rm:{let n=new RegExp(U1,"i").exec(e[1]);if(!n)throw new Error("Cannot parse GUID value. Value doesn't match to regular expression");let o=n.slice(1).map((i,s)=>s<3?$.Convert.ToHex(new Uint8Array($.Convert.FromHex(i)).reverse()):i).join("");t=new ue({otherName:new uo({typeId:M1,value:q.serialize(new ae($.Convert.FromHex(o)))})});break}case Dm:t=new ue({iPAddress:e[1]});break;case wp:t=new ue({registeredID:e[1]});break;case Lm:{t=new ue({otherName:new uo({typeId:K1,value:q.serialize(cy.toASN(e[1]))})});break}case jm:t=new ue({uniformResourceIdentifier:e[1]});break;default:throw new Error("Cannot create GeneralName. Unsupported type of the name")}else $.BufferSourceConverter.isBufferSource(e[0])?t=q.parse(e[0],ue):t=e[0];super(t)}onInit(e){if(e.dNSName!=null)this.type=Bm,this.value=e.dNSName;else if(e.rfc822Name!=null)this.type=Nm,this.value=e.rfc822Name;else if(e.iPAddress!=null)this.type=Dm,this.value=e.iPAddress;else if(e.uniformResourceIdentifier!=null)this.type=jm,this.value=e.uniformResourceIdentifier;else if(e.registeredID!=null)this.type=wp,this.value=e.registeredID;else if(e.directoryName!=null)this.type=km,this.value=new wr(e.directoryName).toString();else if(e.otherName!=null)if(e.otherName.typeId===M1){this.type=Rm;let t=q.parse(e.otherName.value,ae),n=new RegExp(U1,"i").exec($.Convert.ToHex(t));if(!n)throw new Error(cT);this.value=n.slice(1).map((o,i)=>i<3?$.Convert.ToHex(new Uint8Array($.Convert.FromHex(o)).reverse()):o).join("-")}else if(e.otherName.typeId===K1)this.type=Lm,this.value=q.parse(e.otherName.value,et).toString();else throw new Error(L1);else throw new Error(L1)}toJSON(){return{type:this.type,value:this.value}}toTextObject(){let e;switch(this.type){case km:case Bm:case Rm:case Dm:case wp:case Lm:case jm:e=this.type.toUpperCase();break;case Nm:e="Email";break;default:throw new Error("Unsupported GeneralName type")}let t=this.value;return this.type===wp&&(t=pn.toString(t)),new xe(e,void 0,t)}},Zi=class extends Io{constructor(e){let t;if(e instanceof He)t=e;else if(Array.isArray(e)){let n=[];for(let o of e)if(o instanceof ue)n.push(o);else{let i=q.parse(new fn(o.type,o.value).rawData,ue);n.push(i)}t=new He(n)}else if($.BufferSourceConverter.isBufferSource(e))t=q.parse(e,He);else throw new Error("Cannot initialize GeneralNames. Incorrect incoming arguments");super(t)}onInit(e){let t=[];for(let n of e){let o=null;try{o=new fn(n)}catch{continue}t.push(o)}this.items=t}toJSON(){return this.items.map(e=>e.toJSON())}toTextObject(){let e=super.toTextObjectEmpty();for(let t of this.items){let n=t.toTextObject(),o=e[n[xe.NAME]];Array.isArray(o)||(o=[],e[n[xe.NAME]]=o),o.push(n)}return e}};Zi.NAME="GeneralNames";var Iu="-{5}",Bu="\\n",uT=`[^${Bu}]+`,lT=`${Iu}BEGIN (${uT}(?=${Iu}))${Iu}`,fT=`${Iu}END \\1${Iu}`,pa="\\n",pT=`[^:${Bu}]+`,hT=`(?:[^${Bu}]+${pa}(?: +[^${Bu}]+${pa})*)`,dT="[a-zA-Z0-9=+/]+",yT=`(?:${dT}${pa})+`,H1=`${lT}${pa}(?:((?:${pT}: ${hT})+))?${pa}?(${yT})${fT}`,Lt=class{static isPem(e){return typeof e=="string"&&new RegExp(H1,"g").test(e.replace(/\r/g,""))}static decodeWithHeaders(e){e=e.replace(/\r/g,"");let t=new RegExp(H1,"g"),n=[],o=null;for(;o=t.exec(e);){let i=o[3].replace(new RegExp(`[${Bu}]+`,"g"),""),s={type:o[1],headers:[],rawData:$.Convert.FromBase64(i)},a=o[2];if(a){let c=a.split(new RegExp(pa,"g")),l=null;for(let f of c){let[p,y]=f.split(/:(.*)/);if(y===void 0){if(!l)throw new Error("Cannot parse PEM string. Incorrect header value");l.value+=p.trim()}else l&&s.headers.push(l),l={key:p,value:y.trim()}}l&&s.headers.push(l)}n.push(s)}return n}static decode(e){return this.decodeWithHeaders(e).map(n=>n.rawData)}static decodeFirst(e){let t=this.decode(e);if(!t.length)throw new RangeError("PEM string doesn't contain any objects");return t[0]}static encode(e,t){if(Array.isArray(e)){let n=new Array;return t?e.forEach(o=>{if(!$.BufferSourceConverter.isBufferSource(o))throw new TypeError("Cannot encode array of BufferSource in PEM format. Not all items of the array are BufferSource");n.push(this.encodeStruct({type:t,rawData:$.BufferSourceConverter.toArrayBuffer(o)}))}):e.forEach(o=>{if(!("type"in o))throw new TypeError("Cannot encode array of PemStruct in PEM format. Not all items of the array are PemStrut");n.push(this.encodeStruct(o))}),n.join(`
`)}else{if(!t)throw new Error("Required argument 'tag' is missed");return this.encodeStruct({type:t,rawData:$.BufferSourceConverter.toArrayBuffer(e)})}}static encodeStruct(e){var t;let n=e.type.toLocaleUpperCase(),o=[];if(o.push(`-----BEGIN ${n}-----`),!((t=e.headers)===null||t===void 0)&&t.length){for(let l of e.headers)o.push(`${l.key}: ${l.value}`);o.push("")}let i=$.Convert.ToBase64(e.rawData),s,a=0,c=Array();for(;a<i.length&&(i.length-a<64?s=i.substring(a):(s=i.substring(a,a+64),a+=64),s.length!==0);)if(c.push(s),s.length<64)break;return o.push(...c),o.push(`-----END ${n}-----`),o.join(`
`)}};Lt.CertificateTag="CERTIFICATE";Lt.CrlTag="CRL";Lt.CertificateRequestTag="CERTIFICATE REQUEST";Lt.PublicKeyTag="PUBLIC KEY";Lt.PrivateKeyTag="PRIVATE KEY";var Oo=class r extends Io{static isAsnEncoded(e){return $.BufferSourceConverter.isBufferSource(e)||typeof e=="string"}static toArrayBuffer(e){if(typeof e=="string"){if(Lt.isPem(e))return Lt.decode(e)[0];if($.Convert.isHex(e))return $.Convert.FromHex(e);if($.Convert.isBase64(e))return $.Convert.FromBase64(e);if($.Convert.isBase64Url(e))return $.Convert.FromBase64Url(e);throw new TypeError("Unsupported format of 'raw' argument. Must be one of DER, PEM, HEX, Base64, or Base4Url")}else{let t=$.Convert.ToBinary(e);return Lt.isPem(t)?Lt.decode(t)[0]:$.Convert.isHex(t)?$.Convert.FromHex(t):$.Convert.isBase64(t)?$.Convert.FromBase64(t):$.Convert.isBase64Url(t)?$.Convert.FromBase64Url(t):$.BufferSourceConverter.toArrayBuffer(e)}}constructor(...e){r.isAsnEncoded(e[0])?super(r.toArrayBuffer(e[0]),e[1]):super(e[0])}toString(e="pem"){switch(e){case"pem":return Lt.encode(this.rawData,this.tag);default:return super.toString(e)}}},Ln=class r extends Oo{static async create(e,t=xt.get()){if(e instanceof r)return e;if(Pu.isCryptoKey(e)){if(e.type!=="public")throw new TypeError("Public key is required");let n=await t.subtle.exportKey("spki",e);return new r(n)}else{if(e.publicKey)return e.publicKey;if($.BufferSourceConverter.isBufferSource(e))return new r(e);throw new TypeError("Unsupported PublicKeyType")}}constructor(e){Oo.isAsnEncoded(e)?super(e,yt):super(e),this.tag=Lt.PublicKeyTag}async export(...e){let t,n=["verify"],o={hash:"SHA-256",...this.algorithm};e.length>1?(o=e[0]||o,n=e[1]||n,t=e[2]||xt.get()):t=e[0]||xt.get();let i=this.rawData,s=q.parse(this.rawData,yt);return s.algorithm.algorithm===xo&&(i=mT(s,i)),t.subtle.importKey("spki",i,o,!0,n)}onInit(e){let t=Le.resolve(Xi),n=this.algorithm=t.toWebAlgorithm(e.algorithm);switch(e.algorithm.algorithm){case cn:{let o=q.parse(e.subjectPublicKey,sa),i=$.BufferSourceConverter.toUint8Array(o.modulus);n.publicExponent=$.BufferSourceConverter.toUint8Array(o.publicExponent),n.modulusLength=(i[0]?i:i.slice(1)).byteLength<<3;break}}}async getThumbprint(...e){var t;let n,o="SHA-1";return e.length>=1&&!(!((t=e[0])===null||t===void 0)&&t.subtle)?(o=e[0]||o,n=e[1]||xt.get()):n=e[0]||xt.get(),await n.subtle.digest(o,this.rawData)}async getKeyIdentifier(...e){let t,n="SHA-1";e.length===1?typeof e[0]=="string"?(n=e[0],t=xt.get()):t=e[0]:e.length===2?(n=e[0],t=e[1]):t=xt.get();let o=q.parse(this.rawData,yt);return await t.subtle.digest(n,o.subjectPublicKey)}toTextObject(){let e=this.toTextObjectEmpty(),t=q.parse(this.rawData,yt);switch(e.Algorithm=Un.serializeAlgorithm(t.algorithm),t.algorithm.algorithm){case Li:e["EC Point"]=t.subjectPublicKey;break;case cn:default:e["Raw Data"]=t.subjectPublicKey}return e}};function mT(r,e){return r.algorithm=new H({algorithm:cn,parameters:null}),e=q.serialize(r),e}var Ap=class r extends br{static async create(e,t=!1,n=xt.get()){if("name"in e&&"serialNumber"in e)return new r(e,t);let i=await(await Ln.create(e,n)).getKeyIdentifier(n);return new r($.Convert.ToHex(i),t)}constructor(...e){if($.BufferSourceConverter.isBufferSource(e[0]))super(e[0]);else if(typeof e[0]=="string"){let t=new rn({keyIdentifier:new xi($.Convert.FromHex(e[0]))});super(Df,e[1],q.serialize(t))}else{let t=e[0],n=t.name instanceof Zi?q.parse(t.name.rawData,He):t.name,o=new rn({authorityCertIssuer:n,authorityCertSerialNumber:$.Convert.FromHex(t.serialNumber)});super(Df,e[1],q.serialize(o))}}onInit(e){super.onInit(e);let t=q.parse(e.extnValue,rn);t.keyIdentifier&&(this.keyId=$.Convert.ToHex(t.keyIdentifier)),(t.authorityCertIssuer||t.authorityCertSerialNumber)&&(this.certId={name:t.authorityCertIssuer||[],serialNumber:t.authorityCertSerialNumber?$.Convert.ToHex(t.authorityCertSerialNumber):""})}toTextObject(){let e=this.toTextObjectWithoutValue(),t=q.parse(this.value,rn);return t.authorityCertIssuer&&(e["Authority Issuer"]=new Zi(t.authorityCertIssuer).toTextObject()),t.authorityCertSerialNumber&&(e["Authority Serial Number"]=t.authorityCertSerialNumber),t.keyIdentifier&&(e[""]=t.keyIdentifier),e}};Ap.NAME="Authority Key Identifier";var ha=class extends br{constructor(...e){if($.BufferSourceConverter.isBufferSource(e[0])){super(e[0]);let t=q.parse(this.value,vi);this.ca=t.cA,this.pathLength=t.pathLenConstraint}else{let t=new vi({cA:e[0],pathLenConstraint:e[1]});super(jf,e[2],q.serialize(t)),this.ca=e[0],this.pathLength=e[1]}}toTextObject(){let e=this.toTextObjectWithoutValue();return this.ca&&(e.CA=this.ca),this.pathLength!==void 0&&(e["Path Length"]=this.pathLength),e}};ha.NAME="Basic Constraints";var V1;(function(r){r.serverAuth="1.3.6.1.5.5.7.3.1",r.clientAuth="1.3.6.1.5.5.7.3.2",r.codeSigning="1.3.6.1.5.5.7.3.3",r.emailProtection="1.3.6.1.5.5.7.3.4",r.timeStamping="1.3.6.1.5.5.7.3.8",r.ocspSigning="1.3.6.1.5.5.7.3.9"})(V1||(V1={}));var Ep=class extends br{constructor(...e){if($.BufferSourceConverter.isBufferSource(e[0])){super(e[0]);let t=q.parse(this.value,Gc);this.usages=t.map(n=>n)}else{let t=new Gc(e[0]);super(Mf,e[1],q.serialize(t)),this.usages=e[0]}}toTextObject(){let e=this.toTextObjectWithoutValue();return e[""]=this.usages.map(t=>pn.toString(t)).join(", "),e}};Ep.NAME="Extended Key Usages";var $1;(function(r){r[r.digitalSignature=1]="digitalSignature",r[r.nonRepudiation=2]="nonRepudiation",r[r.keyEncipherment=4]="keyEncipherment",r[r.dataEncipherment=8]="dataEncipherment",r[r.keyAgreement=16]="keyAgreement",r[r.keyCertSign=32]="keyCertSign",r[r.cRLSign=64]="cRLSign",r[r.encipherOnly=128]="encipherOnly",r[r.decipherOnly=256]="decipherOnly"})($1||($1={}));var Cp=class extends br{constructor(...e){if($.BufferSourceConverter.isBufferSource(e[0])){super(e[0]);let t=q.parse(this.value,Us);this.usages=t.toNumber()}else{let t=new Us(e[0]);super(Kf,e[1],q.serialize(t)),this.usages=e[0]}}toTextObject(){let e=this.toTextObjectWithoutValue(),t=q.parse(this.value,Us);return e[""]=t.toJSON().join(", "),e}};Cp.NAME="Key Usages";var Tp=class r extends br{static async create(e,t=!1,n=xt.get()){let i=await(await Ln.create(e,n)).getKeyIdentifier(n);return new r($.Convert.ToHex(i),t)}constructor(...e){if($.BufferSourceConverter.isBufferSource(e[0])){super(e[0]);let t=q.parse(this.value,Ft);this.keyId=$.Convert.ToHex(t)}else{let t=typeof e[0]=="string"?$.Convert.FromHex(e[0]):e[0],n=new Ft(t);super(Dy,e[1],q.serialize(n)),this.keyId=$.Convert.ToHex(t)}}toTextObject(){let e=this.toTextObjectWithoutValue(),t=q.parse(this.value,Ft);return e[""]=t,e}};Tp.NAME="Subject Key Identifier";var Ip=class extends br{constructor(...e){$.BufferSourceConverter.isBufferSource(e[0])?super(e[0]):super(ky,e[1],new Zi(e[0]||[]).rawData)}onInit(e){super.onInit(e);let t=q.parse(e.extnValue,Ff);this.names=new Zi(t)}toTextObject(){let e=this.toTextObjectWithoutValue(),t=this.names.toTextObject();for(let n in t)e[n]=t[n];return e}};Ip.NAME="Subject Alternative Name";var Zt=class{static register(e,t){this.items.set(e,t)}static create(e){let t=new br(e),n=this.items.get(t.type);return n?new n(e):t}};Zt.items=new Map;var Op=class extends br{constructor(...e){var t;if($.BufferSourceConverter.isBufferSource(e[0])){super(e[0]);let n=q.parse(this.value,Hc);this.policies=n.map(o=>o.policyIdentifier)}else{let n=e[0],o=(t=e[1])!==null&&t!==void 0?t:!1,i=new Hc(n.map(s=>new _i({policyIdentifier:s})));super(Lf,o,q.serialize(i)),this.policies=n}}toTextObject(){let e=this.toTextObjectWithoutValue();return e.Policy=this.policies.map(t=>new xe("",{},pn.toString(t))),e}};Op.NAME="Certificate Policies";Zt.register(Lf,Op);var Pp=class extends br{constructor(...e){var t;if($.BufferSourceConverter.isBufferSource(e[0]))super(e[0]);else if(Array.isArray(e[0])&&typeof e[0][0]=="string"){let o=e[0].map(s=>new nn({distributionPoint:new Pn({fullName:[new ue({uniformResourceIdentifier:s})]})})),i=new po(o);super(Uf,e[1],q.serialize(i))}else{let n=new po(e[0]);super(Uf,e[1],q.serialize(n))}(t=this.distributionPoints)!==null&&t!==void 0||(this.distributionPoints=[])}onInit(e){super.onInit(e);let t=q.parse(e.extnValue,po);this.distributionPoints=t}toTextObject(){let e=this.toTextObjectWithoutValue();return e["Distribution Point"]=this.distributionPoints.map(t=>{var n;let o={};return t.distributionPoint&&(o[""]=(n=t.distributionPoint.fullName)===null||n===void 0?void 0:n.map(i=>new fn(i).toString()).join(", ")),t.reasons&&(o.Reasons=t.reasons.toString()),t.cRLIssuer&&(o["CRL Issuer"]=t.cRLIssuer.map(i=>i.toString()).join(", ")),o}),e}};Pp.NAME="CRL Distribution Points";var Bp=class extends br{constructor(...e){var t,n,o,i;if($.BufferSourceConverter.isBufferSource(e[0]))super(e[0]);else if(e[0]instanceof bi){let s=new bi(e[0]);super(Nf,e[1],q.serialize(s))}else{let s=e[0],a=new bi;xp(a,s,my,"ocsp"),xp(a,s,gy,"caIssuers"),xp(a,s,wy,"timeStamping"),xp(a,s,by,"caRepository"),super(Nf,e[1],q.serialize(a))}(t=this.ocsp)!==null&&t!==void 0||(this.ocsp=[]),(n=this.caIssuers)!==null&&n!==void 0||(this.caIssuers=[]),(o=this.timeStamping)!==null&&o!==void 0||(this.timeStamping=[]),(i=this.caRepository)!==null&&i!==void 0||(this.caRepository=[])}onInit(e){super.onInit(e),this.ocsp=[],this.caIssuers=[],this.timeStamping=[],this.caRepository=[],q.parse(e.extnValue,bi).forEach(n=>{switch(n.accessMethod){case my:this.ocsp.push(new fn(n.accessLocation));break;case gy:this.caIssuers.push(new fn(n.accessLocation));break;case wy:this.timeStamping.push(new fn(n.accessLocation));break;case by:this.caRepository.push(new fn(n.accessLocation));break}})}toTextObject(){let e=this.toTextObjectWithoutValue();return this.ocsp.length&&bp(e,"OCSP",this.ocsp),this.caIssuers.length&&bp(e,"CA Issuers",this.caIssuers),this.timeStamping.length&&bp(e,"Time Stamping",this.timeStamping),this.caRepository.length&&bp(e,"CA Repository",this.caRepository),e}};Bp.NAME="Authority Info Access";function bp(r,e,t){if(t.length===1)r[e]=t[0].toTextObject();else{let n=new xe("");t.forEach((o,i)=>{let s=o.toTextObject(),a=`${s[xe.NAME]} ${i+1}`,c=n[a];Array.isArray(c)||(c=[],n[a]=c),c.push(s)}),r[e]=n}}function xp(r,e,t,n){let o=e[n];o&&(Array.isArray(o)?o:[o]).forEach(s=>{typeof s=="string"&&(s=new fn("url",s)),r.push(new In({accessMethod:t,accessLocation:q.parse(s.rawData,ue)}))})}var da=class r extends Io{constructor(...e){let t;if($.BufferSourceConverter.isBufferSource(e[0]))t=$.BufferSourceConverter.toArrayBuffer(e[0]);else{let n=e[0],o=Array.isArray(e[1])?e[1].map(i=>$.BufferSourceConverter.toArrayBuffer(i)):[];t=q.serialize(new dt({type:n,values:o}))}super(t,dt)}onInit(e){this.type=e.type,this.values=e.values}toTextObject(){let e=this.toTextObjectWithoutValue();return e.Value=this.values.map(t=>new xe("",{"":t})),e}toTextObjectWithoutValue(){let e=this.toTextObjectEmpty();return e[xe.NAME]===r.NAME&&(e[xe.NAME]=pn.toString(this.type)),e}};da.NAME="Attribute";var kp=class extends da{constructor(...e){var t;if($.BufferSourceConverter.isBufferSource(e[0]))super(e[0]);else{let n=new Su({printableString:e[0]});super(Om,[q.serialize(n)])}(t=this.password)!==null&&t!==void 0||(this.password="")}onInit(e){if(super.onInit(e),this.values[0]){let t=q.parse(this.values[0],Su);this.password=t.toString()}}toTextObject(){let e=this.toTextObjectWithoutValue();return e[xe.VALUE]=this.password,e}};kp.NAME="Challenge Password";var ku=class extends da{constructor(...e){var t;if($.BufferSourceConverter.isBufferSource(e[0]))super(e[0]);else{let n=e[0],o=new nr;for(let i of n)o.push(q.parse(i.rawData,mt));super(Eu,[q.serialize(o)])}(t=this.items)!==null&&t!==void 0||(this.items=[])}onInit(e){if(super.onInit(e),this.values[0]){let t=q.parse(this.values[0],nr);this.items=t.map(n=>Zt.create(q.serialize(n)))}}toTextObject(){let e=this.toTextObjectWithoutValue(),t=this.items.map(n=>n.toTextObject());for(let n of t)e[n[xe.NAME]]=n;return e}};ku.NAME="Extensions";var ya=class{static register(e,t){this.items.set(e,t)}static create(e){let t=new da(e),n=this.items.get(t.type);return n?new n(e):t}};ya.items=new Map;var Du="crypto.signatureFormatter",Vm=class{toAsnSignature(e,t){return $.BufferSourceConverter.toArrayBuffer(t)}toWebSignature(e,t){return $.BufferSourceConverter.toArrayBuffer(t)}},_p,$m=_p=class{static createPssParams(e,t){let n=_p.getHashAlgorithm(e);return n?new un({hashAlgorithm:n,maskGenAlgorithm:new H({algorithm:vo,parameters:q.serialize(n)}),saltLength:t}):null}static getHashAlgorithm(e){let t=Le.resolve(Xi);return typeof e=="string"?t.toAsnAlgorithm({name:e}):typeof e=="object"&&e&&"name"in e?t.toAsnAlgorithm(e):null}toAsnAlgorithm(e){switch(e.name.toLowerCase()){case"rsassa-pkcs1-v1_5":if("hash"in e){let t;if(typeof e.hash=="string")t=e.hash;else if(e.hash&&typeof e.hash=="object"&&"name"in e.hash&&typeof e.hash.name=="string")t=e.hash.name.toUpperCase();else throw new Error("Cannot get hash algorithm name");switch(t.toLowerCase()){case"sha-1":return new H({algorithm:ta,parameters:null});case"sha-256":return new H({algorithm:rp,parameters:null});case"sha-384":return new H({algorithm:ra,parameters:null});case"sha-512":return new H({algorithm:na,parameters:null})}}else return new H({algorithm:cn,parameters:null});break;case"rsa-pss":if("hash"in e){if(!("saltLength"in e&&typeof e.saltLength=="number"))throw new Error("Cannot get 'saltLength' from 'alg' argument");let t=_p.createPssParams(e.hash,e.saltLength);if(!t)throw new Error("Cannot create PSS parameters");return new H({algorithm:xo,parameters:q.serialize(t)})}else return new H({algorithm:xo,parameters:null})}return null}toWebAlgorithm(e){switch(e.algorithm){case cn:return{name:"RSASSA-PKCS1-v1_5"};case ta:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};case rp:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case ra:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case na:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}};case xo:if(e.parameters){let t=q.parse(e.parameters,un);return{name:"RSA-PSS",hash:Le.resolve(Xi).toWebAlgorithm(t.hashAlgorithm),saltLength:t.saltLength}}else return{name:"RSA-PSS"}}return null}};$m=_p=gu([So()],$m);Le.registerSingleton(Nu,$m);var Fm=class{toAsnAlgorithm(e){switch(e.name.toLowerCase()){case"sha-1":return new H({algorithm:Mi});case"sha-256":return new H({algorithm:Ki});case"sha-384":return new H({algorithm:Hi});case"sha-512":return new H({algorithm:Vi})}return null}toWebAlgorithm(e){switch(e.algorithm){case Mi:return{name:"SHA-1"};case Ki:return{name:"SHA-256"};case Hi:return{name:"SHA-384"};case Vi:return{name:"SHA-512"}}return null}};Fm=gu([So()],Fm);Le.registerSingleton(Nu,Fm);var Mn=class r{addPadding(e,t){let n=$.BufferSourceConverter.toUint8Array(t),o=new Uint8Array(e);return o.set(n,e-n.length),o}removePadding(e,t=!1){let n=$.BufferSourceConverter.toUint8Array(e);for(let o=0;o<n.length;o++)if(n[o]){n=n.slice(o);break}if(t&&n[0]>127){let o=new Uint8Array(n.length+1);return o.set(n,1),o.buffer}return n.buffer}toAsnSignature(e,t){if(e.name==="ECDSA"){let n=e.namedCurve,o=r.namedCurveSize.get(n)||r.defaultNamedCurveSize,i=new Ui,s=$.BufferSourceConverter.toUint8Array(t);return i.r=this.removePadding(s.slice(0,o),!0),i.s=this.removePadding(s.slice(o,o+o),!0),q.serialize(i)}return null}toWebSignature(e,t){if(e.name==="ECDSA"){let n=q.parse(t,Ui),o=e.namedCurve,i=r.namedCurveSize.get(o)||r.defaultNamedCurveSize,s=this.addPadding(i,this.removePadding(n.r)),a=this.addPadding(i,this.removePadding(n.s));return(0,$.combine)(s,a)}return null}};Mn.namedCurveSize=new Map;Mn.defaultNamedCurveSize=32;var Um="1.3.101.110",F1="1.3.101.111",Mm="1.3.101.112",W1="1.3.101.113",Wm=class{toAsnAlgorithm(e){let t=null;switch(e.name.toLowerCase()){case"ed25519":t=Mm;break;case"x25519":t=Um;break;case"eddsa":switch(e.namedCurve.toLowerCase()){case"ed25519":t=Mm;break;case"ed448":t=W1;break}break;case"ecdh-es":switch(e.namedCurve.toLowerCase()){case"x25519":t=Um;break;case"x448":t=F1;break}}return t?new H({algorithm:t}):null}toWebAlgorithm(e){switch(e.algorithm){case Mm:return{name:"Ed25519"};case W1:return{name:"EdDSA",namedCurve:"Ed448"};case Um:return{name:"X25519"};case F1:return{name:"ECDH-ES",namedCurve:"X448"}}return null}};Wm=gu([So()],Wm);Le.registerSingleton(Nu,Wm);var Gm=class extends Oo{constructor(e){Oo.isAsnEncoded(e)?super(e,To):super(e),this.tag=Lt.CertificateRequestTag}onInit(e){this.tbs=q.serialize(e.certificationRequestInfo),this.publicKey=new Ln(e.certificationRequestInfo.subjectPKInfo);let t=Le.resolve(Xi);this.signatureAlgorithm=t.toWebAlgorithm(e.signatureAlgorithm),this.signature=e.signature,this.attributes=e.certificationRequestInfo.attributes.map(o=>ya.create(q.serialize(o)));let n=this.getAttribute(Eu);this.extensions=[],n instanceof ku&&(this.extensions=n.items),this.subjectName=new wr(e.certificationRequestInfo.subject),this.subject=this.subjectName.toString()}getAttribute(e){for(let t of this.attributes)if(t.type===e)return t;return null}getAttributes(e){return this.attributes.filter(t=>t.type===e)}getExtension(e){for(let t of this.extensions)if(t.type===e)return t;return null}getExtensions(e){return this.extensions.filter(t=>t.type===e)}async verify(e=xt.get()){let t={...this.publicKey.algorithm,...this.signatureAlgorithm},n=await this.publicKey.export(t,["verify"],e),o=Le.resolveAll(Du).reverse(),i=null;for(let a of o)if(i=a.toWebSignature(t,this.signature),i)break;if(!i)throw Error("Cannot convert WebCrypto signature value to ASN.1 format");return await e.subtle.verify(this.signatureAlgorithm,n,i,this.tbs)}toTextObject(){let e=this.toTextObjectEmpty(),t=q.parse(this.rawData,To),n=t.certificationRequestInfo,o=new xe("",{Version:`${on[n.version]} (${n.version})`,Subject:this.subject,"Subject Public Key Info":this.publicKey});if(this.attributes.length){let i=new xe("");for(let s of this.attributes){let a=s.toTextObject();i[a[xe.NAME]]=a}o.Attributes=i}return e.Data=o,e.Signature=new xe("",{Algorithm:Un.serializeAlgorithm(t.signatureAlgorithm),"":t.signature}),e}};Gm.NAME="PKCS#10 Certificate Request";var ma=class extends Oo{constructor(e){Oo.isAsnEncoded(e)?super(e,hr):super(e),this.tag=Lt.CertificateTag}onInit(e){let t=e.tbsCertificate;this.tbs=q.serialize(t);let n=new Uint8Array(t.serialNumber);n.length>1&&n[0]===0&&n[1]>127&&(n=n.slice(1)),this.serialNumber=$.Convert.ToHex(n),this.subjectName=new wr(t.subject),this.subject=new wr(t.subject).toString(),this.issuerName=new wr(t.issuer),this.issuer=this.issuerName.toString();let o=Le.resolve(Xi);this.signatureAlgorithm=o.toWebAlgorithm(e.signatureAlgorithm),this.signature=e.signatureValue;let i=t.validity.notBefore.utcTime||t.validity.notBefore.generalTime;if(!i)throw new Error("Cannot get 'notBefore' value");this.notBefore=i;let s=t.validity.notAfter.utcTime||t.validity.notAfter.generalTime;if(!s)throw new Error("Cannot get 'notAfter' value");this.notAfter=s,this.extensions=[],t.extensions&&(this.extensions=t.extensions.map(a=>Zt.create(q.serialize(a)))),this.publicKey=new Ln(t.subjectPublicKeyInfo)}getExtension(e){for(let t of this.extensions)if(typeof e=="string"){if(t.type===e)return t}else if(t instanceof e)return t;return null}getExtensions(e){return this.extensions.filter(t=>typeof e=="string"?t.type===e:t instanceof e)}async verify(e={},t=xt.get()){let n,o,i=e.publicKey;try{if(!i)n={...this.publicKey.algorithm,...this.signatureAlgorithm},o=await this.publicKey.export(n,["verify"],t);else if("publicKey"in i)n={...i.publicKey.algorithm,...this.signatureAlgorithm},o=await i.publicKey.export(n,["verify"],t);else if(i instanceof Ln)n={...i.algorithm,...this.signatureAlgorithm},o=await i.export(n,["verify"],t);else if($.BufferSourceConverter.isBufferSource(i)){let l=new Ln(i);n={...l.algorithm,...this.signatureAlgorithm},o=await l.export(n,["verify"],t)}else n={...i.algorithm,...this.signatureAlgorithm},o=i}catch{return!1}let s=Le.resolveAll(Du).reverse(),a=null;for(let l of s)if(a=l.toWebSignature(n,this.signature),a)break;if(!a)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");let c=await t.subtle.verify(this.signatureAlgorithm,o,a,this.tbs);if(e.signatureOnly)return c;{let f=(e.date||new Date).getTime();return c&&this.notBefore.getTime()<f&&f<this.notAfter.getTime()}}async getThumbprint(...e){let t,n="SHA-1";return e[0]&&(e[0].subtle?t=e[0]:(n=e[0]||n,t=e[1])),t??(t=xt.get()),await t.subtle.digest(n,this.rawData)}async isSelfSigned(e=xt.get()){return this.subject===this.issuer&&await this.verify({signatureOnly:!0},e)}toTextObject(){let e=this.toTextObjectEmpty(),t=q.parse(this.rawData,hr),n=t.tbsCertificate,o=new xe("",{Version:`${on[n.version]} (${n.version})`,"Serial Number":n.serialNumber,"Signature Algorithm":Un.serializeAlgorithm(n.signature),Issuer:this.issuer,Validity:new xe("",{"Not Before":n.validity.notBefore.getTime(),"Not After":n.validity.notAfter.getTime()}),Subject:this.subject,"Subject Public Key Info":this.publicKey});if(n.issuerUniqueID&&(o["Issuer Unique ID"]=n.issuerUniqueID),n.subjectUniqueID&&(o["Subject Unique ID"]=n.subjectUniqueID),this.extensions.length){let i=new xe("");for(let s of this.extensions){let a=s.toTextObject();i[a[xe.NAME]]=a}o.Extensions=i}return e.Data=o,e.Signature=new xe("",{Algorithm:Un.serializeAlgorithm(t.signatureAlgorithm),"":t.signatureValue}),e}};ma.NAME="Certificate";var Np=class{static async createSelfSigned(e,t=xt.get()){if(!e.keys.privateKey)throw new Error("Bad field 'keys' in 'params' argument. 'privateKey' is empty");if(!e.keys.publicKey)throw new Error("Bad field 'keys' in 'params' argument. 'publicKey' is empty");return this.create({serialNumber:e.serialNumber,subject:e.name,issuer:e.name,notBefore:e.notBefore,notAfter:e.notAfter,publicKey:e.keys.publicKey,signingKey:e.keys.privateKey,signingAlgorithm:e.signingAlgorithm,extensions:e.extensions},t)}static async create(e,t=xt.get()){var n;let o;e.publicKey instanceof Ln?o=e.publicKey.rawData:"publicKey"in e.publicKey?o=e.publicKey.publicKey.rawData:$.BufferSourceConverter.isBufferSource(e.publicKey)?o=e.publicKey:o=await t.subtle.exportKey("spki",e.publicKey);let i=e.serialNumber?$.BufferSourceConverter.toUint8Array($.Convert.FromHex(e.serialNumber)):t.getRandomValues(new Uint8Array(16));if(i[0]>127){let d=new Uint8Array(i.length+1);d[0]=0,d.set(i,1),i=d}let s=e.notBefore||new Date,a=e.notAfter||new Date(s.getTime()+31536e6),c=new hr({tbsCertificate:new gt({version:on.v3,serialNumber:i,validity:new Bn({notBefore:s,notAfter:a}),extensions:new nr(((n=e.extensions)===null||n===void 0?void 0:n.map(d=>q.parse(d.rawData,mt)))||[]),subjectPublicKeyInfo:q.parse(o,yt)})});if(e.subject){let d=e.subject instanceof wr?e.subject:new wr(e.subject);c.tbsCertificate.subject=q.parse(d.toArrayBuffer(),Pe)}if(e.issuer){let d=e.issuer instanceof wr?e.issuer:new wr(e.issuer);c.tbsCertificate.issuer=q.parse(d.toArrayBuffer(),Pe)}let l={hash:"SHA-256"},f="signingKey"in e?{...l,...e.signingAlgorithm,...e.signingKey.algorithm}:{...l,...e.signingAlgorithm},p=Le.resolve(Xi);c.tbsCertificate.signature=c.signatureAlgorithm=p.toAsnAlgorithm(f);let y=q.serialize(c.tbsCertificate),m="signingKey"in e?await t.subtle.sign(f,e.signingKey,y):e.signature,x=Le.resolveAll(Du).reverse(),v=null;for(let d of x)if(v=d.toAsnSignature(f,m),v)break;if(!v)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");return c.signatureValue=v,new ma(q.serialize(c))}},G1;(function(r){r[r.unspecified=0]="unspecified",r[r.keyCompromise=1]="keyCompromise",r[r.cACompromise=2]="cACompromise",r[r.affiliationChanged=3]="affiliationChanged",r[r.superseded=4]="superseded",r[r.cessationOfOperation=5]="cessationOfOperation",r[r.certificateHold=6]="certificateHold",r[r.removeFromCRL=8]="removeFromCRL",r[r.privilegeWithdrawn=9]="privilegeWithdrawn",r[r.aACompromise=10]="aACompromise"})(G1||(G1={}));Zt.register(jf,ha);Zt.register(Mf,Ep);Zt.register(Kf,Cp);Zt.register(Dy,Tp);Zt.register(Df,Ap);Zt.register(ky,Ip);Zt.register(Uf,Pp);Zt.register(Nf,Bp);ya.register(Om,kp);ya.register(Eu,ku);Le.registerSingleton(Du,Vm);Le.registerSingleton(Du,Mn);Mn.namedCurveSize.set("P-256",32);Mn.namedCurveSize.set("K-256",32);Mn.namedCurveSize.set("P-384",48);Mn.namedCurveSize.set("P-521",66);var Kn="/",Y1=new TextEncoder().encode(Kn),Dp=Y1[0],ju=class r{_buf;constructor(e,t){if(typeof e=="string")this._buf=he(e);else if(e instanceof Uint8Array)this._buf=e;else throw new Error("Invalid key, should be String of Uint8Array");if(t==null&&(t=!0),t&&this.clean(),this._buf.byteLength===0||this._buf[0]!==Dp)throw new Error("Invalid key")}toString(e="utf8"){return le(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new r(e.join(Kn))}static random(){return new r(Math.random().toString().substring(2))}static asKey(e){return e instanceof Uint8Array||typeof e=="string"?new r(e):typeof e.uint8Array=="function"?new r(e.uint8Array()):null}clean(){if((this._buf==null||this._buf.byteLength===0)&&(this._buf=Y1),this._buf[0]!==Dp){let e=new Uint8Array(this._buf.byteLength+1);e.fill(Dp,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===Dp;)this._buf=this._buf.subarray(0,-1)}less(e){let t=this.list(),n=e.list();for(let o=0;o<t.length;o++){if(n.length<o+1)return!1;let i=t[o],s=n[o];if(i<s)return!0;if(i>s)return!1}return t.length<n.length}reverse(){return r.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){let e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(Kn).slice(1)}type(){return gT(this.baseNamespace())}name(){return wT(this.baseNamespace())}instance(e){return new r(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(Kn)||(e+=Kn),e+=this.type(),new r(e)}parent(){let e=this.list();return e.length===1?new r(Kn):new r(e.slice(0,-1).join(Kn))}child(e){return this.toString()===Kn?e:e.toString()===Kn?this:new r(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()===this.toString()?!1:e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()===this.toString()?!1:this.toString().startsWith(e.toString())}isTopLevel(){return this.list().length===1}concat(...e){return r.withNamespaces([...this.namespaces(),...bT(e.map(t=>t.namespaces()))])}};function gT(r){let e=r.split(":");return e.length<2?"":e.slice(0,-1).join(":")}function wT(r){let e=r.split(":");return e[e.length-1]}function bT(r){return[].concat(...r)}var jp=class extends Fn{async listen(){throw new sf("WebRTCTransport.createListener")}getAddrs(){return[]}updateAnnounceAddrs(){}async close(){}};function qm(){let r=Je(),e=!1;return{sink:async t=>{if(e)throw new Error("already piped");e=!0,r.resolve(t)},source:async function*(){yield*await r.promise}()}}function J1(){let r=qm(),e=qm();return[{source:r.source,sink:e.sink},{source:e.source,sink:r.sink}]}function xT(r){return r[Symbol.asyncIterator]!=null}async function vT(r,e,t){try{await Promise.all(r.map(async n=>{for await(let o of n)await e.push(o,{signal:t}),t.throwIfAborted()})),await e.end(void 0,{signal:t})}catch(n){await e.end(n,{signal:t}).catch(()=>{})}}async function*_T(r){let e=new AbortController,t=Jl();vT(r,t,e.signal).catch(()=>{});try{yield*t}finally{e.abort()}}function*ST(r){for(let e of r)yield*e}function AT(...r){let e=[];for(let t of r)xT(t)||e.push(t);return e.length===r.length?ST(e):_T(r)}var Q1=AT;function e_(r,...e){if(r==null)throw new Error("Empty pipeline");if(zm(r)){let n=r;r=()=>n.source}else if(r_(r)||t_(r)){let n=r;r=()=>n}let t=[r,...e];if(t.length>1&&zm(t[t.length-1])&&(t[t.length-1]=t[t.length-1].sink),t.length>2)for(let n=1;n<t.length-1;n++)zm(t[n])&&(t[n]=CT(t[n]));return ET(...t)}var ET=(...r)=>{let e;for(;r.length>0;)e=r.shift()(e);return e},t_=r=>r?.[Symbol.asyncIterator]!=null,r_=r=>r?.[Symbol.iterator]!=null,zm=r=>r==null?!1:r.sink!=null&&r.source!=null,CT=r=>e=>{let t=r.sink(e);if(t?.then!=null){let n=Is({objectMode:!0});t.then(()=>{n.end()},s=>{n.end(s)});let o,i=r.source;if(t_(i))o=async function*(){yield*i,n.end()};else if(r_(i))o=function*(){yield*i,n.end()};else throw new Error("Unknown duplex source type - must be Iterable or AsyncIterable");return Q1(n,o())}return r.source};var ga=!!globalThis.process?.env?.DUMP_SESSION_KEYS;function o_(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Rp(r){if(typeof r!="boolean")throw new Error(`boolean expected, not ${r}`)}function Lp(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function Pt(r,...e){if(!o_(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function Xm(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function i_(r,e){Pt(r);let t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function Hn(r){return new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4))}function Vn(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}function TT(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}var IT=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function OT(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function Up(r){if(typeof r=="string")r=OT(r);else if(o_(r))r=Mp(r);else throw new Error("Uint8Array expected, got "+typeof r);return r}function s_(r,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(r,e)}function a_(r,e){if(r.length!==e.length)return!1;let t=0;for(let n=0;n<r.length;n++)t|=r[n]^e[n];return t===0}var Zm=(r,e)=>{function t(n,...o){if(Pt(n),!IT)throw new Error("Non little-endian hardware is not yet supported");if(r.nonceLength!==void 0){let f=o[0];if(!f)throw new Error("nonce / iv required");r.varSizeNonce?Pt(f):Pt(f,r.nonceLength)}let i=r.tagLength;i&&o[1]!==void 0&&Pt(o[1]);let s=e(n,...o),a=(f,p)=>{if(p!==void 0){if(f!==2)throw new Error("cipher output not supported");Pt(p)}},c=!1;return{encrypt(f,p){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,Pt(f),a(s.encrypt.length,p),s.encrypt(f,p)},decrypt(f,p){if(Pt(f),i&&f.length<i)throw new Error("invalid ciphertext length: smaller than tagLength="+i);return a(s.decrypt.length,p),s.decrypt(f,p)}}}return Object.assign(t,r),t};function Ym(r,e,t=!0){if(e===void 0)return new Uint8Array(r);if(e.length!==r)throw new Error("invalid output length, expected "+r+", got: "+e.length);if(t&&!PT(e))throw new Error("invalid output, must be aligned");return e}function n_(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);let o=BigInt(32),i=BigInt(4294967295),s=Number(t>>o&i),a=Number(t&i),c=n?4:0,l=n?0:4;r.setUint32(e+c,s,n),r.setUint32(e+l,a,n)}function c_(r,e,t){Rp(t);let n=new Uint8Array(16),o=TT(n);return n_(o,0,BigInt(e),t),n_(o,8,BigInt(r),t),n}function PT(r){return r.byteOffset%4===0}function Mp(r){return Uint8Array.from(r)}var l_=r=>Uint8Array.from(r.split("").map(e=>e.charCodeAt(0))),BT=l_("expand 16-byte k"),kT=l_("expand 32-byte k"),NT=Hn(BT),DT=Hn(kT);function te(r,e){return r<<e|r>>>32-e}function Jm(r){return r.byteOffset%4===0}var Kp=64,jT=16,f_=2**32-1,u_=new Uint32Array;function RT(r,e,t,n,o,i,s,a){let c=o.length,l=new Uint8Array(Kp),f=Hn(l),p=Jm(o)&&Jm(i),y=p?Hn(o):u_,m=p?Hn(i):u_;for(let x=0;x<c;s++){if(r(e,t,n,f,s,a),s>=f_)throw new Error("arx: counter overflow");let v=Math.min(Kp,c-x);if(p&&v===Kp){let d=x/4;if(x%4!==0)throw new Error("arx: invalid block position");for(let I=0,D;I<jT;I++)D=d+I,m[D]=y[D]^f[I];x+=Kp;continue}for(let d=0,I;d<v;d++)I=x+d,i[I]=o[I]^l[d];x+=v}}function Qm(r,e){let{allowShortKeys:t,extendNonceFn:n,counterLength:o,counterRight:i,rounds:s}=s_({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof r!="function")throw new Error("core must be a function");return Lp(o),Lp(s),Rp(i),Rp(t),(a,c,l,f,p=0)=>{Pt(a),Pt(c),Pt(l);let y=l.length;if(f===void 0&&(f=new Uint8Array(y)),Pt(f),Lp(p),p<0||p>=f_)throw new Error("arx: counter overflow");if(f.length<y)throw new Error(`arx: output (${f.length}) is shorter than data (${y})`);let m=[],x=a.length,v,d;if(x===32)m.push(v=Mp(a)),d=DT;else if(x===16&&t)v=new Uint8Array(32),v.set(a),v.set(a,16),d=NT,m.push(v);else throw new Error(`arx: invalid 32-byte key, got length=${x}`);Jm(c)||m.push(c=Mp(c));let I=Hn(v);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(d,I,Hn(c.subarray(0,16)),I),c=c.subarray(16)}let D=16-o;if(D!==c.length)throw new Error(`arx: nonce must be ${D} or 16 bytes`);if(D!==12){let Z=new Uint8Array(12);Z.set(c,i?0:12-c.length),c=Z,m.push(c)}let j=Hn(c);return RT(r,d,I,j,l,f,p,s),Vn(...m),f}}var vt=(r,e)=>r[e++]&255|(r[e++]&255)<<8,eg=class{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=Up(e),Pt(e,32);let t=vt(e,0),n=vt(e,2),o=vt(e,4),i=vt(e,6),s=vt(e,8),a=vt(e,10),c=vt(e,12),l=vt(e,14);this.r[0]=t&8191,this.r[1]=(t>>>13|n<<3)&8191,this.r[2]=(n>>>10|o<<6)&7939,this.r[3]=(o>>>7|i<<9)&8191,this.r[4]=(i>>>4|s<<12)&255,this.r[5]=s>>>1&8190,this.r[6]=(s>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let f=0;f<8;f++)this.pad[f]=vt(e,16+2*f)}process(e,t,n=!1){let o=n?0:2048,{h:i,r:s}=this,a=s[0],c=s[1],l=s[2],f=s[3],p=s[4],y=s[5],m=s[6],x=s[7],v=s[8],d=s[9],I=vt(e,t+0),D=vt(e,t+2),j=vt(e,t+4),Z=vt(e,t+6),P=vt(e,t+8),M=vt(e,t+10),V=vt(e,t+12),K=vt(e,t+14),g=i[0]+(I&8191),T=i[1]+((I>>>13|D<<3)&8191),E=i[2]+((D>>>10|j<<6)&8191),O=i[3]+((j>>>7|Z<<9)&8191),B=i[4]+((Z>>>4|P<<12)&8191),R=i[5]+(P>>>1&8191),N=i[6]+((P>>>14|M<<2)&8191),L=i[7]+((M>>>11|V<<5)&8191),W=i[8]+((V>>>8|K<<8)&8191),X=i[9]+(K>>>5|o),G=0,ie=G+g*a+T*(5*d)+E*(5*v)+O*(5*x)+B*(5*m);G=ie>>>13,ie&=8191,ie+=R*(5*y)+N*(5*p)+L*(5*f)+W*(5*l)+X*(5*c),G+=ie>>>13,ie&=8191;let Y=G+g*c+T*a+E*(5*d)+O*(5*v)+B*(5*x);G=Y>>>13,Y&=8191,Y+=R*(5*m)+N*(5*y)+L*(5*p)+W*(5*f)+X*(5*l),G+=Y>>>13,Y&=8191;let U=G+g*l+T*c+E*a+O*(5*d)+B*(5*v);G=U>>>13,U&=8191,U+=R*(5*x)+N*(5*m)+L*(5*y)+W*(5*p)+X*(5*f),G+=U>>>13,U&=8191;let de=G+g*f+T*l+E*c+O*a+B*(5*d);G=de>>>13,de&=8191,de+=R*(5*v)+N*(5*x)+L*(5*m)+W*(5*y)+X*(5*p),G+=de>>>13,de&=8191;let Oe=G+g*p+T*f+E*l+O*c+B*a;G=Oe>>>13,Oe&=8191,Oe+=R*(5*d)+N*(5*v)+L*(5*x)+W*(5*m)+X*(5*y),G+=Oe>>>13,Oe&=8191;let se=G+g*y+T*p+E*f+O*l+B*c;G=se>>>13,se&=8191,se+=R*a+N*(5*d)+L*(5*v)+W*(5*x)+X*(5*m),G+=se>>>13,se&=8191;let De=G+g*m+T*y+E*p+O*f+B*l;G=De>>>13,De&=8191,De+=R*c+N*a+L*(5*d)+W*(5*v)+X*(5*x),G+=De>>>13,De&=8191;let _t=G+g*x+T*m+E*y+O*p+B*f;G=_t>>>13,_t&=8191,_t+=R*l+N*c+L*a+W*(5*d)+X*(5*v),G+=_t>>>13,_t&=8191;let tt=G+g*v+T*x+E*m+O*y+B*p;G=tt>>>13,tt&=8191,tt+=R*f+N*l+L*c+W*a+X*(5*d),G+=tt>>>13,tt&=8191;let rt=G+g*d+T*v+E*x+O*m+B*y;G=rt>>>13,rt&=8191,rt+=R*p+N*f+L*l+W*c+X*a,G+=rt>>>13,rt&=8191,G=(G<<2)+G|0,G=G+ie|0,ie=G&8191,G=G>>>13,Y+=G,i[0]=ie,i[1]=Y,i[2]=U,i[3]=de,i[4]=Oe,i[5]=se,i[6]=De,i[7]=_t,i[8]=tt,i[9]=rt}finalize(){let{h:e,pad:t}=this,n=new Uint16Array(10),o=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=o,o=e[a]>>>13,e[a]&=8191;e[0]+=o*5,o=e[0]>>>13,e[0]&=8191,e[1]+=o,o=e[1]>>>13,e[1]&=8191,e[2]+=o,n[0]=e[0]+5,o=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=e[a]+o,o=n[a]>>>13,n[a]&=8191;n[9]-=8192;let i=(o^1)-1;for(let a=0;a<10;a++)n[a]&=i;i=~i;for(let a=0;a<10;a++)e[a]=e[a]&i|n[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let s=e[0]+t[0];e[0]=s&65535;for(let a=1;a<8;a++)s=(e[a]+t[a]|0)+(s>>>16)|0,e[a]=s&65535;Vn(n)}update(e){Xm(this),e=Up(e),Pt(e);let{buffer:t,blockLen:n}=this,o=e.length;for(let i=0;i<o;){let s=Math.min(n-this.pos,o-i);if(s===n){for(;n<=o-i;i+=n)this.process(e,i);continue}t.set(e.subarray(i,i+s),this.pos),this.pos+=s,i+=s,this.pos===n&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){Vn(this.h,this.r,this.buffer,this.pad)}digestInto(e){Xm(this),i_(e,this),this.finished=!0;let{buffer:t,h:n}=this,{pos:o}=this;if(o){for(t[o++]=1;o<16;o++)t[o]=0;this.process(t,0,!0)}this.finalize();let i=0;for(let s=0;s<8;s++)e[i++]=n[s]>>>0,e[i++]=n[s]>>>8;return e}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}};function LT(r){let e=(n,o)=>r(o).update(Up(n)).digest(),t=r(new Uint8Array(32));return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=n=>r(n),e}var p_=LT(r=>new eg(r));function y_(r,e,t,n,o,i=20){let s=r[0],a=r[1],c=r[2],l=r[3],f=e[0],p=e[1],y=e[2],m=e[3],x=e[4],v=e[5],d=e[6],I=e[7],D=o,j=t[0],Z=t[1],P=t[2],M=s,V=a,K=c,g=l,T=f,E=p,O=y,B=m,R=x,N=v,L=d,W=I,X=D,G=j,ie=Z,Y=P;for(let de=0;de<i;de+=2)M=M+T|0,X=te(X^M,16),R=R+X|0,T=te(T^R,12),M=M+T|0,X=te(X^M,8),R=R+X|0,T=te(T^R,7),V=V+E|0,G=te(G^V,16),N=N+G|0,E=te(E^N,12),V=V+E|0,G=te(G^V,8),N=N+G|0,E=te(E^N,7),K=K+O|0,ie=te(ie^K,16),L=L+ie|0,O=te(O^L,12),K=K+O|0,ie=te(ie^K,8),L=L+ie|0,O=te(O^L,7),g=g+B|0,Y=te(Y^g,16),W=W+Y|0,B=te(B^W,12),g=g+B|0,Y=te(Y^g,8),W=W+Y|0,B=te(B^W,7),M=M+E|0,Y=te(Y^M,16),L=L+Y|0,E=te(E^L,12),M=M+E|0,Y=te(Y^M,8),L=L+Y|0,E=te(E^L,7),V=V+O|0,X=te(X^V,16),W=W+X|0,O=te(O^W,12),V=V+O|0,X=te(X^V,8),W=W+X|0,O=te(O^W,7),K=K+B|0,G=te(G^K,16),R=R+G|0,B=te(B^R,12),K=K+B|0,G=te(G^K,8),R=R+G|0,B=te(B^R,7),g=g+T|0,ie=te(ie^g,16),N=N+ie|0,T=te(T^N,12),g=g+T|0,ie=te(ie^g,8),N=N+ie|0,T=te(T^N,7);let U=0;n[U++]=s+M|0,n[U++]=a+V|0,n[U++]=c+K|0,n[U++]=l+g|0,n[U++]=f+T|0,n[U++]=p+E|0,n[U++]=y+O|0,n[U++]=m+B|0,n[U++]=x+R|0,n[U++]=v+N|0,n[U++]=d+L|0,n[U++]=I+W|0,n[U++]=D+X|0,n[U++]=j+G|0,n[U++]=Z+ie|0,n[U++]=P+Y|0}function UT(r,e,t,n){let o=r[0],i=r[1],s=r[2],a=r[3],c=e[0],l=e[1],f=e[2],p=e[3],y=e[4],m=e[5],x=e[6],v=e[7],d=t[0],I=t[1],D=t[2],j=t[3];for(let P=0;P<20;P+=2)o=o+c|0,d=te(d^o,16),y=y+d|0,c=te(c^y,12),o=o+c|0,d=te(d^o,8),y=y+d|0,c=te(c^y,7),i=i+l|0,I=te(I^i,16),m=m+I|0,l=te(l^m,12),i=i+l|0,I=te(I^i,8),m=m+I|0,l=te(l^m,7),s=s+f|0,D=te(D^s,16),x=x+D|0,f=te(f^x,12),s=s+f|0,D=te(D^s,8),x=x+D|0,f=te(f^x,7),a=a+p|0,j=te(j^a,16),v=v+j|0,p=te(p^v,12),a=a+p|0,j=te(j^a,8),v=v+j|0,p=te(p^v,7),o=o+l|0,j=te(j^o,16),x=x+j|0,l=te(l^x,12),o=o+l|0,j=te(j^o,8),x=x+j|0,l=te(l^x,7),i=i+f|0,d=te(d^i,16),v=v+d|0,f=te(f^v,12),i=i+f|0,d=te(d^i,8),v=v+d|0,f=te(f^v,7),s=s+p|0,I=te(I^s,16),y=y+I|0,p=te(p^y,12),s=s+p|0,I=te(I^s,8),y=y+I|0,p=te(p^y,7),a=a+c|0,D=te(D^a,16),m=m+D|0,c=te(c^m,12),a=a+c|0,D=te(D^a,8),m=m+D|0,c=te(c^m,7);let Z=0;n[Z++]=o,n[Z++]=i,n[Z++]=s,n[Z++]=a,n[Z++]=d,n[Z++]=I,n[Z++]=D,n[Z++]=j}var MT=Qm(y_,{counterRight:!1,counterLength:4,allowShortKeys:!1}),KT=Qm(y_,{counterRight:!1,counterLength:8,extendNonceFn:UT,allowShortKeys:!1});var HT=new Uint8Array(16),h_=(r,e)=>{r.update(e);let t=e.length%16;t&&r.update(HT.subarray(t))},VT=new Uint8Array(32);function d_(r,e,t,n,o){let i=r(e,t,VT),s=p_.create(i);o&&h_(s,o),h_(s,n);let a=c_(n.length,o?o.length:0,!0);s.update(a);let c=s.digest();return Vn(i,a),c}var m_=r=>(e,t,n)=>({encrypt(i,s){let a=i.length;s=Ym(a+16,s,!1),s.set(i);let c=s.subarray(0,-16);r(e,t,c,c,1);let l=d_(r,e,t,c,n);return s.set(l,a),Vn(l),s},decrypt(i,s){s=Ym(i.length-16,s,!1);let a=i.subarray(0,-16),c=i.subarray(-16),l=d_(r,e,t,a,n);if(!a_(c,l))throw new Error("invalid tag");return s.set(i.subarray(0,-16)),r(e,t,s,s,1),Vn(l),s}}),tg=Zm({blockSize:64,nonceLength:12,tagLength:16},m_(MT)),bX=Zm({blockSize:64,nonceLength:24,tagLength:16},m_(KT));function w_(r,e,t){return Pa(r),t===void 0&&(t=new Uint8Array(r.outputLen)),bs(r,zn(t),zn(e))}var rg=Uint8Array.from([0]),g_=Uint8Array.of();function b_(r,e,t,n=32){Pa(r),Lo(n);let o=r.outputLen;if(n>255*o)throw new Error("Length should be <= 255*HashLen");let i=Math.ceil(n/o);t===void 0&&(t=g_);let s=new Uint8Array(i*o),a=bs.create(r,e),c=a._cloneInto(),l=new Uint8Array(a.outputLen);for(let f=0;f<i;f++)rg[0]=f+1,c.update(f===0?g_:l).update(t).update(rg).digestInto(l),s.set(l,o*f),a._cloneInto(c);return a.destroy(),c.destroy(),Ar(l,rg),s.slice(0,n)}var ng={hashSHA256(r){return eo(r.subarray())},getHKDF(r,e){let t=w_(eo,e,r),o=b_(eo,t,void 0,96),i=o.subarray(0,32),s=o.subarray(32,64),a=o.subarray(64,96);return[i,s,a]},generateX25519KeyPair(){let r=Ma.utils.randomPrivateKey();return{publicKey:Ma.getPublicKey(r),privateKey:r}},generateX25519KeyPairFromSeed(r){return{publicKey:Ma.getPublicKey(r),privateKey:r}},generateX25519SharedKey(r,e){return Ma.getSharedSecret(r.subarray(),e.subarray())},chaCha20Poly1305Encrypt(r,e,t,n){return tg(n,e,t).encrypt(r.subarray())},chaCha20Poly1305Decrypt(r,e,t,n,o){return tg(n,e,t).decrypt(r.subarray(),o)}};var x_=ng;function v_(r){return{generateKeypair:r.generateX25519KeyPair,dh:(e,t)=>r.generateX25519SharedKey(e.privateKey,t).subarray(0,32),encrypt:r.chaCha20Poly1305Encrypt,decrypt:r.chaCha20Poly1305Decrypt,hash:r.hashSHA256,hkdf:r.getHKDF}}var wa=r=>{let e=it(2);return e[0]=r>>8,e[1]=r,e};wa.bytes=2;var Ru=r=>{if(r.length<2)throw RangeError("Could not decode int16BE");if(r instanceof Uint8Array){let e=0;return e+=r[0]<<8,e+=r[1],e}return r.getUint16(0)};Ru.bytes=2;function __(r){return{xxHandshakeSuccesses:r.registerCounter("libp2p_noise_xxhandshake_successes_total",{help:"Total count of noise xxHandshakes successes_"}),xxHandshakeErrors:r.registerCounter("libp2p_noise_xxhandshake_error_total",{help:"Total count of noise xxHandshakes errors"}),encryptedPackets:r.registerCounter("libp2p_noise_encrypted_packets_total",{help:"Total count of noise encrypted packets successfully"}),decryptedPackets:r.registerCounter("libp2p_noise_decrypted_packets_total",{help:"Total count of noise decrypted packets"}),decryptErrors:r.registerCounter("libp2p_noise_decrypt_errors_total",{help:"Total count of noise decrypt errors"})}}function og(r,e){!e.enabled||!ga||(r?(e(`LOCAL_STATIC_PUBLIC_KEY ${le(r.publicKey,"hex")}`),e(`LOCAL_STATIC_PRIVATE_KEY ${le(r.privateKey,"hex")}`)):e("Missing local static keys."))}function ig(r,e){!e.enabled||!ga||(r?(e(`LOCAL_PUBLIC_EPHEMERAL_KEY ${le(r.publicKey,"hex")}`),e(`LOCAL_PRIVATE_EPHEMERAL_KEY ${le(r.privateKey,"hex")}`)):e("Missing local ephemeral keys."))}function S_(r,e){!e.enabled||!ga||e(r?`REMOTE_STATIC_PUBLIC_KEY ${le(r.subarray(),"hex")}`:"Missing remote static public key.")}function sg(r,e){!e.enabled||!ga||e(r?`REMOTE_EPHEMERAL_PUBLIC_KEY ${le(r.subarray(),"hex")}`:"Missing remote ephemeral keys.")}function ag(r,e,t){!t.enabled||!ga||(t(`CIPHER_STATE_1 ${r.n.getUint64()} ${r.k&&le(r.k,"hex")}`),t(`CIPHER_STATE_2 ${e.n.getUint64()} ${e.k&&le(e.k,"hex")}`))}var ba=class r extends Error{code;constructor(e="Invalid crypto exchange"){super(e),this.code=r.code}static code="ERR_INVALID_CRYPTO_EXCHANGE"};var $T=0,FT=4294967295,WT="Cipherstate has reached maximum n, a new handshake must be performed",Hp=class{n;bytes;view;constructor(e=$T){this.n=e,this.bytes=ot(12),this.view=new DataView(this.bytes.buffer,this.bytes.byteOffset,this.bytes.byteLength),this.view.setUint32(4,e,!0)}increment(){this.n++,this.view.setUint32(4,this.n,!0)}getBytes(){return this.bytes}getUint64(){return this.n}assertValue(){if(this.n>FT)throw new Error(WT)}};var Yi=ot(0),xa=class{k;n;crypto;constructor(e,t=void 0,n=0){this.crypto=e,this.k=t,this.n=new Hp(n)}hasKey(){return!!this.k}encryptWithAd(e,t){if(!this.hasKey())return t;this.n.assertValue();let n=this.crypto.encrypt(t,this.n.getBytes(),e,this.k);return this.n.increment(),n}decryptWithAd(e,t,n){if(!this.hasKey())return t;this.n.assertValue();let o=this.crypto.decrypt(t,this.n.getBytes(),e,this.k,n);return this.n.increment(),o}},cg=class{cs;ck;h;crypto;constructor(e,t){this.crypto=e;let n=he(t,"utf-8");this.h=GT(e,n),this.ck=this.h,this.cs=new xa(e)}mixKey(e){let[t,n]=this.crypto.hkdf(this.ck,e);this.ck=t,this.cs=new xa(this.crypto,n)}mixHash(e){this.h=this.crypto.hash(new be(this.h,e))}encryptAndHash(e){let t=this.cs.encryptWithAd(this.h,e);return this.mixHash(t),t}decryptAndHash(e){let t=this.cs.decryptWithAd(this.h,e);return this.mixHash(e),t}split(){let[e,t]=this.crypto.hkdf(this.ck,Yi);return[new xa(this.crypto,e),new xa(this.crypto,t)]}},ug=class{ss;s;e;rs;re;initiator;crypto;constructor(e){let{crypto:t,protocolName:n,prologue:o,initiator:i,s,e:a,rs:c,re:l}=e;this.crypto=t,this.ss=new cg(t,n),this.ss.mixHash(o),this.initiator=i,this.s=s,this.e=a,this.rs=c,this.re=l}writeE(){if(this.e)throw new Error("ephemeral keypair is already set");let e=this.crypto.generateKeypair();return this.ss.mixHash(e.publicKey),this.e=e,e.publicKey}writeS(){if(!this.s)throw new Error("static keypair is not set");return this.ss.encryptAndHash(this.s.publicKey)}writeEE(){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.re))}writeES(){if(this.initiator){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}else{if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}}writeSE(){if(this.initiator){if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}else{if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}}readE(e,t=0){if(this.re)throw new Error("remote ephemeral public key is already set");if(e.byteLength<t+32)throw new Error("message is not long enough");this.re=e.sublist(t,t+32),this.ss.mixHash(this.re)}readS(e,t=0){if(this.rs)throw new Error("remote static public key is already set");let n=32+(this.ss.cs.hasKey()?16:0);if(e.byteLength<t+n)throw new Error("message is not long enough");let o=e.sublist(t,t+n);return this.rs=this.ss.decryptAndHash(o),n}readEE(){this.writeEE()}readES(){this.writeES()}readSE(){this.writeSE()}},Lu=class extends ug{writeMessageA(e){return new be(this.writeE(),this.ss.encryptAndHash(e))}writeMessageB(e){let t=this.writeE();this.writeEE();let n=this.writeS();return this.writeES(),new be(t,n,this.ss.encryptAndHash(e))}writeMessageC(e){let t=this.writeS();return this.writeSE(),new be(t,this.ss.encryptAndHash(e))}readMessageA(e){try{return this.readE(e),this.ss.decryptAndHash(e.sublist(32))}catch(t){throw new ba(`handshake stage 0 validation fail: ${t.message}`)}}readMessageB(e){try{this.readE(e),this.readEE();let t=this.readS(e,32);return this.readES(),this.ss.decryptAndHash(e.sublist(32+t))}catch(t){throw new ba(`handshake stage 1 validation fail: ${t.message}`)}}readMessageC(e){try{let t=this.readS(e);return this.readSE(),this.ss.decryptAndHash(e.sublist(t))}catch(t){throw new ba(`handshake stage 2 validation fail: ${t.message}`)}}};function GT(r,e){if(e.length<=32){let t=ot(32);return t.set(e),t}else return r.hash(e)}var Vp;(function(r){let e;r.codec=()=>(e==null&&(e=Br((t,n,o={})=>{if(o.lengthDelimited!==!1&&n.fork(),t.webtransportCerthashes!=null)for(let i of t.webtransportCerthashes)n.uint32(10),n.bytes(i);if(t.streamMuxers!=null)for(let i of t.streamMuxers)n.uint32(18),n.string(i);o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={webtransportCerthashes:[],streamMuxers:[]},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{if(o.limits?.webtransportCerthashes!=null&&i.webtransportCerthashes.length===o.limits.webtransportCerthashes)throw new Ga('Decode error - map field "webtransportCerthashes" had too many elements');i.webtransportCerthashes.push(t.bytes());break}case 2:{if(o.limits?.streamMuxers!=null&&i.streamMuxers.length===o.limits.streamMuxers)throw new Ga('Decode error - map field "streamMuxers" had too many elements');i.streamMuxers.push(t.string());break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>Pr(t,r.codec()),r.decode=(t,n)=>Or(t,r.codec(),n)})(Vp||(Vp={}));var Uu;(function(r){let e;r.codec=()=>(e==null&&(e=Br((t,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),t.identityKey!=null&&t.identityKey.byteLength>0&&(n.uint32(10),n.bytes(t.identityKey)),t.identitySig!=null&&t.identitySig.byteLength>0&&(n.uint32(18),n.bytes(t.identitySig)),t.extensions!=null&&(n.uint32(34),Vp.codec().encode(t.extensions,n)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={identityKey:ot(0),identitySig:ot(0)},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.identityKey=t.bytes();break}case 2:{i.identitySig=t.bytes();break}case 4:{i.extensions=Vp.codec().decode(t,t.uint32(),{limits:o.limits?.extensions});break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>Pr(t,r.codec()),r.decode=(t,n)=>Or(t,r.codec(),n)})(Uu||(Uu={}));async function lg(r,e,t){let n=await r.sign(A_(e));return Uu.encode({identityKey:qn(r.publicKey),identitySig:n,extensions:t})}async function fg(r,e,t){try{let n=Uu.decode(r),o=Ja(n.identityKey);if(t?.equals(o)===!1)throw new Error(`Payload identity key ${o} does not match expected remote identity key ${t}`);if(!e)throw new Error("Remote static does not exist");let i=A_(e);if(!await o.verify(i,n.identitySig))throw new Error("Invalid payload signature");return n}catch(n){throw new Vu(n.message)}}function A_(r){let e=he("noise-libp2p-static-key:");return r instanceof Uint8Array?Bt([e,r],e.length+r.length):(r.prepend(e),r)}async function E_(r,e){let{log:t,connection:n,crypto:o,privateKey:i,prologue:s,s:a,remoteIdentityKey:c,extensions:l}=r,f=await lg(i,a.publicKey,l),p=new Lu({crypto:o,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!0,prologue:s,s:a});og(p.s,t),t.trace("Stage 0 - Initiator starting to send first message."),await n.write(p.writeMessageA(Yi),e),t.trace("Stage 0 - Initiator finished sending first message."),ig(p.e,t),t.trace("Stage 1 - Initiator waiting to receive first message from responder...");let y=p.readMessageB(await n.read(e));t.trace("Stage 1 - Initiator received the message."),sg(p.re,t),S_(p.rs,t),t.trace("Initiator going to check remote's signature...");let m=await fg(y,p.rs,c);t.trace("All good with the signature!"),t.trace("Stage 2 - Initiator sending third handshake message."),await n.write(p.writeMessageC(f),e),t.trace("Stage 2 - Initiator sent message with signed payload.");let[x,v]=p.ss.split();return ag(x,v,t),{payload:m,encrypt:d=>x.encryptWithAd(Yi,d),decrypt:(d,I)=>v.decryptWithAd(Yi,d,I)}}async function C_(r,e){let{log:t,connection:n,crypto:o,privateKey:i,prologue:s,s:a,remoteIdentityKey:c,extensions:l}=r,f=await lg(i,a.publicKey,l),p=new Lu({crypto:o,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!1,prologue:s,s:a});og(p.s,t),t.trace("Stage 0 - Responder waiting to receive first message."),p.readMessageA(await n.read(e)),t.trace("Stage 0 - Responder received first message."),sg(p.re,t),t.trace("Stage 1 - Responder sending out first message with signed payload and static key."),await n.write(p.writeMessageB(f),e),t.trace("Stage 1 - Responder sent the second handshake message with signed payload."),ig(p.e,t),t.trace("Stage 2 - Responder waiting for third handshake message...");let y=p.readMessageC(await n.read(e));t.trace("Stage 2 - Responder received the message, finished handshake.");let m=await fg(y,p.rs,c),[x,v]=p.ss.split();return ag(x,v,t),{payload:m,encrypt:d=>v.encryptWithAd(Yi,d),decrypt:(d,I)=>x.decryptWithAd(Yi,d,I)}}var I_=16;function O_(r,e){return async function*(t){for await(let n of t)for(let o=0;o<n.length;o+=65519){let i=o+65519;i>n.length&&(i=n.length);let s;n instanceof Uint8Array?s=r.encrypt(n.subarray(o,i)):s=r.encrypt(n.sublist(o,i)),e?.encryptedPackets.increment(),yield new be(wa(s.byteLength),s)}}}function P_(r,e){return async function*(t){for await(let n of t)for(let o=0;o<n.length;o+=65535){let i=o+65535;if(i>n.length&&(i=n.length),i-I_<o)throw new Error("Invalid chunk");let s=n.sublist(o,i),a=n.subarray(o,i-I_);try{let c=r.decrypt(s,a);e?.decryptedPackets.increment(),yield c}catch(c){throw e?.decryptErrors.increment(),c}}}}var $p=class{protocol="/noise";crypto;prologue;staticKey;extensions;metrics;components;constructor(e,t={}){let{staticNoiseKey:n,extensions:o,crypto:i,prologueBytes:s}=t,{metrics:a}=e;this.components=e;let c=i??x_;this.crypto=v_(c),this.extensions={webtransportCerthashes:[],...o},this.metrics=a?__(a):void 0,n?this.staticKey=c.generateX25519KeyPairFromSeed(n):this.staticKey=c.generateX25519KeyPair(),this.prologue=s??ot(0)}[Symbol.toStringTag]="@chainsafe/libp2p-noise";[es]=["@libp2p/connection-encryption","@chainsafe/libp2p-noise"];async secureOutbound(e,t){let n=wc(e,{lengthEncoder:wa,lengthDecoder:Ru,maxDataLength:65535}),o=await this.performHandshakeInitiator(n,this.components.privateKey,t?.remotePeer?.publicKey,t),i=await this.createSecureConnection(n,o);e.source=i.source,e.sink=i.sink;let s=Ja(o.payload.identityKey);return{conn:e,remoteExtensions:o.payload.extensions,remotePeer:md(s),streamMuxer:t?.skipStreamMuxerNegotiation===!0?void 0:this.getStreamMuxer(o.payload.extensions?.streamMuxers)}}getStreamMuxer(e){if(e==null||e.length===0)return;let t=this.components.upgrader.getStreamMuxers();if(t!=null)for(let n of e){let o=t.get(n);if(o!=null)return o}if(e.length)throw new $u("Early muxer negotiation was requested but the initiator and responder had no common muxers")}async secureInbound(e,t){let n=wc(e,{lengthEncoder:wa,lengthDecoder:Ru,maxDataLength:65535}),o=await this.performHandshakeResponder(n,this.components.privateKey,t?.remotePeer?.publicKey,t),i=await this.createSecureConnection(n,o);e.source=i.source,e.sink=i.sink;let s=Ja(o.payload.identityKey);return{conn:e,remoteExtensions:o.payload.extensions,remotePeer:md(s),streamMuxer:t?.skipStreamMuxerNegotiation===!0?void 0:this.getStreamMuxer(o.payload.extensions?.streamMuxers)}}async performHandshakeInitiator(e,t,n,o){let i,s=o?.skipStreamMuxerNegotiation===!0?[]:[...this.components.upgrader.getStreamMuxers().keys()];try{i=await E_({connection:e,privateKey:t,remoteIdentityKey:n,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:{streamMuxers:s,webtransportCerthashes:[],...this.extensions}},o),this.metrics?.xxHandshakeSuccesses.increment()}catch(a){throw this.metrics?.xxHandshakeErrors.increment(),a}return i}async performHandshakeResponder(e,t,n,o){let i,s=o?.skipStreamMuxerNegotiation===!0?[]:[...this.components.upgrader.getStreamMuxers().keys()];try{i=await C_({connection:e,privateKey:t,remoteIdentityKey:n,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:{streamMuxers:s,webtransportCerthashes:[],...this.extensions}},o),this.metrics?.xxHandshakeSuccesses.increment()}catch(a){throw this.metrics?.xxHandshakeErrors.increment(),a}return i}async createSecureConnection(e,t){let[n,o]=J1(),i=e.unwrap();return await e_(n,O_(t,this.metrics),i,s=>ei(s,{lengthDecoder:Ru}),P_(t,this.metrics),n),o}};function B_(r={}){return e=>new $p(e,r)}var pg=Object.values(Do).map(r=>r.decoder).reduce((r,e)=>r.or(e)),qT=/^a=fingerprint:(?:\w+-[0-9]+)\s(?<fingerprint>(:?[0-9a-fA-F]{2})+)$/m;function k_(r){return r?.match(qT)?.groups?.fingerprint}function hg(r){let t=r.stringTuples().filter(n=>n[0]===sb).map(n=>n[1])[0];if(t===void 0||t==="")throw new Ie(`Couldn't find a certhash component of multiaddr: ${r.toString()}`);return t}function zT(r){return vr.decode(pg.decode(r))}function XT(r){let e=zT(hg(r)),t=ZT(e.code),n=e.digest.reduce((i,s)=>i+s.toString(16).padStart(2,"0"),""),o=n.match(/.{1,2}/g);if(o==null)throw new of(n,r.toString());return`${t} ${o.join(":").toUpperCase()}`}function N_(r){let e=r.split(":").map(o=>parseInt(o,16)),t=Uint8Array.from(e),n=At(sr.code,t);return xn(`/certhash/${No.encode(n.bytes)}`)}function ZT(r){switch(r){case 17:return"sha-1";case 18:return"sha-256";case 19:return"sha-512";default:throw new af(r)}}function D_(r,e){let{host:t,port:n,family:o}=r.toOptions(),i=XT(r);return{type:"answer",sdp:`v=0
o=- 0 0 IN IP${o} ${t}
s=-
t=0 0
a=ice-lite
m=application ${n} UDP/DTLS/SCTP webrtc-datachannel
c=IN IP${o} ${t}
a=mid:0
a=ice-options:ice2
a=ice-ufrag:${e}
a=ice-pwd:${e}
a=fingerprint:${i}
a=setup:passive
a=sctp-port:5000
a=max-message-size:${Cs}
a=candidate:1467250027 1 UDP 1467250027 ${t} ${n} typ host
a=end-of-candidates
`}}function j_(r,e){let{host:t,port:n,family:o}=r.toOptions();return{type:"offer",sdp:`v=0
o=- 0 0 IN IP${o} ${t}
s=-
c=IN IP${o} ${t}
t=0 0
a=ice-options:ice2,trickle
m=application ${n} UDP/DTLS/SCTP webrtc-datachannel
a=mid:0
a=setup:active
a=ice-ufrag:${e}
a=ice-pwd:${e}
a=fingerprint:sha-256 00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00
a=sctp-port:5000
a=max-message-size:${Cs}
a=candidate:1467250027 1 UDP 1467250027 ${t} ${n} typ host
a=end-of-candidates
`}}function dg(r,e){if(r.sdp===void 0)throw new Ie("Can't munge a missing SDP");let t=r.sdp.includes(`\r
`)?`\r
`:`
`;return r.sdp=r.sdp.replace(/\na=ice-ufrag:[^\n]*\n/,`
a=ice-ufrag:`+e+t).replace(/\na=ice-pwd:[^\n]*\n/,`
a=ice-pwd:`+e+t),r}var yg=he("libp2p-webrtc-noise:");function L_(r,e,t){let n=r.trim().toLowerCase().replaceAll(":",""),o=he(n,"hex"),i=At(sr.code,o),s=pg.decode(hg(e)),a=yg.byteLength+i.bytes.byteLength+s.byteLength;return t==="server"?Bt([yg,s,i.bytes],a):Bt([yg,i.bytes,s],a)}var YT=dc?"iceconnectionstatechange":"connectionstatechange";async function U_(r,e,t){let n=r.createDataChannel("",{negotiated:!0,id:0});try{if(t.role==="client"){t.log.trace("client creating local offer");let p=await r.createOffer();t.log.trace("client created local offer %s",p.sdp);let y=dg(p,e);t.log.trace("client setting local offer %s",y.sdp),await r.setLocalDescription(y);let m=D_(t.remoteAddr,e);t.log.trace("client setting server description %s",m.sdp),await r.setRemoteDescription(m)}else{let p=j_(t.remoteAddr,e);t.log.trace("server setting client %s %s",p.type,p.sdp),await r.setRemoteDescription(p),t.log.trace("server creating local answer");let y=await r.createAnswer();t.log.trace("server created local answer");let m=dg(y,e);t.log.trace("server setting local description %s",y.sdp),await r.setLocalDescription(m)}if(n.readyState!=="open"&&(t.log.trace("%s wait for handshake channel to open, starting status %s",t.role,n.readyState),await gc(n,"open",t.signal)),t.log.trace("%s handshake channel opened",t.role),t.role==="server"){let p=r.remoteFingerprint()?.value??"";t.remoteAddr=t.remoteAddr.encapsulate(N_(p))}let o=k_(r.localDescription?.sdp);if(o==null)throw new no("Could not get fingerprint from local description sdp");t.log.trace("%s performing noise handshake",t.role);let i=L_(o,t.remoteAddr,t.role),s=B_({prologueBytes:i})(t),a=Ps({channel:n,direction:"outbound",handshake:!0,logger:t.logger,...t.dataChannel??{}}),c=new Jo(t,{peerConnection:r,remoteAddr:t.remoteAddr,timeline:{open:Date.now()},metrics:t.events});r.addEventListener(YT,()=>{switch(r.connectionState){case"failed":case"disconnected":case"closed":c.close().catch(p=>{t.log.error("error closing connection",p),c.abort(p)});break;default:break}}),t.events?.increment({peer_connection:!0});let l=new ro(t,{peerConnection:r,metrics:t.events,dataChannelOptions:t.dataChannel});if(t.role==="client")return t.log.trace("%s secure inbound",t.role),await s.secureInbound(a,{remotePeer:t.remotePeerId,signal:t.signal,skipStreamMuxerNegotiation:!0}),t.log.trace("%s upgrade outbound",t.role),await t.upgrader.upgradeOutbound(c,{skipProtection:!0,skipEncryption:!0,muxerFactory:l,signal:t.signal});t.log.trace("%s secure outbound",t.role);let f=await s.secureOutbound(a,{remotePeer:t.remotePeerId,signal:t.signal,skipStreamMuxerNegotiation:!0});c.remoteAddr=c.remoteAddr.encapsulate(`/p2p/${f.remotePeer}`),t.log.trace("%s upgrade inbound",t.role),await t.upgrader.upgradeInbound(c,{skipProtection:!0,skipEncryption:!0,muxerFactory:l,signal:t.signal})}catch(o){throw n.close(),o}}async function M_(r,e,t,n){n==null&&(n=await RTCPeerConnection.generateCertificate({name:"ECDSA",namedCurve:"P-256"}));let o=typeof t=="function"?await t():t;return new RTCPeerConnection({...o??{},certificates:[n]})}async function K_(r){let e=await El(r),t=await crypto.subtle.exportKey("pkcs8",e.privateKey);return["-----BEGIN PRIVATE KEY-----",...le(new Uint8Array(t),"base64pad").split(/(.{64})/).filter(Boolean),"-----END PRIVATE KEY-----"].join(`
`)}var Fp=class{log;metrics;components;init;certificate;privateKey;emitter;renewCertificateTask;constructor(e,t={}){if(this.log=e.logger.forComponent("libp2p:webrtc-direct"),this.components=e,this.init=t,this.emitter=new Fn,t.certificateLifespan!=null&&t.certificateRenewalThreshold!=null&&t.certificateRenewalThreshold>=t.certificateLifespan)throw new Ie("Certificate renewal threshold must be less than certificate lifespan");e.metrics!=null&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_webrtc-direct_dialer_events_total",{label:"event",help:"Total count of WebRTC-direct dial events by type"})})}[Hu]=!0;[Symbol.toStringTag]="@libp2p/webrtc-direct";[es]=["@libp2p/transport"];async start(){this.certificate=await this.getCertificate()}async stop(){this.renewCertificateTask!=null&&clearTimeout(this.renewCertificateTask),this.certificate=void 0}async dial(e,t){this.log("dial %a",e),t.signal.throwIfAborted();let n,o=e.getPeerId();o!=null&&(n=Cl(o));let i=Eb(),s=await M_("client",i,typeof this.init.rtcConfiguration=="function"?await this.init.rtcConfiguration():this.init.rtcConfiguration??{});try{return await U_(s,i,{role:"client",log:this.log,logger:this.components.logger,metrics:this.components.metrics,events:this.metrics?.dialerEvents,signal:t.signal,remoteAddr:e,dataChannel:this.init.dataChannel,upgrader:t.upgrader,peerId:this.components.peerId,remotePeerId:n,privateKey:this.components.privateKey})}catch(a){throw s.close(),a}}createListener(e){if(this.certificate==null)throw new Zu;return new jp(this.components,{...this.init,...e,certificate:this.certificate,emitter:this.emitter})}listenFilter(e){return e.filter(eb.exactMatch)}dialFilter(e){return this.listenFilter(e)}async getCertificate(e){if(JT(this.init.certificate))return this.log("using provided TLS certificate"),this.init.certificate;let t=await this.loadOrCreatePrivateKey(),{pem:n,certhash:o}=await this.loadOrCreateCertificate(t,e);return{privateKey:await K_(t),pem:n,certhash:o}}async loadOrCreatePrivateKey(){if(this.privateKey!=null)return this.privateKey;let e=this.init.certificateKeychainName??db,t=this.getKeychain();try{if(t==null)throw this.log("no keychain configured - not checking for stored private key"),new Bo;this.log.trace("checking for stored private key"),this.privateKey=await t.exportKey(e)}catch(n){if(n.name!=="NotFoundError")throw n;this.log.trace("generating private key"),this.privateKey=await Cw("ECDSA","P-256"),t!=null?(this.log.trace("storing private key"),await t.importKey(e,this.privateKey)):this.log("no keychain configured - not storing private key")}return this.privateKey}async loadOrCreateCertificate(e,t){if(this.certificate!=null&&t!==!0)return this.certificate;let n,o=new ju(this.init.certificateDatastoreKey??hb),i=await El(e);try{if(t===!0)throw this.log.trace("forcing renewal of TLS certificate"),new Bo;this.log.trace("checking for stored TLS certificate"),n=await this.loadCertificate(o,i)}catch(a){if(a.name!=="NotFoundError")throw a;this.log.trace("generating new TLS certificate"),n=await this.createCertificate(o,i)}let s=n.notAfter.getTime()-(this.init.certificateRenewalThreshold??Vd)-Date.now();return s<0&&(s=100),this.log("will renew TLS certificate after %d ms",s),this.renewCertificateTask=setTimeout(()=>{this.log("renewing TLS certificate"),this.getCertificate(!0).then(a=>{this.certificate=a,this.emitter.safeDispatchEvent("certificate:renew",{detail:a})}).catch(a=>{this.log.error("could not renew certificate - %e",a)})},s),{pem:n.toString("pem"),certhash:No.encode((await sr.digest(new Uint8Array(n.rawData))).bytes)}}async loadCertificate(e,t){let n=await this.components.datastore.get(e),o=new ma(n),i=o.notAfter.getTime()-(this.init.certificateRenewalThreshold??Vd);if(Date.now()>i)throw this.log("stored TLS certificate has expired"),new Bo;this.log("loaded certificate, expires in %d ms",i);let s=await o.publicKey.export(crypto),a=await crypto.subtle.exportKey("raw",s),c=await crypto.subtle.exportKey("raw",t.publicKey);if(!We(new Uint8Array(a,0,a.byteLength),new Uint8Array(c,0,c.byteLength)))throw this.log("stored TLS certificate public key did not match public key from private key"),new Bo;return this.log("loaded certificate, expiry time is %o",i),o}async createCertificate(e,t){let n=new Date,o=new Date(Date.now()+(this.init.certificateLifespan??yb));n.setMilliseconds(0),o.setMilliseconds(0);let i=await Np.createSelfSigned({serialNumber:(BigInt(Math.random().toString().replace(".",""))*100000n).toString(16),name:"CN=example.com, C=US, L=CA, O=example, ST=CA",notBefore:n,notAfter:o,keys:t,extensions:[new ha(!1,void 0,!0)]},crypto);return this.getKeychain()!=null?(this.log.trace("storing TLS certificate"),await this.components.datastore.put(e,he(i.toString("pem")))):this.log("no keychain is configured so not storing TLS certificate since the private key will not be reused"),i}getKeychain(){try{return this.components.keychain}catch{}}};function JT(r){return r==null?!1:typeof r.privateKey=="string"&&typeof r.pem=="string"&&typeof r.certhash=="string"}function QT(r){return e=>new Fp(e,r)}function eI(r){return e=>new ff(e,r)}return rS(tI);})();
/*! Bundled license information:

reflect-metadata/Reflect.js:
  (*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0
  
  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.
  
  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** *)

pvtsutils/build/index.js:
  (*!
   * MIT License
   * 
   * Copyright (c) 2017-2024 Peculiar Ventures, LLC
   * 
   * Permission is hereby granted, free of charge, to any person obtaining a copy
   * of this software and associated documentation files (the "Software"), to deal
   * in the Software without restriction, including without limitation the rights
   * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
   * copies of the Software, and to permit persons to whom the Software is
   * furnished to do so, subject to the following conditions:
   * 
   * The above copyright notice and this permission notice shall be included in all
   * copies or substantial portions of the Software.
   * 
   * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
   * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
   * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
   * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
   * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
   * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
   * SOFTWARE.
   * 
   *)

tslib/tslib.js:
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/utils.js:
@noble/curves/esm/abstract/modular.js:
@noble/curves/esm/abstract/curve.js:
@noble/curves/esm/abstract/edwards.js:
@noble/curves/esm/abstract/montgomery.js:
@noble/curves/esm/ed25519.js:
@noble/curves/esm/abstract/weierstrass.js:
@noble/curves/esm/_shortw_utils.js:
@noble/curves/esm/secp256k1.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

pvutils/build/utils.es.js:
  (*!
   Copyright (c) Peculiar Ventures, LLC
  *)

asn1js/build/index.es.js:
  (*!
   * Copyright (c) 2014, GMO GlobalSign
   * Copyright (c) 2015-2022, Peculiar Ventures
   * All rights reserved.
   * 
   * Author 2014-2019, Yury Strozhevsky
   * 
   * Redistribution and use in source and binary forms, with or without modification,
   * are permitted provided that the following conditions are met:
   * 
   * * Redistributions of source code must retain the above copyright notice, this
   *   list of conditions and the following disclaimer.
   * 
   * * Redistributions in binary form must reproduce the above copyright notice, this
   *   list of conditions and the following disclaimer in the documentation and/or
   *   other materials provided with the distribution.
   * 
   * * Neither the name of the copyright holder nor the names of its
   *   contributors may be used to endorse or promote products derived from
   *   this software without specific prior written permission.
   * 
   * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
   * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
   * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
   * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
   * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
   * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
   * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
   * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
   * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
   * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
   * 
   *)

@peculiar/x509/build/x509.es.js:
  (*!
   * MIT License
   * 
   * Copyright (c) Peculiar Ventures. All rights reserved.
   * 
   * Permission is hereby granted, free of charge, to any person obtaining a copy
   * of this software and associated documentation files (the "Software"), to deal
   * in the Software without restriction, including without limitation the rights
   * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
   * copies of the Software, and to permit persons to whom the Software is
   * furnished to do so, subject to the following conditions:
   * 
   * The above copyright notice and this permission notice shall be included in all
   * copies or substantial portions of the Software.
   * 
   * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
   * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
   * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
   * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
   * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
   * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
   * SOFTWARE.
   * 
   *)

@noble/ciphers/esm/utils.js:
  (*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) *)
*/
return Libp2PWebrtc}));
//# sourceMappingURL=index.min.js.map
