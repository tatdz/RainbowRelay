(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.IpfsUnixfsImporter = factory()}(typeof self !== 'undefined' ? self : this, function () {
"use strict";var IpfsUnixfsImporter=(()=>{var yn=Object.create;var Ft=Object.defineProperty;var xn=Object.getOwnPropertyDescriptor;var bn=Object.getOwnPropertyNames;var Bn=Object.getPrototypeOf,_n=Object.prototype.hasOwnProperty;var jt=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports),I=(r,t)=>{for(var e in t)Ft(r,e,{get:t[e],enumerable:!0})},Xe=(r,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of bn(t))!_n.call(r,i)&&i!==e&&Ft(r,i,{get:()=>t[i],enumerable:!(n=xn(t,i))||n.enumerable});return r};var Ke=(r,t,e)=>(e=r!=null?yn(Bn(r)):{},Xe(t||!r||!r.__esModule?Ft(e,"default",{value:r,enumerable:!0}):e,r)),An=r=>Xe(Ft({},"__esModule",{value:!0}),r);var Yr=jt((Lt,Xt)=>{(function(r,t){"use strict";var e={version:"3.0.0",x86:{},x64:{},inputValidation:!0};function n(s){if(!Array.isArray(s)&&!ArrayBuffer.isView(s))return!1;for(var h=0;h<s.length;h++)if(!Number.isInteger(s[h])||s[h]<0||s[h]>255)return!1;return!0}function i(s,h){return(s&65535)*h+(((s>>>16)*h&65535)<<16)}function o(s,h){return s<<h|s>>>32-h}function a(s){return s^=s>>>16,s=i(s,2246822507),s^=s>>>13,s=i(s,3266489909),s^=s>>>16,s}function c(s,h){s=[s[0]>>>16,s[0]&65535,s[1]>>>16,s[1]&65535],h=[h[0]>>>16,h[0]&65535,h[1]>>>16,h[1]&65535];var d=[0,0,0,0];return d[3]+=s[3]+h[3],d[2]+=d[3]>>>16,d[3]&=65535,d[2]+=s[2]+h[2],d[1]+=d[2]>>>16,d[2]&=65535,d[1]+=s[1]+h[1],d[0]+=d[1]>>>16,d[1]&=65535,d[0]+=s[0]+h[0],d[0]&=65535,[d[0]<<16|d[1],d[2]<<16|d[3]]}function l(s,h){s=[s[0]>>>16,s[0]&65535,s[1]>>>16,s[1]&65535],h=[h[0]>>>16,h[0]&65535,h[1]>>>16,h[1]&65535];var d=[0,0,0,0];return d[3]+=s[3]*h[3],d[2]+=d[3]>>>16,d[3]&=65535,d[2]+=s[2]*h[3],d[1]+=d[2]>>>16,d[2]&=65535,d[2]+=s[3]*h[2],d[1]+=d[2]>>>16,d[2]&=65535,d[1]+=s[1]*h[3],d[0]+=d[1]>>>16,d[1]&=65535,d[1]+=s[2]*h[2],d[0]+=d[1]>>>16,d[1]&=65535,d[1]+=s[3]*h[1],d[0]+=d[1]>>>16,d[1]&=65535,d[0]+=s[0]*h[3]+s[1]*h[2]+s[2]*h[1]+s[3]*h[0],d[0]&=65535,[d[0]<<16|d[1],d[2]<<16|d[3]]}function x(s,h){return h%=64,h===32?[s[1],s[0]]:h<32?[s[0]<<h|s[1]>>>32-h,s[1]<<h|s[0]>>>32-h]:(h-=32,[s[1]<<h|s[0]>>>32-h,s[0]<<h|s[1]>>>32-h])}function f(s,h){return h%=64,h===0?s:h<32?[s[0]<<h|s[1]>>>32-h,s[1]<<h]:[s[1]<<h-32,0]}function y(s,h){return[s[0]^h[0],s[1]^h[1]]}function S(s){return s=y(s,[0,s[0]>>>1]),s=l(s,[4283543511,3981806797]),s=y(s,[0,s[0]>>>1]),s=l(s,[3301882366,444984403]),s=y(s,[0,s[0]>>>1]),s}e.x86.hash32=function(s,h){if(e.inputValidation&&!n(s))return t;h=h||0;for(var d=s.length%4,E=s.length-d,u=h,p=0,m=3432918353,w=461845907,b=0;b<E;b=b+4)p=s[b]|s[b+1]<<8|s[b+2]<<16|s[b+3]<<24,p=i(p,m),p=o(p,15),p=i(p,w),u^=p,u=o(u,13),u=i(u,5)+3864292196;switch(p=0,d){case 3:p^=s[b+2]<<16;case 2:p^=s[b+1]<<8;case 1:p^=s[b],p=i(p,m),p=o(p,15),p=i(p,w),u^=p}return u^=s.length,u=a(u),u>>>0},e.x86.hash128=function(s,h){if(e.inputValidation&&!n(s))return t;h=h||0;for(var d=s.length%16,E=s.length-d,u=h,p=h,m=h,w=h,b=0,B=0,g=0,A=0,O=597399067,vt=2869860233,zt=951274213,Ct=2716044179,_=0;_<E;_=_+16)b=s[_]|s[_+1]<<8|s[_+2]<<16|s[_+3]<<24,B=s[_+4]|s[_+5]<<8|s[_+6]<<16|s[_+7]<<24,g=s[_+8]|s[_+9]<<8|s[_+10]<<16|s[_+11]<<24,A=s[_+12]|s[_+13]<<8|s[_+14]<<16|s[_+15]<<24,b=i(b,O),b=o(b,15),b=i(b,vt),u^=b,u=o(u,19),u+=p,u=i(u,5)+1444728091,B=i(B,vt),B=o(B,16),B=i(B,zt),p^=B,p=o(p,17),p+=m,p=i(p,5)+197830471,g=i(g,zt),g=o(g,17),g=i(g,Ct),m^=g,m=o(m,15),m+=w,m=i(m,5)+2530024501,A=i(A,Ct),A=o(A,18),A=i(A,O),w^=A,w=o(w,13),w+=u,w=i(w,5)+850148119;switch(b=0,B=0,g=0,A=0,d){case 15:A^=s[_+14]<<16;case 14:A^=s[_+13]<<8;case 13:A^=s[_+12],A=i(A,Ct),A=o(A,18),A=i(A,O),w^=A;case 12:g^=s[_+11]<<24;case 11:g^=s[_+10]<<16;case 10:g^=s[_+9]<<8;case 9:g^=s[_+8],g=i(g,zt),g=o(g,17),g=i(g,Ct),m^=g;case 8:B^=s[_+7]<<24;case 7:B^=s[_+6]<<16;case 6:B^=s[_+5]<<8;case 5:B^=s[_+4],B=i(B,vt),B=o(B,16),B=i(B,zt),p^=B;case 4:b^=s[_+3]<<24;case 3:b^=s[_+2]<<16;case 2:b^=s[_+1]<<8;case 1:b^=s[_],b=i(b,O),b=o(b,15),b=i(b,vt),u^=b}return u^=s.length,p^=s.length,m^=s.length,w^=s.length,u+=p,u+=m,u+=w,p+=u,m+=u,w+=u,u=a(u),p=a(p),m=a(m),w=a(w),u+=p,u+=m,u+=w,p+=u,m+=u,w+=u,("00000000"+(u>>>0).toString(16)).slice(-8)+("00000000"+(p>>>0).toString(16)).slice(-8)+("00000000"+(m>>>0).toString(16)).slice(-8)+("00000000"+(w>>>0).toString(16)).slice(-8)},e.x64.hash128=function(s,h){if(e.inputValidation&&!n(s))return t;h=h||0;for(var d=s.length%16,E=s.length-d,u=[0,h],p=[0,h],m=[0,0],w=[0,0],b=[2277735313,289559509],B=[1291169091,658871167],g=0;g<E;g=g+16)m=[s[g+4]|s[g+5]<<8|s[g+6]<<16|s[g+7]<<24,s[g]|s[g+1]<<8|s[g+2]<<16|s[g+3]<<24],w=[s[g+12]|s[g+13]<<8|s[g+14]<<16|s[g+15]<<24,s[g+8]|s[g+9]<<8|s[g+10]<<16|s[g+11]<<24],m=l(m,b),m=x(m,31),m=l(m,B),u=y(u,m),u=x(u,27),u=c(u,p),u=c(l(u,[0,5]),[0,1390208809]),w=l(w,B),w=x(w,33),w=l(w,b),p=y(p,w),p=x(p,31),p=c(p,u),p=c(l(p,[0,5]),[0,944331445]);switch(m=[0,0],w=[0,0],d){case 15:w=y(w,f([0,s[g+14]],48));case 14:w=y(w,f([0,s[g+13]],40));case 13:w=y(w,f([0,s[g+12]],32));case 12:w=y(w,f([0,s[g+11]],24));case 11:w=y(w,f([0,s[g+10]],16));case 10:w=y(w,f([0,s[g+9]],8));case 9:w=y(w,[0,s[g+8]]),w=l(w,B),w=x(w,33),w=l(w,b),p=y(p,w);case 8:m=y(m,f([0,s[g+7]],56));case 7:m=y(m,f([0,s[g+6]],48));case 6:m=y(m,f([0,s[g+5]],40));case 5:m=y(m,f([0,s[g+4]],32));case 4:m=y(m,f([0,s[g+3]],24));case 3:m=y(m,f([0,s[g+2]],16));case 2:m=y(m,f([0,s[g+1]],8));case 1:m=y(m,[0,s[g]]),m=l(m,b),m=x(m,31),m=l(m,B),u=y(u,m)}return u=y(u,[0,s.length]),p=y(p,[0,s.length]),u=c(u,p),p=c(p,u),u=S(u),p=S(p),u=c(u,p),p=c(p,u),("00000000"+(u[0]>>>0).toString(16)).slice(-8)+("00000000"+(u[1]>>>0).toString(16)).slice(-8)+("00000000"+(p[0]>>>0).toString(16)).slice(-8)+("00000000"+(p[1]>>>0).toString(16)).slice(-8)},typeof Lt<"u"?(typeof Xt<"u"&&Xt.exports&&(Lt=Xt.exports=e),Lt.murmurHash3=e):typeof define=="function"&&define.amd?define([],function(){return e}):(e._murmurHash3=r.murmurHash3,e.noConflict=function(){return r.murmurHash3=e._murmurHash3,e._murmurHash3=t,e.noConflict=t,e},r.murmurHash3=e)})(Lt)});var en=jt((Ic,tn)=>{tn.exports=Yr()});var sn=jt((Cc,on)=>{"use strict";on.exports=class{constructor(){this._bitArrays=[],this._data=[],this._length=0,this._changedLength=!1,this._changedData=!1}set(t,e){let n=this._internalPositionFor(t,!1);if(e===void 0)n!==-1&&(this._unsetInternalPos(n),this._unsetBit(t),this._changedLength=!0,this._changedData=!0);else{let i=!1;n===-1?(n=this._data.length,this._setBit(t),this._changedData=!0):i=!0,this._setInternalPos(n,t,e,i),this._changedLength=!0}}unset(t){this.set(t,void 0)}get(t){this._sortData();let e=this._internalPositionFor(t,!0);if(e!==-1)return this._data[e][1]}push(t){return this.set(this.length,t),this.length}get length(){if(this._sortData(),this._changedLength){let t=this._data[this._data.length-1];this._length=t?t[0]+1:0,this._changedLength=!1}return this._length}forEach(t){let e=0;for(;e<this.length;)t(this.get(e),e,this),e++}map(t){let e=0,n=new Array(this.length);for(;e<this.length;)n[e]=t(this.get(e),e,this),e++;return n}reduce(t,e){let n=0,i=e;for(;n<this.length;){let o=this.get(n);i=t(i,o,n),n++}return i}find(t){let e=0,n,i;for(;e<this.length&&!n;)i=this.get(e),n=t(i),e++;return n?i:void 0}_internalPositionFor(t,e){let n=this._bytePosFor(t,e);if(n>=this._bitArrays.length)return-1;let i=this._bitArrays[n],o=t-n*7;if(!((i&1<<o)>0))return-1;let c=this._bitArrays.slice(0,n).reduce(Bo,0),l=~(4294967295<<o+1),x=nn(i&l);return c+x-1}_bytePosFor(t,e){let n=Math.floor(t/7),i=n+1;for(;!e&&this._bitArrays.length<i;)this._bitArrays.push(0);return n}_setBit(t){let e=this._bytePosFor(t,!1);this._bitArrays[e]|=1<<t-e*7}_unsetBit(t){let e=this._bytePosFor(t,!1);this._bitArrays[e]&=~(1<<t-e*7)}_setInternalPos(t,e,n,i){let o=this._data,a=[e,n];if(i)this._sortData(),o[t]=a;else{if(o.length)if(o[o.length-1][0]>=e)o.push(a);else if(o[0][0]<=e)o.unshift(a);else{let c=Math.round(o.length/2);this._data=o.slice(0,c).concat(a).concat(o.slice(c))}else this._data.push(a);this._changedData=!0,this._changedLength=!0}}_unsetInternalPos(t){this._data.splice(t,1)}_sortData(){this._changedData&&this._data.sort(_o),this._changedData=!1}bitField(){let t=[],e=8,n=0,i=0,o,a=this._bitArrays.slice();for(;a.length||n;){n===0&&(o=a.shift(),n=7);let l=Math.min(n,e),x=~(255<<l),f=o&x;i|=f<<8-e,o=o>>>l,n-=l,e-=l,(!e||!n&&!a.length)&&(t.push(i),i=0,e=8)}for(var c=t.length-1;c>0&&t[c]===0;c--)t.pop();return t}compactArray(){return this._sortData(),this._data.map(Ao)}};function Bo(r,t){return r+nn(t)}function nn(r){let t=r;return t=t-(t>>1&1431655765),t=(t&858993459)+(t>>2&858993459),(t+(t>>4)&252645135)*16843009>>24}function _o(r,t){return r[0]-t[0]}function Ao(r){return r[1]}});var Vo={};I(Vo,{InvalidAvgChunkSizeError:()=>Me,InvalidChunkSizeError:()=>Ve,InvalidContentError:()=>q,InvalidMinChunkSizeError:()=>Re,InvalidParametersError:()=>ut,importByteStream:()=>Mo,importBytes:()=>Uo,importDirectory:()=>Po,importFile:()=>qe,importer:()=>$e});function Sn(r){return r[Symbol.asyncIterator]!=null}function kn(r){if(Sn(r))return(async()=>{for await(let t of r)return t})();for(let t of r)return t}var Zt=kn;function En(r){return r[Symbol.asyncIterator]!=null}function In(r,t=1){return t=Number(t),En(r)?async function*(){let e=[];if(t<1&&(t=1),t!==Math.round(t))throw new Error("Batch size must be an integer");for await(let n of r)for(e.push(n);e.length>=t;)yield e.slice(0,t),e=e.slice(t);for(;e.length>0;)yield e.slice(0,t),e=e.slice(t)}():function*(){let e=[];if(t<1&&(t=1),t!==Math.round(t))throw new Error("Batch size must be an integer");for(let n of r)for(e.push(n);e.length>=t;)yield e.slice(0,t),e=e.slice(t);for(;e.length>0;)yield e.slice(0,t),e=e.slice(t)}()}var Pt=In;async function*lt(r,t=1){for await(let e of Pt(r,t)){let n=e.map(async i=>i().then(o=>({ok:!0,value:o}),o=>({ok:!1,err:o})));for(let i=0;i<n.length;i++){let o=await n[i];if(o.ok)yield o.value;else throw o.err}}}function G(r=0){return new Uint8Array(r)}function v(r=0){return new Uint8Array(r)}function dt(r,t){t==null&&(t=r.reduce((i,o)=>i+o.length,0));let e=v(t),n=0;for(let i of r)e.set(i,n),n+=i.length;return e}function We(r,t){if(r===t)return!0;if(r.byteLength!==t.byteLength)return!1;for(let e=0;e<r.byteLength;e++)if(r[e]!==t[e])return!1;return!0}var je=Symbol.for("@achingbrain/uint8arraylist");function Je(r,t){if(t==null||t<0)throw new RangeError("index is out of bounds");let e=0;for(let n of r){let i=e+n.byteLength;if(t<i)return{buf:n,index:t-e};e=i}throw new RangeError("index is out of bounds")}function Ut(r){return!!r?.[je]}var et=class r{bufs;length;[je]=!0;constructor(...t){this.bufs=[],this.length=0,t.length>0&&this.appendAll(t)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...t){this.appendAll(t)}appendAll(t){let e=0;for(let n of t)if(n instanceof Uint8Array)e+=n.byteLength,this.bufs.push(n);else if(Ut(n))e+=n.byteLength,this.bufs.push(...n.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=e}prepend(...t){this.prependAll(t)}prependAll(t){let e=0;for(let n of t.reverse())if(n instanceof Uint8Array)e+=n.byteLength,this.bufs.unshift(n);else if(Ut(n))e+=n.byteLength,this.bufs.unshift(...n.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=e}get(t){let e=Je(this.bufs,t);return e.buf[e.index]}set(t,e){let n=Je(this.bufs,t);n.buf[n.index]=e}write(t,e=0){if(t instanceof Uint8Array)for(let n=0;n<t.length;n++)this.set(e+n,t[n]);else if(Ut(t))for(let n=0;n<t.length;n++)this.set(e+n,t.get(n));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(t){if(t=Math.trunc(t),!(Number.isNaN(t)||t<=0)){if(t===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(t>=this.bufs[0].byteLength)t-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(t),this.length-=t;break}}}slice(t,e){let{bufs:n,length:i}=this._subList(t,e);return dt(n,i)}subarray(t,e){let{bufs:n,length:i}=this._subList(t,e);return n.length===1?n[0]:dt(n,i)}sublist(t,e){let{bufs:n,length:i}=this._subList(t,e),o=new r;return o.length=i,o.bufs=[...n],o}_subList(t,e){if(t=t??0,e=e??this.length,t<0&&(t=this.length+t),e<0&&(e=this.length+e),t<0||e>this.length)throw new RangeError("index is out of bounds");if(t===e)return{bufs:[],length:0};if(t===0&&e===this.length)return{bufs:this.bufs,length:this.length};let n=[],i=0;for(let o=0;o<this.bufs.length;o++){let a=this.bufs[o],c=i,l=c+a.byteLength;if(i=l,t>=l)continue;let x=t>=c&&t<l,f=e>c&&e<=l;if(x&&f){if(t===c&&e===l){n.push(a);break}let y=t-c;n.push(a.subarray(y,y+(e-t)));break}if(x){if(t===0){n.push(a);continue}n.push(a.subarray(t-c));continue}if(f){if(e===l){n.push(a);break}n.push(a.subarray(0,e-c));break}n.push(a)}return{bufs:n,length:e-t}}indexOf(t,e=0){if(!Ut(t)&&!(t instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');let n=t instanceof Uint8Array?t:t.subarray();if(e=Number(e??0),isNaN(e)&&(e=0),e<0&&(e=this.length+e),e<0&&(e=0),t.length===0)return e>this.length?this.length:e;let i=n.byteLength;if(i===0)throw new TypeError("search must be at least 1 byte long");let o=256,a=new Int32Array(o);for(let y=0;y<o;y++)a[y]=-1;for(let y=0;y<i;y++)a[n[y]]=y;let c=a,l=this.byteLength-n.byteLength,x=n.byteLength-1,f;for(let y=e;y<=l;y+=f){f=0;for(let S=x;S>=0;S--){let s=this.get(y+S);if(n[S]!==s){f=Math.max(1,S-c[s]);break}}if(f===0)return y}return-1}getInt8(t){let e=this.subarray(t,t+1);return new DataView(e.buffer,e.byteOffset,e.byteLength).getInt8(0)}setInt8(t,e){let n=v(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,e),this.write(n,t)}getInt16(t,e){let n=this.subarray(t,t+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,e)}setInt16(t,e,n){let i=G(2);new DataView(i.buffer,i.byteOffset,i.byteLength).setInt16(0,e,n),this.write(i,t)}getInt32(t,e){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,e)}setInt32(t,e,n){let i=G(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setInt32(0,e,n),this.write(i,t)}getBigInt64(t,e){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,e)}setBigInt64(t,e,n){let i=G(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setBigInt64(0,e,n),this.write(i,t)}getUint8(t){let e=this.subarray(t,t+1);return new DataView(e.buffer,e.byteOffset,e.byteLength).getUint8(0)}setUint8(t,e){let n=v(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,e),this.write(n,t)}getUint16(t,e){let n=this.subarray(t,t+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,e)}setUint16(t,e,n){let i=G(2);new DataView(i.buffer,i.byteOffset,i.byteLength).setUint16(0,e,n),this.write(i,t)}getUint32(t,e){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,e)}setUint32(t,e,n){let i=G(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setUint32(0,e,n),this.write(i,t)}getBigUint64(t,e){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,e)}setBigUint64(t,e,n){let i=G(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setBigUint64(0,e,n),this.write(i,t)}getFloat32(t,e){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,e)}setFloat32(t,e,n){let i=G(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setFloat32(0,e,n),this.write(i,t)}getFloat64(t,e){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,e)}setFloat64(t,e,n){let i=G(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setFloat64(0,e,n),this.write(i,t)}equals(t){if(t==null||!(t instanceof r)||t.bufs.length!==this.bufs.length)return!1;for(let e=0;e<this.bufs.length;e++)if(!We(this.bufs[e],t.bufs[e]))return!1;return!0}static fromUint8Arrays(t,e){let n=new r;return n.bufs=t,e==null&&(e=t.reduce((i,o)=>i+o.byteLength,0)),n.length=e,n}};var Dn=262144,Ze=(r={})=>{let t=r.chunkSize??Dn;return async function*(n){let i=new et,o=0,a=!1;for await(let c of n)for(i.append(c),o+=c.length;o>=t;)if(yield i.slice(0,t),a=!0,t===i.length)i=new et,o=0;else{let l=new et;l.append(i.sublist(t)),i=l,o-=t}(!a||o>0)&&(yield i.subarray(0,o))}};var bt={};I(bt,{code:()=>Di,createLink:()=>yr,createNode:()=>wr,decode:()=>Ni,encode:()=>C,name:()=>Ii,prepare:()=>z,validate:()=>le});var oe={};I(oe,{base32:()=>it,base32hex:()=>Hn,base32hexpad:()=>Gn,base32hexpadupper:()=>$n,base32hexupper:()=>On,base32pad:()=>Vn,base32padupper:()=>Rn,base32upper:()=>Mn,base32z:()=>qn});var rt={};I(rt,{coerce:()=>P,empty:()=>Qe,equals:()=>Qt,fromHex:()=>Tn,fromString:()=>Yt,isBinary:()=>Ln,toHex:()=>Nn,toString:()=>te});var Qe=new Uint8Array(0);function Nn(r){return r.reduce((t,e)=>t+e.toString(16).padStart(2,"0"),"")}function Tn(r){let t=r.match(/../g);return t!=null?new Uint8Array(t.map(e=>parseInt(e,16))):Qe}function Qt(r,t){if(r===t)return!0;if(r.byteLength!==t.byteLength)return!1;for(let e=0;e<r.byteLength;e++)if(r[e]!==t[e])return!1;return!0}function P(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function Ln(r){return r instanceof ArrayBuffer||ArrayBuffer.isView(r)}function Yt(r){return new TextEncoder().encode(r)}function te(r){return new TextDecoder().decode(r)}function vn(r,t){if(r.length>=255)throw new TypeError("Alphabet too long");for(var e=new Uint8Array(256),n=0;n<e.length;n++)e[n]=255;for(var i=0;i<r.length;i++){var o=r.charAt(i),a=o.charCodeAt(0);if(e[a]!==255)throw new TypeError(o+" is ambiguous");e[a]=i}var c=r.length,l=r.charAt(0),x=Math.log(c)/Math.log(256),f=Math.log(256)/Math.log(c);function y(h){if(h instanceof Uint8Array||(ArrayBuffer.isView(h)?h=new Uint8Array(h.buffer,h.byteOffset,h.byteLength):Array.isArray(h)&&(h=Uint8Array.from(h))),!(h instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(h.length===0)return"";for(var d=0,E=0,u=0,p=h.length;u!==p&&h[u]===0;)u++,d++;for(var m=(p-u)*f+1>>>0,w=new Uint8Array(m);u!==p;){for(var b=h[u],B=0,g=m-1;(b!==0||B<E)&&g!==-1;g--,B++)b+=256*w[g]>>>0,w[g]=b%c>>>0,b=b/c>>>0;if(b!==0)throw new Error("Non-zero carry");E=B,u++}for(var A=m-E;A!==m&&w[A]===0;)A++;for(var O=l.repeat(d);A<m;++A)O+=r.charAt(w[A]);return O}function S(h){if(typeof h!="string")throw new TypeError("Expected String");if(h.length===0)return new Uint8Array;var d=0;if(h[d]!==" "){for(var E=0,u=0;h[d]===l;)E++,d++;for(var p=(h.length-d)*x+1>>>0,m=new Uint8Array(p);h[d];){var w=e[h.charCodeAt(d)];if(w===255)return;for(var b=0,B=p-1;(w!==0||b<u)&&B!==-1;B--,b++)w+=c*m[B]>>>0,m[B]=w%256>>>0,w=w/256>>>0;if(w!==0)throw new Error("Non-zero carry");u=b,d++}if(h[d]!==" "){for(var g=p-u;g!==p&&m[g]===0;)g++;for(var A=new Uint8Array(E+(p-g)),O=E;g!==p;)A[O++]=m[g++];return A}}}function s(h){var d=S(h);if(d)return d;throw new Error(`Non-${t} character`)}return{encode:y,decodeUnsafe:S,decode:s}}var zn=vn,Cn=zn,Ye=Cn;var ee=class{name;prefix;baseEncode;constructor(t,e,n){this.name=t,this.prefix=e,this.baseEncode=n}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}},re=class{name;prefix;baseDecode;prefixCodePoint;constructor(t,e,n){this.name=t,this.prefix=e;let i=e.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return tr(this,t)}},ne=class{decoders;constructor(t){this.decoders=t}or(t){return tr(this,t)}decode(t){let e=t[0],n=this.decoders[e];if(n!=null)return n.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function tr(r,t){return new ne({...r.decoders??{[r.prefix]:r},...t.decoders??{[t.prefix]:t}})}var ie=class{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(t,e,n,i){this.name=t,this.prefix=e,this.baseEncode=n,this.baseDecode=i,this.encoder=new ee(t,e,n),this.decoder=new re(t,e,i)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}};function nt({name:r,prefix:t,encode:e,decode:n}){return new ie(r,t,e,n)}function X({name:r,prefix:t,alphabet:e}){let{encode:n,decode:i}=Ye(e,r);return nt({prefix:t,name:r,encode:n,decode:o=>P(i(o))})}function Fn(r,t,e,n){let i=r.length;for(;r[i-1]==="=";)--i;let o=new Uint8Array(i*e/8|0),a=0,c=0,l=0;for(let x=0;x<i;++x){let f=t[r[x]];if(f===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<e|f,a+=e,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=e||(255&c<<8-a)!==0)throw new SyntaxError("Unexpected end of data");return o}function Pn(r,t,e){let n=t[t.length-1]==="=",i=(1<<e)-1,o="",a=0,c=0;for(let l=0;l<r.length;++l)for(c=c<<8|r[l],a+=8;a>e;)a-=e,o+=t[i&c>>a];if(a!==0&&(o+=t[i&c<<e-a]),n)for(;(o.length*e&7)!==0;)o+="=";return o}function Un(r){let t={};for(let e=0;e<r.length;++e)t[r[e]]=e;return t}function k({name:r,prefix:t,bitsPerChar:e,alphabet:n}){let i=Un(n);return nt({prefix:t,name:r,encode(o){return Pn(o,n,e)},decode(o){return Fn(o,i,e,r)}})}var it=k({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Mn=k({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Vn=k({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Rn=k({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Hn=k({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),On=k({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Gn=k({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),$n=k({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),qn=k({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var se={};I(se,{base36:()=>pt,base36upper:()=>Xn});var pt=X({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Xn=X({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var ae={};I(ae,{base58btc:()=>R,base58flickr:()=>Kn});var R=X({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Kn=X({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Wn=nr,er=128,Jn=127,jn=~Jn,Zn=Math.pow(2,31);function nr(r,t,e){t=t||[],e=e||0;for(var n=e;r>=Zn;)t[e++]=r&255|er,r/=128;for(;r&jn;)t[e++]=r&255|er,r>>>=7;return t[e]=r|0,nr.bytes=e-n+1,t}var Qn=ce,Yn=128,rr=127;function ce(r,n){var e=0,n=n||0,i=0,o=n,a,c=r.length;do{if(o>=c)throw ce.bytes=0,new RangeError("Could not decode varint");a=r[o++],e+=i<28?(a&rr)<<i:(a&rr)*Math.pow(2,i),i+=7}while(a>=Yn);return ce.bytes=o-n,e}var ti=Math.pow(2,7),ei=Math.pow(2,14),ri=Math.pow(2,21),ni=Math.pow(2,28),ii=Math.pow(2,35),oi=Math.pow(2,42),si=Math.pow(2,49),ai=Math.pow(2,56),ci=Math.pow(2,63),hi=function(r){return r<ti?1:r<ei?2:r<ri?3:r<ni?4:r<ii?5:r<oi?6:r<si?7:r<ai?8:r<ci?9:10},fi={encode:Wn,decode:Qn,encodingLength:hi},ui=fi,mt=ui;function gt(r,t=0){return[mt.decode(r,t),mt.decode.bytes]}function ot(r,t,e=0){return mt.encode(r,t,e),t}function st(r){return mt.encodingLength(r)}function j(r,t){let e=t.byteLength,n=st(r),i=n+st(e),o=new Uint8Array(i+e);return ot(r,o,0),ot(e,o,n),o.set(t,i),new at(r,e,t,o)}function ir(r){let t=P(r),[e,n]=gt(t),[i,o]=gt(t.subarray(n)),a=t.subarray(n+o);if(a.byteLength!==i)throw new Error("Incorrect length");return new at(e,i,a,t)}function or(r,t){if(r===t)return!0;{let e=t;return r.code===e.code&&r.size===e.size&&e.bytes instanceof Uint8Array&&Qt(r.bytes,e.bytes)}}var at=class{code;size;digest;bytes;constructor(t,e,n,i){this.code=t,this.size=e,this.digest=n,this.bytes=i}};function sr(r,t){let{bytes:e,version:n}=r;switch(n){case 0:return di(e,he(r),t??R.encoder);default:return pi(e,he(r),t??it.encoder)}}var ar=new WeakMap;function he(r){let t=ar.get(r);if(t==null){let e=new Map;return ar.set(r,e),e}return t}var D=class r{code;version;multihash;bytes;"/";constructor(t,e,n,i){this.code=e,this.version=t,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:t,multihash:e}=this;if(t!==yt)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(e.code!==mi)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return r.createV0(e)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:t,digest:e}=this.multihash,n=j(t,e);return r.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(t){return r.equals(this,t)}static equals(t,e){let n=e;return n!=null&&t.code===n.code&&t.version===n.version&&or(t.multihash,n.multihash)}toString(t){return sr(this,t)}toJSON(){return{"/":sr(this)}}link(){return this}[Symbol.toStringTag]="CID";[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(t){if(t==null)return null;let e=t;if(e instanceof r)return e;if(e["/"]!=null&&e["/"]===e.bytes||e.asCID===e){let{version:n,code:i,multihash:o,bytes:a}=e;return new r(n,i,o,a??cr(n,i,o.bytes))}else if(e[gi]===!0){let{version:n,multihash:i,code:o}=e,a=ir(i);return r.create(n,o,a)}else return null}static create(t,e,n){if(typeof e!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(t){case 0:{if(e!==yt)throw new Error(`Version 0 CID must use dag-pb (code: ${yt}) block encoding`);return new r(t,e,n,n.bytes)}case 1:{let i=cr(t,e,n.bytes);return new r(t,e,n,i)}default:throw new Error("Invalid version")}}static createV0(t){return r.create(0,yt,t)}static createV1(t,e){return r.create(1,t,e)}static decode(t){let[e,n]=r.decodeFirst(t);if(n.length!==0)throw new Error("Incorrect length");return e}static decodeFirst(t){let e=r.inspectBytes(t),n=e.size-e.multihashSize,i=P(t.subarray(n,n+e.multihashSize));if(i.byteLength!==e.multihashSize)throw new Error("Incorrect length");let o=i.subarray(e.multihashSize-e.digestSize),a=new at(e.multihashCode,e.digestSize,o,i);return[e.version===0?r.createV0(a):r.createV1(e.codec,a),t.subarray(e.size)]}static inspectBytes(t){let e=0,n=()=>{let[y,S]=gt(t.subarray(e));return e+=S,y},i=n(),o=yt;if(i===18?(i=0,e=0):o=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);let a=e,c=n(),l=n(),x=e+l,f=x-a;return{version:i,codec:o,multihashCode:c,digestSize:l,multihashSize:f,size:x}}static parse(t,e){let[n,i]=li(t,e),o=r.decode(i);if(o.version===0&&t[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return he(o).set(n,t),o}};function li(r,t){switch(r[0]){case"Q":{let e=t??R;return[R.prefix,e.decode(`${R.prefix}${r}`)]}case R.prefix:{let e=t??R;return[R.prefix,e.decode(r)]}case it.prefix:{let e=t??it;return[it.prefix,e.decode(r)]}case pt.prefix:{let e=t??pt;return[pt.prefix,e.decode(r)]}default:{if(t==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],t.decode(r)]}}}function di(r,t,e){let{prefix:n}=e;if(n!==R.prefix)throw Error(`Cannot string encode V0 in ${e.name} encoding`);let i=t.get(n);if(i==null){let o=e.encode(r).slice(1);return t.set(n,o),o}else return i}function pi(r,t,e){let{prefix:n}=e,i=t.get(n);if(i==null){let o=e.encode(r);return t.set(n,o),o}else return i}var yt=112,mi=18;function cr(r,t,e){let n=st(r),i=n+st(t),o=new Uint8Array(i+e.byteLength);return ot(r,o,0),ot(t,o,n),o.set(e,i),o}var gi=Symbol.for("@ipld/js-cid/CID");var wi=new TextDecoder;function fe(r,t){let e=0;for(let n=0;;n+=7){if(n>=64)throw new Error("protobuf: varint overflow");if(t>=r.length)throw new Error("protobuf: unexpected end of data");let i=r[t++];if(e+=n<28?(i&127)<<n:(i&127)*2**n,i<128)break}return[e,t]}function Vt(r,t){let e;[e,t]=fe(r,t);let n=t+e;if(e<0||n<0)throw new Error("protobuf: invalid length");if(n>r.length)throw new Error("protobuf: unexpected end of data");return[r.subarray(t,n),n]}function hr(r,t){let e;return[e,t]=fe(r,t),[e&7,e>>3,t]}function yi(r){let t={},e=r.length,n=0;for(;n<e;){let i,o;if([i,o,n]=hr(r,n),o===1){if(t.Hash)throw new Error("protobuf: (PBLink) duplicate Hash section");if(i!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Hash`);if(t.Name!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Name before Hash");if(t.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[t.Hash,n]=Vt(r,n)}else if(o===2){if(t.Name!==void 0)throw new Error("protobuf: (PBLink) duplicate Name section");if(i!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Name`);if(t.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Name");let a;[a,n]=Vt(r,n),t.Name=wi.decode(a)}else if(o===3){if(t.Tsize!==void 0)throw new Error("protobuf: (PBLink) duplicate Tsize section");if(i!==0)throw new Error(`protobuf: (PBLink) wrong wireType (${i}) for Tsize`);[t.Tsize,n]=fe(r,n)}else throw new Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${o}`)}if(n>e)throw new Error("protobuf: (PBLink) unexpected end of data");return t}function fr(r){let t=r.length,e=0,n,i=!1,o;for(;e<t;){let c,l;if([c,l,e]=hr(r,e),c!==2)throw new Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${c}`);if(l===1){if(o)throw new Error("protobuf: (PBNode) duplicate Data section");[o,e]=Vt(r,e),n&&(i=!0)}else if(l===2){if(i)throw new Error("protobuf: (PBNode) duplicate Links section");n||(n=[]);let x;[x,e]=Vt(r,e),n.push(yi(x))}else throw new Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${l}`)}if(e>t)throw new Error("protobuf: (PBNode) unexpected end of data");let a={};return o&&(a.Data=o),a.Links=n||[],a}var lr=new TextEncoder,ur=2**32,xi=2**31;function bi(r,t){let e=t.length;if(typeof r.Tsize=="number"){if(r.Tsize<0)throw new Error("Tsize cannot be negative");if(!Number.isSafeInteger(r.Tsize))throw new Error("Tsize too large for encoding");e=xt(t,e,r.Tsize)-1,t[e]=24}if(typeof r.Name=="string"){let n=lr.encode(r.Name);e-=n.length,t.set(n,e),e=xt(t,e,n.length)-1,t[e]=18}return r.Hash&&(e-=r.Hash.length,t.set(r.Hash,e),e=xt(t,e,r.Hash.length)-1,t[e]=10),t.length-e}function dr(r){let t=_i(r),e=new Uint8Array(t),n=t;if(r.Data&&(n-=r.Data.length,e.set(r.Data,n),n=xt(e,n,r.Data.length)-1,e[n]=10),r.Links)for(let i=r.Links.length-1;i>=0;i--){let o=bi(r.Links[i],e.subarray(0,n));n-=o,n=xt(e,n,o)-1,e[n]=18}return e}function Bi(r){let t=0;if(r.Hash){let e=r.Hash.length;t+=1+e+ct(e)}if(typeof r.Name=="string"){let e=lr.encode(r.Name).length;t+=1+e+ct(e)}return typeof r.Tsize=="number"&&(t+=1+ct(r.Tsize)),t}function _i(r){let t=0;if(r.Data){let e=r.Data.length;t+=1+e+ct(e)}if(r.Links)for(let e of r.Links){let n=Bi(e);t+=1+n+ct(n)}return t}function xt(r,t,e){t-=ct(e);let n=t;for(;e>=xi;)r[t++]=e&127|128,e/=128;for(;e>=128;)r[t++]=e&127|128,e>>>=7;return r[t]=e,n}function ct(r){return r%2===0&&r++,Math.floor((Ai(r)+6)/7)}function Ai(r){let t=0;return r>=ur&&(r=Math.floor(r/ur),t=32),r>=65536&&(r>>>=16,t+=16),r>=256&&(r>>>=8,t+=8),t+Si[r]}var Si=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8];var ki=["Data","Links"],Ei=["Hash","Name","Tsize"],ue=new TextEncoder;function mr(r,t){if(r===t)return 0;let e=r.Name?ue.encode(r.Name):[],n=t.Name?ue.encode(t.Name):[],i=e.length,o=n.length;for(let a=0,c=Math.min(i,o);a<c;++a)if(e[a]!==n[a]){i=e[a],o=n[a];break}return i<o?-1:o<i?1:0}function pr(r,t){return!Object.keys(r).some(e=>!t.includes(e))}function gr(r){if(typeof r.asCID=="object"){let e=D.asCID(r);if(!e)throw new TypeError("Invalid DAG-PB form");return{Hash:e}}if(typeof r!="object"||Array.isArray(r))throw new TypeError("Invalid DAG-PB form");let t={};if(r.Hash){let e=D.asCID(r.Hash);try{e||(typeof r.Hash=="string"?e=D.parse(r.Hash):r.Hash instanceof Uint8Array&&(e=D.decode(r.Hash)))}catch(n){throw new TypeError(`Invalid DAG-PB form: ${n.message}`)}e&&(t.Hash=e)}if(!t.Hash)throw new TypeError("Invalid DAG-PB form");return typeof r.Name=="string"&&(t.Name=r.Name),typeof r.Tsize=="number"&&(t.Tsize=r.Tsize),t}function z(r){if((r instanceof Uint8Array||typeof r=="string")&&(r={Data:r}),typeof r!="object"||Array.isArray(r))throw new TypeError("Invalid DAG-PB form");let t={};if(r.Data!==void 0)if(typeof r.Data=="string")t.Data=ue.encode(r.Data);else if(r.Data instanceof Uint8Array)t.Data=r.Data;else throw new TypeError("Invalid DAG-PB form");if(r.Links!==void 0)if(Array.isArray(r.Links))t.Links=r.Links.map(gr),t.Links.sort(mr);else throw new TypeError("Invalid DAG-PB form");else t.Links=[];return t}function le(r){if(!r||typeof r!="object"||Array.isArray(r)||r instanceof Uint8Array||r["/"]&&r["/"]===r.bytes)throw new TypeError("Invalid DAG-PB form");if(!pr(r,ki))throw new TypeError("Invalid DAG-PB form (extraneous properties)");if(r.Data!==void 0&&!(r.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form (Data must be bytes)");if(!Array.isArray(r.Links))throw new TypeError("Invalid DAG-PB form (Links must be a list)");for(let t=0;t<r.Links.length;t++){let e=r.Links[t];if(!e||typeof e!="object"||Array.isArray(e)||e instanceof Uint8Array||e["/"]&&e["/"]===e.bytes)throw new TypeError("Invalid DAG-PB form (bad link)");if(!pr(e,Ei))throw new TypeError("Invalid DAG-PB form (extraneous properties on link)");if(e.Hash===void 0)throw new TypeError("Invalid DAG-PB form (link must have a Hash)");if(e.Hash==null||!e.Hash["/"]||e.Hash["/"]!==e.Hash.bytes)throw new TypeError("Invalid DAG-PB form (link Hash must be a CID)");if(e.Name!==void 0&&typeof e.Name!="string")throw new TypeError("Invalid DAG-PB form (link Name must be a string)");if(e.Tsize!==void 0){if(typeof e.Tsize!="number"||e.Tsize%1!==0)throw new TypeError("Invalid DAG-PB form (link Tsize must be an integer)");if(e.Tsize<0)throw new TypeError("Invalid DAG-PB form (link Tsize cannot be negative)")}if(t>0&&mr(e,r.Links[t-1])===-1)throw new TypeError("Invalid DAG-PB form (links must be sorted by Name bytes)")}}function wr(r,t=[]){return z({Data:r,Links:t})}function yr(r,t,e){return gr({Hash:e,Name:r,Tsize:t})}function xr(r){return r instanceof ArrayBuffer?new Uint8Array(r,0,r.byteLength):r}var Ii="dag-pb",Di=112;function C(r){le(r);let t={};return r.Links&&(t.Links=r.Links.map(e=>{let n={};return e.Hash&&(n.Hash=e.Hash.bytes),e.Name!==void 0&&(n.Name=e.Name),e.Tsize!==void 0&&(n.Tsize=e.Tsize),n})),r.Data&&(t.Data=r.Data),dr(t)}function Ni(r){let t=xr(r),e=fr(t),n={};return e.Data&&(n.Data=e.Data),e.Links&&(n.Links=e.Links.map(i=>{let o={};try{o.Hash=D.decode(i.Hash)}catch{}if(!o.Hash)throw new Error("Invalid Hash field found in link, expected CID");return i.Name!==void 0&&(o.Name=i.Name),i.Tsize!==void 0&&(o.Tsize=i.Tsize),o})),n}var Bt=class r extends Error{static name="InvalidTypeError";static code="ERR_INVALID_TYPE";name=r.name;code=r.code;constructor(t="Invalid type"){super(t)}},Rt=class r extends Error{static name="InvalidUnixFSMessageError";static code="ERR_INVALID_MESSAGE";name=r.name;code=r.code;constructor(t="Invalid message"){super(t)}};var Ti=Math.pow(2,7),Li=Math.pow(2,14),vi=Math.pow(2,21),br=Math.pow(2,28),Br=Math.pow(2,35),_r=Math.pow(2,42),Ar=Math.pow(2,49),T=128,K=127;function _t(r){if(r<Ti)return 1;if(r<Li)return 2;if(r<vi)return 3;if(r<br)return 4;if(r<Br)return 5;if(r<_r)return 6;if(r<Ar)return 7;if(Number.MAX_SAFE_INTEGER!=null&&r>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function Sr(r,t,e=0){switch(_t(r)){case 8:t[e++]=r&255|T,r/=128;case 7:t[e++]=r&255|T,r/=128;case 6:t[e++]=r&255|T,r/=128;case 5:t[e++]=r&255|T,r/=128;case 4:t[e++]=r&255|T,r>>>=7;case 3:t[e++]=r&255|T,r>>>=7;case 2:t[e++]=r&255|T,r>>>=7;case 1:{t[e++]=r&255,r>>>=7;break}default:throw new Error("unreachable")}return t}function kr(r,t){let e=r[t],n=0;if(n+=e&K,e<T||(e=r[t+1],n+=(e&K)<<7,e<T)||(e=r[t+2],n+=(e&K)<<14,e<T)||(e=r[t+3],n+=(e&K)<<21,e<T)||(e=r[t+4],n+=(e&K)*br,e<T)||(e=r[t+5],n+=(e&K)*Br,e<T)||(e=r[t+6],n+=(e&K)*_r,e<T)||(e=r[t+7],n+=(e&K)*Ar,e<T))return n;throw new RangeError("Could not decode varint")}var de=new Float32Array([-0]),W=new Uint8Array(de.buffer);function Er(r,t,e){de[0]=r,t[e]=W[0],t[e+1]=W[1],t[e+2]=W[2],t[e+3]=W[3]}function Ir(r,t){return W[0]=r[t],W[1]=r[t+1],W[2]=r[t+2],W[3]=r[t+3],de[0]}var pe=new Float64Array([-0]),N=new Uint8Array(pe.buffer);function Dr(r,t,e){pe[0]=r,t[e]=N[0],t[e+1]=N[1],t[e+2]=N[2],t[e+3]=N[3],t[e+4]=N[4],t[e+5]=N[5],t[e+6]=N[6],t[e+7]=N[7]}function Nr(r,t){return N[0]=r[t],N[1]=r[t+1],N[2]=r[t+2],N[3]=r[t+3],N[4]=r[t+4],N[5]=r[t+5],N[6]=r[t+6],N[7]=r[t+7],pe[0]}var zi=BigInt(Number.MAX_SAFE_INTEGER),Ci=BigInt(Number.MIN_SAFE_INTEGER),F=class r{lo;hi;constructor(t,e){this.lo=t|0,this.hi=e|0}toNumber(t=!1){if(!t&&this.hi>>>31>0){let e=~this.lo+1>>>0,n=~this.hi>>>0;return e===0&&(n=n+1>>>0),-(e+n*4294967296)}return this.lo+this.hi*4294967296}toBigInt(t=!1){if(t)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){let e=~this.lo+1>>>0,n=~this.hi>>>0;return e===0&&(n=n+1>>>0),-(BigInt(e)+(BigInt(n)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(t=!1){return this.toBigInt(t).toString()}zzEncode(){let t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this}zzDecode(){let t=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this}length(){let t=this.lo,e=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?e===0?t<16384?t<128?1:2:t<2097152?3:4:e<16384?e<128?5:6:e<2097152?7:8:n<128?9:10}static fromBigInt(t){if(t===0n)return Z;if(t<zi&&t>Ci)return this.fromNumber(Number(t));let e=t<0n;e&&(t=-t);let n=t>>32n,i=t-(n<<32n);return e&&(n=~n|0n,i=~i|0n,++i>Tr&&(i=0n,++n>Tr&&(n=0n))),new r(Number(i),Number(n))}static fromNumber(t){if(t===0)return Z;let e=t<0;e&&(t=-t);let n=t>>>0,i=(t-n)/4294967296>>>0;return e&&(i=~i>>>0,n=~n>>>0,++n>4294967295&&(n=0,++i>4294967295&&(i=0))),new r(n,i)}static from(t){return typeof t=="number"?r.fromNumber(t):typeof t=="bigint"?r.fromBigInt(t):typeof t=="string"?r.fromBigInt(BigInt(t)):t.low!=null||t.high!=null?new r(t.low>>>0,t.high>>>0):Z}},Z=new F(0,0);Z.toBigInt=function(){return 0n};Z.zzEncode=Z.zzDecode=function(){return this};Z.length=function(){return 1};var Tr=4294967296n;function Lr(r){let t=0,e=0;for(let n=0;n<r.length;++n)e=r.charCodeAt(n),e<128?t+=1:e<2048?t+=2:(e&64512)===55296&&(r.charCodeAt(n+1)&64512)===56320?(++n,t+=4):t+=3;return t}function vr(r,t,e){if(e-t<1)return"";let i,o=[],a=0,c;for(;t<e;)c=r[t++],c<128?o[a++]=c:c>191&&c<224?o[a++]=(c&31)<<6|r[t++]&63:c>239&&c<365?(c=((c&7)<<18|(r[t++]&63)<<12|(r[t++]&63)<<6|r[t++]&63)-65536,o[a++]=55296+(c>>10),o[a++]=56320+(c&1023)):o[a++]=(c&15)<<12|(r[t++]&63)<<6|r[t++]&63,a>8191&&((i??(i=[])).push(String.fromCharCode.apply(String,o)),a=0);return i!=null?(a>0&&i.push(String.fromCharCode.apply(String,o.slice(0,a))),i.join("")):String.fromCharCode.apply(String,o.slice(0,a))}function me(r,t,e){let n=e,i,o;for(let a=0;a<r.length;++a)i=r.charCodeAt(a),i<128?t[e++]=i:i<2048?(t[e++]=i>>6|192,t[e++]=i&63|128):(i&64512)===55296&&((o=r.charCodeAt(a+1))&64512)===56320?(i=65536+((i&1023)<<10)+(o&1023),++a,t[e++]=i>>18|240,t[e++]=i>>12&63|128,t[e++]=i>>6&63|128,t[e++]=i&63|128):(t[e++]=i>>12|224,t[e++]=i>>6&63|128,t[e++]=i&63|128);return e-n}function U(r,t){return RangeError(`index out of range: ${r.pos} + ${t??1} > ${r.len}`)}function Ht(r,t){return(r[t-4]|r[t-3]<<8|r[t-2]<<16|r[t-1]<<24)>>>0}var ge=class{buf;pos;len;_slice=Uint8Array.prototype.subarray;constructor(t){this.buf=t,this.pos=0,this.len=t.length}uint32(){let t=4294967295;if(t=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(t=(t|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return t;if((this.pos+=5)>this.len)throw this.pos=this.len,U(this,10);return t}int32(){return this.uint32()|0}sint32(){let t=this.uint32();return t>>>1^-(t&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw U(this,4);return Ht(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw U(this,4);return Ht(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw U(this,4);let t=Ir(this.buf,this.pos);return this.pos+=4,t}double(){if(this.pos+8>this.len)throw U(this,4);let t=Nr(this.buf,this.pos);return this.pos+=8,t}bytes(){let t=this.uint32(),e=this.pos,n=this.pos+t;if(n>this.len)throw U(this,t);return this.pos+=t,e===n?new Uint8Array(0):this.buf.subarray(e,n)}string(){let t=this.bytes();return vr(t,0,t.length)}skip(t){if(typeof t=="number"){if(this.pos+t>this.len)throw U(this,t);this.pos+=t}else do if(this.pos>=this.len)throw U(this);while((this.buf[this.pos++]&128)!==0);return this}skipType(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(t=this.uint32()&7)!==4;)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${t} at offset ${this.pos}`)}return this}readLongVarint(){let t=new F(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(t.lo=(t.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(this.buf[this.pos]&127)<<28)>>>0,t.hi=(t.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return t;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw U(this);if(t.lo=(t.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,t}if(this.len-this.pos>4){for(;e<5;++e)if(t.hi=(t.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return t}else for(;e<5;++e){if(this.pos>=this.len)throw U(this);if(t.hi=(t.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw U(this,8);let t=Ht(this.buf,this.pos+=4),e=Ht(this.buf,this.pos+=4);return new F(t,e)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){let t=kr(this.buf,this.pos);return this.pos+=_t(t),t}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}};function we(r){return new ge(r instanceof Uint8Array?r:r.subarray())}function At(r,t,e){let n=we(r);return t.decode(n,void 0,e)}var ye={};I(ye,{base10:()=>Fi});var Fi=X({prefix:"9",name:"base10",alphabet:"0123456789"});var xe={};I(xe,{base16:()=>Pi,base16upper:()=>Ui});var Pi=k({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Ui=k({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var be={};I(be,{base2:()=>Mi});var Mi=k({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Be={};I(Be,{base256emoji:()=>Gi});var Cr=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),Vi=Cr.reduce((r,t,e)=>(r[e]=t,r),[]),Ri=Cr.reduce((r,t,e)=>{let n=t.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${t}`);return r[n]=e,r},[]);function Hi(r){return r.reduce((t,e)=>(t+=Vi[e],t),"")}function Oi(r){let t=[];for(let e of r){let n=e.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${e}`);let i=Ri[n];if(i==null)throw new Error(`Non-base256emoji character: ${e}`);t.push(i)}return new Uint8Array(t)}var Gi=nt({prefix:"\u{1F680}",name:"base256emoji",encode:Hi,decode:Oi});var _e={};I(_e,{base64:()=>$i,base64pad:()=>qi,base64url:()=>Xi,base64urlpad:()=>Ki});var $i=k({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),qi=k({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Xi=k({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Ki=k({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Ae={};I(Ae,{base8:()=>Wi});var Wi=k({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Se={};I(Se,{identity:()=>Ji});var Ji=nt({prefix:"\0",name:"identity",encode:r=>te(r),decode:r=>Yt(r)});var Ks=new TextEncoder,Ws=new TextDecoder;var St={};I(St,{code:()=>Ot,decode:()=>Yi,encode:()=>Qi,name:()=>Zi});var Zi="raw",Ot=85;function Qi(r){return P(r)}function Yi(r){return P(r)}var ke={};I(ke,{identity:()=>ro});var Fr=0,to="identity",Pr=P;function eo(r){return j(Fr,Pr(r))}var ro={code:Fr,name:to,encode:Pr,digest:eo};var De={};I(De,{sha256:()=>Ie,sha512:()=>no});function Q({name:r,code:t,encode:e}){return new Ee(r,t,e)}var Ee=class{name;code;encode;constructor(t,e,n){this.name=t,this.code=e,this.encode=n}digest(t){if(t instanceof Uint8Array){let e=this.encode(t);return e instanceof Uint8Array?j(this.code,e):e.then(n=>j(this.code,n))}else throw Error("Unknown type, must be binary type")}};function Mr(r){return async t=>new Uint8Array(await crypto.subtle.digest(r,t))}var Ie=Q({name:"sha2-256",code:18,encode:Mr("SHA-256")}),no=Q({name:"sha2-512",code:19,encode:Mr("SHA-512")});var Ne={...Se,...be,...Ae,...ye,...xe,...oe,...se,...ae,..._e,...Be},aa={...De,...ke};function Rr(r,t,e,n){return{name:r,prefix:t,encoder:{name:r,prefix:t,encode:e},decoder:{decode:n}}}var Vr=Rr("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),Te=Rr("ascii","a",r=>{let t="a";for(let e=0;e<r.length;e++)t+=String.fromCharCode(r[e]);return t},r=>{r=r.substring(1);let t=v(r.length);for(let e=0;e<r.length;e++)t[e]=r.charCodeAt(e);return t}),io={utf8:Vr,"utf-8":Vr,hex:Ne.base16,latin1:Te,ascii:Te,binary:Te,...Ne},Hr=io;function ht(r,t="utf8"){let e=Hr[t];if(e==null)throw new Error(`Unsupported encoding "${t}"`);return e.decoder.decode(`${e.prefix}${r}`)}function Le(r){let t=r??8192,e=t>>>1,n,i=t;return function(a){if(a<1||a>e)return v(a);i+a>t&&(n=v(t),i=0);let c=n.subarray(i,i+=a);return(i&7)!==0&&(i=(i|7)+1),c}}var Y=class{fn;len;next;val;constructor(t,e,n){this.fn=t,this.len=e,this.next=void 0,this.val=n}};function ve(){}var Ce=class{head;tail;len;next;constructor(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}},oo=Le();function so(r){return globalThis.Buffer!=null?v(r):oo(r)}var Et=class{len;head;tail;states;constructor(){this.len=0,this.head=new Y(ve,0,0),this.tail=this.head,this.states=null}_push(t,e,n){return this.tail=this.tail.next=new Y(t,e,n),this.len+=e,this}uint32(t){return this.len+=(this.tail=this.tail.next=new Fe((t=t>>>0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this}int32(t){return t<0?this._push(Gt,10,F.fromNumber(t)):this.uint32(t)}sint32(t){return this.uint32((t<<1^t>>31)>>>0)}uint64(t){let e=F.fromBigInt(t);return this._push(Gt,e.length(),e)}uint64Number(t){return this._push(Sr,_t(t),t)}uint64String(t){return this.uint64(BigInt(t))}int64(t){return this.uint64(t)}int64Number(t){return this.uint64Number(t)}int64String(t){return this.uint64String(t)}sint64(t){let e=F.fromBigInt(t).zzEncode();return this._push(Gt,e.length(),e)}sint64Number(t){let e=F.fromNumber(t).zzEncode();return this._push(Gt,e.length(),e)}sint64String(t){return this.sint64(BigInt(t))}bool(t){return this._push(ze,1,t?1:0)}fixed32(t){return this._push(kt,4,t>>>0)}sfixed32(t){return this.fixed32(t)}fixed64(t){let e=F.fromBigInt(t);return this._push(kt,4,e.lo)._push(kt,4,e.hi)}fixed64Number(t){let e=F.fromNumber(t);return this._push(kt,4,e.lo)._push(kt,4,e.hi)}fixed64String(t){return this.fixed64(BigInt(t))}sfixed64(t){return this.fixed64(t)}sfixed64Number(t){return this.fixed64Number(t)}sfixed64String(t){return this.fixed64String(t)}float(t){return this._push(Er,4,t)}double(t){return this._push(Dr,8,t)}bytes(t){let e=t.length>>>0;return e===0?this._push(ze,1,0):this.uint32(e)._push(co,e,t)}string(t){let e=Lr(t);return e!==0?this.uint32(e)._push(me,e,t):this._push(ze,1,0)}fork(){return this.states=new Ce(this),this.head=this.tail=new Y(ve,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Y(ve,0,0),this.len=0),this}ldelim(){let t=this.head,e=this.tail,n=this.len;return this.reset().uint32(n),n!==0&&(this.tail.next=t.next,this.tail=e,this.len+=n),this}finish(){let t=this.head.next,e=so(this.len),n=0;for(;t!=null;)t.fn(t.val,e,n),n+=t.len,t=t.next;return e}};function ze(r,t,e){t[e]=r&255}function ao(r,t,e){for(;r>127;)t[e++]=r&127|128,r>>>=7;t[e]=r}var Fe=class extends Y{next;constructor(t,e){super(ao,t,e),this.next=void 0}};function Gt(r,t,e){for(;r.hi!==0;)t[e++]=r.lo&127|128,r.lo=(r.lo>>>7|r.hi<<25)>>>0,r.hi>>>=7;for(;r.lo>127;)t[e++]=r.lo&127|128,r.lo=r.lo>>>7;t[e++]=r.lo}function kt(r,t,e){t[e]=r&255,t[e+1]=r>>>8&255,t[e+2]=r>>>16&255,t[e+3]=r>>>24}function co(r,t,e){t.set(r,e)}globalThis.Buffer!=null&&(Et.prototype.bytes=function(r){let t=r.length>>>0;return this.uint32(t),t>0&&this._push(ho,t,r),this},Et.prototype.string=function(r){let t=globalThis.Buffer.byteLength(r);return this.uint32(t),t>0&&this._push(fo,t,r),this});function ho(r,t,e){t.set(r,e)}function fo(r,t,e){r.length<40?me(r,t,e):t.utf8Write!=null?t.utf8Write(r,e):t.set(ht(r),e)}function Pe(){return new Et}function It(r,t){let e=Pe();return t.encode(r,e,{lengthDelimited:!1}),e.finish()}var ft;(function(r){r[r.VARINT=0]="VARINT",r[r.BIT64=1]="BIT64",r[r.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",r[r.START_GROUP=3]="START_GROUP",r[r.END_GROUP=4]="END_GROUP",r[r.BIT32=5]="BIT32"})(ft||(ft={}));function $t(r,t,e,n){return{name:r,type:t,encode:e,decode:n}}function Ue(r){function t(i){if(r[i.toString()]==null)throw new Error("Invalid enum value");return r[i]}let e=function(o,a){let c=t(o);a.int32(c)},n=function(o){let a=o.int32();return t(a)};return $t("enum",ft.VARINT,e,n)}function Dt(r,t){return $t("message",ft.LENGTH_DELIMITED,r,t)}var M;(function(r){let t;(function(i){i.Raw="Raw",i.Directory="Directory",i.File="File",i.Metadata="Metadata",i.Symlink="Symlink",i.HAMTShard="HAMTShard"})(t=r.DataType||(r.DataType={}));let e;(function(i){i[i.Raw=0]="Raw",i[i.Directory=1]="Directory",i[i.File=2]="File",i[i.Metadata=3]="Metadata",i[i.Symlink=4]="Symlink",i[i.HAMTShard=5]="HAMTShard"})(e||(e={})),function(i){i.codec=()=>Ue(e)}(t=r.DataType||(r.DataType={}));let n;r.codec=()=>(n==null&&(n=Dt((i,o,a={})=>{if(a.lengthDelimited!==!1&&o.fork(),i.Type!=null&&(o.uint32(8),r.DataType.codec().encode(i.Type,o)),i.Data!=null&&(o.uint32(18),o.bytes(i.Data)),i.filesize!=null&&(o.uint32(24),o.uint64(i.filesize)),i.blocksizes!=null)for(let c of i.blocksizes)o.uint32(32),o.uint64(c);i.hashType!=null&&(o.uint32(40),o.uint64(i.hashType)),i.fanout!=null&&(o.uint32(48),o.uint64(i.fanout)),i.mode!=null&&(o.uint32(56),o.uint32(i.mode)),i.mtime!=null&&(o.uint32(66),qt.codec().encode(i.mtime,o)),a.lengthDelimited!==!1&&o.ldelim()},(i,o)=>{let a={blocksizes:[]},c=o==null?i.len:i.pos+o;for(;i.pos<c;){let l=i.uint32();switch(l>>>3){case 1:a.Type=r.DataType.codec().decode(i);break;case 2:a.Data=i.bytes();break;case 3:a.filesize=i.uint64();break;case 4:a.blocksizes.push(i.uint64());break;case 5:a.hashType=i.uint64();break;case 6:a.fanout=i.uint64();break;case 7:a.mode=i.uint32();break;case 8:a.mtime=qt.codec().decode(i,i.uint32());break;default:i.skipType(l&7);break}}return a})),n),r.encode=i=>It(i,r.codec()),r.decode=i=>At(i,r.codec())})(M||(M={}));var qt;(function(r){let t;r.codec=()=>(t==null&&(t=Dt((e,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),e.Seconds!=null&&(n.uint32(8),n.int64(e.Seconds)),e.FractionalNanoseconds!=null&&(n.uint32(21),n.fixed32(e.FractionalNanoseconds)),i.lengthDelimited!==!1&&n.ldelim()},(e,n)=>{let i={},o=n==null?e.len:e.pos+n;for(;e.pos<o;){let a=e.uint32();switch(a>>>3){case 1:i.Seconds=e.int64();break;case 2:i.FractionalNanoseconds=e.fixed32();break;default:e.skipType(a&7);break}}return i})),t),r.encode=e=>It(e,r.codec()),r.decode=e=>At(e,r.codec())})(qt||(qt={}));var Or;(function(r){let t;r.codec=()=>(t==null&&(t=Dt((e,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),e.MimeType!=null&&(n.uint32(10),n.string(e.MimeType)),i.lengthDelimited!==!1&&n.ldelim()},(e,n)=>{let i={},o=n==null?e.len:e.pos+n;for(;e.pos<o;){let a=e.uint32();switch(a>>>3){case 1:i.MimeType=e.string();break;default:e.skipType(a&7);break}}return i})),t),r.encode=e=>It(e,r.codec()),r.decode=e=>At(e,r.codec())})(Or||(Or={}));var Gr={Raw:"raw",Directory:"directory",File:"file",Metadata:"metadata",Symlink:"symlink",HAMTShard:"hamt-sharded-directory"},uo=["directory","hamt-sharded-directory"],$r=parseInt("0644",8),qr=parseInt("0755",8),Xr=BigInt(1024),L=class r{static unmarshal(t){let e=M.decode(t);if(e.fanout!=null&&e.fanout>Xr)throw new Rt(`Fanout size was too large - ${e.fanout} > ${Xr}`);let n=new r({type:Gr[e.Type!=null?e.Type.toString():"File"],data:e.Data,blockSizes:e.blocksizes,mode:e.mode,mtime:e.mtime!=null?{secs:e.mtime.Seconds??0n,nsecs:e.mtime.FractionalNanoseconds}:void 0,fanout:e.fanout});return n._originalMode=e.mode??0,n}type;data;blockSizes;hashType;fanout;mtime;_mode;_originalMode;constructor(t={type:"file"}){let{type:e,data:n,blockSizes:i,hashType:o,fanout:a,mtime:c,mode:l}=t;if(e!=null&&!Object.values(Gr).includes(e))throw new Bt("Type: "+e+" is not valid");this.type=e??"file",this.data=n,this.hashType=o,this.fanout=a,this.blockSizes=i??[],this._originalMode=0,this.mode=l,this.mtime=c}set mode(t){t==null?this._mode=this.isDirectory()?qr:$r:this._mode=t&4095}get mode(){return this._mode}isDirectory(){return uo.includes(this.type)}addBlockSize(t){this.blockSizes.push(t)}removeBlockSize(t){this.blockSizes.splice(t,1)}fileSize(){if(this.isDirectory())return 0n;let t=0n;return this.blockSizes.forEach(e=>{t+=e}),this.data!=null&&(t+=BigInt(this.data.length)),t}marshal(){let t;switch(this.type){case"raw":t=M.DataType.Raw;break;case"directory":t=M.DataType.Directory;break;case"file":t=M.DataType.File;break;case"metadata":t=M.DataType.Metadata;break;case"symlink":t=M.DataType.Symlink;break;case"hamt-sharded-directory":t=M.DataType.HAMTShard;break;default:throw new Bt(`Type: ${t} is not valid`)}let e=this.data;(this.data==null||this.data.length===0)&&(e=void 0);let n;this.mode!=null&&(n=this._originalMode&4294963200|(this.mode??0),n===$r&&!this.isDirectory()&&(n=void 0),n===qr&&this.isDirectory()&&(n=void 0));let i;return this.mtime!=null&&(i={Seconds:this.mtime.secs,FractionalNanoseconds:this.mtime.nsecs}),M.encode({Type:t,Data:e,filesize:this.isDirectory()?void 0:this.fileSize(),blocksizes:this.blockSizes,hashType:this.hashType,fanout:this.fanout,mode:n,mtime:i})}};var $=class extends Event{type;detail;constructor(t,e){super(t),this.type=t,this.detail=e}};var V=async(r,t,e)=>{e.codec==null&&(e.codec=bt);let n=await Ie.digest(r),i=D.create(e.cidVersion,e.codec.code,n);return await t.put(i,r,e),i};function Kr(r){return async function*(e,n){let i=0n;for await(let o of e.content)yield async()=>{let a,c={codec:bt,cidVersion:r.cidVersion,onProgress:r.onProgress};r.rawLeaves?(c.codec=St,c.cidVersion=1):(a=new L({type:r.leafType,data:o}),o=C({Data:a.marshal(),Links:[]}));let l=await V(o,n,c);return i+=BigInt(o.byteLength),r.onProgress?.(new $("unixfs:importer:progress:file:write",{bytesWritten:i,cid:l,path:e.path})),{cid:l,unixfs:a,size:BigInt(o.length),block:o}}}}var ut=class r extends Error{static name="InvalidParametersError";static code="ERR_INVALID_PARAMS";name=r.name;code=r.code;constructor(t="Invalid parameters"){super(t)}},Me=class r extends Error{static name="InvalidAvgChunkSizeError";static code="ERR_INVALID_AVG_CHUNK_SIZE";name=r.name;code=r.code;constructor(t="Invalid avg chunk size"){super(t)}},Ve=class r extends Error{static name="InvalidChunkSizeError";static code="ERR_INVALID_CHUNK_SIZE";name=r.name;code=r.code;constructor(t="Invalid chunk size"){super(t)}},Re=class r extends Error{static name="InvalidMinChunkSizeError";static code="ERR_INVALID_MIN_CHUNK_SIZE";name=r.name;code=r.code;constructor(t="Invalid min chunk size"){super(t)}},q=class r extends Error{static name="InvalidContentError";static code="ERR_INVALID_CONTENT";name=r.name;code=r.code;constructor(t="Invalid content"){super(t)}};var Wr=async(r,t,e)=>{let n=new L({type:"directory",mtime:r.mtime,mode:r.mode}),i=C(z({Data:n.marshal()})),o=await V(i,t,e),a=r.path;return{cid:o,path:a,unixfs:n,size:BigInt(i.length),originalPath:r.originalPath,block:i}};async function*lo(r,t,e){let n=-1,i;for await(let o of lt(e.bufferImporter(r,t),e.blockWriteConcurrency)){if(n++,n===0){i={...o,single:!0};continue}else n===1&&i!=null&&(yield{...i,block:void 0,single:void 0},i=void 0);yield{...o,block:void 0}}i!=null&&(yield i)}function Jr(r){return r.single===!0}var po=(r,t,e)=>async function(i){if(i.length===1&&Jr(i[0])&&e.reduceSingleLeafToSelf){let f=i[0],y=f.block;return Jr(f)&&(r.mtime!==void 0||r.mode!==void 0)&&(f.unixfs=new L({type:"file",mtime:r.mtime,mode:r.mode,data:f.block}),y={Data:f.unixfs.marshal(),Links:[]},f.block=C(z(y)),f.cid=await V(f.block,t,{...e,cidVersion:e.cidVersion}),f.size=BigInt(f.block.length)),e.onProgress?.(new $("unixfs:importer:progress:file:layout",{cid:f.cid,path:f.originalPath})),{cid:f.cid,path:r.path,unixfs:f.unixfs,size:f.size,originalPath:f.originalPath}}let o=new L({type:"file",mtime:r.mtime,mode:r.mode}),a=i.filter(f=>f.cid.code===Ot&&f.size>0||f.unixfs!=null&&f.unixfs.data==null&&f.unixfs.fileSize()>0n?!0:!!f.unixfs?.data?.length).map(f=>f.cid.code===Ot?(o.addBlockSize(f.size),{Name:"",Tsize:Number(f.size),Hash:f.cid}):(f.unixfs?.data==null?o.addBlockSize(f.unixfs?.fileSize()??0n):o.addBlockSize(BigInt(f.unixfs.data.length)),{Name:"",Tsize:Number(f.size),Hash:f.cid})),c={Data:o.marshal(),Links:a},l=C(z(c)),x=await V(l,t,e);return e.onProgress?.(new $("unixfs:importer:progress:file:layout",{cid:x,path:r.originalPath})),{cid:x,path:r.path,unixfs:o,size:BigInt(l.length+c.Links.reduce((f,y)=>f+(y.Tsize??0),0)),originalPath:r.originalPath,block:l}},jr=async(r,t,e)=>e.layout(lo(r,t,e),po(r,t,e));function mo(r){return Symbol.iterator in r}function go(r){return Symbol.asyncIterator in r}function wo(r){try{if(r instanceof Uint8Array)return async function*(){yield r}();if(mo(r))return async function*(){yield*r}();if(go(r))return r}catch{throw new q("Content was invalid")}throw new q("Content was invalid")}function Zr(r){return async function*(e,n){for await(let i of e){let o;if(i.path!=null&&(o=i.path,i.path=i.path.split("/").filter(a=>a!=null&&a!==".").join("/")),yo(i)){let a={path:i.path,mtime:i.mtime,mode:i.mode,content:async function*(){let l=0n;for await(let x of r.chunker(r.chunkValidator(wo(i.content)))){let f=BigInt(x.byteLength);l+=f,r.onProgress?.(new $("unixfs:importer:progress:file:read",{bytesRead:l,chunkSize:f,path:i.path})),yield x}}(),originalPath:o},c=r.fileBuilder??jr;yield async()=>c(a,n,r)}else if(i.path!=null){let a={path:i.path,mtime:i.mtime,mode:i.mode,originalPath:o},c=r.dirBuilder??Wr;yield async()=>c(a,n,r)}else throw new Error("Import candidate must have content or path or both")}}}function yo(r){return r.content!=null}var Qr=()=>async function*(t){for await(let e of t){if(e.length===void 0)throw new q("Content was invalid");if(typeof e=="string"||e instanceof String)yield ht(e.toString());else if(Array.isArray(e))yield Uint8Array.from(e);else if(e instanceof Uint8Array)yield e;else throw new q("Content was invalid")}};var xo=174;function He(r){let t=r?.maxChildrenPerNode??xo;return async function e(n,i){let o=[];for await(let a of Pt(n,t))o.push(await i(a));return o.length>1?e(o,i):o[0]}}var H=class{options;root;dir;path;dirty;flat;parent;parentKey;unixfs;mode;mtime;cid;size;nodeSize;constructor(t,e){this.options=e??{},this.root=t.root,this.dir=t.dir,this.path=t.path,this.dirty=t.dirty,this.flat=t.flat,this.parent=t.parent,this.parentKey=t.parentKey,this.unixfs=t.unixfs,this.mode=t.mode,this.mtime=t.mtime}},Nt=D.parse("QmUNLLsPACCz1vLxQVkXqqLX5R1X345qqfHbsf67hvA3Nn"),Tt=D.parse("zdj7WbTaiJT1fgatdet9Ei9iDB5hdCxkbVyhyh8YTUnXMiwYi");var tt=class extends H{_children;constructor(t,e){super(t,e),this._children=new Map}async put(t,e){this.cid=void 0,this.size=void 0,this.nodeSize=void 0,this._children.set(t,e)}async get(t){return Promise.resolve(this._children.get(t))}childCount(){return this._children.size}directChildrenCount(){return this.childCount()}onlyChild(){return this._children.values().next().value}*eachChildSeries(){for(let[t,e]of this._children.entries())yield{key:t,child:e}}estimateNodeSize(){if(this.nodeSize!==void 0)return this.nodeSize;this.nodeSize=0;for(let[t,e]of this._children.entries())e.size!=null&&e.cid!=null&&(this.nodeSize+=t.length+(this.options.cidVersion===1?Tt.bytes.byteLength:Nt.bytes.byteLength));return this.nodeSize}async*flush(t){let e=[];for(let[l,x]of this._children.entries()){let f=x;if(x instanceof H)for await(let y of x.flush(t))f=y,yield y;f.size!=null&&f.cid!=null&&e.push({Name:l,Tsize:Number(f.size),Hash:f.cid})}let n=new L({type:"directory",mtime:this.mtime,mode:this.mode}),i={Data:n.marshal(),Links:e},o=C(z(i)),a=await V(o,t,this.options),c=o.length+i.Links.reduce((l,x)=>l+(x.Tsize??0),0);this.cid=a,this.size=c,yield{cid:a,unixfs:n,path:this.path,size:BigInt(c)}}};var Kt=Ke(en(),1);function bo(r){let t=new Array(4);for(let e=0;e<4;e++)t[e]=r&255,r=r>>8;return new Uint8Array(t)}var Tc=Q({name:"murmur3-32",code:35,encode:r=>bo(Kt.default.x86.hash32(r))}),rn=Q({name:"murmur3-128",code:34,encode:r=>rt.fromHex(Kt.default.x64.hash128(r))}),Lc=Q({name:"murmur3-x64-64",code:34,encode:r=>rt.fromHex(Kt.default.x64.hash128(r)).subarray(0,8)});var an=Ke(sn(),1);var J=class r{_options;_popCount;_parent;_posAtParent;_children;key;constructor(t,e,n=0){this._options=t,this._popCount=0,this._parent=e,this._posAtParent=n,this._children=new an.default,this.key=null}async put(t,e){let n=await this._findNewBucketAndPos(t);n.bucket._putAt(n,t,e)}async get(t){let e=await this._findChild(t);if(e!=null)return e.value}async del(t){let e=await this._findPlace(t),n=e.bucket._at(e.pos);n!=null&&n.key===t&&e.bucket._delAt(e.pos)}leafCount(){return this._children.compactArray().reduce((e,n)=>n instanceof r?e+n.leafCount():e+1,0)}childrenCount(){return this._children.length}onlyChild(){return this._children.get(0)}*eachLeafSeries(){let t=this._children.compactArray();for(let e of t)e instanceof r?yield*e.eachLeafSeries():yield e}serialize(t,e){let n=[];return e(this._children.reduce((i,o,a)=>(o!=null&&(o instanceof r?i.push(o.serialize(t,e)):i.push(t(o,a))),i),n))}async asyncTransform(t,e){return cn(this,t,e)}toJSON(){return this.serialize(ko,Eo)}prettyPrint(){return JSON.stringify(this.toJSON(),null,"  ")}tableSize(){return Math.pow(2,this._options.bits)}async _findChild(t){let e=await this._findPlace(t),n=e.bucket._at(e.pos);if(!(n instanceof r)&&n!=null&&n.key===t)return n}async _findPlace(t){let e=this._options.hash(typeof t=="string"?ht(t):t),n=await e.take(this._options.bits),i=this._children.get(n);return i instanceof r?i._findPlace(e):{bucket:this,pos:n,hash:e,existingChild:i}}async _findNewBucketAndPos(t){let e=await this._findPlace(t);if(e.existingChild!=null&&e.existingChild.key!==t){let n=new r(this._options,e.bucket,e.pos);e.bucket._putObjectAt(e.pos,n);let i=await n._findPlace(e.existingChild.hash);return i.bucket._putAt(i,e.existingChild.key,e.existingChild.value),n._findNewBucketAndPos(e.hash)}return e}_putAt(t,e,n){this._putObjectAt(t.pos,{key:e,value:n,hash:t.hash})}_putObjectAt(t,e){this._children.get(t)==null&&this._popCount++,this._children.set(t,e)}_delAt(t){if(t===-1)throw new Error("Invalid position");this._children.get(t)!=null&&this._popCount--,this._children.unset(t),this._level()}_level(){if(this._parent!=null&&this._popCount<=1)if(this._popCount===1){let t=this._children.find(So);if(t!=null&&!(t instanceof r)){let e=t.hash;e.untake(this._options.bits);let n={pos:this._posAtParent,hash:e,bucket:this._parent};this._parent._putAt(n,t.key,t.value)}}else this._parent._delAt(this._posAtParent)}_at(t){return this._children.get(t)}};function So(r){return!!r}function ko(r,t){return r.key}function Eo(r){return r}async function cn(r,t,e){let n=[];for(let i of r._children.compactArray())if(i instanceof J)await cn(i,t,e);else{let o=await t(i);n.push({bitField:r._children.bitField(),children:o})}return e(n)}var Io=[255,254,252,248,240,224,192,128],Do=[1,3,7,15,31,63,127,255],Wt=class{_value;_currentBytePos;_currentBitPos;constructor(t){this._value=t,this._currentBytePos=t.length-1,this._currentBitPos=7}availableBits(){return this._currentBitPos+1+this._currentBytePos*8}totalBits(){return this._value.length*8}take(t){let e=t,n=0;for(;e>0&&this._haveBits();){let i=this._value[this._currentBytePos],o=this._currentBitPos+1,a=Math.min(o,e),c=No(i,o-a,a);n=(n<<a)+c,e-=a,this._currentBitPos-=a,this._currentBitPos<0&&(this._currentBitPos=7,this._currentBytePos--)}return n}untake(t){for(this._currentBitPos+=t;this._currentBitPos>7;)this._currentBitPos-=8,this._currentBytePos+=1}_haveBits(){return this._currentBytePos>=0}};function No(r,t,e){let n=To(t,e);return(r&n)>>>t}function To(r,t){return Io[r]&Do[Math.min(t+r-1,7)]}function hn(r){function t(e){return e instanceof Jt?e:new Jt(e,r)}return t}var Jt=class{_value;_hashFn;_depth;_availableBits;_currentBufferIndex;_buffers;constructor(t,e){if(!(t instanceof Uint8Array))throw new Error("can only hash Uint8Arrays");this._value=t,this._hashFn=e,this._depth=-1,this._availableBits=0,this._currentBufferIndex=0,this._buffers=[]}async take(t){let e=t;for(;this._availableBits<e;)await this._produceMoreBits();let n=0;for(;e>0;){let i=this._buffers[this._currentBufferIndex],o=Math.min(i.availableBits(),e),a=i.take(o);n=(n<<o)+a,e-=o,this._availableBits-=o,i.availableBits()===0&&this._currentBufferIndex++}return n}untake(t){let e=t;for(;e>0;){let n=this._buffers[this._currentBufferIndex],i=Math.min(n.totalBits()-n.availableBits(),e);n.untake(i),e-=i,this._availableBits+=i,this._currentBufferIndex>0&&n.totalBits()===n.availableBits()&&(this._depth--,this._currentBufferIndex--)}}async _produceMoreBits(){this._depth++;let t=this._depth>0?dt([this._value,Uint8Array.from([this._depth])]):this._value,e=await this._hashFn(t),n=new Wt(e);this._buffers.push(n),this._availableBits+=n.availableBits()}};function fn(r){if(r==null||r.hashFn==null)throw new Error("please define an options.hashFn");let t={bits:r.bits??8,hash:hn(r.hashFn)};return new J(t)}async function Lo(r){return(await rn.encode(r)).slice(0,8).reverse()}var un=BigInt(34),vo=8,Oe=class extends H{_bucket;constructor(t,e){super(t,e),this._bucket=fn({hashFn:Lo,bits:e.shardFanoutBits??vo})}async put(t,e){this.cid=void 0,this.size=void 0,this.nodeSize=void 0,await this._bucket.put(t,e)}async get(t){return this._bucket.get(t)}childCount(){return this._bucket.leafCount()}directChildrenCount(){return this._bucket.childrenCount()}onlyChild(){return this._bucket.onlyChild()}*eachChildSeries(){for(let{key:t,value:e}of this._bucket.eachLeafSeries())yield{key:t,child:e}}estimateNodeSize(){return this.nodeSize!==void 0?this.nodeSize:(this.nodeSize=pn(this._bucket,this,this.options),this.nodeSize)}async*flush(t){for await(let e of dn(this._bucket,t,this,this.options))yield{...e,path:this.path}}},ln=Oe;async function*dn(r,t,e,n){let i=r._children,o=(r.tableSize()-1).toString(16).length,a=[],c=0n;for(let h=0;h<i.length;h++){let d=i.get(h);if(d==null)continue;let E=h.toString(16).toUpperCase().padStart(o,"0");if(d instanceof J){let u;for await(let p of dn(d,t,null,n))u=p;if(u==null)throw new Error("Could not flush sharded directory, no subshard found");a.push({Name:E,Tsize:Number(u.size),Hash:u.cid}),c+=u.size}else if(zo(d.value)){let u=d.value,p;for await(let w of u.flush(t))p=w,yield p;if(p==null)throw new Error("Did not flush dir");let m=E+d.key;a.push({Name:m,Tsize:Number(p.size),Hash:p.cid}),c+=p.size}else{let u=d.value;if(u.cid==null)continue;let p=E+d.key,m=u.size;a.push({Name:p,Tsize:Number(m),Hash:u.cid}),c+=BigInt(m??0)}}let l=Uint8Array.from(i.bitField().reverse()),x=new L({type:"hamt-sharded-directory",data:l,fanout:BigInt(r.tableSize()),hashType:un,mtime:e?.mtime,mode:e?.mode}),f={Data:x.marshal(),Links:a},y=C(z(f)),S=await V(y,t,n),s=BigInt(y.byteLength)+c;yield{cid:S,unixfs:x,size:s}}function zo(r){return typeof r.flush=="function"}function pn(r,t,e){let n=r._children,i=(r.tableSize()-1).toString(16).length,o=[];for(let x=0;x<n.length;x++){let f=n.get(x);if(f==null)continue;let y=x.toString(16).toUpperCase().padStart(i,"0");if(f instanceof J){let S=pn(f,null,e);o.push({Name:y,Tsize:Number(S),Hash:e.cidVersion===0?Nt:Tt})}else if(typeof f.value.flush=="function"){let s=f.value.nodeSize();o.push({Name:y+f.key,Tsize:Number(s),Hash:e.cidVersion===0?Nt:Tt})}else{let S=f.value;if(S.cid==null)continue;let s=y+f.key,h=S.size;o.push({Name:s,Tsize:Number(h),Hash:S.cid})}}let a=Uint8Array.from(n.bitField().reverse()),c=new L({type:"hamt-sharded-directory",data:a,fanout:BigInt(r.tableSize()),hashType:un,mtime:t?.mtime,mode:t?.mode});return C(z({Data:c.marshal(),Links:o})).length}async function Ge(r,t,e,n){let i=t;t instanceof tt&&t.estimateNodeSize()>e&&(i=await Co(t,n));let o=i.parent;if(o!=null){if(i!==t){if(r!=null&&(r.parent=i),i.parentKey==null)throw new Error("No parent key found");await o.put(i.parentKey,i)}return Ge(i,o,e,n)}return i}async function Co(r,t){let e=new ln({root:r.root,dir:!0,parent:r.parent,parentKey:r.parentKey,path:r.path,dirty:r.dirty,flat:!1,mtime:r.mtime,mode:r.mode},t);for(let{key:n,child:i}of r.eachChildSeries())await e.put(n,i);return e}var mn=(r="")=>r.split(/(?<!\\)\//).filter(Boolean);async function Fo(r,t,e){let n=mn(r.path??""),i=n.length-1,o=t,a="";for(let c=0;c<n.length;c++){let l=n[c];a+=`${a!==""?"/":""}${l}`;let x=c===i;if(o.dirty=!0,o.cid=void 0,o.size=void 0,x)await o.put(l,r),t=await Ge(null,o,e.shardSplitThresholdBytes,e);else{let f=await o.get(l);(f==null||!(f instanceof H))&&(f=new tt({root:!1,dir:!0,parent:o,parentKey:l,path:a,dirty:!0,flat:!0,mtime:f?.unixfs?.mtime,mode:f?.unixfs?.mode},e)),await o.put(l,f),o=f}}return t}async function*gn(r,t){if(!(r instanceof H)){r.unixfs?.isDirectory()===!0&&(yield r);return}yield*r.flush(t)}function wn(r){return async function*(e,n){let i=new tt({root:!0,dir:!0,path:"",dirty:!0,flat:!0},r),o,a=!1;for await(let c of e){if(c==null)continue;let l=`${c.originalPath??""}`.split("/")[0];l!=null&&l!==""&&(o==null?(o=l,a=!0):o!==l&&(a=!1)),i=await Fo(c,i,r),c.unixfs?.isDirectory()!==!0&&(yield c)}if(r.wrapWithDirectory||a&&i.childCount()>1)yield*gn(i,n);else for(let c of i.eachChildSeries())c!=null&&(yield*gn(c.child,n))}}async function*$e(r,t,e={}){let n;Symbol.asyncIterator in r||Symbol.iterator in r?n=r:n=[r];let i=e.wrapWithDirectory??!1,o=e.shardSplitThresholdBytes??262144,a=e.shardFanoutBits??8,c=e.cidVersion??1,l=e.rawLeaves??!0,x=e.leafType??"file",f=e.fileImportConcurrency??50,y=e.blockWriteConcurrency??10,S=e.reduceSingleLeafToSelf??!0,s=e.chunker??Ze(),h=e.chunkValidator??Qr(),d=e.dagBuilder??Zr({chunker:s,chunkValidator:h,wrapWithDirectory:i,layout:e.layout??He(),bufferImporter:e.bufferImporter??Kr({cidVersion:c,rawLeaves:l,leafType:x,onProgress:e.onProgress}),blockWriteConcurrency:y,reduceSingleLeafToSelf:S,cidVersion:c,onProgress:e.onProgress,dirBuilder:e.dirBuilder,fileBuilder:e.fileBuilder}),E=e.treeBuilder??wn({wrapWithDirectory:i,shardSplitThresholdBytes:o,shardFanoutBits:a,cidVersion:c,onProgress:e.onProgress});for await(let u of E(lt(d(n,t),f),t))yield{cid:u.cid,path:u.path,unixfs:u.unixfs,size:u.size}}async function qe(r,t,e={}){let n=await Zt($e([r],t,e));if(n==null)throw new ut("Nothing imported");return n}async function Po(r,t,e={}){let n=await Zt($e([r],t,e));if(n==null)throw new ut("Nothing imported");return n}async function Uo(r,t,e={}){return qe({content:r},t,e)}async function Mo(r,t,e={}){return qe({content:r},t,e)}return An(Vo);})();
return IpfsUnixfsImporter}));
//# sourceMappingURL=index.min.js.map
